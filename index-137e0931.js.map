{"version":3,"file":"index-137e0931.js","sources":["../src/enums/mode.ts","../src/utils/Env.ts","../node_modules/littlejsengine/build/littlejs.esm.js","../src/components/Paddle.ts","../src/components/Wall.ts","../src/constants/level.ts","../src/game/utils/Score.ts","../src/assets/bricks/tiles.png","../src/utils/Debug.ts","../node_modules/tiny-emitter/index.js","../src/utils/Emitter.ts","../src/enums/bonus.ts","../src/commands/bonus/BonusType.ts","../src/commands/bonus/ExtraBalls.ts","../src/commands/bonus/ExtraLife.ts","../src/commands/bonus/PaddleIncrease.ts","../src/commands/bonus/PaddleDecrease.ts","../src/commands/bonus/ExtraScore.ts","../src/commands/bonus/ExtraWall.ts","../src/commands/bonus/DoubleBalls.ts","../src/commands/bonus/TripleBalls.ts","../src/constants/color.ts","../src/components/Bonus.ts","../src/commands/BonusCommand.ts","../src/constants/sound.ts","../src/commands/stage/Levels.ts","../src/enums/brick.ts","../src/components/utils/RandomPicker.ts","../src/components/brick/Brick.ts","../src/components/brick/BrickUnbreakable.ts","../src/components/brick/BrickBreakable.ts","../src/commands/StageCommand.ts","../src/components/utils/Counter.ts","../src/components/utils/Lives.ts","../src/data-structures/LinkedList.ts","../src/constants/particle.ts","../src/components/utils/Strength.ts","../src/components/Ball.ts","../src/components/Balls.ts","../src/commands/mode/Mode.ts","../node_modules/@tweenjs/tween.js/dist/tween.esm.js","../src/commands/mode/DynamicMode.ts","../src/commands/mode/ClassicMode.ts","../src/commands/mode/BonusMode.ts","../src/commands/mode/ModernMode.ts","../src/commands/ModeCommand.ts","../src/game/Game.ts","../src/ui/lobby.ts","../src/main.ts"],"sourcesContent":["export enum EnvMode {\n  development = 'development',\n  production = 'production',\n  githubPages = 'github',\n  crazyGames = 'crazy',\n  itchIo = 'itch',\n  unitTest = 'test',\n  e2eTest = 'e2e',\n}\n\nexport enum GameMode {\n  Classic,\n  Dynamic,\n  Modern,\n  Bonus,\n}\n","import { EnvMode } from '/src/enums/mode';\n\nexport class Env {\n  constructor(readonly mode: string) {}\n\n  isDevelopment() {\n    return this.mode === EnvMode.development;\n  }\n\n  isCrazyGames() {\n    return this.mode === EnvMode.crazyGames;\n  }\n\n  isItchIo() {\n    return this.mode === EnvMode.itchIo;\n  }\n\n  isGithubPages() {\n    return this.mode === EnvMode.githubPages;\n  }\n\n  isUnitTest() {\n    return this.mode === EnvMode.unitTest;\n  }\n\n  isE2ETest() {\n    return this.mode === EnvMode.e2eTest;\n  }\n}\n\nexport default new Env(import.meta.env.MODE);\n","/*\r\n    LittleJS - Debug Build\r\n    MIT License - Copyright 2021 Frank Force\r\n*/\r\n\r\n/** \r\n * LittleJS Debug System\r\n * <br> - Press ~ to show debug overlay with mouse pick\r\n * <br> - Number keys toggle debug functions\r\n * <br> - +/- apply time scale\r\n * <br> - Debug primitive rendering\r\n * <br> - Save a 2d canvas as an image\r\n * @namespace Debug\r\n */\r\n\r\n'use strict';\r\n\r\n/** True if debug is enabled\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Debug */\r\nconst debug = 1;\r\n\r\n/** True if asserts are enaled\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Debug */\r\nconst enableAsserts = 1;\r\n\r\n/** Size to render debug points by default\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Debug */\r\nconst debugPointSize = .5;\r\n\r\n/** True if watermark with FPS should be shown, false in release builds\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Debug */\r\nlet showWatermark = 1;\r\n\r\n/** True if god mode is enabled, handle this however you want\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Debug */\r\nlet godMode = 0;\r\n\r\n/** Key code used to toggle debug mode, Esc by default\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Debug */\r\nlet debugKey = 27;\r\n\r\n// Engine internal variables not exposed to documentation\r\nlet debugPrimitives = [], debugOverlay = 0, debugPhysics = 0, debugRaycast = 0,\r\ndebugParticles = 0, debugGamepads = 0, debugMedals = 0, debugTakeScreenshot, downloadLink;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Debug helper functions\r\n\r\n/** Asserts if the experssion is false, does not do anything in release builds\r\n *  @param {Boolean} assertion\r\n *  @param {Object}  output\r\n *  @memberof Debug */\r\nconst ASSERT = enableAsserts ? (...assert)=> console.assert(...assert) : ()=>{};\r\n\r\n/** Draw a debug rectangle in world space\r\n *  @param {Vector2} pos\r\n *  @param {Vector2} [size=Vector2()]\r\n *  @param {String}  [color='#fff']\r\n *  @param {Number}  [time=0]\r\n *  @param {Number}  [angle=0]\r\n *  @param {Boolean} [fill=false]\r\n *  @memberof Debug */\r\nconst debugRect = (pos, size=vec2(), color='#fff', time=0, angle=0, fill=false)=> \r\n{\r\n    ASSERT(typeof color == 'string'); // pass in regular html strings as colors\r\n    debugPrimitives.push({pos, size:vec2(size), color, time:new Timer(time), angle, fill});\r\n}\r\n\r\n/** Draw a debug circle in world space\r\n *  @param {Vector2} pos\r\n *  @param {Number}  [radius=0]\r\n *  @param {String}  [color='#fff']\r\n *  @param {Number}  [time=0]\r\n *  @param {Boolean} [fill=false]\r\n *  @memberof Debug */\r\nconst debugCircle = (pos, radius=0, color='#fff', time=0, fill=false)=>\r\n{\r\n    ASSERT(typeof color == 'string'); // pass in regular html strings as colors\r\n    debugPrimitives.push({pos, size:radius, color, time:new Timer(time), angle:0, fill});\r\n}\r\n\r\n/** Draw a debug point in world space\r\n *  @param {Vector2} pos\r\n *  @param {String}  [color='#fff']\r\n *  @param {Number}  [time=0]\r\n *  @param {Number}  [angle=0]\r\n *  @memberof Debug */\r\nconst debugPoint = (pos, color, time, angle)=> debugRect(pos, 0, color, time, angle);\r\n\r\n/** Draw a debug line in world space\r\n *  @param {Vector2} posA\r\n *  @param {Vector2} posB\r\n *  @param {String}  [color='#fff']\r\n *  @param {Number}  [thickness=.1]\r\n *  @param {Number}  [time=0]\r\n *  @memberof Debug */\r\nconst debugLine = (posA, posB, color, thickness=.1, time)=>\r\n{\r\n    const halfDelta = vec2((posB.x - posA.x)/2, (posB.y - posA.y)/2);\r\n    const size = vec2(thickness, halfDelta.length()*2);\r\n    debugRect(posA.add(halfDelta), size, color, time, halfDelta.angle(), 1);\r\n}\r\n\r\n/** Draw a debug axis aligned bounding box in world space\r\n *  @param {Vector2} posA\r\n *  @param {Vector2} sizeA\r\n *  @param {Vector2} posB\r\n *  @param {Vector2} sizeB\r\n *  @param {String}  [color='#fff']\r\n *  @memberof Debug */\r\nconst debugAABB = (pA, sA, pB, sB, color)=>\r\n{\r\n    const minPos = vec2(min(pA.x - sA.x/2, pB.x - sB.x/2), min(pA.y - sA.y/2, pB.y - sB.y/2));\r\n    const maxPos = vec2(max(pA.x + sA.x/2, pB.x + sB.x/2), max(pA.y + sA.y/2, pB.y + sB.y/2));\r\n    debugRect(minPos.lerp(maxPos,.5), maxPos.subtract(minPos), color);\r\n}\r\n\r\n/** Draw a debug axis aligned bounding box in world space\r\n *  @param {String}  text\r\n *  @param {Vector2} pos\r\n *  @param {Number}  [size=1]\r\n *  @param {String}  [color='#fff']\r\n *  @param {Number}  [time=0]\r\n *  @param {Number}  [angle=0]\r\n *  @param {String}  [font='monospace']\r\n *  @memberof Debug */\r\nconst debugText = (text, pos, size=1, color='#fff', time=0, angle=0, font='monospace')=> \r\n{\r\n    ASSERT(typeof color == 'string'); // pass in regular html strings as colors\r\n    debugPrimitives.push({text, pos, size, color, time:new Timer(time), angle, font});\r\n}\r\n\r\n/** Clear all debug primitives in the list\r\n *  @memberof Debug */\r\nconst debugClear = ()=> debugPrimitives = [];\r\n\r\n/** Save a canvas to disk \r\n *  @param {HTMLCanvasElement} canvas\r\n *  @param {String}            [filename]\r\n *  @memberof Debug */\r\nconst debugSaveCanvas = (canvas, filename = engineName + '.png') =>\r\n{\r\n    downloadLink.download = 'screenshot.png';\r\n    downloadLink.href = canvas.toDataURL('image/png').replace('image/png','image/octet-stream');\r\n    downloadLink.click();\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Engine debug function (called automatically)\r\n\r\nconst debugInit = ()=>\r\n{\r\n    // create link for saving screenshots\r\n    document.body.appendChild(downloadLink = document.createElement('a'));\r\n    downloadLink.style.display = 'none';\r\n}\r\n\r\nconst debugUpdate = ()=>\r\n{\r\n    if (!debug)\r\n        return;\r\n\r\n    if (keyWasPressed(debugKey)) // Esc\r\n        debugOverlay = !debugOverlay;\r\n    if (debugOverlay)\r\n    {\r\n        if (keyWasPressed(48)) // 0\r\n            showWatermark = !showWatermark;\r\n        if (keyWasPressed(49)) // 1\r\n            debugPhysics = !debugPhysics, debugParticles = 0;\r\n        if (keyWasPressed(50)) // 2\r\n            debugParticles = !debugParticles, debugPhysics = 0;\r\n        if (keyWasPressed(51)) // 3\r\n            debugGamepads = !debugGamepads;\r\n        if (keyWasPressed(52)) // 4\r\n            godMode = !godMode;\r\n        if (keyWasPressed(53)) // 5\r\n            debugTakeScreenshot = 1;\r\n        //if (keyWasPressed(54)) // 6\r\n        //if (keyWasPressed(55)) // 7\r\n        //if (keyWasPressed(56)) // 8\r\n        //if (keyWasPressed(57)) // 9\r\n    }\r\n}\r\n\r\nconst debugRender = ()=>\r\n{\r\n    glCopyToContext(mainContext);\r\n\r\n    if (debugTakeScreenshot)\r\n    {\r\n        // composite canvas\r\n        glCopyToContext(mainContext, 1);\r\n        mainContext.drawImage(overlayCanvas, 0, 0);\r\n        overlayCanvas.width |= 0;\r\n\r\n        debugSaveCanvas(mainCanvas);\r\n        debugTakeScreenshot = 0;\r\n    }\r\n\r\n    if (debugGamepads && gamepadsEnable && navigator.getGamepads)\r\n    {\r\n        // gamepad debug display\r\n        const gamepads = navigator.getGamepads();\r\n        for (let i = gamepads.length; i--;)\r\n        {\r\n            const gamepad = gamepads[i];\r\n            if (gamepad)\r\n            {\r\n                const stickScale = 1;\r\n                const buttonScale = .2;\r\n                const centerPos = cameraPos;\r\n                const sticks = stickData[i];\r\n                for (let j = sticks.length; j--;)\r\n                {\r\n                    const drawPos = centerPos.add(vec2(j*stickScale*2, i*stickScale*3));\r\n                    const stickPos = drawPos.add(sticks[j].scale(stickScale));\r\n                    debugCircle(drawPos, stickScale, '#fff7',0,1);\r\n                    debugLine(drawPos, stickPos, '#f00');\r\n                    debugPoint(stickPos, '#f00');\r\n                }\r\n                for (let j = gamepad.buttons.length; j--;)\r\n                {\r\n                    const drawPos = centerPos.add(vec2(j*buttonScale*2, i*stickScale*3-stickScale-buttonScale));\r\n                    const pressed = gamepad.buttons[j].pressed;\r\n                    debugCircle(drawPos, buttonScale, pressed ? '#f00' : '#fff7', 0, 1);\r\n                    debugText(j, drawPos, .2);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (debugOverlay)\r\n    {\r\n        const saveContext = mainContext;\r\n        mainContext = overlayContext;\r\n\r\n        // mouse pick\r\n        let bestDistance = Infinity, bestObject;\r\n        for (const o of engineObjects)\r\n        {\r\n            if (o.canvas || o.destroyed)\r\n                continue;\r\n            if (!o.size.x || !o.size.y)\r\n                continue;\r\n\r\n            const distance = mousePos.distanceSquared(o.pos);\r\n            if (distance < bestDistance)\r\n            {\r\n                bestDistance = distance;\r\n                bestObject = o;\r\n            }\r\n\r\n            // show object info\r\n            const size = vec2(max(o.size.x, .2), max(o.size.y, .2));\r\n            const color1 = new Color(!!o.collideTiles, !!o.collideSolidObjects, !!o.isSolid, o.parent?.2:.5);\r\n            const color2 = o.parent ? new Color(1,1,1,.5) : new Color(0,0,0,.8);\r\n            drawRect(o.pos, size, color1, o.angle, 0);\r\n            drawRect(o.pos, size.scale(.8), color2, o.angle, 0);\r\n            o.parent && drawLine(o.pos, o.parent.pos, .1, new Color(0,0,1,.5), 0);\r\n        }\r\n        \r\n        if (bestObject)\r\n        {\r\n            const raycastHitPos = tileCollisionRaycast(bestObject.pos, mousePos);\r\n            raycastHitPos && drawRect(raycastHitPos.floor().add(vec2(.5)), vec2(1), new Color(0,1,1,.3));\r\n            drawRect(mousePos.floor().add(vec2(.5)), vec2(1), new Color(0,0,1,.5), 0, 0);\r\n            drawLine(mousePos, bestObject.pos, .1, raycastHitPos ? new Color(1,0,0,.5) : new Color(0,1,0,.5), 0);\r\n\r\n            const debugText = 'mouse pos = ' + mousePos + \r\n                '\\nmouse collision = ' + getTileCollisionData(mousePos) + \r\n                '\\n\\n--- object info ---\\n' +\r\n                bestObject.toString();\r\n            drawTextScreen(debugText, mousePosScreen, 24, new Color, .05, 0, 0, 'monospace');\r\n        }\r\n\r\n        glCopyToContext(mainContext = saveContext);\r\n    }\r\n\r\n    {\r\n        // draw debug primitives\r\n        overlayContext.lineWidth = 2;\r\n        const pointSize = debugPointSize * cameraScale;\r\n        debugPrimitives.forEach(p=>\r\n        {\r\n            overlayContext.save();\r\n\r\n            // create canvas transform from world space to screen space\r\n            const pos = worldToScreen(p.pos);\r\n            overlayContext.translate(pos.x|0, pos.y|0);\r\n            overlayContext.rotate(p.angle);\r\n            overlayContext.fillStyle = overlayContext.strokeStyle = p.color;\r\n\r\n            if (p.text != undefined)\r\n            {\r\n                overlayContext.font = p.size*cameraScale + 'px '+ p.font;\r\n                overlayContext.textAlign = 'center';\r\n                overlayContext.textBaseline = 'middle';\r\n                overlayContext.fillText(p.text, 0, 0);\r\n            }\r\n            else if (p.size == 0 || p.size.x === 0 && p.size.y === 0 )\r\n            {\r\n                // point\r\n                overlayContext.fillRect(-pointSize/2, -1, pointSize, 3);\r\n                overlayContext.fillRect(-1, -pointSize/2, 3, pointSize);\r\n            }\r\n            else if (p.size.x != undefined)\r\n            {\r\n                // rect\r\n                const w = p.size.x*cameraScale|0, h = p.size.y*cameraScale|0;\r\n                p.fill && overlayContext.fillRect(-w/2|0, -h/2|0, w, h);\r\n                overlayContext.strokeRect(-w/2|0, -h/2|0, w, h);\r\n            }\r\n            else\r\n            {\r\n                // circle\r\n                overlayContext.beginPath();\r\n                overlayContext.arc(0, 0, p.size*cameraScale, 0, 9);\r\n                p.fill && overlayContext.fill();\r\n                overlayContext.stroke();\r\n            }\r\n            \r\n            overlayContext.restore();\r\n        });\r\n\r\n        // remove expired pritives\r\n        debugPrimitives = debugPrimitives.filter(r=>r.time<0);\r\n    }\r\n\r\n    {\r\n        // draw debug overlay\r\n        overlayContext.save();\r\n        overlayContext.fillStyle = '#fff';\r\n        overlayContext.textAlign = 'left';\r\n        overlayContext.textBaseline = 'top';\r\n        overlayContext.font = '28px monospace';\r\n        overlayContext.shadowColor = '#000';\r\n        overlayContext.shadowBlur = 9;\r\n\r\n        let x = 9, y = -20, h = 30;\r\n        if (debugOverlay)\r\n        {\r\n            overlayContext.fillText(engineName, x, y += h);\r\n            overlayContext.fillText('Objects: ' + engineObjects.length, x, y += h);\r\n            overlayContext.fillText('Time: ' + formatTime(time), x, y += h);\r\n            overlayContext.fillText('---------', x, y += h);\r\n            overlayContext.fillStyle = '#f00';\r\n            overlayContext.fillText('ESC: Debug Overlay', x, y += h);\r\n            overlayContext.fillStyle = debugPhysics ? '#f00' : '#fff';\r\n            overlayContext.fillText('1: Debug Physics', x, y += h);\r\n            overlayContext.fillStyle = debugParticles ? '#f00' : '#fff';\r\n            overlayContext.fillText('2: Debug Particles', x, y += h);\r\n            overlayContext.fillStyle = debugGamepads ? '#f00' : '#fff';\r\n            overlayContext.fillText('3: Debug Gamepads', x, y += h);\r\n            overlayContext.fillStyle = godMode ? '#f00' : '#fff';\r\n            overlayContext.fillText('4: God Mode', x, y += h);\r\n            overlayContext.fillStyle = '#fff';\r\n            overlayContext.fillText('5: Save Screenshot', x, y += h);\r\n\r\n            let keysPressed = '';\r\n            for(const i in inputData[0])\r\n            {\r\n                if (i && keyIsDown(i, 0))\r\n                    keysPressed += i + ' ' ;\r\n            }\r\n            keysPressed && overlayContext.fillText('Keys Down: ' + keysPressed, x, y += h);\r\n\r\n            let buttonsPressed = '';\r\n            if (inputData[1])\r\n            for(const i in inputData[1])\r\n            {\r\n                if (i && keyIsDown(i, 1))\r\n                    buttonsPressed += i + ' ' ;\r\n            }\r\n            buttonsPressed && overlayContext.fillText('Gamepad: ' + buttonsPressed, x, y += h);\r\n        }\r\n        else\r\n        {\r\n            overlayContext.fillText(debugPhysics ? 'Debug Physics' : '', x, y += h);\r\n            overlayContext.fillText(debugParticles ? 'Debug Particles' : '', x, y += h);\r\n            overlayContext.fillText(godMode ? 'God Mode' : '', x, y += h);\r\n            overlayContext.fillText(debugGamepads ? 'Debug Gamepads' : '', x, y += h);\r\n        }\r\n    \r\n        overlayContext.restore();\r\n    }\r\n}\r\n/**\r\n * LittleJS Utility Classes and Functions\r\n * <br> - General purpose math library\r\n * <br> - Vector2 - fast, simple, easy 2D vector class\r\n * <br> - Color - holds a rgba color with some math functions\r\n * <br> - Timer - tracks time automatically\r\n * @namespace Utilities\r\n */\r\n\r\n'use strict';\r\n\r\n/** A shortcut to get Math.PI\r\n *  @type {Number}\r\n *  @default Math.PI\r\n *  @memberof Utilities */\r\nconst PI = Math.PI;\r\n\r\n/** Returns absoulte value of value passed in\r\n *  @param {Number} value\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst abs = (a)=> a < 0 ? -a : a;\r\n\r\n/** Returns lowest of two values passed in\r\n *  @param {Number} valueA\r\n *  @param {Number} valueB\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst min = (a, b)=> a < b ?  a : b;\r\n\r\n/** Returns highest of two values passed in\r\n *  @param {Number} valueA\r\n *  @param {Number} valueB\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst max = (a, b)=> a > b ?  a : b;\r\n\r\n/** Returns the sign of value passed in (also returns 1 if 0)\r\n *  @param {Number} value\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst sign = (a)=> a < 0 ? -1 : 1;\r\n\r\n/** Returns first parm modulo the second param, but adjusted so negative numbers work as expected\r\n *  @param {Number} dividend\r\n *  @param {Number} [divisor=1]\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst mod = (a, b=1)=> ((a % b) + b) % b;\r\n\r\n/** Clamps the value beween max and min\r\n *  @param {Number} value\r\n *  @param {Number} [min=0]\r\n *  @param {Number} [max=1]\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst clamp = (v, min=0, max=1)=> v < min ? min : v > max ? max : v;\r\n\r\n/** Returns what percentage the value is between max and min\r\n *  @param {Number} value\r\n *  @param {Number} [min=0]\r\n *  @param {Number} [max=1]\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst percent = (v, min=0, max=1)=> max-min ? clamp((v-min) / (max-min)) : 0;\r\n\r\n/** Linearly interpolates the percent value between max and min\r\n *  @param {Number} percent\r\n *  @param {Number} [min=0]\r\n *  @param {Number} [max=1]\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst lerp = (p, min=0, max=1)=> min + clamp(p) * (max-min);\r\n\r\n/** Applies smoothstep function to the percentage value\r\n *  @param {Number} value\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst smoothStep = (p)=> p * p * (3 - 2 * p);\r\n\r\n/** Returns the nearest power of two not less then the value\r\n *  @param {Number} value\r\n *  @return {Number}\r\n *  @memberof Utilities */\r\nconst nearestPowerOfTwo = (v)=> 2**Math.ceil(Math.log2(v));\r\n\r\n/** Returns true if two axis aligned bounding boxes are overlapping \r\n *  @param {Vector2} pointA  - Center of box A\r\n *  @param {Vector2} sizeA   - Size of box A\r\n *  @param {Vector2} pointB  - Center of box B\r\n *  @param {Vector2} [sizeB] - Size of box B\r\n *  @return {Boolean}        - True if overlapping\r\n *  @memberof Utilities */\r\nconst isOverlapping = (pA, sA, pB, sB)=> abs(pA.x - pB.x)*2 < sA.x + sB.x && abs(pA.y - pB.y)*2 < sA.y + sB.y;\r\n\r\n/** Returns an oscillating wave between 0 and amplitude with frequency of 1 Hz by default\r\n *  @param {Number} [frequency=1] - Frequency of the wave in Hz\r\n *  @param {Number} [amplitude=1] - Amplitude (max height) of the wave\r\n *  @param {Number} [t=time]      - Value to use for time of the wave\r\n *  @return {Number}              - Value waving between 0 and amplitude\r\n *  @memberof Utilities */\r\nconst wave = (frequency=1, amplitude=1, t=time)=> amplitude/2 * (1 - Math.cos(t*frequency*2*PI));\r\n\r\n/** Formats seconds to mm:ss style for display purposes \r\n *  @param {Number} t - time in seconds\r\n *  @return {String}\r\n *  @memberof Utilities */\r\nconst formatTime = (t)=> (t/60|0) + ':' + (t%60<10?'0':'') + (t%60|0);\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** Random global functions\r\n *  @namespace Random */\r\n\r\n/** Returns a random value between the two values passed in\r\n *  @param {Number} [valueA=1]\r\n *  @param {Number} [valueB=0]\r\n *  @return {Number}\r\n *  @memberof Random */\r\nconst rand = (a=1, b=0)=> b + (a-b)*Math.random();\r\n\r\n/** Returns a floored random value the two values passed in\r\n *  @param {Number} [valueA=1]\r\n *  @param {Number} [valueB=0]\r\n *  @return {Number}\r\n *  @memberof Random */\r\nconst randInt = (a=1, b=0)=> rand(a,b)|0;\r\n\r\n/** Randomly returns either -1 or 1\r\n *  @return {Number}\r\n *  @memberof Random */\r\nconst randSign = ()=> randInt(2) * 2 - 1;\r\n\r\n/** Returns a random Vector2 within a circular shape\r\n *  @param {Number} [radius=1]\r\n *  @param {Number} [minRadius=0]\r\n *  @return {Vector2}\r\n *  @memberof Random */\r\nconst randInCircle = (radius=1, minRadius=0)=> radius > 0 ? randVector(radius * rand(minRadius / radius, 1)**.5) : new Vector2;\r\n\r\n/** Returns a random Vector2 with the passed in length\r\n *  @param {Number} [length=1]\r\n *  @return {Vector2}\r\n *  @memberof Random */\r\nconst randVector = (length=1)=> new Vector2().setAngle(rand(2*PI), length);\r\n\r\n/** Returns a random color between the two passed in colors, combine components if linear\r\n *  @param {Color}   [colorA=Color()]\r\n *  @param {Color}   [colorB=Color(0,0,0,1)]\r\n *  @param {Boolean} [linear]\r\n *  @return {Color}\r\n *  @memberof Random */\r\nconst randColor = (cA = new Color, cB = new Color(0,0,0,1), linear)=>\r\n    linear ? cA.lerp(cB, rand()) : new Color(rand(cA.r,cB.r),rand(cA.g,cB.g),rand(cA.b,cB.b),rand(cA.a,cB.a));\r\n\r\n/** Seed used by the randSeeded function\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Random */\r\nlet randSeed = 1;\r\n\r\n/** Set seed used by the randSeeded function, should not be 0\r\n *  @param {Number} seed\r\n *  @memberof Random */\r\nconst setRandSeed = (seed)=> randSeed = seed;\r\n\r\n/** Returns a seeded random value between the two values passed in using randSeed\r\n *  @param {Number} [valueA=1]\r\n *  @param {Number} [valueB=0]\r\n *  @return {Number}\r\n *  @memberof Random */\r\nconst randSeeded = (a=1, b=0)=>\r\n{\r\n    randSeed ^= randSeed << 13; randSeed ^= randSeed >>> 17; randSeed ^= randSeed << 5; // xorshift\r\n    return b + (a-b) * abs(randSeed % 1e9) / 1e9;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** \r\n * Create a 2d vector, can take another Vector2 to copy, 2 scalars, or 1 scalar\r\n * @param {Number} [x=0]\r\n * @param {Number} [y=0]\r\n * @return {Vector2}\r\n * @example\r\n * let a = vec2(0, 1); // vector with coordinates (0, 1)\r\n * let b = vec2(a);    // copy a into b\r\n * a = vec2(5);        // set a to (5, 5)\r\n * b = vec2();         // set b to (0, 0)\r\n * @memberof Utilities\r\n */\r\nconst vec2 = (x=0, y)=> x.x == undefined ? new Vector2(x, y == undefined? x : y) : new Vector2(x.x, x.y);\r\n\r\n/** \r\n * Check if object is a valid Vector2\r\n * @param {Vector2} vector\r\n * @return {Boolean}\r\n * @memberof Utilities\r\n */\r\nconst isVector2 = (v)=> !isNaN(v.x) && !isNaN(v.y);\r\n\r\n/** \r\n * 2D Vector object with vector math library\r\n * <br> - Functions do not change this so they can be chained together\r\n * @example\r\n * let a = new Vector2(2, 3); // vector with coordinates (2, 3)\r\n * let b = new Vector2;       // vector with coordinates (0, 0)\r\n * let c = vec2(4, 2);        // use the vec2 function to make a Vector2\r\n * let d = a.add(b).scale(5); // operators can be chained\r\n */\r\nclass Vector2\r\n{\r\n    /** Create a 2D vector with the x and y passed in, can also be created with vec2()\r\n     *  @param {Number} [x=0] - X axis location\r\n     *  @param {Number} [y=0] - Y axis location */\r\n    constructor(x=0, y=0)\r\n    {\r\n        /** @property {Number} - X axis location */\r\n        this.x = x;\r\n        /** @property {Number} - Y axis location */\r\n        this.y = y;\r\n    }\r\n\r\n    /** Returns a new vector that is a copy of this\r\n     *  @return {Vector2} */\r\n    copy() { return new Vector2(this.x, this.y); }\r\n\r\n    /** Returns a copy of this vector plus the vector passed in\r\n     *  @param {Vector2} vector\r\n     *  @return {Vector2} */\r\n    add(v) { ASSERT(isVector2(v)); return new Vector2(this.x + v.x, this.y + v.y); }\r\n\r\n    /** Returns a copy of this vector minus the vector passed in\r\n     *  @param {Vector2} vector\r\n     *  @return {Vector2} */\r\n    subtract(v) { ASSERT(isVector2(v)); return new Vector2(this.x - v.x, this.y - v.y); }\r\n\r\n    /** Returns a copy of this vector times the vector passed in\r\n     *  @param {Vector2} vector\r\n     *  @return {Vector2} */\r\n    multiply(v) { ASSERT(isVector2(v)); return new Vector2(this.x * v.x, this.y * v.y); }\r\n\r\n    /** Returns a copy of this vector divided by the vector passed in\r\n     *  @param {Vector2} vector\r\n     *  @return {Vector2} */\r\n    divide(v) { ASSERT(isVector2(v)); return new Vector2(this.x / v.x, this.y / v.y); }\r\n\r\n    /** Returns a copy of this vector scaled by the vector passed in\r\n     *  @param {Number} scale\r\n     *  @return {Vector2} */\r\n    scale(s) { ASSERT(!isVector2(s)); return new Vector2(this.x * s, this.y * s); }\r\n\r\n    /** Returns the length of this vector\r\n     * @return {Number} */\r\n    length() { return this.lengthSquared()**.5; }\r\n\r\n    /** Returns the length of this vector squared\r\n     * @return {Number} */\r\n    lengthSquared() { return this.x**2 + this.y**2; }\r\n\r\n    /** Returns the distance from this vector to vector passed in\r\n     * @param {Vector2} vector\r\n     * @return {Number} */\r\n    distance(v) { return this.distanceSquared(v)**.5; }\r\n\r\n    /** Returns the distance squared from this vector to vector passed in\r\n     * @param {Vector2} vector\r\n     * @return {Number} */\r\n    distanceSquared(v) { return (this.x - v.x)**2 + (this.y - v.y)**2; }\r\n\r\n    /** Returns a new vector in same direction as this one with the length passed in\r\n     * @param {Number} [length=1]\r\n     * @return {Vector2} */\r\n    normalize(length=1) { const l = this.length(); return l ? this.scale(length/l) : new Vector2(0, length); }\r\n\r\n    /** Returns a new vector clamped to length passed in\r\n     * @param {Number} [length=1]\r\n     * @return {Vector2} */\r\n    clampLength(length=1) { const l = this.length(); return l > length ? this.scale(length/l) : this; }\r\n\r\n    /** Returns the dot product of this and the vector passed in\r\n     * @param {Vector2} vector\r\n     * @return {Number} */\r\n    dot(v) { ASSERT(isVector2(v)); return this.x*v.x + this.y*v.y; }\r\n\r\n    /** Returns the cross product of this and the vector passed in\r\n     * @param {Vector2} vector\r\n     * @return {Number} */\r\n    cross(v) { ASSERT(isVector2(v)); return this.x*v.y - this.y*v.x; }\r\n\r\n    /** Returns the angle of this vector, up is angle 0\r\n     * @return {Number} */\r\n    angle() { return Math.atan2(this.x, this.y); }\r\n\r\n    /** Sets this vector with angle and length passed in\r\n     * @param {Number} [angle=0]\r\n     * @param {Number} [length=1]\r\n     * @return {Vector2} */\r\n    setAngle(a=0, length=1) { this.x = length*Math.sin(a); this.y = length*Math.cos(a); return this; }\r\n\r\n    /** Returns copy of this vector rotated by the angle passed in\r\n     * @param {Number} angle\r\n     * @return {Vector2} */\r\n    rotate(a) { const c = Math.cos(a), s = Math.sin(a); return new Vector2(this.x*c-this.y*s, this.x*s+this.y*c); }\r\n\r\n    /** Returns the integer direction of this vector, corrosponding to multiples of 90 degree rotation (0-3)\r\n     * @return {Number} */\r\n    direction() { return abs(this.x) > abs(this.y) ? this.x < 0 ? 3 : 1 : this.y < 0 ? 2 : 0; }\r\n\r\n    /** Returns a copy of this vector that has been inverted\r\n     * @return {Vector2} */\r\n    invert() { return new Vector2(this.y, -this.x); }\r\n\r\n    /** Returns a copy of this vector with each axis floored\r\n     * @return {Vector2} */\r\n    floor() { return new Vector2(Math.floor(this.x), Math.floor(this.y)); }\r\n\r\n    /** Returns the area this vector covers as a rectangle\r\n     * @return {Number} */\r\n    area() { return abs(this.x * this.y); }\r\n\r\n    /** Returns a new vector that is p percent between this and the vector passed in\r\n     * @param {Vector2} vector\r\n     * @param {Number}  percent\r\n     * @return {Vector2} */\r\n    lerp(v, p) { ASSERT(isVector2(v)); return this.add(v.subtract(this).scale(clamp(p))); }\r\n\r\n    /** Returns true if this vector is within the bounds of an array size passed in\r\n     * @param {Vector2} arraySize\r\n     * @return {Boolean} */\r\n    arrayCheck(arraySize) { return this.x >= 0 && this.y >= 0 && this.x < arraySize.x && this.y < arraySize.y; }\r\n\r\n    /** Returns this vector expressed as a string\r\n     * @param {float} digits - precision to display\r\n     * @return {String} */\r\n    toString(digits=3) \r\n    { if (debug) { return `(${(this.x<0?'':' ') + this.x.toFixed(digits)},${(this.y<0?'':' ') + this.y.toFixed(digits)} )`; }}\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** \r\n * Create a color object with RGBA values\r\n * @param {Number} [r=1]\r\n * @param {Number} [g=1]\r\n * @param {Number} [b=1]\r\n * @param {Number} [a=1]\r\n * @return {Color}\r\n * @memberof Utilities\r\n */\r\nconst rgb = (r, g, b, a)=> new Color(r, g, b, a);\r\n\r\n/** \r\n * Create a color object with HSLA values\r\n * @param {Number} [h=0]\r\n * @param {Number} [s=0]\r\n * @param {Number} [l=1]\r\n * @param {Number} [a=1]\r\n * @return {Color}\r\n * @memberof Utilities\r\n */\r\nconst hsl = (h, s, l, a)=> new Color().setHSLA(h, s, l, a);\r\n\r\n/** \r\n * Color object (red, green, blue, alpha) with some helpful functions\r\n * @example\r\n * let a = new Color;              // white\r\n * let b = new Color(1, 0, 0);     // red\r\n * let c = new Color(0, 0, 0, 0);  // transparent black\r\n * let d = RGB(0, 0, 1);           // blue using rgb color\r\n * let e = HSL(.3, 1, .5);         // green using hsl color\r\n */\r\nclass Color\r\n{\r\n    /** Create a color with the components passed in, white by default\r\n     *  @param {Number} [red=1]\r\n     *  @param {Number} [green=1]\r\n     *  @param {Number} [blue=1]\r\n     *  @param {Number} [alpha=1] */\r\n    constructor(r=1, g=1, b=1, a=1)\r\n    {\r\n        /** @property {Number} - Red */\r\n        this.r = r;\r\n        /** @property {Number} - Green */\r\n        this.g = g;\r\n        /** @property {Number} - Blue */\r\n        this.b = b;\r\n        /** @property {Number} - Alpha */\r\n        this.a = a;\r\n    }\r\n\r\n    /** Returns a new color that is a copy of this\r\n     * @return {Color} */\r\n    copy() { return new Color(this.r, this.g, this.b, this.a); }\r\n\r\n    /** Returns a copy of this color plus the color passed in\r\n     * @param {Color} color\r\n     * @return {Color} */\r\n    add(c) { return new Color(this.r+c.r, this.g+c.g, this.b+c.b, this.a+c.a); }\r\n\r\n    /** Returns a copy of this color minus the color passed in\r\n     * @param {Color} color\r\n     * @return {Color} */\r\n    subtract(c) { return new Color(this.r-c.r, this.g-c.g, this.b-c.b, this.a-c.a); }\r\n\r\n    /** Returns a copy of this color times the color passed in\r\n     * @param {Color} color\r\n     * @return {Color} */\r\n    multiply(c) { return new Color(this.r*c.r, this.g*c.g, this.b*c.b, this.a*c.a); }\r\n\r\n    /** Returns a copy of this color divided by the color passed in\r\n     * @param {Color} color\r\n     * @return {Color} */\r\n    divide(c) { return new Color(this.r/c.r, this.g/c.g, this.b/c.b, this.a/c.a); }\r\n\r\n    /** Returns a copy of this color scaled by the value passed in, alpha can be scaled separately\r\n     * @param {Number} scale\r\n     * @param {Number} [alphaScale=scale]\r\n     * @return {Color} */\r\n    scale(s, a=s) { return new Color(this.r*s, this.g*s, this.b*s, this.a*a); }\r\n\r\n    /** Returns a copy of this color clamped to the valid range between 0 and 1\r\n     * @return {Color} */\r\n    clamp() { return new Color(clamp(this.r), clamp(this.g), clamp(this.b), clamp(this.a)); }\r\n\r\n    /** Returns a new color that is p percent between this and the color passed in\r\n     * @param {Color}  color\r\n     * @param {Number} percent\r\n     * @return {Color} */\r\n    lerp(c, p) { return this.add(c.subtract(this).scale(clamp(p))); }\r\n\r\n    /** Sets this color given a hue, saturation, lightness, and alpha\r\n     * @param {Number} [hue=0]\r\n     * @param {Number} [saturation=0]\r\n     * @param {Number} [lightness=1]\r\n     * @param {Number} [alpha=1]\r\n     * @return {Color} */\r\n    setHSLA(h=0, s=0, l=1, a=1)\r\n    {\r\n        const q = l < .5 ? l*(1+s) : l+s-l*s, p = 2*l-q,\r\n            f = (p, q, t)=>\r\n                (t = ((t%1)+1)%1) < 1/6 ? p+(q-p)*6*t :\r\n                t < 1/2 ? q :\r\n                t < 2/3 ? p+(q-p)*(2/3-t)*6 : p;\r\n                \r\n        this.r = f(p, q, h + 1/3);\r\n        this.g = f(p, q, h);\r\n        this.b = f(p, q, h - 1/3);\r\n        this.a = a;\r\n        return this;\r\n    }\r\n\r\n    /** Returns this color expressed in hsla format\r\n     * @return {Array} */\r\n    getHSLA()\r\n    {\r\n        const r = clamp(this.r);\r\n        const g = clamp(this.g);\r\n        const b = clamp(this.b);\r\n        const a = clamp(this.a);\r\n        const max = Math.max(r, g, b);\r\n        const min = Math.min(r, g, b);\r\n        const l = (max + min) / 2;\r\n        \r\n        let h = 0, s = 0;\r\n        if (max != min)\r\n        {\r\n            let d = max - min;\r\n            s = l > .5 ? d / (2 - max - min) : d / (max + min);\r\n            if (r == max)\r\n                h = (g - b) / d + (g < b ? 6 : 0);\r\n            else if (g == max)\r\n                h = (b - r) / d + 2;\r\n            else if (b == max)\r\n                h =  (r - g) / d + 4;\r\n        }\r\n\r\n        return [h / 6, s, l, a];\r\n    }\r\n\r\n    /** Returns a new color that has each component randomly adjusted\r\n     * @param {Number} [amount=.05]\r\n     * @param {Number} [alphaAmount=0]\r\n     * @return {Color} */\r\n    mutate(amount=.05, alphaAmount=0) \r\n    {\r\n        return new Color\r\n        (\r\n            this.r + rand(amount, -amount),\r\n            this.g + rand(amount, -amount),\r\n            this.b + rand(amount, -amount),\r\n            this.a + rand(alphaAmount, -alphaAmount)\r\n        ).clamp();\r\n    }\r\n\r\n    /** Returns this color expressed as a hex color code\r\n     * @param {Boolean} [useAlpha=1] - if alpha should be included in result\r\n     * @return {String} */\r\n    toString(useAlpha = 1)      \r\n    { \r\n        const toHex = (c)=> ((c=c*255|0)<16 ? '0' : '') + c.toString(16);\r\n        return '#' + toHex(this.r) + toHex(this.g) + toHex(this.b) + (useAlpha ? toHex(this.a) : '');\r\n    }\r\n\r\n    /** Set this color from a hex code\r\n     * @param {String} hex - html hex code\r\n     * @return {Color} */\r\n    setHex(hex)\r\n    {\r\n        const fromHex = (c)=> clamp(parseInt(hex.slice(c,c+2),16)/255);\r\n        this.r = fromHex(1);\r\n        this.g = fromHex(3),\r\n        this.b = fromHex(5);\r\n        this.a = hex.length > 7 ? fromHex(7) : 1;\r\n        return this;\r\n    }\r\n    \r\n    /** Returns this color expressed as 32 bit RGBA value\r\n     * @return {Number} */\r\n    rgbaInt()  \r\n    {\r\n        const toByte = (c)=> clamp(c)*255|0;\r\n        const r = toByte(this.r);\r\n        const g = toByte(this.g)<<8;\r\n        const b = toByte(this.b)<<16;\r\n        const a = toByte(this.a)<<24;\r\n        return r + g + b + a;\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/**\r\n * Timer object tracks how long has passed since it was set\r\n * @example\r\n * let a = new Timer;    // creates a timer that is not set\r\n * a.set(3);             // sets the timer to 3 seconds\r\n *\r\n * let b = new Timer(1); // creates a timer with 1 second left\r\n * b.unset();            // unsets the timer\r\n */\r\nclass Timer\r\n{\r\n    /** Create a timer object set time passed in\r\n     *  @param {Number} [timeLeft] - How much time left before the timer elapses in seconds */\r\n    constructor(timeLeft) { this.time = timeLeft == undefined ? undefined : time + timeLeft; this.setTime = timeLeft; }\r\n\r\n    /** Set the timer with seconds passed in\r\n     *  @param {Number} [timeLeft=0] - How much time left before the timer is elapsed in seconds */\r\n    set(timeLeft=0) { this.time = time + timeLeft; this.setTime = timeLeft; }\r\n\r\n    /** Unset the timer */\r\n    unset() { this.time = undefined; }\r\n\r\n    /** Returns true if set\r\n     * @return {Boolean} */\r\n    isSet() { return this.time != undefined; }\r\n\r\n    /** Returns true if set and has not elapsed\r\n     * @return {Boolean} */\r\n    active() { return time <= this.time; }\r\n\r\n    /** Returns true if set and elapsed\r\n     * @return {Boolean} */\r\n    elapsed() { return time > this.time; }\r\n\r\n    /** Get how long since elapsed, returns 0 if not set (returns negative if currently active)\r\n     * @return {Number} */\r\n    get() { return this.isSet()? time - this.time : 0; }\r\n\r\n    /** Get percentage elapsed based on time it was set to, returns 0 if not set\r\n     * @return {Number} */\r\n    getPercent() { return this.isSet()? percent(this.time - time, this.setTime, 0) : 0; }\r\n    \r\n    /** Returns this timer expressed as a string\r\n     * @return {String} */\r\n    toString() { if (debug) { return this.unset() ? 'unset' : Math.abs(this.get()) + ' seconds ' + (this.get()<0 ? 'before' : 'after' ); }}\r\n    \r\n    /** Get how long since elapsed, returns 0 if not set (returns negative if currently active)\r\n     * @return {Number} */\r\n    valueOf()               { return this.get(); }\r\n}\r\n/**\r\n * LittleJS Engine Settings\r\n * @namespace Settings\r\n */\r\n\r\n'use strict';\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Camera settings\r\n\r\n/** Position of camera in world space\r\n *  @type {Vector2}\r\n *  @default Vector2()\r\n *  @memberof Settings */\r\nlet cameraPos = vec2();\r\n\r\n/** Scale of camera in world space\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet cameraScale = 32;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Display settings\r\n\r\n/** The max size of the canvas, centered if window is larger\r\n *  @type {Vector2}\r\n *  @default Vector2(1920,1200)\r\n *  @memberof Settings */\r\nlet canvasMaxSize = vec2(1920, 1200);\r\n\r\n/** Fixed size of the canvas, if enabled canvas size never changes\r\n * - you may also need to set mainCanvasSize if using screen space coords in startup\r\n *  @type {Vector2}\r\n *  @default Vector2()\r\n *  @memberof Settings */\r\nlet canvasFixedSize = vec2();\r\n\r\n/** Disables anti aliasing for pixel art if true\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet cavasPixelated = 1;\r\n\r\n/** Default font used for text rendering\r\n *  @type {String}\r\n *  @default\r\n *  @memberof Settings */\r\nlet fontDefault = 'arial';\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// WebGL settings\r\n\r\n/** Enable webgl rendering, webgl can be disabled and removed from build (with some features disabled)\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet glEnable = 1;\r\n\r\n/** Fixes slow rendering in some browsers by not compositing the WebGL canvas\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet glOverlay = 1;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Tile sheet settings\r\n\r\n/** Default size of tiles in pixels\r\n *  @type {Vector2}\r\n *  @default Vector2(16,16)\r\n *  @memberof Settings */\r\nlet tileSizeDefault = vec2(16);\r\n\r\n/** Prevent tile bleeding from neighbors in pixels\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet tileFixBleedScale = .3;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Object settings\r\n\r\n/** Enable physics solver for collisions between objects\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet enablePhysicsSolver = 1;\r\n\r\n/** Default object mass for collison calcuations (how heavy objects are)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet objectDefaultMass = 1;\r\n\r\n/** How much to slow velocity by each frame (0-1)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet objectDefaultDamping = 1;\r\n\r\n/** How much to slow angular velocity each frame (0-1)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet objectDefaultAngleDamping = 1;\r\n\r\n/** How much to bounce when a collision occurs (0-1)\r\n *  @type {Number}\r\n *  @default 0\r\n *  @memberof Settings */\r\nlet objectDefaultElasticity = 0;\r\n\r\n/** How much to slow when touching (0-1)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet objectDefaultFriction = .8;\r\n\r\n/** Clamp max speed to avoid fast objects missing collisions\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet objectMaxSpeed = 1;\r\n\r\n/** How much gravity to apply to objects along the Y axis, negative is down\r\n *  @type {Number}\r\n *  @default 0\r\n *  @memberof Settings */\r\nlet gravity = 0;\r\n\r\n/** Scales emit rate of particles, useful for low graphics mode (0 disables particle emitters)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet particleEmitRateScale = 1;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Input settings\r\n\r\n/** Should gamepads be allowed\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet gamepadsEnable = 1;\r\n\r\n/** If true, the dpad input is also routed to the left analog stick (for better accessability)\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet gamepadDirectionEmulateStick = 1;\r\n\r\n/** If true the WASD keys are also routed to the direction keys (for better accessability)\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet inputWASDEmulateDirection = 1;\r\n\r\n/** True if touch gamepad should appear on mobile devices\r\n *  <br> - Supports left analog stick, 4 face buttons and start button (button 9)\r\n *  <br> - Must be set by end of gameInit to be activated\r\n *  @type {Boolean}\r\n *  @default 0\r\n *  @memberof Settings */\r\nlet touchGamepadEnable = 0;\r\n\r\n/** True if touch gamepad should be analog stick or false to use if 8 way dpad\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet touchGamepadAnalog = 1;\r\n\r\n/** Size of virutal gamepad for touch devices in pixels\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet touchGamepadSize = 99;\r\n\r\n/** Transparency of touch gamepad overlay\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet touchGamepadAlpha = .3;\r\n\r\n/** Allow vibration hardware if it exists\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet vibrateEnable = 1;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Audio settings\r\n\r\n/** All audio code can be disabled and removed from build\r\n *  @type {Boolean}\r\n *  @default\r\n *  @memberof Settings */\r\nlet soundEnable = 1;\r\n\r\n/** Volume scale to apply to all sound, music and speech\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet soundVolume = .5;\r\n\r\n/** Default range where sound no longer plays\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet soundDefaultRange = 40;\r\n\r\n/** Default range percent to start tapering off sound (0-1)\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet soundDefaultTaper = .7;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Medals settings\r\n\r\n/** How long to show medals for in seconds\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet medalDisplayTime = 5;\r\n\r\n/** How quickly to slide on/off medals in seconds\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet medalDisplaySlideTime = .5;\r\n\r\n/** Size of medal display\r\n *  @type {Vector2}\r\n *  @default Vector2(640,80)\r\n *  @memberof Settings */\r\nlet medalDisplaySize = vec2(640, 80);\r\n\r\n/** Size of icon in medal display\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Settings */\r\nlet medalDisplayIconSize = 50;\r\n\r\n/** Set to stop medals from being unlockable (like if cheats are enabled)\r\n *  @type {Boolean}\r\n *  @default 0\r\n *  @memberof Settings */\r\nlet medalsPreventUnlock;\r\n/*\r\n    LittleJS Object System\r\n*/\r\n\r\n'use strict';\r\n\r\n/** \r\n * LittleJS Object Base Object Class\r\n * <br> - Base object class used by the engine\r\n * <br> - Automatically adds self to object list\r\n * <br> - Will be updated and rendered each frame\r\n * <br> - Renders as a sprite from a tilesheet by default\r\n * <br> - Can have color and addtive color applied\r\n * <br> - 2d Physics and collision system\r\n * <br> - Sorted by renderOrder\r\n * <br> - Objects can have children attached\r\n * <br> - Parents are updated before children, and set child transform\r\n * <br> - Call destroy() to get rid of objects\r\n * <br>\r\n * <br>The physics system used by objects is simple and fast with some caveats...\r\n * <br> - Collision uses the axis aligned size, the object's rotation angle is only for rendering\r\n * <br> - Objects are guaranteed to not intersect tile collision from physics\r\n * <br> - If an object starts or is moved inside tile collision, it will not collide with that tile\r\n * <br> - Collision for objects can be set to be solid to block other objects\r\n * <br> - Objects may get pushed into overlapping other solid objects, if so they will push away\r\n * <br> - Solid objects are more performance intensive and should be used sparingly\r\n * @example\r\n * // create an engine object, normally you would first extend the class with your own\r\n * const pos = vec2(2,3);\r\n * const object = new EngineObject(pos); \r\n */\r\nclass EngineObject\r\n{\r\n    /** Create an engine object and adds it to the list of objects\r\n     *  @param {Vector2} [position=Vector2()]        - World space position of the object\r\n     *  @param {Vector2} [size=Vector2(1,1)]         - World space size of the object\r\n     *  @param {Number}  [tileIndex=-1]              - Tile to use to render object (-1 is untextured)\r\n     *  @param {Vector2} [tileSize=tileSizeDefault]  - Size of tile in source pixels\r\n     *  @param {Number}  [angle=0]                   - Angle the object is rotated by\r\n     *  @param {Color}   [color=Color()]             - Color to apply to tile when rendered\r\n     *  @param {Number}  [renderOrder=0]             - Objects sorted by renderOrder before being rendered\r\n     */\r\n    constructor(pos=vec2(), size=vec2(1), tileIndex=-1, tileSize=tileSizeDefault, angle=0, color, renderOrder=0)\r\n    {\r\n        // set passed in params\r\n        ASSERT(isVector2(pos) && isVector2(size)); // ensure pos and size are vec2s\r\n\r\n        /** @property {Vector2} - World space position of the object */\r\n        this.pos = pos.copy();\r\n        /** @property {Vector2} - World space width and height of the object */\r\n        this.size = size;\r\n        /** @property {Vector2} - Size of object used for drawing, uses size if not set */\r\n        this.drawSize;\r\n        /** @property {Number}  - Tile to use to render object (-1 is untextured) */\r\n        this.tileIndex = tileIndex;\r\n        /** @property {Vector2} - Size of tile in source pixels */\r\n        this.tileSize = tileSize;\r\n        /** @property {Number}  - Angle to rotate the object */\r\n        this.angle = angle;\r\n        /** @property {Color}   - Color to apply when rendered */\r\n        this.color = color;\r\n        /** @property {Color}   - Additive color to apply when rendered */\r\n        this.additiveColor;\r\n\r\n        // set object defaults\r\n        /** @property {Number} [mass=objectDefaultMass]                 - How heavy the object is, static if 0 */\r\n        this.mass         = objectDefaultMass;\r\n        /** @property {Number} [damping=objectDefaultDamping]           - How much to slow down velocity each frame (0-1) */\r\n        this.damping      = objectDefaultDamping;\r\n        /** @property {Number} [angleDamping=objectDefaultAngleDamping] - How much to slow down rotation each frame (0-1) */\r\n        this.angleDamping = objectDefaultAngleDamping;\r\n        /** @property {Number} [elasticity=objectDefaultElasticity]     - How bouncy the object is when colliding (0-1) */\r\n        this.elasticity   = objectDefaultElasticity;\r\n        /** @property {Number} [friction=objectDefaultFriction]         - How much friction to apply when sliding (0-1) */\r\n        this.friction     = objectDefaultFriction;\r\n        /** @property {Number} [gravityScale=1]                         - How much to scale gravity by for this object */\r\n        this.gravityScale = 1;\r\n        /** @property {Number} [renderOrder=0]                          - Objects are sorted by render order */\r\n        this.renderOrder = renderOrder;\r\n        /** @property {Vector2} [velocity=Vector2()]                    - Velocity of the object */\r\n        this.velocity = new Vector2();\r\n        /** @property {Number} [angleVelocity=0]                        - Angular velocity of the object */\r\n        this.angleVelocity = 0;\r\n\r\n        // init other internal object stuff\r\n        this.spawnTime = time;\r\n        this.children = [];\r\n        this.collideTiles = 1;\r\n\r\n        // add to list of objects\r\n        engineObjects.push(this);\r\n    }\r\n    \r\n    /** Update the object transform and physics, called automatically by engine once each frame */\r\n    update()\r\n    {\r\n        const parent = this.parent;\r\n        if (parent)\r\n        {\r\n            // copy parent pos/angle\r\n            this.pos = this.localPos.multiply(vec2(parent.getMirrorSign(),1)).rotate(-parent.angle).add(parent.pos);\r\n            this.angle = parent.getMirrorSign()*this.localAngle + parent.angle;\r\n            return;\r\n        }\r\n\r\n        // limit max speed to prevent missing collisions\r\n        this.velocity.x = clamp(this.velocity.x, -objectMaxSpeed, objectMaxSpeed);\r\n        this.velocity.y = clamp(this.velocity.y, -objectMaxSpeed, objectMaxSpeed);\r\n\r\n        // apply physics\r\n        const oldPos = this.pos.copy();\r\n        this.velocity.y += gravity * this.gravityScale;\r\n        this.pos.x += this.velocity.x *= this.damping;\r\n        this.pos.y += this.velocity.y *= this.damping;\r\n        this.angle += this.angleVelocity *= this.angleDamping;\r\n\r\n        // physics sanity checks\r\n        ASSERT(this.angleDamping >= 0 && this.angleDamping <= 1);\r\n        ASSERT(this.damping >= 0 && this.damping <= 1);\r\n\r\n        if (!enablePhysicsSolver || !this.mass) // do not update collision for fixed objects\r\n            return;\r\n\r\n        const wasMovingDown = this.velocity.y < 0;\r\n        if (this.groundObject)\r\n        {\r\n            // apply friction in local space of ground object\r\n            const groundSpeed = this.groundObject.velocity ? this.groundObject.velocity.x : 0;\r\n            this.velocity.x = groundSpeed + (this.velocity.x - groundSpeed) * this.friction;\r\n            this.groundObject = 0;\r\n            //debugOverlay && debugPhysics && debugPoint(this.pos.subtract(vec2(0,this.size.y/2)), '#0f0');\r\n        }\r\n\r\n        if (this.collideSolidObjects)\r\n        {\r\n            // check collisions against solid objects\r\n            const epsilon = .001; // necessary to push slightly outside of the collision\r\n            for (const o of engineObjectsCollide)\r\n            {\r\n                // non solid objects don't collide with eachother\r\n                if (!this.isSolid & !o.isSolid || o.destroyed || o.parent || o == this)\r\n                    continue;\r\n\r\n                // check collision\r\n                if (!isOverlapping(this.pos, this.size, o.pos, o.size))\r\n                    continue;\r\n\r\n                // pass collision to objects\r\n                if (!this.collideWithObject(o) | !o.collideWithObject(this))\r\n                    continue;\r\n\r\n                if (isOverlapping(oldPos, this.size, o.pos, o.size))\r\n                {\r\n                    // if already was touching, try to push away\r\n                    const deltaPos = oldPos.subtract(o.pos);\r\n                    const length = deltaPos.length();\r\n                    const pushAwayAccel = .001; // push away if already overlapping\r\n                    const velocity = length < .01 ? randVector(pushAwayAccel) : deltaPos.scale(pushAwayAccel/length);\r\n                    this.velocity = this.velocity.add(velocity);\r\n                    if (o.mass) // push away if not fixed\r\n                        o.velocity = o.velocity.subtract(velocity);\r\n                        \r\n                    debugOverlay && debugPhysics && debugAABB(this.pos, this.size, o.pos, o.size, '#f00');\r\n                    continue;\r\n                }\r\n\r\n                // check for collision\r\n                const sizeBoth = this.size.add(o.size);\r\n                const smallStepUp = (oldPos.y - o.pos.y)*2 > sizeBoth.y + gravity; // prefer to push up if small delta\r\n                const isBlockedX = abs(oldPos.y - o.pos.y)*2 < sizeBoth.y;\r\n                const isBlockedY = abs(oldPos.x - o.pos.x)*2 < sizeBoth.x;\r\n                const elasticity = max(this.elasticity, o.elasticity);\r\n                \r\n                if (smallStepUp | isBlockedY | !isBlockedX) // resolve y collision\r\n                {\r\n                    // push outside object collision\r\n                    this.pos.y = o.pos.y + (sizeBoth.y/2 + epsilon) * sign(oldPos.y - o.pos.y);\r\n                    if (o.groundObject && wasMovingDown || !o.mass)\r\n                    {\r\n                        // set ground object if landed on something\r\n                        if (wasMovingDown)\r\n                            this.groundObject = o;\r\n\r\n                        // bounce if other object is fixed or grounded\r\n                        this.velocity.y *= -elasticity;\r\n                    }\r\n                    else if (o.mass)\r\n                    {\r\n                        // inelastic collision\r\n                        const inelastic = (this.mass * this.velocity.y + o.mass * o.velocity.y) / (this.mass + o.mass);\r\n\r\n                        // elastic collision\r\n                        const elastic0 = this.velocity.y * (this.mass - o.mass) / (this.mass + o.mass)\r\n                            + o.velocity.y * 2 * o.mass / (this.mass + o.mass);\r\n                        const elastic1 = o.velocity.y * (o.mass - this.mass) / (this.mass + o.mass)\r\n                            + this.velocity.y * 2 * this.mass / (this.mass + o.mass);\r\n\r\n                        // lerp betwen elastic or inelastic based on elasticity\r\n                        this.velocity.y = lerp(elasticity, inelastic, elastic0);\r\n                        o.velocity.y = lerp(elasticity, inelastic, elastic1);\r\n                    }\r\n                }\r\n                if (!smallStepUp & isBlockedX) // resolve x collision\r\n                {\r\n                    // push outside collision\r\n                    this.pos.x = o.pos.x + (sizeBoth.x/2 + epsilon) * sign(oldPos.x - o.pos.x);\r\n                    if (o.mass)\r\n                    {\r\n                        // inelastic collision\r\n                        const inelastic = (this.mass * this.velocity.x + o.mass * o.velocity.x) / (this.mass + o.mass);\r\n\r\n                        // elastic collision\r\n                        const elastic0 = this.velocity.x * (this.mass - o.mass) / (this.mass + o.mass)\r\n                            + o.velocity.x * 2 * o.mass / (this.mass + o.mass);\r\n                        const elastic1 = o.velocity.x * (o.mass - this.mass) / (this.mass + o.mass)\r\n                            + this.velocity.x * 2 * this.mass / (this.mass + o.mass);\r\n\r\n                        // lerp betwen elastic or inelastic based on elasticity\r\n                        this.velocity.x = lerp(elasticity, inelastic, elastic0);\r\n                        o.velocity.x = lerp(elasticity, inelastic, elastic1);\r\n                    }\r\n                    else // bounce if other object is fixed\r\n                        this.velocity.x *= -elasticity;\r\n                }\r\n                debugOverlay && debugPhysics && debugAABB(this.pos, this.size, o.pos, o.size, '#f0f');\r\n            }\r\n        }\r\n        if (this.collideTiles)\r\n        {\r\n            // check collision against tiles\r\n            if (tileCollisionTest(this.pos, this.size, this))\r\n            {\r\n                // if already was stuck in collision, don't do anything\r\n                // this should not happen unless something starts in collision\r\n                if (!tileCollisionTest(oldPos, this.size, this))\r\n                {\r\n                    // test which side we bounced off (or both if a corner)\r\n                    const isBlockedY = tileCollisionTest(new Vector2(oldPos.x, this.pos.y), this.size, this);\r\n                    const isBlockedX = tileCollisionTest(new Vector2(this.pos.x, oldPos.y), this.size, this);\r\n                    if (isBlockedY | !isBlockedX)\r\n                    {\r\n                        // set if landed on ground\r\n                        this.groundObject = wasMovingDown;\r\n\r\n                        // bounce velocity\r\n                        this.velocity.y *= -this.elasticity;\r\n\r\n                        // adjust next velocity to settle on ground\r\n                        const o = (oldPos.y - this.size.y/2|0) - (oldPos.y - this.size.y/2);\r\n                        if (o < 0 && o > this.damping * this.velocity.y + gravity * this.gravityScale) \r\n                            this.velocity.y = this.damping ? (o - gravity * this.gravityScale) / this.damping : 0;\r\n\r\n                        // move to previous position\r\n                        this.pos.y = oldPos.y;\r\n                    }\r\n                    if (isBlockedX)\r\n                    {\r\n                        // move to previous position and bounce\r\n                        this.pos.x = oldPos.x;\r\n                        this.velocity.x *= -this.elasticity;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n       \r\n    /** Render the object, draws a tile by default, automatically called each frame, sorted by renderOrder */\r\n    render()\r\n    {\r\n        // default object render\r\n        drawTile(this.pos, this.drawSize || this.size, this.tileIndex, this.tileSize, this.color, this.angle, this.mirror, this.additiveColor);\r\n    }\r\n    \r\n    /** Destroy this object, destroy it's children, detach it's parent, and mark it for removal */\r\n    destroy()             \r\n    { \r\n        if (this.destroyed)\r\n            return;\r\n        \r\n        // disconnect from parent and destroy chidren\r\n        this.destroyed = 1;\r\n        this.parent && this.parent.removeChild(this);\r\n        for (const child of this.children)\r\n            child.destroy(child.parent = 0);\r\n    }\r\n    \r\n    /** Called to check if a tile collision should be resolved\r\n     *  @param {Number}  tileData - the value of the tile at the position\r\n     *  @param {Vector2} pos      - tile where the collision occured\r\n     *  @return {Boolean}         - true if the collision should be resolved */\r\n    collideWithTile(tileData, pos)        { return tileData > 0; }\r\n    \r\n    /** Called to check if a tile raycast hit\r\n     *  @param {Number}  tileData - the value of the tile at the position\r\n     *  @param {Vector2} pos      - tile where the raycast is\r\n     *  @return {Boolean}         - true if the raycast should hit */\r\n    collideWithTileRaycast(tileData, pos) { return tileData > 0; }\r\n\r\n    /** Called to check if a object collision should be resolved\r\n     *  @param {EngineObject} object - the object to test against\r\n     *  @return {Boolean}            - true if the collision should be resolved\r\n     */\r\n    collideWithObject(o)              { return 1; }\r\n\r\n    /** How long since the object was created\r\n     *  @return {Number} */\r\n    getAliveTime()                    { return time - this.spawnTime; }\r\n\r\n    /** Apply acceleration to this object (adjust velocity, not affected by mass)\r\n     *  @param {Vector2} acceleration */\r\n    applyAcceleration(a)              { if (this.mass) this.velocity = this.velocity.add(a); }\r\n\r\n    /** Apply force to this object (adjust velocity, affected by mass)\r\n     *  @param {Vector2} force */\r\n    applyForce(force)\t              { this.applyAcceleration(force.scale(1/this.mass)); }\r\n    \r\n    /** Get the direction of the mirror\r\n     *  @return {Number} -1 if this.mirror is true, or 1 if not mirrored */\r\n    getMirrorSign() { return this.mirror ? -1 : 1; }\r\n\r\n    /** Attaches a child to this with a given local transform\r\n     *  @param {EngineObject} child\r\n     *  @param {Vector2}      [localPos=Vector2()]\r\n     *  @param {Number}       [localAngle=0] */\r\n    addChild(child, localPos=vec2(), localAngle=0)\r\n    {\r\n        ASSERT(!child.parent && !this.children.includes(child));\r\n        this.children.push(child);\r\n        child.parent = this;\r\n        child.localPos = localPos.copy();\r\n        child.localAngle = localAngle;\r\n    }\r\n\r\n    /** Removes a child from this one\r\n     *  @param {EngineObject} child */\r\n    removeChild(child)\r\n    {\r\n        ASSERT(child.parent == this && this.children.includes(child));\r\n        this.children.splice(this.children.indexOf(child), 1);\r\n        child.parent = 0;\r\n    }\r\n\r\n    /** Set how this object collides\r\n     *  @param {Boolean} [collideSolidObjects=1] - Does it collide with solid objects\r\n     *  @param {Boolean} [isSolid=1]             - Does it collide with and block other objects (expensive in large numbers)\r\n     *  @param {Boolean} [collideTiles=1]        - Does it collide with the tile collision */\r\n    setCollision(collideSolidObjects=1, isSolid=1, collideTiles=1)\r\n    {\r\n        ASSERT(collideSolidObjects || !isSolid); // solid objects must be set to collide\r\n\r\n        this.collideSolidObjects = collideSolidObjects;\r\n        this.isSolid = isSolid;\r\n        this.collideTiles = collideTiles;\r\n    }\r\n\r\n    /** Returns string containg info about this object for debugging\r\n     *  @return {String} */\r\n    toString()\r\n    {\r\n        if (debug)\r\n        {\r\n            let text = 'type = ' + this.constructor.name;\r\n            if (this.pos.x || this.pos.y)\r\n                text += '\\npos = ' + this.pos;\r\n            if (this.velocity.x || this.velocity.y)\r\n                text += '\\nvelocity = ' + this.velocity;\r\n            if (this.size.x || this.size.y)\r\n                text += '\\nsize = ' + this.size;\r\n            if (this.angle)\r\n                text += '\\nangle = ' + this.angle.toFixed(3);\r\n            if (this.color)\r\n                text += '\\ncolor = ' + this.color;\r\n            return text;\r\n        }\r\n    }\r\n}\r\n/** \r\n * LittleJS Drawing System\r\n * <br> - Hybrid with both Canvas2D and WebGL available\r\n * <br> - Super fast tile sheet rendering with WebGL\r\n * <br> - Can apply rotation, mirror, color and additive color\r\n * <br> - Many useful utility functions\r\n * <br>\r\n * <br>LittleJS uses a hybrid rendering solution with the best of both Canvas2D and WebGL.\r\n * <br>There are 3 canvas/contexts available to draw to...\r\n * <br> - mainCanvas - 2D background canvas, non WebGL stuff like tile layers are drawn here.\r\n * <br> - glCanvas - Used by the accelerated WebGL batch rendering system.\r\n * <br> - overlayCanvas - Another 2D canvas that appears on top of the other 2 canvases.\r\n * <br>\r\n * <br>The WebGL rendering system is very fast with some caveats...\r\n * <br> - The default setup supports only 1 tile sheet, to support more call glCreateTexture and glSetTexture\r\n * <br> - Switching blend modes (additive) or textures causes another draw call which is expensive in excess\r\n * <br> - Group additive rendering together using renderOrder to mitigate this issue\r\n * <br>\r\n * <br>The LittleJS rendering solution is intentionally simple, feel free to adjust it for your needs!\r\n * @namespace Draw\r\n */\r\n\r\n'use strict';\r\n\r\n/** The primary 2D canvas visible to the user\r\n *  @type {HTMLCanvasElement}\r\n *  @memberof Draw */\r\nlet mainCanvas;\r\n\r\n/** 2d context for mainCanvas\r\n *  @type {CanvasRenderingContext2D}\r\n *  @memberof Draw */\r\nlet mainContext;\r\n\r\n/** A canvas that appears on top of everything the same size as mainCanvas\r\n *  @type {HTMLCanvasElement}\r\n *  @memberof Draw */\r\nlet overlayCanvas;\r\n\r\n/** 2d context for overlayCanvas\r\n *  @type {CanvasRenderingContext2D}\r\n *  @memberof Draw */\r\nlet overlayContext;\r\n\r\n/** The size of the main canvas (and other secondary canvases) \r\n *  @type {Vector2}\r\n *  @memberof Draw */\r\nlet mainCanvasSize = vec2();\r\n\r\n/** Tile sheet for batch rendering system\r\n *  @type {CanvasImageSource}\r\n *  @memberof Draw */\r\nconst tileImage = new Image;\r\n\r\n// Engine internal variables not exposed to documentation\r\nlet tileImageSize, tileImageFixBleed, drawCount;\r\n\r\n/** Convert from screen to world space coordinates\r\n *  - if calling outside of render, you may need to manually set mainCanvasSize\r\n *  @param {Vector2} screenPos\r\n *  @return {Vector2}\r\n *  @memberof Draw */\r\nconst screenToWorld = (screenPos)=>\r\n{\r\n    ASSERT(mainCanvasSize.x && mainCanvasSize.y, 'mainCanvasSize is invalid');\r\n    return screenPos.add(vec2(.5)).subtract(mainCanvasSize.scale(.5)).multiply(vec2(1/cameraScale,-1/cameraScale)).add(cameraPos);\r\n}\r\n\r\n/** Convert from world to screen space coordinates\r\n *  - if calling outside of render, you may need to manually set mainCanvasSize\r\n *  @param {Vector2} worldPos\r\n *  @return {Vector2}\r\n *  @memberof Draw */\r\nconst worldToScreen = (worldPos)=>\r\n{\r\n    ASSERT(mainCanvasSize.x && mainCanvasSize.y, 'mainCanvasSize is invalid');\r\n    return worldPos.subtract(cameraPos).multiply(vec2(cameraScale,-cameraScale)).add(mainCanvasSize.scale(.5)).subtract(vec2(.5));\r\n}\r\n\r\n/** Draw textured tile centered in world space, with color applied if using WebGL\r\n *  @param {Vector2} pos                            - Center of the tile in world space\r\n *  @param {Vector2} [size=Vector2(1,1)]            - Size of the tile in world space\r\n *  @param {Number}  [tileIndex=-1]                 - Tile index to use, negative is untextured\r\n *  @param {Vector2} [tileSize=tileSizeDefault]     - Tile size in source pixels\r\n *  @param {Color}   [color=Color()]                - Color to modulate with\r\n *  @param {Number}  [angle=0]                      - Angle to rotate by\r\n *  @param {Boolean} [mirror=0]                     - If true image is flipped along the Y axis\r\n *  @param {Color}   [additiveColor=Color(0,0,0,0)] - Additive color to be applied\r\n *  @param {Boolean} [useWebGL=glEnable]            - Use accelerated WebGL rendering\r\n *  @memberof Draw */\r\nfunction drawTile(pos, size=vec2(1), tileIndex=-1, tileSize=tileSizeDefault, color=new Color, angle=0, mirror, \r\n    additiveColor=new Color(0,0,0,0), useWebGL=glEnable)\r\n{\r\n    showWatermark && ++drawCount;\r\n    if (glEnable && useWebGL)\r\n    {\r\n        if (tileIndex < 0 || !tileImage.width)\r\n        {\r\n            // if negative tile index or image not found, force untextured\r\n            glDraw(pos.x, pos.y, size.x, size.y, angle, 0, 0, 0, 0, 0, color.rgbaInt()); \r\n        }\r\n        else\r\n        {\r\n            // calculate uvs and render\r\n            const cols = tileImageSize.x / tileSize.x |0;\r\n            const uvSizeX = tileSize.x / tileImageSize.x;\r\n            const uvSizeY = tileSize.y / tileImageSize.y;\r\n            const uvX = (tileIndex%cols)*uvSizeX, uvY = (tileIndex/cols|0)*uvSizeY;\r\n            \r\n            glDraw(pos.x, pos.y, mirror ? -size.x : size.x, size.y, angle, \r\n                uvX + tileImageFixBleed.x, uvY + tileImageFixBleed.y, \r\n                uvX - tileImageFixBleed.x + uvSizeX, uvY - tileImageFixBleed.y + uvSizeY, \r\n                color.rgbaInt(), additiveColor.rgbaInt()); \r\n        }\r\n    }\r\n    else\r\n    {\r\n        // normal canvas 2D rendering method (slower)\r\n        drawCanvas2D(pos, size, angle, mirror, (context)=>\r\n        {\r\n            if (tileIndex < 0)\r\n            {\r\n                // if negative tile index, force untextured\r\n                context.fillStyle = color;\r\n                context.fillRect(-.5, -.5, 1, 1);\r\n            }\r\n            else\r\n            {\r\n                // calculate uvs and render\r\n                const cols = tileImageSize.x / tileSize.x |0;\r\n                const sX = (tileIndex%cols)*tileSize.x   + tileFixBleedScale;\r\n                const sY = (tileIndex/cols|0)*tileSize.y + tileFixBleedScale;\r\n                const sWidth  = tileSize.x - 2*tileFixBleedScale;\r\n                const sHeight = tileSize.y - 2*tileFixBleedScale;\r\n                context.globalAlpha = color.a; // only alpha is supported\r\n                context.drawImage(tileImage, sX, sY, sWidth, sHeight, -.5, -.5, 1, 1);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/** Draw colored rect centered on pos\r\n *  @param {Vector2} pos\r\n *  @param {Vector2} [size=Vector2(1,1)]\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Number}  [angle=0]\r\n *  @param {Boolean} [useWebGL=glEnable]\r\n *  @memberof Draw */\r\nfunction drawRect(pos, size, color, angle, useWebGL)\r\n{\r\n    drawTile(pos, size, -1, tileSizeDefault, color, angle, 0, 0, useWebGL);\r\n}\r\n\r\n/** Draw textured tile centered on pos in screen space\r\n *  @param {Vector2} pos                        - Center of the tile\r\n *  @param {Vector2} [size=Vector2(1,1)]    - Size of the tile\r\n *  @param {Number}  [tileIndex=-1]             - Tile index to use, negative is untextured\r\n *  @param {Vector2} [tileSize=tileSizeDefault] - Tile size in source pixels\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Number}  [angle=0]\r\n *  @param {Boolean} [mirror=0]\r\n *  @param {Color}   [additiveColor=Color(0,0,0,0)]\r\n *  @param {Boolean} [useWebGL=glEnable]\r\n *  @memberof Draw */\r\nfunction drawTileScreenSpace(pos, size=vec2(1), tileIndex, tileSize, color, angle, mirror, additiveColor, useWebGL)\r\n{\r\n    drawTile(screenToWorld(pos), size.scale(1/cameraScale), tileIndex, tileSize, color, angle, mirror, additiveColor, useWebGL);\r\n}\r\n\r\n/** Draw colored rectangle in screen space\r\n *  @param {Vector2} pos\r\n *  @param {Vector2} [size=Vector2(1,1)]\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Number}  [angle=0]\r\n *  @param {Boolean} [useWebGL=glEnable]\r\n *  @memberof Draw */\r\nfunction drawRectScreenSpace(pos, size, color, angle, useWebGL)\r\n{\r\n    drawTileScreenSpace(pos, size, -1, tileSizeDefault, color, angle, 0, 0, useWebGL);\r\n}\r\n\r\n/** Draw colored line between two points\r\n *  @param {Vector2} posA\r\n *  @param {Vector2} posB\r\n *  @param {Number}  [thickness=.1]\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Boolean} [useWebGL=glEnable]\r\n *  @memberof Draw */\r\nfunction drawLine(posA, posB, thickness=.1, color, useWebGL)\r\n{\r\n    const halfDelta = vec2((posB.x - posA.x)/2, (posB.y - posA.y)/2);\r\n    const size = vec2(thickness, halfDelta.length()*2);\r\n    drawRect(posA.add(halfDelta), size, color, halfDelta.angle(), useWebGL);\r\n}\r\n\r\n/** Draw directly to a 2d canvas context in world space\r\n *  @param {Vector2}  pos\r\n *  @param {Vector2}  size\r\n *  @param {Number}   angle\r\n *  @param {Boolean}  mirror\r\n *  @param {Function} drawFunction\r\n *  @param {CanvasRenderingContext2D} [context=mainContext]\r\n *  @memberof Draw */\r\nfunction drawCanvas2D(pos, size, angle, mirror, drawFunction, context = mainContext)\r\n{\r\n    // create canvas transform from world space to screen space\r\n    pos = worldToScreen(pos);\r\n    size = size.scale(cameraScale);\r\n    context.save();\r\n    context.translate(pos.x+.5|0, pos.y+.5|0);\r\n    context.rotate(angle);\r\n    context.scale(mirror ? -size.x : size.x, size.y);\r\n    drawFunction(context);\r\n    context.restore();\r\n}\r\n\r\n/** Enable normal or additive blend mode\r\n *  @param {Boolean} [additive=0]\r\n *  @param {Boolean} [useWebGL=glEnable]\r\n *  @memberof Draw */\r\nfunction setBlendMode(additive, useWebGL=glEnable)\r\n{\r\n    if (glEnable && useWebGL)\r\n        glSetBlendMode(additive);\r\n    else\r\n        mainContext.globalCompositeOperation = additive ? 'lighter' : 'source-over';\r\n}\r\n\r\n/** Draw text on overlay canvas in world space\r\n *  Automatically splits new lines into rows\r\n *  @param {String}  text\r\n *  @param {Vector2} pos\r\n *  @param {Number}  [size=1]\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Number}  [lineWidth=0]\r\n *  @param {Color}   [lineColor=Color(0,0,0)]\r\n *  @param {String}  [textAlign='center']\r\n *  @param {String}  [font=fontDefault]\r\n *  @param {CanvasRenderingContext2D} [context=overlayContext]\r\n *  @memberof Draw */\r\nfunction drawText(text, pos, size=1, color, lineWidth=0, lineColor, textAlign, font, context)\r\n{\r\n    drawTextScreen(text, worldToScreen(pos), size*cameraScale, color, lineWidth*cameraScale, lineColor, textAlign, font, context);\r\n}\r\n\r\n/** Draw text on overlay canvas in screen space\r\n *  Automatically splits new lines into rows\r\n *  @param {String}  text\r\n *  @param {Vector2} pos\r\n *  @param {Number}  [size=1]\r\n *  @param {Color}   [color=Color()]\r\n *  @param {Number}  [lineWidth=0]\r\n *  @param {Color}   [lineColor=Color(0,0,0)]\r\n *  @param {String}  [textAlign='center']\r\n *  @param {String}  [font=fontDefault]\r\n *  @param {CanvasRenderingContext2D} [context=overlayContext]\r\n *  @memberof Draw */\r\nfunction drawTextScreen(text, pos, size=1, color=new Color, lineWidth=0, lineColor=new Color(0,0,0), textAlign='center', font=fontDefault, context=overlayContext)\r\n{\r\n    context.fillStyle = color;\r\n    context.lineWidth = lineWidth;\r\n    context.strokeStyle = lineColor;\r\n    context.textAlign = textAlign;\r\n    context.font = size + 'px '+ font;\r\n    context.textBaseline = 'middle';\r\n    context.lineJoin = 'round';\r\n\r\n    pos = pos.copy();\r\n    (text+'').split('\\n').forEach(line=>\r\n    {\r\n        lineWidth && context.strokeText(line, pos.x, pos.y);\r\n        context.fillText(line, pos.x, pos.y);\r\n        pos.y += size;\r\n    });\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nlet engineFontImage;\r\n\r\n/** \r\n * Font Image Object - Draw text on a 2D canvas by using characters in an image\r\n * <br> - 96 characters (from space to tilde) are stored in an image\r\n * <br> - Uses a default 8x8 font if none is supplied\r\n * <br> - You can also use fonts from the main tile sheet\r\n * @example\r\n * // use built in font\r\n * const font = new ImageFont;\r\n * \r\n * // draw text\r\n * font.drawTextScreen(\"LittleJS\\nHello World!\", vec2(200, 50));\r\n */\r\nclass FontImage\r\n{\r\n    /** Create an image font\r\n     *  @param {HTMLImageElement} [image] - Image for the font, if undefined default font is used\r\n     *  @param {Vector2} [tileSize=vec2(8)] - Size of the font source tiles\r\n     *  @param {Vector2} [paddingSize=vec2(0,1)] - How much extra space to add between characters\r\n     *  @param {Number}  [startTileIndex=0] - Tile index in image where font starts\r\n     *  @param {CanvasRenderingContext2D} [context=overlayContext] - context to draw to\r\n     */\r\n    constructor(image, tileSize=vec2(8), paddingSize=vec2(0,1), startTileIndex=0, context=overlayContext)\r\n    {\r\n        // load default font image\r\n        if (!engineFontImage)\r\n            (engineFontImage = new Image).src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC';\r\n\r\n        this.image = image || engineFontImage;\r\n        this.tileSize = tileSize;\r\n        this.paddingSize = paddingSize;\r\n        this.startTileIndex = startTileIndex;\r\n        this.context = context;\r\n    }\r\n\r\n    /** Draw text in screen space using the image font\r\n     *  @param {String}  text\r\n     *  @param {Vector2} pos\r\n     *  @param {Number}  [scale=4]\r\n     *  @param {Boolean} [center]\r\n     */\r\n    drawTextScreen(text, pos, scale=4, center)\r\n    {\r\n        const context = this.context;\r\n        context.save();\r\n        context.imageSmoothingEnabled = !cavasPixelated;\r\n\r\n        const size = this.tileSize;\r\n        const drawSize = size.add(this.paddingSize).scale(scale);\r\n        const cols = this.image.width / this.tileSize.x |0;\r\n        (text+'').split('\\n').forEach((line, i)=>\r\n        {\r\n            const centerOffset = center ? line.length * size.x * scale / 2 |0 : 0;\r\n            for(let j=line.length; j--;)\r\n            {\r\n                // draw each character\r\n                let charCode = line[j].charCodeAt();\r\n                if (charCode < 32 || charCode > 127)\r\n                    charCode = 127; // unknown character\r\n\r\n                // get the character source location and draw it\r\n                const tile = this.startTileIndex + charCode - 32;\r\n                const x = tile % cols;\r\n                const y = tile / cols |0;\r\n                const drawPos = pos.add(vec2(j,i).multiply(drawSize));\r\n                context.drawImage(this.image, x * size.x, y * size.y, size.x, size.y, \r\n                    drawPos.x - centerOffset, drawPos.y, size.x * scale, size.y * scale);\r\n            }\r\n        });\r\n\r\n        context.restore();\r\n    }\r\n\r\n    /** Draw text in world space using the image font\r\n     *  @param {String}  text\r\n     *  @param {Vector2} pos\r\n     *  @param {Number}  [scale=.25]\r\n     *  @param {Boolean} [center]\r\n     */\r\n    drawText(text, pos, scale=1, center)\r\n    {\r\n        this.drawTextScreen(text, worldToScreen(pos).floor(), scale*cameraScale|0, center);\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Fullscreen mode\r\n\r\n/** Returns true if fullscreen mode is active\r\n *  @return {Boolean}\r\n *  @memberof Draw */\r\nconst isFullscreen = ()=> document.fullscreenElement;\r\n\r\n/** Toggle fullsceen mode\r\n *  @memberof Draw */\r\nfunction toggleFullscreen()\r\n{\r\n    if (isFullscreen())\r\n    {\r\n        if (document.exitFullscreen)\r\n            document.exitFullscreen();\r\n    }\r\n    else if (document.body.requestFullscreen)\r\n            document.body.requestFullscreen();\r\n}\r\n\r\n/** \r\n * LittleJS Input System\r\n * <br> - Tracks key down, pressed, and released\r\n * <br> - Also tracks mouse buttons, position, and wheel\r\n * <br> - Supports multiple gamepads\r\n * <br> - Virtual gamepad for touch devices with touchGamepadSize\r\n * @namespace Input\r\n */\r\n\r\n'use strict';\r\n\r\n/** Returns true if device key is down\r\n *  @param {Number} key\r\n *  @param {Number} [device=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst keyIsDown = (key, device=0)=> inputData[device] && inputData[device][key] & 1;\r\n\r\n/** Returns true if device key was pressed this frame\r\n *  @param {Number} key\r\n *  @param {Number} [device=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst keyWasPressed = (key, device=0)=> inputData[device] && inputData[device][key] & 2 ? 1 : 0;\r\n\r\n/** Returns true if device key was released this frame\r\n *  @param {Number} key\r\n *  @param {Number} [device=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst keyWasReleased = (key, device=0)=> inputData[device] && inputData[device][key] & 4 ? 1 : 0;\r\n\r\n/** Clears all input\r\n *  @memberof Input */\r\nconst clearInput = ()=> inputData = [[]];\r\n\r\n/** Returns true if mouse button is down\r\n *  @function\r\n *  @param {Number} button\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst mouseIsDown = keyIsDown;\r\n\r\n/** Returns true if mouse button was pressed\r\n *  @function\r\n *  @param {Number} button\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst mouseWasPressed = keyWasPressed;\r\n\r\n/** Returns true if mouse button was released\r\n *  @function\r\n *  @param {Number} button\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst mouseWasReleased = keyWasReleased;\r\n\r\n/** Mouse pos in world space\r\n *  @type {Vector2}\r\n *  @memberof Input */\r\nlet mousePos = vec2();\r\n\r\n/** Mouse pos in screen space\r\n *  @type {Vector2}\r\n *  @memberof Input */\r\nlet mousePosScreen = vec2();\r\n\r\n/** Mouse wheel delta this frame\r\n *  @type {Number}\r\n *  @memberof Input */\r\nlet mouseWheel = 0;\r\n\r\n/** Returns true if user is using gamepad (has more recently pressed a gamepad button)\r\n *  @type {Boolean}\r\n *  @memberof Input */\r\nlet isUsingGamepad = 0;\r\n\r\n/** Prevents input continuing to the default browser handling (false by default)\r\n *  @type {Boolean}\r\n *  @memberof Input */\r\nlet preventDefaultInput = 0;\r\n\r\n/** Returns true if gamepad button is down\r\n *  @param {Number} button\r\n *  @param {Number} [gamepad=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst gamepadIsDown = (button, gamepad=0)=> keyIsDown(button, gamepad+1);\r\n\r\n/** Returns true if gamepad button was pressed\r\n *  @param {Number} button\r\n *  @param {Number} [gamepad=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst gamepadWasPressed = (button, gamepad=0)=> keyWasPressed(button, gamepad+1);\r\n\r\n/** Returns true if gamepad button was released\r\n *  @param {Number} button\r\n *  @param {Number} [gamepad=0]\r\n *  @return {Boolean}\r\n *  @memberof Input */\r\nconst gamepadWasReleased = (button, gamepad=0)=> keyWasReleased(button, gamepad+1);\r\n\r\n/** Returns gamepad stick value\r\n *  @param {Number} stick\r\n *  @param {Number} [gamepad=0]\r\n *  @return {Vector2}\r\n *  @memberof Input */\r\nconst gamepadStick = (stick,  gamepad=0)=> stickData[gamepad] ? stickData[gamepad][stick] || vec2() : vec2();\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Input update called by engine\r\n\r\n// store input as a bit field for each key: 1 = isDown, 2 = wasPressed, 4 = wasReleased\r\n// mouse and keyboard are stored together in device 0, gamepads are in devices > 0\r\nlet inputData = [[]];\r\n\r\nfunction inputUpdate()\r\n{\r\n    // clear input when lost focus (prevent stuck keys)\r\n    isTouchDevice || document.hasFocus() || clearInput();\r\n\r\n    // update mouse world space position\r\n    mousePos = screenToWorld(mousePosScreen);\r\n\r\n    // update gamepads if enabled\r\n    gamepadsUpdate();\r\n}\r\n\r\nfunction inputUpdatePost()\r\n{\r\n    // clear input to prepare for next frame\r\n    for (const deviceInputData of inputData)\r\n    for (const i in deviceInputData)\r\n        deviceInputData[i] &= 1;\r\n    mouseWheel = 0;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Keyboard event handlers\r\n\r\nonkeydown = (e)=>\r\n{\r\n    if (debug && e.target != document.body) return;\r\n    e.repeat || (inputData[isUsingGamepad = 0][remapKey(e.which)] = 3);\r\n    preventDefaultInput && e.preventDefault();\r\n}\r\nonkeyup = (e)=>\r\n{\r\n    if (debug && e.target != document.body) return;\r\n    inputData[0][remapKey(e.which)] = 4;\r\n}\r\nconst remapKey = (c)=> inputWASDEmulateDirection ? c==87?38 : c==83?40 : c==65?37 : c==68?39 : c : c;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Mouse event handlers\r\n\r\nonmousedown = (e)=> {inputData[isUsingGamepad = 0][e.button] = 3; onmousemove(e); e.button && e.preventDefault();}\r\nonmouseup   = (e)=> inputData[0][e.button] = inputData[0][e.button] & 2 | 4;\r\nonmousemove = (e)=> mousePosScreen = mouseToScreen(e);\r\nonwheel = (e)=> e.ctrlKey || (mouseWheel = sign(e.deltaY));\r\noncontextmenu = (e)=> !1; // prevent right click menu\r\n\r\n// convert a mouse or touch event position to screen space\r\nconst mouseToScreen = (mousePos)=>\r\n{\r\n    if (!mainCanvas)\r\n        return vec2(); // fix bug that can occur if user clicks before page loads\r\n\r\n    const rect = mainCanvas.getBoundingClientRect();\r\n    return vec2(mainCanvas.width, mainCanvas.height).multiply(\r\n        vec2(percent(mousePos.x, rect.left, rect.right), percent(mousePos.y, rect.top, rect.bottom)));\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Gamepad input\r\n\r\nconst stickData = [];\r\nfunction gamepadsUpdate()\r\n{\r\n    if (touchGamepadEnable && touchGamepadTimer.isSet())\r\n    {\r\n        // read virtual analog stick\r\n        const sticks = stickData[0] || (stickData[0] = []);\r\n        sticks[0] = vec2(touchGamepadStick.x, -touchGamepadStick.y); // flip vertical\r\n\r\n        // read virtual gamepad buttons\r\n        const data = inputData[1] || (inputData[1] = []);\r\n        for (let i=10; i--;)\r\n        {\r\n            const j = i == 3 ? 2 : i == 2 ? 3 : i; // fix button locations\r\n            data[j] = touchGamepadButtons[i] ? 1 + 2*!gamepadIsDown(j,0) : 4*gamepadIsDown(j,0);\r\n        }\r\n    }\r\n\r\n    if (!gamepadsEnable || !navigator || !navigator.getGamepads || !document.hasFocus() && !debug)\r\n        return;\r\n\r\n    // poll gamepads\r\n    const gamepads = navigator.getGamepads();\r\n    for (let i = gamepads.length; i--;)\r\n    {\r\n        // get or create gamepad data\r\n        const gamepad = gamepads[i];\r\n        const data = inputData[i+1] || (inputData[i+1] = []);\r\n        const sticks = stickData[i] || (stickData[i] = []);\r\n\r\n        if (gamepad)\r\n        {\r\n            // read clamp dead zone of analog sticks\r\n            const deadZone = .3, deadZoneMax = .8;\r\n            const applyDeadZone = (v)=> \r\n                v >  deadZone ?  percent( v, deadZone, deadZoneMax) : \r\n                v < -deadZone ? -percent(-v, deadZone, deadZoneMax) : 0;\r\n\r\n            // read analog sticks\r\n            for (let j = 0; j < gamepad.axes.length-1; j+=2)\r\n                sticks[j>>1] = vec2(applyDeadZone(gamepad.axes[j]), applyDeadZone(-gamepad.axes[j+1])).clampLength();\r\n            \r\n            // read buttons\r\n            for (let j = gamepad.buttons.length; j--;)\r\n            {\r\n                const button = gamepad.buttons[j];\r\n                data[j] = button.pressed ? 1 + 2*!gamepadIsDown(j,i) : 4*gamepadIsDown(j,i);\r\n                isUsingGamepad |= !i && button.pressed;\r\n                touchGamepadEnable && touchGamepadTimer.unset(); // disable touch gamepad if using real gamepad\r\n            }\r\n\r\n            if (gamepadDirectionEmulateStick)\r\n            {\r\n                // copy dpad to left analog stick when pressed\r\n                const dpad = vec2(gamepadIsDown(15,i) - gamepadIsDown(14,i), gamepadIsDown(12,i) - gamepadIsDown(13,i));\r\n                if (dpad.lengthSquared())\r\n                    sticks[0] = dpad.clampLength();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** Pulse the vibration hardware if it exists\r\n *  @param {Number} [pattern=100] - a single value in miliseconds or vibration interval array\r\n *  @memberof Input */\r\nconst vibrate = (pattern)=> vibrateEnable && navigator && navigator.vibrate && navigator.vibrate(pattern);\r\n\r\n/** Cancel any ongoing vibration\r\n *  @memberof Input */\r\nconst vibrateStop = ()=> vibrate(0);\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Touch input\r\n\r\n/** True if a touch device has been detected\r\n *  @memberof Input */\r\nconst isTouchDevice = window.ontouchstart !== undefined;\r\n\r\n// try to enable touch mouse\r\nif (isTouchDevice)\r\n{\r\n    // override mouse events\r\n    let wasTouching, mouseDown = onmousedown, mouseUp = onmouseup;\r\n    onmousedown = onmouseup = ()=> 0;\r\n\r\n    // setup touch input\r\n    ontouchstart = (e)=>\r\n    {\r\n        // fix mobile audio, force it to play a sound on first touch\r\n        zzfx(0);\r\n\r\n        // handle all touch events the same way\r\n        ontouchstart = ontouchmove = ontouchend = (e)=>\r\n        {\r\n            e.button = 0; // all touches are left click\r\n\r\n            // check if touching and pass to mouse events\r\n            const touching = e.touches.length;\r\n            if (touching)\r\n            {\r\n                // set event pos and pass it along\r\n                e.x = e.touches[0].clientX;\r\n                e.y = e.touches[0].clientY;\r\n                wasTouching ? onmousemove(e) : mouseDown(e);\r\n            }\r\n            else if (wasTouching)\r\n                mouseUp(e);\r\n\r\n            // set was touching\r\n            wasTouching = touching;\r\n\r\n            // must return true so the document will get focus\r\n            return true;\r\n        }\r\n\r\n        // try to create touch game pad\r\n        touchGamepadEnable && touchGamepadCreate();\r\n\r\n        return ontouchstart(e);\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// touch gamepad, virtual on screen gamepad emulator for touch devices\r\n\r\n// touch input internal variables\r\nlet touchGamepadTimer = new Timer, touchGamepadButtons, touchGamepadStick;\r\n\r\n// create the touch gamepad, called automatically by the engine\r\nfunction touchGamepadCreate()\r\n{\r\n    // touch input internal variables\r\n    touchGamepadButtons = [];\r\n    touchGamepadStick = vec2();\r\n\r\n    let touchHandler = ontouchstart;\r\n    ontouchstart = ontouchmove = ontouchend = (e)=> \r\n    {\r\n        // clear touch gamepad input\r\n        touchGamepadStick = vec2();\r\n        touchGamepadButtons = [];\r\n            \r\n        const touching = e.touches.length;\r\n        if (touching)\r\n        {\r\n            touchGamepadTimer.set();\r\n            if (paused)\r\n            {\r\n                // touch anywhere to press start when paused\r\n                touchGamepadButtons[9] = 1;\r\n                return;\r\n            }\r\n        }\r\n\r\n        // get center of left and right sides\r\n        const stickCenter = vec2(touchGamepadSize, mainCanvasSize.y-touchGamepadSize);\r\n        const buttonCenter = mainCanvasSize.subtract(vec2(touchGamepadSize, touchGamepadSize));\r\n        const startCenter = mainCanvasSize.scale(.5);\r\n\r\n        // check each touch point\r\n        for (const touch of e.touches)\r\n        {\r\n            const touchPos = mouseToScreen(vec2(touch.clientX, touch.clientY));\r\n            if (touchPos.distance(stickCenter) < touchGamepadSize)\r\n            {\r\n                // virtual analog stick\r\n                if (touchGamepadAnalog)\r\n                    touchGamepadStick = touchPos.subtract(stickCenter).scale(2/touchGamepadSize).clampLength();\r\n                else\r\n                {\r\n                    // 8 way dpad\r\n                    const angle = touchPos.subtract(stickCenter).angle();\r\n                    touchGamepadStick.setAngle((angle * 4 / PI + 8.5 | 0) * PI / 4);\r\n                }\r\n            }\r\n            else if (touchPos.distance(buttonCenter) < touchGamepadSize)\r\n            {\r\n                // virtual face buttons\r\n                const button = touchPos.subtract(buttonCenter).direction();\r\n                touchGamepadButtons[button] = 1;\r\n            }\r\n            else if (touchPos.distance(startCenter) < touchGamepadSize)\r\n            {\r\n                // virtual start button in center\r\n                touchGamepadButtons[9] = 1;\r\n            }\r\n        }\r\n\r\n        // call default touch handler and set to using gamepad\r\n        touchHandler(e);\r\n        isUsingGamepad = 1;\r\n        \r\n        // must return true so the document will get focus\r\n        return true;\r\n    }\r\n}\r\n\r\n// render the touch gamepad, called automatically by the engine\r\nfunction touchGamepadRender()\r\n{\r\n    if (!touchGamepadEnable || !touchGamepadTimer.isSet())\r\n        return;\r\n    \r\n    // fade off when not touching or paused\r\n    const alpha = percent(touchGamepadTimer, 4, 3);\r\n    if (!alpha || paused)\r\n        return;\r\n\r\n    // setup the canvas\r\n    overlayContext.save();\r\n    overlayContext.globalAlpha = alpha*touchGamepadAlpha;\r\n    overlayContext.strokeStyle = '#fff';\r\n    overlayContext.lineWidth = 3;\r\n\r\n    // draw left analog stick\r\n    overlayContext.fillStyle = touchGamepadStick.lengthSquared() > 0 ? '#fff' : '#000';\r\n    overlayContext.beginPath();\r\n\r\n    const leftCenter = vec2(touchGamepadSize, mainCanvasSize.y-touchGamepadSize);\r\n    if (touchGamepadAnalog) // draw circle shaped gamepad\r\n    {\r\n        overlayContext.arc(leftCenter.x, leftCenter.y, touchGamepadSize/2, 0, 9);\r\n        overlayContext.fill();\r\n        overlayContext.stroke();\r\n    }\r\n    else // draw cross shaped gamepad\r\n    {\r\n        for(let i=10; i--;)\r\n        {\r\n            const angle = i*PI/4;\r\n            overlayContext.arc(leftCenter.x, leftCenter.y,touchGamepadSize*.6, angle + PI/8, angle + PI/8);\r\n            i%2 && overlayContext.arc(leftCenter.x, leftCenter.y, touchGamepadSize*.33, angle, angle);\r\n            i==1 && overlayContext.fill();\r\n        }\r\n        overlayContext.stroke();\r\n    }\r\n    \r\n    // draw right face buttons\r\n    const rightCenter = vec2(mainCanvasSize.x-touchGamepadSize, mainCanvasSize.y-touchGamepadSize);\r\n    for (let i=4; i--;)\r\n    {\r\n        const pos = rightCenter.add((new Vector2).setAngle(i*PI/2, touchGamepadSize/2));\r\n        overlayContext.fillStyle = touchGamepadButtons[i] ? '#fff' : '#000';\r\n        overlayContext.beginPath();\r\n        overlayContext.arc(pos.x, pos.y, touchGamepadSize/4, 0,9);\r\n        overlayContext.fill();\r\n        overlayContext.stroke();\r\n    }\r\n\r\n    // set canvas back to normal\r\n    overlayContext.restore();\r\n}\r\n/** \r\n * LittleJS Audio System\r\n * <br> - <a href=https://killedbyapixel.github.io/ZzFX/>ZzFX Sound Effects</a>\r\n * <br> - <a href=https://keithclark.github.io/ZzFXM/>ZzFXM Music</a>\r\n * <br> - Caches sounds and music for fast playback\r\n * <br> - Can attenuate and apply stereo panning to sounds\r\n * <br> - Ability to play mp3, ogg, and wave files\r\n * <br> - Speech synthesis wrapper functions\r\n */\r\n\r\n'use strict';\r\n\r\n/** \r\n * Sound Object - Stores a zzfx sound for later use and can be played positionally\r\n * <br>\r\n * <br><b><a href=https://killedbyapixel.github.io/ZzFX/>Create sounds using the ZzFX Sound Designer.</a></b>\r\n * @example\r\n * // create a sound\r\n * const sound_example = new Sound([.5,.5]);\r\n * \r\n * // play the sound\r\n * sound_example.play();\r\n */\r\nclass Sound\r\n{\r\n    /** Create a sound object and cache the zzfx samples for later use\r\n     *  @param {Array}  zzfxSound - Array of zzfx parameters, ex. [.5,.5]\r\n     *  @param {Number} [range=soundDefaultRange] - World space max range of sound, will not play if camera is farther away\r\n     *  @param {Number} [taper=soundDefaultTaper] - At what percentage of range should it start tapering off\r\n     */\r\n    constructor(zzfxSound, range=soundDefaultRange, taper=soundDefaultTaper)\r\n    {\r\n        if (!soundEnable) return;\r\n\r\n        /** @property {Number} - World space max range of sound, will not play if camera is farther away */\r\n        this.range = range;\r\n\r\n        /** @property {Number} - At what percentage of range should it start tapering off */\r\n        this.taper = taper;\r\n\r\n        // get randomness from sound parameters\r\n        this.randomness = zzfxSound[1] || 0;\r\n        zzfxSound[1] = 0;\r\n\r\n        // generate sound now for fast playback\r\n        this.cachedSamples = zzfxG(...zzfxSound);\r\n    }\r\n\r\n    /** Play the sound\r\n     *  @param {Vector2} [pos] - World space position to play the sound, sound is not attenuated if null\r\n     *  @param {Number}  [volume=1] - How much to scale volume by (in addition to range fade)\r\n     *  @param {Number}  [pitch=1] - How much to scale pitch by (also adjusted by this.randomness)\r\n     *  @param {Number}  [randomnessScale=1] - How much to scale randomness\r\n     *  @return {AudioBufferSourceNode} - The audio, can be used to stop sound later\r\n     */\r\n    play(pos, volume=1, pitch=1, randomnessScale=1)\r\n    {\r\n        if (!soundEnable) return;\r\n\r\n        let pan;\r\n        if (pos)\r\n        {\r\n            const range = this.range;\r\n            if (range)\r\n            {\r\n                // apply range based fade\r\n                const lengthSquared = cameraPos.distanceSquared(pos);\r\n                if (lengthSquared > range*range)\r\n                    return; // out of range\r\n\r\n                // attenuate volume by distance\r\n                volume *= percent(lengthSquared**.5, range, range*this.taper);\r\n            }\r\n\r\n            // get pan from screen space coords\r\n            pan = worldToScreen(pos).x * 2/mainCanvas.width - 1;\r\n        }\r\n\r\n        // play the sound\r\n        const playbackRate = pitch + pitch * this.randomness*randomnessScale*rand(-1,1);\r\n        return playSamples([this.cachedSamples], volume, playbackRate, pan);\r\n    }\r\n\r\n    /** Play the sound as a note with a semitone offset\r\n     *  @param {Number}  semitoneOffset - How many semitones to offset pitch\r\n     *  @param {Vector2} [pos] - World space position to play the sound, sound is not attenuated if null\r\n     *  @param {Number}  [volume=1] - How much to scale volume by (in addition to range fade)\r\n     *  @return {AudioBufferSourceNode} - The audio, can be used to stop sound later\r\n     */\r\n    playNote(semitoneOffset, pos, volume)\r\n    {\r\n        if (!soundEnable) return;\r\n\r\n        return this.play(pos, volume, 2**(semitoneOffset/12), 0);\r\n    }\r\n}\r\n\r\n/**\r\n * Music Object - Stores a zzfx music track for later use\r\n * <br>\r\n * <br><b><a href=https://keithclark.github.io/ZzFXM/>Create music with the ZzFXM tracker.</a></b>\r\n * @example\r\n * // create some music\r\n * const music_example = new Music(\r\n * [\r\n *     [                         // instruments\r\n *       [,0,400]                // simple note\r\n *     ], \r\n *     [                         // patterns\r\n *         [                     // pattern 1\r\n *             [                 // channel 0\r\n *                 0, -1,        // instrument 0, left speaker\r\n *                 1, 0, 9, 1    // channel notes\r\n *             ], \r\n *             [                 // channel 1\r\n *                 0, 1,         // instrument 1, right speaker\r\n *                 0, 12, 17, -1 // channel notes\r\n *             ]\r\n *         ],\r\n *     ],\r\n *     [0, 0, 0, 0], // sequence, play pattern 0 four times\r\n *     90            // BPM\r\n * ]);\r\n * \r\n * // play the music\r\n * music_example.play();\r\n */\r\nclass Music\r\n{\r\n    /** Create a music object and cache the zzfx music samples for later use\r\n     *  @param {Array} zzfxMusic - Array of zzfx music parameters\r\n     */\r\n    constructor(zzfxMusic)\r\n    {\r\n        if (!soundEnable) return;\r\n\r\n        this.cachedSamples = zzfxM(...zzfxMusic);\r\n    }\r\n\r\n    /** Play the music\r\n     *  @param {Number}  [volume=1] - How much to scale volume by\r\n     *  @param {Boolean} [loop=1] - True if the music should loop when it reaches the end\r\n     *  @return {AudioBufferSourceNode} - The audio node, can be used to stop sound later\r\n     */\r\n    play(volume, loop = 1)\r\n    {\r\n        if (!soundEnable) return;\r\n\r\n        return this.source = playSamples(this.cachedSamples, volume, 1, 0, loop);\r\n    }\r\n\r\n    /** Stop the music */\r\n    stop()\r\n    {\r\n        if (this.source)\r\n            this.source.stop();\r\n        this.source = 0;\r\n    }\r\n\r\n    /** Check if music is playing\r\n     *  @return {Boolean}\r\n     */\r\n    isPlaying() { return this.source; }\r\n}\r\n\r\n/** Play an mp3 or wav audio from a local file or url\r\n *  @param {String}  url - Location of sound file to play\r\n *  @param {Number}  [volume=1] - How much to scale volume by\r\n *  @param {Boolean} [loop=1] - True if the music should loop when it reaches the end\r\n *  @return {HTMLAudioElement} - The audio element for this sound\r\n *  @memberof Audio */\r\nfunction playAudioFile(url, volume=1, loop=1)\r\n{\r\n    if (!soundEnable) return;\r\n\r\n    const audio = new Audio(url);\r\n    audio.volume = soundVolume * volume;\r\n    audio.loop = loop;\r\n    audio.play();\r\n    return audio;\r\n}\r\n\r\n/** Speak text with passed in settings\r\n *  @param {String} text - The text to speak\r\n *  @param {String} [language] - The language/accent to use (examples: en, it, ru, ja, zh)\r\n *  @param {Number} [volume=1] - How much to scale volume by\r\n *  @param {Number} [rate=1] - How quickly to speak\r\n *  @param {Number} [pitch=1] - How much to change the pitch by\r\n *  @return {SpeechSynthesisUtterance} - The utterance that was spoken\r\n *  @memberof Audio */\r\nfunction speak(text, language='', volume=1, rate=1, pitch=1)\r\n{\r\n    if (!soundEnable || !speechSynthesis) return;\r\n\r\n    // common languages (not supported by all browsers)\r\n    // en - english,  it - italian, fr - french,  de - german, es - spanish\r\n    // ja - japanese, ru - russian, zh - chinese, hi - hindi,  ko - korean\r\n\r\n    // build utterance and speak\r\n    const utterance = new SpeechSynthesisUtterance(text);\r\n    utterance.lang = language;\r\n    utterance.volume = 2*volume*soundVolume;\r\n    utterance.rate = rate;\r\n    utterance.pitch = pitch;\r\n    speechSynthesis.speak(utterance);\r\n    return utterance;\r\n}\r\n\r\n/** Stop all queued speech\r\n *  @memberof Audio */\r\nconst speakStop = ()=> speechSynthesis && speechSynthesis.cancel();\r\n\r\n/** Get frequency of a note on a musical scale\r\n *  @param {Number} semitoneOffset - How many semitones away from the root note\r\n *  @param {Number} [rootNoteFrequency=220] - Frequency at semitone offset 0\r\n *  @return {Number} - The frequency of the note\r\n *  @memberof Audio */\r\nconst getNoteFrequency = (semitoneOffset, rootFrequency=220)=> rootFrequency * 2**(semitoneOffset/12); \r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** Audio context used by the engine\r\n *  @memberof Audio */\r\nlet audioContext;\r\n\r\n/** Play cached audio samples with given settings\r\n *  @param {Array}   sampleChannels - Array of arrays of samples to play (for stereo playback)\r\n *  @param {Number}  [volume=1] - How much to scale volume by\r\n *  @param {Number}  [rate=1] - The playback rate to use\r\n *  @param {Number}  [pan=0] - How much to apply stereo panning\r\n *  @param {Boolean} [loop=0] - True if the sound should loop when it reaches the end\r\n *  @return {AudioBufferSourceNode} - The audio node of the sound played\r\n *  @memberof Audio */\r\nfunction playSamples(sampleChannels, volume=1, rate=1, pan=0, loop=0) \r\n{\r\n    if (!soundEnable) return;\r\n\r\n    // create audio context\r\n    if (!audioContext)\r\n        audioContext = new AudioContext;\r\n\r\n    // fix stalled audio\r\n    audioContext.resume();\r\n\r\n    // prevent sounds from building up if they can't be played\r\n    if (audioContext.state != 'running')\r\n        return;\r\n\r\n    // create buffer and source\r\n    const buffer = audioContext.createBuffer(sampleChannels.length, sampleChannels[0].length, zzfxR), \r\n        source = audioContext.createBufferSource();\r\n\r\n    // copy samples to buffer and setup source\r\n    sampleChannels.forEach((c,i)=> buffer.getChannelData(i).set(c));\r\n    source.buffer = buffer;\r\n    source.playbackRate.value = rate;\r\n    source.loop = loop;\r\n\r\n    // create and connect gain node (createGain is more widely spported then GainNode construtor)\r\n    const gainNode = audioContext.createGain();\r\n    gainNode.gain.value = soundVolume*volume;\r\n    gainNode.connect(audioContext.destination);\r\n\r\n    // connect source to stereo panner and gain\r\n    source.connect(new StereoPannerNode(audioContext, {'pan':clamp(pan, -1, 1)})).connect(gainNode);\r\n\r\n    // play and return sound\r\n    source.start();\r\n    return source;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// ZzFXMicro - Zuper Zmall Zound Zynth - v1.2.0 by Frank Force\r\n\r\n/** Generate and play a ZzFX sound\r\n *  <br>\r\n *  <br><b><a href=https://killedbyapixel.github.io/ZzFX/>Create sounds using the ZzFX Sound Designer.</a></b>\r\n *  @param {Array} zzfxSound - Array of ZzFX parameters, ex. [.5,.5]\r\n *  @return {Array} - Array of audio samples\r\n *  @memberof Audio */\r\nconst zzfx = (...zzfxSound) => playSamples([zzfxG(...zzfxSound)]);\r\n\r\n/** Sample rate used for all ZzFX sounds\r\n *  @default 44100\r\n *  @memberof Audio */\r\nconst zzfxR = 44100; \r\n\r\n/** Generate samples for a ZzFX sound\r\n *  @memberof Audio */\r\nfunction zzfxG\r\n(\r\n    // parameters\r\n    volume = 1, randomness = .05, frequency = 220, attack = 0, sustain = 0,\r\n    release = .1, shape = 0, shapeCurve = 1, slide = 0, deltaSlide = 0,\r\n    pitchJump = 0, pitchJumpTime = 0, repeatTime = 0, noise = 0, modulation = 0,\r\n    bitCrush = 0, delay = 0, sustainVolume = 1, decay = 0, tremolo = 0\r\n)\r\n{\r\n    // locals\r\n    let PI2 = PI*2, startSlide = slide *= 500 * PI2 / zzfxR / zzfxR, b=[],\r\n        startFrequency = frequency *= (1 + randomness*rand(-1,1)) * PI2 / zzfxR,\r\n        t=0, tm=0, i=0, j=1, r=0, c=0, s=0, f, length\r\n\r\n    // scale by sample rate\r\n    attack = attack * zzfxR + 9; // minimum attack to prevent pop\r\n    decay *= zzfxR;\r\n    sustain *= zzfxR;\r\n    release *= zzfxR;\r\n    delay *= zzfxR;\r\n    deltaSlide *= 500 * PI2 / zzfxR**3;\r\n    modulation *= PI2 / zzfxR;\r\n    pitchJump *= PI2 / zzfxR;\r\n    pitchJumpTime *= zzfxR;\r\n    repeatTime = repeatTime * zzfxR | 0;\r\n\r\n    // generate waveform\r\n    for (length = attack + decay + sustain + release + delay | 0;\r\n        i < length; b[i++] = s)\r\n    {\r\n        if (!(++c%(bitCrush*100|0)))                      // bit crush\r\n        {\r\n            s = shape? shape>1? shape>2? shape>3?         // wave shape\r\n                Math.sin((t%PI2)**3) :                    // 4 noise\r\n                max(min(Math.tan(t),1),-1):               // 3 tan\r\n                1-(2*t/PI2%2+2)%2:                        // 2 saw\r\n                1-4*abs(Math.round(t/PI2)-t/PI2):         // 1 triangle\r\n                Math.sin(t);                              // 0 sin\r\n                \r\n            s = (repeatTime ?\r\n                    1 - tremolo + tremolo*Math.sin(PI2*i/repeatTime) // tremolo\r\n                    : 1) *\r\n                sign(s)*(abs(s)**shapeCurve) *            // curve 0=square, 2=pointy\r\n                volume * soundVolume * (                  // envelope\r\n                i < attack ? i/attack :                   // attack\r\n                i < attack + decay ?                      // decay\r\n                1-((i-attack)/decay)*(1-sustainVolume) :  // decay falloff\r\n                i < attack  + decay + sustain ?           // sustain\r\n                sustainVolume :                           // sustain volume\r\n                i < length - delay ?                      // release\r\n                (length - i - delay)/release *            // release falloff\r\n                sustainVolume :                           // release volume\r\n                0);                                       // post release\r\n \r\n            s = delay ? s/2 + (delay > i ? 0 :            // delay\r\n                (i<length-delay? 1 : (length-i)/delay) *  // release delay \r\n                b[i-delay|0]/2) : s;                      // sample delay\r\n        }\r\n\r\n        f = (frequency += slide += deltaSlide) *          // frequency\r\n            Math.cos(modulation*tm++);                    // modulation\r\n        t += f - f*noise*(1 - (Math.sin(i)+1)*1e9%2);     // noise\r\n\r\n        if (j && ++j > pitchJumpTime)    // pitch jump\r\n        {\r\n            frequency += pitchJump;      // apply pitch jump\r\n            startFrequency += pitchJump; // also apply to start\r\n            j = 0;                       // reset pitch jump time\r\n        }\r\n\r\n        if (repeatTime && !(++r % repeatTime)) // repeat\r\n        {\r\n            frequency = startFrequency;  // reset frequency\r\n            slide = startSlide;          // reset slide\r\n            j ||= 1;                     // reset pitch jump time\r\n        }\r\n    }\r\n    \r\n    return b;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// ZzFX Music Renderer v2.0.3 by Keith Clark and Frank Force\r\n\r\n/** Generate samples for a ZzFM song with given parameters\r\n *  @param {Array} instruments - Array of ZzFX sound paramaters\r\n *  @param {Array} patterns - Array of pattern data\r\n *  @param {Array} sequence - Array of pattern indexes\r\n *  @param {Number} [BPM=125] - Playback speed of the song in BPM\r\n *  @returns {Array} - Left and right channel sample data\r\n *  @memberof Audio */\r\nfunction zzfxM(instruments, patterns, sequence, BPM = 125) \r\n{\r\n  let i, j, k;\r\n  let instrumentParameters;\r\n  let note;\r\n  let sample;\r\n  let patternChannel;\r\n  let notFirstBeat;\r\n  let stop;\r\n  let instrument;\r\n  let attenuation;\r\n  let outSampleOffset;\r\n  let isSequenceEnd;\r\n  let sampleOffset = 0;\r\n  let nextSampleOffset;\r\n  let sampleBuffer = [];\r\n  let leftChannelBuffer = [];\r\n  let rightChannelBuffer = [];\r\n  let channelIndex = 0;\r\n  let panning = 0;\r\n  let hasMore = 1;\r\n  let sampleCache = {};\r\n  let beatLength = zzfxR / BPM * 60 >> 2;\r\n\r\n  // for each channel in order until there are no more\r\n  for (; hasMore; channelIndex++) {\r\n\r\n    // reset current values\r\n    sampleBuffer = [hasMore = notFirstBeat = outSampleOffset = 0];\r\n\r\n    // for each pattern in sequence\r\n    sequence.forEach((patternIndex, sequenceIndex) => {\r\n      // get pattern for current channel, use empty 1 note pattern if none found\r\n      patternChannel = patterns[patternIndex][channelIndex] || [0, 0, 0];\r\n\r\n      // check if there are more channels\r\n      hasMore |= !!patterns[patternIndex][channelIndex];\r\n\r\n      // get next offset, use the length of first channel\r\n      nextSampleOffset = outSampleOffset + (patterns[patternIndex][0].length - 2 - !notFirstBeat) * beatLength;\r\n      // for each beat in pattern, plus one extra if end of sequence\r\n      isSequenceEnd = sequenceIndex == sequence.length - 1;\r\n      for (i = 2, k = outSampleOffset; i < patternChannel.length + isSequenceEnd; notFirstBeat = ++i) {\r\n\r\n        // <channel-note>\r\n        note = patternChannel[i];\r\n\r\n        // stop if end, different instrument or new note\r\n        stop = i == patternChannel.length + isSequenceEnd - 1 && isSequenceEnd ||\r\n            instrument != (patternChannel[0] || 0) | note | 0;\r\n\r\n        // fill buffer with samples for previous beat, most cpu intensive part\r\n        for (j = 0; j < beatLength && notFirstBeat;\r\n\r\n            // fade off attenuation at end of beat if stopping note, prevents clicking\r\n            j++ > beatLength - 99 && stop ? attenuation += (attenuation < 1) / 99 : 0\r\n        ) {\r\n          // copy sample to stereo buffers with panning\r\n          sample = (1 - attenuation) * sampleBuffer[sampleOffset++] / 2 || 0;\r\n          leftChannelBuffer[k] = (leftChannelBuffer[k] || 0) - sample * panning + sample;\r\n          rightChannelBuffer[k] = (rightChannelBuffer[k++] || 0) + sample * panning + sample;\r\n        }\r\n\r\n        // set up for next note\r\n        if (note) {\r\n          // set attenuation\r\n          attenuation = note % 1;\r\n          panning = patternChannel[1] || 0;\r\n          if (note |= 0) {\r\n            // get cached sample\r\n            sampleBuffer = sampleCache[\r\n              [\r\n                instrument = patternChannel[sampleOffset = 0] || 0,\r\n                note\r\n              ]\r\n            ] = sampleCache[[instrument, note]] || (\r\n                // add sample to cache\r\n                instrumentParameters = [...instruments[instrument]],\r\n                instrumentParameters[2] *= 2 ** ((note - 12) / 12),\r\n\r\n                // allow negative values to stop notes\r\n                note > 0 ? zzfxG(...instrumentParameters) : []\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      // update the sample offset\r\n      outSampleOffset = nextSampleOffset;\r\n    });\r\n  }\r\n\r\n  return [leftChannelBuffer, rightChannelBuffer];\r\n}\r\n/** \r\n * LittleJS Tile Layer System\r\n * <br> - Caches arrays of tiles to off screen canvas for fast rendering\r\n * <br> - Unlimted numbers of layers, allocates canvases as needed\r\n * <br> - Interfaces with EngineObject for collision\r\n * <br> - Collision layer is separate from visible layers\r\n * <br> - It is recommended to have a visible layer that matches the collision\r\n * <br> - Tile layers can be drawn to using their context with canvas2d\r\n * <br> - Drawn directly to the main canvas without using WebGL\r\n * @namespace TileCollision\r\n */\r\n\r\n'use strict';\r\n\r\n/** The tile collision layer array, use setTileCollisionData and getTileCollisionData to access\r\n *  @type {Array} \r\n *  @memberof TileCollision */\r\nlet tileCollision = [];\r\n\r\n/** Size of the tile collision layer\r\n *  @type {Vector2} \r\n *  @memberof TileCollision */\r\nlet tileCollisionSize = vec2();\r\n\r\n/** Clear and initialize tile collision\r\n *  @param {Vector2} size\r\n *  @memberof TileCollision */\r\nfunction initTileCollision(size)\r\n{\r\n    tileCollisionSize = size;\r\n    tileCollision = [];\r\n    for (let i=tileCollision.length = tileCollisionSize.area(); i--;)\r\n        tileCollision[i] = 0;\r\n}\r\n\r\n/** Set tile collision data\r\n *  @param {Vector2} pos\r\n *  @param {Number}  [data=0]\r\n *  @memberof TileCollision */\r\nconst setTileCollisionData = (pos, data=0)=>\r\n    pos.arrayCheck(tileCollisionSize) && (tileCollision[(pos.y|0)*tileCollisionSize.x+pos.x|0] = data);\r\n\r\n/** Get tile collision data\r\n *  @param {Vector2} pos\r\n *  @return {Number}\r\n *  @memberof TileCollision */\r\nconst getTileCollisionData = (pos)=>\r\n    pos.arrayCheck(tileCollisionSize) ? tileCollision[(pos.y|0)*tileCollisionSize.x+pos.x|0] : 0;\r\n\r\n/** Check if collision with another object should occur\r\n *  @param {Vector2}      pos\r\n *  @param {Vector2}      [size=Vector2(1,1)]\r\n *  @param {EngineObject} [object]\r\n *  @return {Boolean}\r\n *  @memberof TileCollision */\r\nfunction tileCollisionTest(pos, size=vec2(), object)\r\n{\r\n    const minX = max(pos.x - size.x/2|0, 0);\r\n    const minY = max(pos.y - size.y/2|0, 0);\r\n    const maxX = min(pos.x + size.x/2, tileCollisionSize.x);\r\n    const maxY = min(pos.y + size.y/2, tileCollisionSize.y);\r\n    for (let y = minY; y < maxY; ++y)\r\n    for (let x = minX; x < maxX; ++x)\r\n    {\r\n        const tileData = tileCollision[y*tileCollisionSize.x+x];\r\n        if (tileData && (!object || object.collideWithTile(tileData, new Vector2(x, y))))\r\n            return 1;\r\n    }\r\n}\r\n\r\n/** Return the center of tile if any that is hit (this does not return the exact hit point)\r\n *  @param {Vector2}      posStart\r\n *  @param {Vector2}      posEnd\r\n *  @param {EngineObject} [object]\r\n *  @return {Vector2}\r\n *  @memberof TileCollision */\r\nfunction tileCollisionRaycast(posStart, posEnd, object)\r\n{\r\n    // test if a ray collides with tiles from start to end\r\n    // todo: a way to get the exact hit point, it must still register as inside the hit tile\r\n    const posDelta = (posEnd = posEnd.floor()).subtract(posStart = posStart.floor());\r\n    const dx = abs(posDelta.x),  dy = -abs(posDelta.y);\r\n    const sx = sign(posDelta.x), sy = sign(posDelta.y);\r\n\r\n    for (let x = posStart.x, y = posStart.y, e = dx + dy;;)\r\n    {\r\n        const tileData = getTileCollisionData(vec2(x,y));\r\n        if (tileData && (object ? object.collideWithTileRaycast(tileData, new Vector2(x, y)) : tileData > 0))\r\n        {\r\n            debugRaycast && debugLine(posStart, posEnd, '#f00',.02, 1);\r\n            debugRaycast && debugPoint(new Vector2(x+.5, y+.5), '#ff0', 1);\r\n            return new Vector2(x+.5, y+.5);\r\n        }\r\n\r\n        // update Bresenham line drawing algorithm\r\n        if (x == posEnd.x & y == posEnd.y) break;\r\n        const e2 = 2*e;\r\n        if (e2 >= dy) e += dy, x += sx;\r\n        if (e2 <= dx) e += dx, y += sy;\r\n    }\r\n    debugRaycast && debugLine(posStart, posEnd, '#00f',.02, 1);\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Tile Layer Rendering System\r\n\r\n/**\r\n * Tile layer data object stores info about how to render a tile\r\n * @example\r\n * // create tile layer data with tile index 0 and random orientation and color\r\n * const tileIndex = 0;\r\n * const direction = randInt(4)\r\n * const mirror = randInt(2);\r\n * const color = randColor();\r\n * const data = new TileLayerData(tileIndex, direction, mirror, color);\r\n */\r\nclass TileLayerData\r\n{\r\n    /** Create a tile layer data object, one for each tile in a TileLayer\r\n     *  @param {Number}  [tile]          - The tile to use, untextured if undefined\r\n     *  @param {Number}  [direction=0]   - Integer direction of tile, in 90 degree increments\r\n     *  @param {Boolean} [mirror=0]      - If the tile should be mirrored along the x axis\r\n     *  @param {Color}   [color=Color()] - Color of the tile */\r\n    constructor(tile, direction=0, mirror=0, color=new Color())\r\n    {\r\n        /** @property {Number}  - The tile to use, untextured if undefined */\r\n        this.tile      = tile;\r\n        /** @property {Number}  - Integer direction of tile, in 90 degree increments */\r\n        this.direction = direction;\r\n        /** @property {Boolean} - If the tile should be mirrored along the x axis */\r\n        this.mirror    = mirror;\r\n        /** @property {Color}   - Color of the tile */\r\n        this.color     = color;\r\n    }\r\n\r\n    /** Set this tile to clear, it will not be rendered */\r\n    clear() { this.tile = this.direction = this.mirror = 0; color = new Color; }\r\n}\r\n\r\n/**\r\n * Tile layer object - cached rendering system for tile layers\r\n * <br> - Each Tile layer is rendered to an off screen canvas\r\n * <br> - To allow dynamic modifications, layers are rendered using canvas 2d\r\n * <br> - Some devices like mobile phones are limited to 4k texture resolution\r\n * <br> - So with 16x16 tiles this limits layers to 256x256 on mobile devices\r\n * @extends EngineObject\r\n * @example\r\n * // create tile collision and visible tile layer\r\n * initTileCollision(vec2(200,100));\r\n * const tileLayer = new TileLayer();\r\n */\r\nclass TileLayer extends EngineObject\r\n{\r\n/** Create a tile layer object\r\n    *  @param {Vector2} [position=Vector2()]       - World space position\r\n    *  @param {Vector2} [size=tileCollisionSize]   - World space size\r\n    *  @param {Vector2} [tileSize=tileSizeDefault] - Size of tiles in source pixels\r\n    *  @param {Vector2} [scale=Vector2(1,1)]       - How much to scale this layer when rendered\r\n    *  @param {Number}  [renderOrder=0]            - Objects sorted by renderOrder before being rendered\r\n    */\r\nconstructor(pos, size=tileCollisionSize, tileSize=tileSizeDefault, scale=vec2(1), renderOrder=0)\r\n    {\r\n        super(pos, size, -1, tileSize, 0, undefined, renderOrder);\r\n\r\n        /** @property {HTMLCanvasElement}        - The canvas used by this tile layer */\r\n        this.canvas = document.createElement('canvas');\r\n        /** @property {CanvasRenderingContext2D} - The 2D canvas context used by this tile layer */\r\n        this.context = this.canvas.getContext('2d');\r\n        /** @property {Vector2}                  - How much to scale this layer when rendered */\r\n        this.scale = scale;\r\n        /** @property {Boolean} [isOverlay=0]    - If true this layer will render to overlay canvas and appear above all objects */\r\n        this.isOverlay;\r\n\r\n        // init tile data\r\n        this.data = [];\r\n        for (let j = this.size.area(); j--;)\r\n            this.data.push(new TileLayerData);\r\n    }\r\n    \r\n    /** Set data at a given position in the array \r\n     *  @param {Vector2}       position   - Local position in array\r\n     *  @param {TileLayerData} data       - Data to set\r\n     *  @param {Boolean}       [redraw=0] - Force the tile to redraw if true */\r\n    setData(layerPos, data, redraw)\r\n    {\r\n        if (layerPos.arrayCheck(this.size))\r\n        {\r\n            this.data[(layerPos.y|0)*this.size.x+layerPos.x|0] = data;\r\n            redraw && this.drawTileData(layerPos);\r\n        }\r\n    }\r\n    \r\n    /** Get data at a given position in the array \r\n     *  @param {Vector2} layerPos - Local position in array\r\n     *  @return {TileLayerData} */\r\n    getData(layerPos)\r\n    { return layerPos.arrayCheck(this.size) && this.data[(layerPos.y|0)*this.size.x+layerPos.x|0]; }\r\n    \r\n    // Tile layers are not updated\r\n    update() {}\r\n\r\n    // Render the tile layer, called automatically by the engine\r\n    render()\r\n    {\r\n        ASSERT(mainContext != this.context); // must call redrawEnd() after drawing tiles\r\n\r\n        // flush and copy gl canvas because tile canvas does not use webgl\r\n        glEnable && !glOverlay && !this.isOverlay && glCopyToContext(mainContext);\r\n        \r\n        // draw the entire cached level onto the canvas\r\n        const pos = worldToScreen(this.pos.add(vec2(0,this.size.y*this.scale.y)));\r\n        (this.isOverlay ? overlayContext : mainContext).drawImage\r\n        (\r\n            this.canvas, pos.x, pos.y,\r\n            cameraScale*this.size.x*this.scale.x, cameraScale*this.size.y*this.scale.y\r\n        );\r\n    }\r\n\r\n    /** Draw all the tile data to an offscreen canvas \r\n     *  - This may be slow in some browsers\r\n    */\r\n    redraw()\r\n    {\r\n        this.redrawStart(1);\r\n        this.drawAllTileData();\r\n        this.redrawEnd();\r\n    }\r\n\r\n    /** Call to start the redraw process\r\n     *  @param {Boolean} [clear=0] - Should it clear the canvas before drawing */\r\n    redrawStart(clear = 0)\r\n    {\r\n        // save current render settings\r\n        this.savedRenderSettings = [mainCanvas, mainContext, mainCanvasSize, cameraPos, cameraScale];\r\n\r\n        // hack: use normal rendering system to render the tiles\r\n        mainCanvas = this.canvas;\r\n        mainContext = this.context;\r\n        cameraPos = this.size.scale(.5);\r\n        cameraScale = this.tileSize.x;\r\n\r\n        if (clear)\r\n        {\r\n            // clear and set size\r\n            mainCanvas.width  = this.size.x * this.tileSize.x;\r\n            mainCanvas.height = this.size.y * this.tileSize.y;\r\n        }\r\n\r\n        // begin a new render for the tile canvas\r\n        enginePreRender();\r\n    }\r\n\r\n    /** Call to end the redraw process */\r\n    redrawEnd()\r\n    {\r\n        ASSERT(mainContext == this.context); // must call redrawStart() before drawing tiles\r\n        glEnable && glCopyToContext(mainContext, 1);\r\n        //debugSaveCanvas(this.canvas);\r\n\r\n        // set stuff back to normal\r\n        [mainCanvas, mainContext, mainCanvasSize, cameraPos, cameraScale] = this.savedRenderSettings;\r\n    }\r\n\r\n    /** Draw the tile at a given position\r\n     *  @param {Vector2} layerPos */\r\n    drawTileData(layerPos)\r\n    {\r\n        // first clear out where the tile was\r\n        const pos = layerPos.floor().add(this.pos).add(vec2(.5));\r\n        this.drawCanvas2D(pos, vec2(1), 0, 0, (context)=>context.clearRect(-.5, -.5, 1, 1));\r\n\r\n        // draw the tile if not undefined\r\n        const d = this.getData(layerPos);\r\n        if (d.tile != undefined)\r\n        {\r\n            ASSERT(mainContext == this.context); // must call redrawStart() before drawing tiles\r\n            drawTile(pos, vec2(1), d.tile, this.tileSize, d.color, d.direction*PI/2, d.mirror);\r\n        }\r\n    }\r\n\r\n    /** Draw all the tiles in this layer */\r\n    drawAllTileData()\r\n    {\r\n        for (let x = this.size.x; x--;)\r\n        for (let y = this.size.y; y--;)\r\n             this.drawTileData(vec2(x,y));\r\n    }\r\n\r\n    /** Draw directly to the 2D canvas in world space (bipass webgl)\r\n     *  @param {Vector2}  pos\r\n     *  @param {Vector2}  size\r\n     *  @param {Number}   [angle=0]\r\n     *  @param {Boolean}  [mirror=0]\r\n     *  @param {Function} drawFunction */\r\n    drawCanvas2D(pos, size, angle=0, mirror, drawFunction)\r\n    {\r\n        const context = this.context;\r\n        context.save();\r\n        pos = pos.subtract(this.pos).multiply(this.tileSize);\r\n        size = size.multiply(this.tileSize);\r\n        context.translate(pos.x, this.canvas.height - pos.y);\r\n        context.rotate(angle);\r\n        context.scale(mirror ? -size.x : size.x, size.y);\r\n        drawFunction(context);\r\n        context.restore();\r\n    }\r\n\r\n    /** Draw a tile directly onto the layer canvas\r\n     *  @param {Vector2} pos\r\n     *  @param {Vector2} [size=Vector2(1,1)]\r\n     *  @param {Number}  [tileIndex=-1]\r\n     *  @param {Vector2} [tileSize=tileSizeDefault]\r\n     *  @param {Color}   [color=Color()]\r\n     *  @param {Number}  [angle=0]\r\n     *  @param {Boolean} [mirror=0] */\r\n    drawTile(pos, size=vec2(1), tileIndex=-1, tileSize=tileSizeDefault, color=new Color, angle, mirror)\r\n    {\r\n        this.drawCanvas2D(pos, size, angle, mirror, (context)=>\r\n        {\r\n            if (tileIndex < 0)\r\n            {\r\n                // untextured\r\n                context.fillStyle = color;\r\n                context.fillRect(-.5, -.5, 1, 1);\r\n            }\r\n            else\r\n            {\r\n                const cols = tileImage.width/tileSize.x;\r\n                context.globalAlpha = color.a; // only alpha, no color, is supported in this mode\r\n                context.drawImage(tileImage, \r\n                    (tileIndex%cols)*tileSize.x, (tileIndex/cols|0)*tileSize.y, \r\n                    tileSize.x, tileSize.y, -.5, -.5, 1, 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    /** Draw a rectangle directly onto the layer canvas\r\n     *  @param {Vector2} pos\r\n     *  @param {Vector2} [size=Vector2(1,1)]\r\n     *  @param {Color}   [color=Color()]\r\n     *  @param {Number}  [angle=0] */\r\n    drawRect(pos, size, color, angle) \r\n    { this.drawTile(pos, size, -1, 0, color, angle); }\r\n}\r\n/*\r\n    LittleJS Particle System\r\n    - Spawns particles with randomness from parameters\r\n    - Updates particle physics\r\n    - Fast particle rendering\r\n*/\r\n\r\n'use strict';\r\n\r\n/**\r\n * Particle Emitter - Spawns particles with the given settings\r\n * @extends EngineObject\r\n * @example\r\n * // create a particle emitter\r\n * let pos = vec2(2,3);\r\n * let particleEmiter = new ParticleEmitter\r\n * (\r\n *     pos, 0, 1, 0, 500, PI,  // pos, angle, emitSize, emitTime, emitRate, emiteCone\r\n *     0, vec2(16),                            // tileIndex, tileSize\r\n *     new Color(1,1,1),   new Color(0,0,0),   // colorStartA, colorStartB\r\n *     new Color(1,1,1,0), new Color(0,0,0,0), // colorEndA, colorEndB\r\n *     2, .2, .2, .1, .05,  // particleTime, sizeStart, sizeEnd, particleSpeed, particleAngleSpeed\r\n *     .99, 1, 1, PI, .05,  // damping, angleDamping, gravityScale, particleCone, fadeRate, \r\n *     .5, 1                // randomness, collide, additive, randomColorLinear, renderOrder\r\n * );\r\n */\r\nclass ParticleEmitter extends EngineObject\r\n{\r\n    /** Create a particle system with the given settings\r\n     *  @param {Vector2} position           - World space position of the emitter\r\n     *  @param {Number}  [angle=0]          - Angle to emit the particles\r\n     *  @param {Number}  [emitSize=0]       - World space size of the emitter (float for circle diameter, vec2 for rect)\r\n     *  @param {Number}  [emitTime=0]       - How long to stay alive (0 is forever)\r\n     *  @param {Number}  [emitRate=100]     - How many particles per second to spawn, does not emit if 0\r\n     *  @param {Number}  [emitConeAngle=PI] - Local angle to apply velocity to particles from emitter\r\n     *  @param {Number}  [tileIndex=-1]     - Index into tile sheet, if <0 no texture is applied\r\n     *  @param {Vector2} [tileSize=tileSizeDefault] - Tile size for particles\r\n     *  @param {Color}   [colorStartA=Color()] - Color at start of life 1, randomized between start colors\r\n     *  @param {Color}   [colorStartB=Color()] - Color at start of life 2, randomized between start colors\r\n     *  @param {Color}   [colorEndA=Color(1,1,1,0)] - Color at end of life 1, randomized between end colors\r\n     *  @param {Color}   [colorEndB=Color(1,1,1,0)] - Color at end of life 2, randomized between end colors\r\n     *  @param {Number}  [particleTime=.5]      - How long particles live\r\n     *  @param {Number}  [sizeStart=.1]         - How big are particles at start\r\n     *  @param {Number}  [sizeEnd=1]            - How big are particles at end\r\n     *  @param {Number}  [speed=.1]             - How fast are particles when spawned\r\n     *  @param {Number}  [angleSpeed=.05]       - How fast are particles rotating\r\n     *  @param {Number}  [damping=1]            - How much to dampen particle speed\r\n     *  @param {Number}  [angleDamping=1]       - How much to dampen particle angular speed\r\n     *  @param {Number}  [gravityScale=0]       - How much does gravity effect particles\r\n     *  @param {Number}  [particleConeAngle=PI] - Cone for start particle angle\r\n     *  @param {Number}  [fadeRate=.1]          - How quick to fade in particles at start/end in percent of life\r\n     *  @param {Number}  [randomness=.2]        - Apply extra randomness percent\r\n     *  @param {Boolean} [collideTiles=0]       - Do particles collide against tiles\r\n     *  @param {Boolean} [additive=0]           - Should particles use addtive blend\r\n     *  @param {Boolean} [randomColorLinear=1]  - Should color be randomized linearly or across each component\r\n     *  @param {Number}  [renderOrder=0]        - Render order for particles (additive is above other stuff by default)\r\n     *  @param {Boolean}  [localSpace=0]        - Should it be in local space of emitter (world space is default)\r\n     */\r\n    constructor\r\n    ( \r\n        pos,\r\n        angle,\r\n        emitSize = 0,\r\n        emitTime = 0,\r\n        emitRate = 100,\r\n        emitConeAngle = PI,\r\n        tileIndex = -1,\r\n        tileSize = tileSizeDefault,\r\n        colorStartA = new Color,\r\n        colorStartB = new Color,\r\n        colorEndA = new Color(1,1,1,0),\r\n        colorEndB = new Color(1,1,1,0),\r\n        particleTime = .5,\r\n        sizeStart = .1,\r\n        sizeEnd = 1,\r\n        speed = .1,\r\n        angleSpeed = .05,\r\n        damping = 1,\r\n        angleDamping = 1,\r\n        gravityScale = 0,\r\n        particleConeAngle = PI,\r\n        fadeRate = .1,\r\n        randomness = .2, \r\n        collideTiles,\r\n        additive,\r\n        randomColorLinear = 1,\r\n        renderOrder = additive ? 1e9 : 0,\r\n        localSpace\r\n    )\r\n    {\r\n        super(pos, new Vector2, tileIndex, tileSize, angle, undefined, renderOrder);\r\n\r\n        // emitter settings\r\n        /** @property {Number} - World space size of the emitter (float for circle diameter, vec2 for rect) */\r\n        this.emitSize = emitSize\r\n        /** @property {Number} - How long to stay alive (0 is forever) */\r\n        this.emitTime = emitTime;\r\n        /** @property {Number} - How many particles per second to spawn, does not emit if 0 */\r\n        this.emitRate = emitRate;\r\n        /** @property {Number} - Local angle to apply velocity to particles from emitter */\r\n        this.emitConeAngle = emitConeAngle;\r\n\r\n        // color settings\r\n        /** @property {Color} - Color at start of life 1, randomized between start colors */\r\n        this.colorStartA = colorStartA;\r\n        /** @property {Color} - Color at start of life 2, randomized between start colors */\r\n        this.colorStartB = colorStartB;\r\n        /** @property {Color} - Color at end of life 1, randomized between end colors */\r\n        this.colorEndA   = colorEndA;\r\n        /** @property {Color} - Color at end of life 2, randomized between end colors */\r\n        this.colorEndB   = colorEndB;\r\n        /** @property {Boolean} - Should color be randomized linearly or across each component */\r\n        this.randomColorLinear = randomColorLinear;\r\n\r\n        // particle settings\r\n        /** @property {Number} - How long particles live */\r\n        this.particleTime      = particleTime;\r\n        /** @property {Number} - How big are particles at start */\r\n        this.sizeStart         = sizeStart;\r\n        /** @property {Number} - How big are particles at end */\r\n        this.sizeEnd           = sizeEnd;\r\n        /** @property {Number} - How fast are particles when spawned */\r\n        this.speed             = speed;\r\n        /** @property {Number} - How fast are particles rotating */\r\n        this.angleSpeed        = angleSpeed;\r\n        /** @property {Number} - How much to dampen particle speed */\r\n        this.damping           = damping;\r\n        /** @property {Number} - How much to dampen particle angular speed */\r\n        this.angleDamping      = angleDamping;\r\n        /** @property {Number} - How much does gravity effect particles */\r\n        this.gravityScale      = gravityScale;\r\n        /** @property {Number} - Cone for start particle angle */\r\n        this.particleConeAngle = particleConeAngle;\r\n        /** @property {Number} - How quick to fade in particles at start/end in percent of life */\r\n        this.fadeRate          = fadeRate;\r\n        /** @property {Number} - Apply extra randomness percent */\r\n        this.randomness        = randomness;\r\n        /** @property {Number} - Do particles collide against tiles */\r\n        this.collideTiles      = collideTiles;\r\n        /** @property {Number} - Should particles use addtive blend */\r\n        this.additive          = additive;\r\n        /** @property {Boolean} - Should it be in local space of emitter */\r\n        this.localSpace          = localSpace;\r\n        /** @property {Number} - If set the partile is drawn as a trail, stretched in the drection of velocity */\r\n        this.trailScale        = 0;\r\n\r\n        // internal variables\r\n        this.emitTimeBuffer    = 0;\r\n    }\r\n    \r\n    /** Update the emitter to spawn particles, called automatically by engine once each frame */\r\n    update()\r\n    {\r\n        // only do default update to apply parent transforms\r\n        this.parent && super.update();\r\n\r\n        // update emitter\r\n        if (!this.emitTime | this.getAliveTime() <= this.emitTime)\r\n        {\r\n            // emit particles\r\n            if (this.emitRate * particleEmitRateScale)\r\n            {\r\n                const rate = 1/this.emitRate/particleEmitRateScale;\r\n                for (this.emitTimeBuffer += timeDelta; this.emitTimeBuffer > 0; this.emitTimeBuffer -= rate)\r\n                    this.emitParticle();\r\n            }\r\n        }\r\n        else\r\n            this.destroy();\r\n\r\n        debugParticles && debugRect(this.pos, vec2(this.emitSize), '#0f0', 0, this.angle);\r\n    }\r\n\r\n    /** Spawn one particle\r\n     *  @return {Particle} */\r\n    emitParticle()\r\n    {\r\n        // spawn a particle\r\n        let pos = this.emitSize.x != undefined ? // check if vec2 was used for size\r\n            (new Vector2(rand(-.5,.5), rand(-.5,.5)))\r\n                .multiply(this.emitSize).rotate(this.angle) // box emitter\r\n            : randInCircle(this.emitSize/2);                // circle emitter\r\n        let angle = rand(this.particleConeAngle, -this.particleConeAngle);\r\n        if (!this.localSpace)\r\n        {\r\n            pos = this.pos.add(pos);\r\n            angle += this.angle;\r\n        }\r\n            \r\n        const particle = new Particle(pos, this.tileIndex, this.tileSize, angle);\r\n\r\n        // randomness scales each paremeter by a percentage\r\n        const randomness = this.randomness;\r\n        const randomizeScale = (v)=> v + v*rand(randomness, -randomness);\r\n\r\n        // randomize particle settings\r\n        const particleTime  = randomizeScale(this.particleTime);\r\n        const sizeStart     = randomizeScale(this.sizeStart);\r\n        const sizeEnd       = randomizeScale(this.sizeEnd);\r\n        const speed         = randomizeScale(this.speed);\r\n        const angleSpeed    = randomizeScale(this.angleSpeed) * randSign();\r\n        const coneAngle     = rand(this.emitConeAngle, -this.emitConeAngle);\r\n        const colorStart    = randColor(this.colorStartA, this.colorStartB, this.randomColorLinear);\r\n        const colorEnd      = randColor(this.colorEndA,   this.colorEndB, this.randomColorLinear);\r\n        const velocityAngle = this.localSpace ? coneAngle : this.angle + coneAngle;\r\n\r\n        // build particle settings\r\n        particle.colorStart    = colorStart;\r\n        particle.colorEndDelta = colorEnd.subtract(colorStart);\r\n        particle.velocity      = (new Vector2).setAngle(velocityAngle, speed);\r\n        particle.angleVelocity = angleSpeed;\r\n        particle.lifeTime      = particleTime;\r\n        particle.sizeStart     = sizeStart;\r\n        particle.sizeEndDelta  = sizeEnd - sizeStart;\r\n        particle.fadeRate      = this.fadeRate;\r\n        particle.damping       = this.damping;\r\n        particle.angleDamping  = this.angleDamping;\r\n        particle.elasticity    = this.elasticity;\r\n        particle.friction      = this.friction;\r\n        particle.gravityScale  = this.gravityScale;\r\n        particle.collideTiles  = this.collideTiles;\r\n        particle.additive      = this.additive;\r\n        particle.renderOrder   = this.renderOrder;\r\n        particle.trailScale    = this.trailScale;\r\n        particle.mirror        = randInt(2);\r\n        particle.localSpaceEmitter = this.localSpace && this;\r\n\r\n        // setup callbacks for particles\r\n        particle.destroyCallback = this.particleDestroyCallback;\r\n        this.particleCreateCallback && this.particleCreateCallback(particle);\r\n\r\n        // return the newly created particle\r\n        return particle;\r\n    }\r\n\r\n    // Particle emitters are not rendered, only the particles are\r\n    render() {}\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n/**\r\n * Particle Object - Created automatically by Particle Emitters\r\n * @extends EngineObject\r\n */\r\nclass Particle extends EngineObject\r\n{\r\n    /**\r\n     * Create a particle with the given settings\r\n     * @param {Vector2} position                   - World space position of the particle\r\n     * @param {Number}  [tileIndex=-1]             - Tile to use to render, untextured if -1\r\n     * @param {Vector2} [tileSize=tileSizeDefault] - Size of tile in source pixels\r\n     * @param {Number}  [angle=0]                  - Angle to rotate the particle\r\n     */\r\n    constructor(pos, tileIndex, tileSize, angle)\r\n    { super(pos, new Vector2, tileIndex, tileSize, angle); }\r\n\r\n    /** Render the particle, automatically called each frame, sorted by renderOrder */\r\n    render()\r\n    {\r\n        // modulate size and color\r\n        const p = min((time - this.spawnTime) / this.lifeTime, 1);\r\n        const radius = this.sizeStart + p * this.sizeEndDelta;\r\n        const size = new Vector2(radius, radius);\r\n        const fadeRate = this.fadeRate/2;\r\n        const color = new Color(\r\n            this.colorStart.r + p * this.colorEndDelta.r,\r\n            this.colorStart.g + p * this.colorEndDelta.g,\r\n            this.colorStart.b + p * this.colorEndDelta.b,\r\n            (this.colorStart.a + p * this.colorEndDelta.a) * \r\n             (p < fadeRate ? p/fadeRate : p > 1-fadeRate ? (1-p)/fadeRate : 1)); // fade alpha\r\n\r\n        // draw the particle\r\n        this.additive && setBlendMode(1);\r\n\r\n        let pos = this.pos, angle = this.angle;\r\n        if (this.localSpaceEmitter)\r\n        {\r\n            // in local space of emitter\r\n            pos = this.localSpaceEmitter.pos.add(pos.rotate(-this.localSpaceEmitter.angle)); \r\n            angle += this.localSpaceEmitter.angle;\r\n        }\r\n        if (this.trailScale)\r\n        {\r\n            // trail style particles\r\n            let velocity = this.velocity;\r\n            if (this.localSpaceEmitter)\r\n                velocity = velocity.rotate(-this.localSpaceEmitter.angle);\r\n            const speed = velocity.length();\r\n            const direction = velocity.scale(1/speed);\r\n            const trailLength = speed * this.trailScale;\r\n            size.y = max(size.x, trailLength);\r\n            angle = direction.angle();\r\n            drawTile(pos.add(direction.multiply(vec2(0,-trailLength/2))), size, this.tileIndex, this.tileSize, color, angle, this.mirror);\r\n        }\r\n        else\r\n            drawTile(pos, size, this.tileIndex, this.tileSize, color, angle, this.mirror);\r\n        this.additive && setBlendMode();\r\n        debugParticles && debugRect(pos, size, '#f005', 0, angle);\r\n\r\n        if (p == 1)\r\n        {\r\n            // destroy particle when it's time runs out\r\n            this.color = color;\r\n            this.size = size;\r\n            this.destroyCallback && this.destroyCallback(this);\r\n            this.destroyed = 1;\r\n        }\r\n    }\r\n}\r\n/** \r\n * LittleJS Medal System\r\n * <br> - Tracks and displays medals\r\n * <br> - Saves medals to local storage\r\n * <br> - Newgrounds integration\r\n * @namespace Medals\r\n */\r\n\r\n'use strict';\r\n\r\n/** List of all medals\r\n *  @type {Array}\r\n *  @memberof Medals */\r\nconst medals = [];\r\n\r\n// Engine internal variables not exposed to documentation\r\nlet medalsDisplayQueue = [], medalsSaveName, medalsDisplayTimeLast;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** Initialize medals with a save name used for storage\r\n *  <br> - Call this after creating all medals\r\n *  <br> - Checks if medals are unlocked\r\n *  @param {String} saveName\r\n *  @memberof Medals */\r\nfunction medalsInit(saveName)\r\n{\r\n    // check if medals are unlocked\r\n    medalsSaveName = saveName;\r\n    debugMedals || medals.forEach(medal=> medal.unlocked = (localStorage[medal.storageKey()] | 0));\r\n}\r\n\r\n/** \r\n * Medal Object - Tracks an unlockable medal \r\n * @example\r\n * // create a medal\r\n * const medal_example = new Medal(0, 'Example Medal', 'More info about the medal goes here.', '🎖️');\r\n * \r\n * // initialize medals\r\n * medalsInit('Example Game');\r\n * \r\n * // unlock the medal\r\n * medal_example.unlock();\r\n */\r\nclass Medal\r\n{\r\n    /** Create an medal object and adds it to the list of medals\r\n     *  @param {Number} id            - The unique identifier of the medal\r\n     *  @param {String} name          - Name of the medal\r\n     *  @param {String} [description] - Description of the medal\r\n     *  @param {String} [icon='🏆']  - Icon for the medal\r\n     *  @param {String} [src]         - Image location for the medal\r\n     */\r\n    constructor(id, name, description='', icon='🏆', src)\r\n    {\r\n        ASSERT(id >= 0 && !medals[id]);\r\n\r\n        // save attributes and add to list of medals\r\n        medals[this.id = id] = this;\r\n        this.name = name;\r\n        this.description = description;\r\n        this.icon = icon;\r\n        if (src)\r\n            (this.image = new Image).src = src;\r\n    }\r\n\r\n    /** Unlocks a medal if not already unlocked */\r\n    unlock()\r\n    {\r\n        if (medalsPreventUnlock || this.unlocked)\r\n            return;\r\n\r\n        // save the medal\r\n        ASSERT(medalsSaveName); // save name must be set\r\n        localStorage[this.storageKey()] = this.unlocked = 1;\r\n        medalsDisplayQueue.push(this);\r\n        newgrounds && newgrounds.unlockMedal(this.id);\r\n    }\r\n\r\n    /** Render a medal\r\n     *  @param {Number} [hidePercent=0] - How much to slide the medal off screen\r\n     */\r\n    render(hidePercent=0)\r\n    {\r\n        const context = overlayContext;\r\n        const width = min(medalDisplaySize.x, mainCanvas.width);\r\n        const x = overlayCanvas.width - width;\r\n        const y = -medalDisplaySize.y*hidePercent;\r\n\r\n        // draw containing rect and clip to that region\r\n        context.save();\r\n        context.beginPath();\r\n        context.fillStyle = new Color(.9,.9,.9);\r\n        context.strokeStyle = new Color(0,0,0);\r\n        context.lineWidth = 3;\r\n        context.fill(context.rect(x, y, width, medalDisplaySize.y));\r\n        context.stroke();\r\n        context.clip();\r\n\r\n        // draw the icon and text\r\n        this.renderIcon(vec2(x+15+medalDisplayIconSize/2, y+medalDisplaySize.y/2));\r\n        const pos = vec2(x+medalDisplayIconSize+30, y+28);\r\n        drawTextScreen(this.name, pos, 38, new Color(0,0,0), 0, 0, 'left');\r\n        pos.y += 32;\r\n        drawTextScreen(this.description, pos, 24, new Color(0,0,0), 0, 0, 'left');\r\n        context.restore();\r\n    }\r\n\r\n    /** Render the icon for a medal\r\n     *  @param {Number} x - Screen space X position\r\n     *  @param {Number} y - Screen space Y position\r\n     *  @param {Number} [size=medalDisplayIconSize] - Screen space size\r\n     */\r\n    renderIcon(pos, size=medalDisplayIconSize)\r\n    {\r\n        // draw the image or icon\r\n        if (this.image)\r\n            overlayContext.drawImage(this.image, pos.x-size/2, pos.y-size/2, size, size);\r\n        else\r\n            drawTextScreen(this.icon, pos, size*.7, new Color(0,0,0));\r\n    }\r\n \r\n    // Get local storage key used by the medal\r\n    storageKey() { return medalsSaveName + '_' + this.id; }\r\n}\r\n\r\n// engine automatically renders medals\r\nfunction medalsRender()\r\n{\r\n    if (!medalsDisplayQueue.length)\r\n        return;\r\n    \r\n    // update first medal in queue\r\n    const medal = medalsDisplayQueue[0];\r\n    const time = timeReal - medalsDisplayTimeLast;\r\n    if (!medalsDisplayTimeLast)\r\n        medalsDisplayTimeLast = timeReal;\r\n    else if (time > medalDisplayTime)\r\n        medalsDisplayQueue.shift(medalsDisplayTimeLast = 0);\r\n    else\r\n    {\r\n        // slide on/off medals\r\n        const slideOffTime = medalDisplayTime - medalDisplaySlideTime;\r\n        const hidePercent = \r\n            time < medalDisplaySlideTime ? 1 - time / medalDisplaySlideTime :\r\n            time > slideOffTime ? (time - slideOffTime) / medalDisplaySlideTime : 0;\r\n        medal.render(hidePercent);\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n// global Newgrounds object\r\nlet newgrounds;\r\n\r\n/** This can used to enable Newgrounds functionality\r\n *  @param {Number} app_id   - The newgrounds App ID\r\n *  @param {String} [cipher] - The encryption Key (AES-128/Base64)\r\n *  @memberof Medals */\r\nfunction newgroundsInit(app_id, cipher) { newgrounds = new Newgrounds(app_id, cipher); }\r\n\r\n/** \r\n * Newgrounds API wrapper object\r\n * @example\r\n * // create a newgrounds object, replace the app id and cipher with your own\r\n * const app_id = '53123:1ZuSTQ9l';\r\n * const cipher = 'enF0vGH@Mj/FRASKL23Q==';\r\n * newgrounds = new Newgrounds(app_id, cipher);\r\n */\r\nclass Newgrounds\r\n{\r\n    /** Create a newgrounds object\r\n     *  @param {Number} app_id   - The newgrounds App ID\r\n     *  @param {String} [cipher] - The encryption Key (AES-128/Base64) */\r\n    constructor(app_id, cipher)\r\n    {\r\n        ASSERT(!newgrounds && app_id);\r\n\r\n        this.app_id = app_id;\r\n        this.cipher = cipher;\r\n        this.host = location ? location.hostname : '';\r\n        \r\n        // create an instance of CryptoJS for encrypted calls\r\n        if (cipher)\r\n            this.cryptoJS = this.CryptoJS();\r\n\r\n        // get session id from url search params\r\n        const url = new URL(location.href);\r\n        this.session_id = url.searchParams.get('ngio_session_id');\r\n\r\n        if (!this.session_id)\r\n            return; // only use newgrounds when logged in\r\n\r\n        // get medals\r\n        const medalsResult = this.call('Medal.getList');\r\n        this.medals = medalsResult ? medalsResult.result.data['medals'] : [];\r\n        debugMedals && console.log(this.medals);\r\n        for (const newgroundsMedal of this.medals)\r\n        {\r\n            const medal = medals[newgroundsMedal['id']];\r\n            if (medal)\r\n            {\r\n                // copy newgrounds medal data\r\n                medal.image =       new Image;\r\n                medal.image.src =   newgroundsMedal['icon'];\r\n                medal.name =        newgroundsMedal['name'];\r\n                medal.description = newgroundsMedal['description'];\r\n                medal.unlocked =    newgroundsMedal['unlocked'];\r\n                medal.difficulty =  newgroundsMedal['difficulty'];\r\n                medal.value =       newgroundsMedal['value'];\r\n\r\n                if (medal.value)\r\n                    medal.description = medal.description + ' (' + medal.value + ')';\r\n            }\r\n        }\r\n    \r\n        // get scoreboards\r\n        const scoreboardResult = this.call('ScoreBoard.getBoards');\r\n        this.scoreboards = scoreboardResult ? scoreboardResult.result.data.scoreboards : [];\r\n        debugMedals && console.log(this.scoreboards);\r\n\r\n        const keepAliveMS = 5 * 60 * 1e3;\r\n        setInterval(()=>this.call('Gateway.ping', 0, 1), keepAliveMS);\r\n    }\r\n\r\n    /** Send message to unlock a medal by id\r\n     * @param {Number} id - The medal id */\r\n    unlockMedal(id) { return this.call('Medal.unlock', {'id':id}, 1); }\r\n\r\n    /** Send message to post score\r\n     * @param {Number} id    - The scoreboard id\r\n     * @param {Number} value - The score value */\r\n    postScore(id, value) { return this.call('ScoreBoard.postScore', {'id':id, 'value':value}, 1); }\r\n\r\n    /** Get scores from a scoreboard\r\n     * @param {Number} id         - The scoreboard id\r\n     * @param {String} [user=0]   - A user's id or name\r\n     * @param {Number} [social=0] - If true, only social scores will be loaded\r\n     * @param {Number} [skip=0]   - Number of scores to skip before start\r\n     * @param {Number} [limit=10] - Number of scores to include in the list\r\n     * @return {Object}           - The response JSON object\r\n     */\r\n    getScores(id, user=0, social=0, skip=0, limit=10)\r\n    { return this.call('ScoreBoard.getScores', {'id':id, 'user':user, 'social':social, 'skip':skip, 'limit':limit}); }\r\n\r\n    /** Send message to log a view */\r\n    logView() { return this.call('App.logView', {'host':this.host}, 1); }\r\n\r\n    /** Send a message to call a component of the Newgrounds API\r\n     * @param {String}  component      - Name of the component\r\n     * @param {Object}  [parameters=0] - Parameters to use for call\r\n     * @param {Boolean} [async=0]      - If true, don't wait for response before continuing (avoid stall)\r\n     * @return {Object}                - The response JSON object\r\n     */\r\n    call(component, parameters=0, async=0)\r\n    {\r\n        const call = {'component':component, 'parameters':parameters};\r\n        if (this.cipher)\r\n        {\r\n            // encrypt using AES-128 Base64 with cryptoJS\r\n            const cryptoJS = this.cryptoJS;\r\n            const aesKey = cryptoJS['enc']['Base64']['parse'](this.cipher);\r\n            const iv = cryptoJS['lib']['WordArray']['random'](16);\r\n            const encrypted = cryptoJS['AES']['encrypt'](JSON.stringify(call), aesKey, {'iv':iv});\r\n            call['secure'] = cryptoJS['enc']['Base64']['stringify'](iv.concat(encrypted['ciphertext']));\r\n            call['parameters'] = 0;\r\n        }\r\n\r\n        // build the input object\r\n        const input = \r\n        {\r\n            'app_id':     this.app_id,\r\n            'session_id': this.session_id,\r\n            'call':       call\r\n        };\r\n\r\n        // build post data\r\n        const formData = new FormData();\r\n        formData.append('input', JSON.stringify(input));\r\n        \r\n        // send post data\r\n        const xmlHttp = new XMLHttpRequest();\r\n        const url = 'https://newgrounds.io/gateway_v3.php';\r\n        xmlHttp.open('POST', url, !debugMedals && async);\r\n        xmlHttp.send(formData);\r\n        debugMedals && console.log(xmlHttp.responseText);\r\n        return xmlHttp.responseText && JSON.parse(xmlHttp.responseText);\r\n    }\r\n\r\n    CryptoJS()\r\n    {\r\n        ///////////////////////////////////////////////////////////////////////////////\r\n        // Crypto-JS - https://github.com/brix/crypto-js [The MIT License (MIT)]\r\n        // Copyright (c) 2009-2013 Jeff Mott  Copyright (c) 2013-2016 Evan Vosberg\r\n\r\n        return eval(Function(\"[M='GBMGXz^oVYPPKKbB`agTXU|LxPc_ZBcMrZvCr~wyGfW\u001crwk@ATqlqeTp^N?p{\u001cwe}jIpEnB_sEr`l?YDkDhWhprc|Er|XETG?pTl`\u001ce}dIc[_N~}fzRycIfpW{HTolvoPB_FMe_eH~BTMx]yyOhv?biWPC\u001cGc]kABencBhgERHGf{OL`Dj`c^sh@canhy[secghiyotcdOWgO{tJIE^JtdGQRNSCrwKYciZOa]Y@tcRATYKzv|sXpboHcbCBf`}SKeXPFM|RiJsSNaIb]QPc[D]Jy_O^XkOVTZep`ONmntLL`Qz~UupHBX_Ia~WX]yTRJIxG`ioZ{fefLJFhdyYoyLPvqgH?b`[TMnTwwfzDXhfM?rKs^aFr|nyBdPmVHTtAjXoYUloEziWDCw_suyYT~lSMksI~ZNCS[Bex~j]Vz?kx`gdYSEMCsHpjbyxQvw|XxX_^nQYue{sBzVWQKYndtYQMWRef{bOHSfQhiNdtR{o?cUAHQAABThwHPT}F{VvFmgN`E@FiFYS`UJmpQNM`\u001cX|tPKHlccT}z}k{sACHL?Rt@MkWplxO`ASgh?hBsuuP|xD~LSH~KBlRs]t|l|_tQAroDRqWS^SEr[sYdPB}TAROtW{mIkE|dWOuLgLmJrucGLpebrAFKWjikTUzS|j}M}szasKOmrjy[?hpwnEfX[jGpLt@^v_e\u001cNwSQHNwtOtDgWD{rk|UgASs@mziIXrsHN_|hZuxXlPJOsA^^?QY^yGoCBx{ekLuZzRqQZdsNSx@ezDAn{XNj@fRXIwrDX?{ZQHwTEfu@GhxDO\u001cykqts|n{jOeZ@c`dvTY?e^]ATvWpb?SVyg]GC?SlzteilZJAL]mlhLjYZazY__qcVFYvt@|bIQnSno@OXyt]OulzkWqH`rYFWrwGs\u001c`v|~XeTsIssLrbmHZCYHiJrX}eEzSssH}]l]IhPQhPoQ}rCXLyhFIT[clhzYO\u001cvyHqigxmjz`phKUU^T\u001cPf[GRAIhNqSOdayFP@FmKmuIzMOeoqdpxyCOwCthcLq?n`L`tLIBboNn~uXeFcPE{C~mC`h]jUUUQe^`UqvzCutYCgct|SBrAeiYQW?X~KzCz}guXbsUw?pLsg@hDArw?Ke\u001cJD[BN?GD@\u001cwgFWCiHq@Ypp_QKFixEKWqRp]oJFuVIEvjDcTFu~Zz]a{IcXhWuIdMQjJ]lwmGQ|]g~c]Hl]pl`Pd^?loIcsoNir_kikBYyg?NarXZEGYspt_vLBIoj}LI[uBFvm}tbqvC|xyR~a{kob|HlctZslTGtPDhBKsNsoZPuH`U`Fqg{gKnGSHVLJ^O`zmNgMn~{rsQuoymw^JY\u001c?iUBvw_~mMr|G\u001crPHTERS[\u001c\u001cMiNpY[Mm{ggHpzRaJaoFomtdaQ_?xuTRm}@KjU~RtPsAdxa|uHmy}n^i||FVL[eQAPrWfLm^ndczgF~Nk~aplQvTUpHvnTya\u001c]\u001c\u001ckOenZlLAQIm{lPl@CCTchvCF[fI{^zPkeYZTiamoEcKmBMf\u001cZhk_j_~Fjp|wPVZlkh_nHu]@tP|hS@^G^PdsQ~f[RqgTDqezxNFcaO}HZhb|MMiNSYSAnQWCDJukT~e|OTgc}sf[cnr?fyzTa|EwEtRG|I~|IO}O]S|rp]CQ}}DWhSjC_|z|oY|FYl@WkCOoPuWuqr{fJu?Brs^_EBI[@_OCKs}?]O`jnDiXBvaIWhhMAQDNb{U`bqVR}oqVAvR@AZHEBY@depD]OLh`kf^UsHhzKT}CS}HQKy}Q~AeMydXPQztWSSzDnghULQgMAmbWIZ|lWWeEXrE^EeNoZApooEmrXe{NAnoDf`m}UNlRdqQ@jOc~HLOMWs]IDqJHYoMziEedGBPOxOb?[X`KxkFRg@`mgFYnP{hSaxwZ\u001cfBQq\u001cTm}_?RSEaQga]w[vxc]\u001chMne}VfSlqUeMo_iqmd`\u001cilnJXnhdj^EEFifvZyxYFRf^VaqBhLyrGlk~qowqzHOBlOwtx?i{m~`n^G?Yxzxux}b{LSlx]dS~thO^lYE}bzKmUEzwW^{rPGhbEov[Plv\u001c??xtyKJshbG`KuO?hjBdS@Ru}iGpvFXJRrvOlrKN?`I_n_tplk}kgwSXuKylXbRQ]]?a|{xiT[li?k]CJpwy^o@ebyGQrPfF`aszGKp]baIx~H?ElETtFh]dz[OjGl@C?]VDhr}OE@V]wLTc[WErXacM{We`F|utKKjgllAxvsVYBZ@HcuMgLboFHVZmi}eIXAI\u001cFhS@A@FGRbjeoJWZ_NKd^oEH`qgy`q[Tq{x?\u001cLRP|GfBFFJV|fgZs`MLbpPYUdIV^]mD@FG]pYAT^A^RNCcXVrPsgk{jTrAIQPs_`mD}\u001crOqAZA[}RETFz]WkXFTz_m{N@{W@_fPKZLT`@aIqf|L^Mb|crNqZ{BVsijzpGPEKQQZGlApDn`ruH}cvF|iXcNqK}\u001ccxe_U~HRnKV}sCYb`D~oGvwG[Ca|UaybXea~DdD~LiIbGRxJ_VGheI{ika}KC\u001c[OZJLn^I\u001cBkPrQj\u001c_EuoFwZ}DpoBRcK]Q}?EmTv~i_Tul{bky?Iit~tgS|o}JL_VYcCQdjeJ_\u001cMfaA`FgCgc[Ii|CBHwq~nbJeYTK{e`CNstKfTKPzw{jdhp|qsZyP_FcugxCFNpKitlR~vUrx^NrSVsSTaEgnxZTmKc`R|lGJeX}ccKLsQZQhsFkeFd|ckHIVTlGMg`~uPwuHRJS_CPuN_ogXe{Ba}dO_UBhuNXby|h?JlgBIqMKx^_u{molgL\u001c[W_iavNQuOq?ap]PGB`clAicnl@k~pA?MWHEZ{HuT\u001cLsCpOxxrK\u001clBh]FyMjLdFl|nMIvTHyGAlPogqfZ?PlvlFJvYnDQd}R@uAhtJmDfe|iJqdkYr}r@mEjjIetDl_I`TELfoR|qTBu@Tic[BaXjP?dCS~MUK[HPRI}OUOwAaf|_}HZzrwXvbnNgltjTwkBE~MztTQhtRSWoQHajMoVyBBA`kdgK~\u001ch`o[J`dm~pm]tk@i`[F~F]DBlJKklrkR]SNw@{aG~Vhl`KIN\u001csQkOy?WhcqUMTGDOM_]bUjVd|Yh_KUCCgIJ|LDIGZCPls{\u001cRzbVWVLEhHvWBzKq|^N?Dy\u001cJB|__aCUjoE\u001cgsARki}j@DQXS`RNU|DJ^\u001ca~d{sh_Iu\u001c{ONcUtSrGWW@cvUjefHHi}eSSGrNtO?cTPBShLqzwMVjWQQCCFB^culBjZHEK_{dO~Q`YhJYFn]jq~XSnG@[lQr]eKrjXpG~L^h~tDgEma^AUFThlaR{xyuP@[^VFwXSeUbVetufa@dX]CLyAnDV@Bs[DnpeghJw^?UIana}r_CKGDySoRudklbgio}kIDpA@McDoPK?iYcG?_zOmnWfJp}a[JL\u001cR[stXMo?_^Ng[whQlrDbrawZeSZ~SJstIObdDSfAA{MV}?gNunLOnbMv_\u001c~KFQUAjIMj^GkoGxuYtYbGDImEYiwEMyTpMxN_LSnSMdl{bg@dtAnAMvhDTBR_FxoQgANniRqxd`pWv@rFJ|mWNWmh[GMJz_Nq`BIN@KsjMPASXORcdHjf~rJfgZYe_uulzqM_KdPlMsuvU^YJuLtofPhGonVOQxCMuXliNvJIaoC?h\u001cSxcxKVVxWlNs^ENDv\u001cCtSmO~WxI\u001c[itnjs^RDvI@KqG}YekaSbTaB]ki]XM@[ZnDAP~@|BzLRgOzmjmPkRE@_sobk\u001cT|SszXK[rZN?F]Z_u}\u001cYue^[\u001cBZgLtR}FHzWyxWEX^wXC]MJmiVbQuBzkgRcKGUhOvUc_bga|Tx`\u001cKEM\u001c`JWEgTpFYVeXLCm|mctZR@uKTDeUONPozBeIkrY`cz]]~WPGMUf`MNUGHDbxZuO{gmsKYkAGRPqjc|_FtblEOwy}dnwCHo]PJhN~JoteaJ?dmYZeB^Xd?X^pOKDbOMF@Ugg^hETLdhwlA}PL@_ur|o{VZosP?ntJ_kG][g{Zq`Tu]dzQlSWiKfnxDnk}KOzp~tdFstMobmy[oPYjyOtUzMWdjcNSUAjRuqhLS@A\u001cwB^{BFnqjCmmlk?jpn}TksS{KcKkDboXiwK]qMVjm~V`LgWhjS^nLGwfhAYrjDSBL_{cRus~{?xar_xqPlArrYFd?pHKdMEZzzjJpfC?Hv}mAuIDkyBxFpxhstTx`IO{rp}XGuQ]VtbHerlRc_LFGWK[XluFcNGUtDYMZny[M^nVKVeMllQI[xtvwQnXFlWYqxZZFp_|]^oWX[{pOMpxXxvkbyJA[DrPzwD|LW|QcV{\u001cNw~U^dgguSpG]ClmO@j_TENIGjPWwgdVbHganhM?ema\u001c|dBaqla|WBd`\u001cpoj~klxaasKxGG^xbWquAl~_lKWxUkDFagMnE{zHug{b`A~IYcQYBF_E}wiA}K@yxWHrZ{[d~|ARsYsjeNWzkMs~IOqqp[yzD\u001c\u001cE|WFrivsidTcnbHFRoW@XpAV`lv_zj?B~tPCppRjgbbDTALeFaOf?VcjnKTQMLyp{NwdylHCqmo?oelhjWuXj~}{fpuX`fra?GNkDiChYgVSh{R[BgF~eQa^WVz}ATI_CpY?g_diae]|ijH`TyNIF}|D_xpmBq_JpKih{Ba|sWzhnAoyraiDvk`h{qbBfsylBGmRH}DRPdryEsSaKS~tIaeF[s]I~xxHVrcNe@Jjxa@jlhZueLQqHh_]twVMqG_EGuwyab{nxOF?`HCle}nBZzlTQjkLmoXbXhOtBglFoMz?eqre`HiE@vNwBulglmQjj]DB@pPkPUgA^sjOA\u001cUNdSu_`oA\u001czar\u001c?n?eMnw{{hYmslYi[TnlJD'\",...']charCodeAtUinyxpf',\"for(;e<10359;c[e++]=p-=128,A=A?p-A&&A:p==34&&p)for(p=1;p<128;y=f.map((n,x)=>(U=r[n]*2+1,U=Math.log(U/(h-U)),t-=a[x]*U,U/500)),t=~-h/(1+Math.exp(t))|1,i=o%h<t,o=o%h+(i?t:h-t)*(o>>17)-!i*t,f.map((n,x)=>(U=r[n]+=(i*h/2-r[n]<<13)/((C[n]+=C[n]<5)+1/20)>>13,a[x]+=y[x]*(i-t/h))),p=p*2+i)for(f='010202103203210431053105410642065206541'.split(t=0).map((n,x)=>(U=0,[...n].map((n,x)=>(U=U*997+(c[e-n]|0)|0)),h*32-1&U*997+p+!!A*129)*12+x);o<h*32;o=o*64|M.charCodeAt(d++)&63);for(C=String.fromCharCode(...c);r=/[\\0-\u001f#?@\\\\\\\\~]/.exec(C);)with(C.split(r))C=join(shift());return C\")([],[],1<<17,[0,0,0,0,0,0,0,0,0,0,0,0],new Uint16Array(51e6).fill(1<<15),new Uint8Array(51e6),0,0,0,0));\r\n    }\r\n}\r\n/** \r\n * LittleJS WebGL Interface\r\n * <br> - All webgl used by the engine is wrapped up here\r\n * <br> - For normal stuff you won't need to see or call anything in this file\r\n * <br> - For advanced stuff there are helper functions to create shaders, textures, etc\r\n * <br> - Can be disabled with glEnable to revert to 2D canvas rendering\r\n * <br> - Batches sprite rendering on GPU for incredibly fast performance\r\n * <br> - Sprite transform math is done in the shader where possible\r\n * @namespace WebGL\r\n */\r\n\r\n'use strict';\r\n\r\n/** The WebGL canvas which appears above the main canvas and below the overlay canvas\r\n *  @type {HTMLCanvasElement}\r\n *  @memberof WebGL */\r\nlet glCanvas;\r\n\r\n/** 2d context for glCanvas \r\n *  @type {WebGLRenderingContext}\r\n *  @memberof WebGL */\r\nlet glContext;\r\n\r\n/** Main tile sheet texture automatically loaded by engine\r\n *  @type {WebGLTexture}\r\n *  @memberof WebGL */\r\nlet glTileTexture;\r\n\r\n// WebGL internal variables not exposed to documentation\r\nlet glActiveTexture, glShader, glArrayBuffer, glPositionData, glColorData, glBatchCount, glBatchAdditive, glAdditive;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n// Init WebGL, called automatically by the engine\r\nfunction glInit()\r\n{\r\n    // create the canvas and tile texture\r\n    glCanvas = document.createElement('canvas');\r\n    glContext = glCanvas.getContext('webgl', {antialias: false});\r\n    glTileTexture = glCreateTexture(tileImage);\r\n\r\n    // some browsers are much faster without copying the gl buffer so we just overlay it instead\r\n    glOverlay && document.body.appendChild(glCanvas);\r\n\r\n    // setup vertex and fragment shaders\r\n    glShader = glCreateProgram(\r\n        'precision highp float;'+     // use highp for better accuracy\r\n        'uniform mat4 m;'+            // transform matrix\r\n        'attribute vec2 p,t;'+        // position, uv\r\n        'attribute vec4 c,a;'+        // color, additiveColor\r\n        'varying vec4 v,d,e;'+        // return uv, color, additiveColor\r\n        'void main(){'+               // shader entry point\r\n        'gl_Position=m*vec4(p,1,1);'+ // transform position\r\n        'v=vec4(t,p);d=c;e=a;'+       // pass stuff to fragment shader\r\n        '}'                           // end of shader\r\n        ,\r\n        'precision highp float;'+              // use highp for better accuracy\r\n        'varying vec4 v,d,e;'+                 // uv, color, additiveColor\r\n        'uniform sampler2D s;'+                // texture\r\n        'void main(){'+                        // shader entry point\r\n        'gl_FragColor=texture2D(s,v.xy)*d+e;'+ // modulate texture by color plus additive\r\n        '}'                                    // end of shader\r\n    );\r\n\r\n    // init buffers\r\n    const vertexData = new ArrayBuffer(gl_VERTEX_BUFFER_SIZE);\r\n    glArrayBuffer = glContext.createBuffer();\r\n    glPositionData = new Float32Array(vertexData);\r\n    glColorData = new Uint32Array(vertexData);\r\n    glBatchCount = 0;\r\n}\r\n\r\n/** Set the WebGl blend mode, normally you should call setBlendMode instead\r\n *  @param {Boolean} [additive=0]\r\n *  @memberof WebGL */\r\nfunction glSetBlendMode(additive)\r\n{\r\n    // setup blending\r\n    glAdditive = additive;\r\n}\r\n\r\n/** Set the WebGl texture, not normally necessary unless multiple tile sheets are used\r\n *  <br> - This may also flush the gl buffer resulting in more draw calls and worse performance\r\n *  @param {WebGLTexture} [texture=glTileTexture]\r\n *  @memberof WebGL */\r\nfunction glSetTexture(texture=glTileTexture)\r\n{\r\n    // must flush cache with the old texture to set a new one\r\n    if (texture != glActiveTexture)\r\n        glFlush();\r\n\r\n    glContext.bindTexture(gl_TEXTURE_2D, glActiveTexture = texture);\r\n}\r\n\r\n/** Compile WebGL shader of the given type, will throw errors if in debug mode\r\n *  @param {String} source\r\n *  @param          type\r\n *  @return {WebGLShader}\r\n *  @memberof WebGL */\r\nfunction glCompileShader(source, type)\r\n{\r\n    // build the shader\r\n    const shader = glContext.createShader(type);\r\n    glContext.shaderSource(shader, source);\r\n    glContext.compileShader(shader);\r\n\r\n    // check for errors\r\n    if (debug && !glContext.getShaderParameter(shader, gl_COMPILE_STATUS))\r\n        throw glContext.getShaderInfoLog(shader);\r\n    return shader;\r\n}\r\n\r\n/** Create WebGL program with given shaders\r\n *  @param {WebGLShader} vsSource\r\n *  @param {WebGLShader} fsSource\r\n *  @return {WebGLProgram}\r\n *  @memberof WebGL */\r\nfunction glCreateProgram(vsSource, fsSource)\r\n{\r\n    // build the program\r\n    const program = glContext.createProgram();\r\n    glContext.attachShader(program, glCompileShader(vsSource, gl_VERTEX_SHADER));\r\n    glContext.attachShader(program, glCompileShader(fsSource, gl_FRAGMENT_SHADER));\r\n    glContext.linkProgram(program);\r\n\r\n    // check for errors\r\n    if (debug && !glContext.getProgramParameter(program, gl_LINK_STATUS))\r\n        throw glContext.getProgramInfoLog(program);\r\n    return program;\r\n}\r\n\r\n/** Create WebGL texture from an image and set the texture settings\r\n *  @param {Image} image\r\n *  @return {WebGLTexture}\r\n *  @memberof WebGL */\r\nfunction glCreateTexture(image)\r\n{\r\n    // build the texture\r\n    const texture = glContext.createTexture();\r\n    glContext.bindTexture(gl_TEXTURE_2D, texture);\r\n    image && image.width && glContext.texImage2D(gl_TEXTURE_2D, 0, gl_RGBA, gl_RGBA, gl_UNSIGNED_BYTE, image);\r\n        \r\n    // use point filtering for pixelated rendering\r\n    const filter = cavasPixelated ? gl_NEAREST : gl_LINEAR;\r\n    glContext.texParameteri(gl_TEXTURE_2D, gl_TEXTURE_MIN_FILTER, filter);\r\n    glContext.texParameteri(gl_TEXTURE_2D, gl_TEXTURE_MAG_FILTER, filter);\r\n    glContext.texParameteri(gl_TEXTURE_2D, gl_TEXTURE_WRAP_S, gl_CLAMP_TO_EDGE);\r\n    glContext.texParameteri(gl_TEXTURE_2D, gl_TEXTURE_WRAP_T, gl_CLAMP_TO_EDGE);\r\n    return texture;\r\n}\r\n\r\n// called automatically by engine before render\r\nfunction glPreRender()\r\n{\r\n    // clear and set to same size as main canvas\r\n    glContext.viewport(0, 0, glCanvas.width = mainCanvas.width, glCanvas.height = mainCanvas.height);\r\n    glContext.clear(gl_COLOR_BUFFER_BIT);\r\n\r\n    // set up the shader\r\n    glContext.useProgram(glShader);\r\n    glContext.activeTexture(gl_TEXTURE0);\r\n    glContext.bindTexture(gl_TEXTURE_2D, glActiveTexture = glTileTexture);\r\n    glContext.bindBuffer(gl_ARRAY_BUFFER, glArrayBuffer);\r\n    glContext.bufferData(gl_ARRAY_BUFFER, gl_VERTEX_BUFFER_SIZE, gl_DYNAMIC_DRAW);\r\n    glSetBlendMode();\r\n    \r\n    // set vertex attributes\r\n    let offset = 0;\r\n    const initVertexAttribArray = (name, type, typeSize, size, normalize=0)=>\r\n    {\r\n        const location = glContext.getAttribLocation(glShader, name);\r\n        glContext.enableVertexAttribArray(location);\r\n        glContext.vertexAttribPointer(location, size, type, normalize, gl_VERTEX_BYTE_STRIDE, offset);\r\n        offset += size*typeSize;\r\n    }\r\n    initVertexAttribArray('p', gl_FLOAT, 4, 2);            // position\r\n    initVertexAttribArray('t', gl_FLOAT, 4, 2);            // texture coords\r\n    initVertexAttribArray('c', gl_UNSIGNED_BYTE, 1, 4, 1); // color\r\n    initVertexAttribArray('a', gl_UNSIGNED_BYTE, 1, 4, 1); // additiveColor\r\n\r\n    // build the transform matrix\r\n    const sx = 2 * cameraScale / mainCanvas.width;\r\n    const sy = 2 * cameraScale / mainCanvas.height;\r\n    glContext.uniformMatrix4fv(glContext.getUniformLocation(glShader, 'm'), 0,\r\n        new Float32Array([\r\n            sx, 0, 0, 0,\r\n            0, sy, 0, 0,\r\n            1, 1, -1, 1,\r\n            -1-sx*cameraPos.x, -1-sy*cameraPos.y, 0, 0\r\n        ])\r\n    );\r\n}\r\n\r\n/** Draw all sprites and clear out the buffer, called automatically by the system whenever necessary\r\n *  @memberof WebGL */\r\nfunction glFlush()\r\n{\r\n    if (!glBatchCount) return;\r\n\r\n    const destBlend = glBatchAdditive ? gl_ONE : gl_ONE_MINUS_SRC_ALPHA;\r\n    glContext.blendFuncSeparate(gl_SRC_ALPHA, destBlend, gl_ONE, destBlend);\r\n    glContext.enable(gl_BLEND);\r\n\r\n    // draw all the sprites in the batch and reset the buffer\r\n    glContext.bufferSubData(gl_ARRAY_BUFFER, 0, \r\n        glPositionData.subarray(0, glBatchCount * gl_VERTICES_PER_QUAD * gl_INDICIES_PER_VERT));\r\n    glContext.drawArrays(gl_TRIANGLES, 0, glBatchCount * gl_VERTICES_PER_QUAD);\r\n    glBatchCount = 0;\r\n    glBatchAdditive = glAdditive;\r\n}\r\n\r\n/** Draw any sprites still in the buffer, copy to main canvas and clear\r\n *  @param {CanvasRenderingContext2D} context\r\n *  @param {Boolean} [forceDraw=0]\r\n *  @memberof WebGL */\r\nfunction glCopyToContext(context, forceDraw)\r\n{\r\n    if (!glBatchCount && !forceDraw) return;\r\n    \r\n    glFlush();\r\n    \r\n    // do not draw in overlay mode because the canvas is visible\r\n    if (!glOverlay || forceDraw)\r\n        context.drawImage(glCanvas, 0, 0);\r\n}\r\n\r\n/** Add a sprite to the gl draw list, used by all gl draw functions\r\n *  @param x\r\n *  @param y\r\n *  @param sizeX\r\n *  @param sizeY\r\n *  @param angle\r\n *  @param uv0X\r\n *  @param uv0Y\r\n *  @param uv1X\r\n *  @param uv1Y\r\n *  @param rgba\r\n *  @param [rgbaAdditive=0]\r\n *  @memberof WebGL */\r\nfunction glDraw(x, y, sizeX, sizeY, angle, uv0X, uv0Y, uv1X, uv1Y, rgba, rgbaAdditive=0)\r\n{\r\n    // flush if there is no room for more verts or if different blend mode\r\n    if (glBatchCount == gl_MAX_BATCH || glBatchAdditive != glAdditive)\r\n        glFlush();\r\n\r\n    // prepare to create the verts from size and angle\r\n    const c = Math.cos(angle)/2, s = Math.sin(angle)/2;\r\n    const cx = c*sizeX, cy = c*sizeY, sx = s*sizeX, sy = s*sizeY;\r\n        \r\n    // setup 2 triangles to form a quad\r\n    for(let i=6, offset = glBatchCount++ * gl_VERTICES_PER_QUAD * gl_INDICIES_PER_VERT; i--;)\r\n    {\r\n        const a = i-4&&i>1, b = i-5&&i-2&&i-1;\r\n        glPositionData[offset++] = x + (a?-cx:cx) + (b?sy:-sy);\r\n        glPositionData[offset++] = y + (b?cy:-cy) + (a?sx:-sx);\r\n        glPositionData[offset++] = a ? uv0X : uv1X; \r\n        glPositionData[offset++] = b ? uv0Y : uv1Y;\r\n        glColorData[offset++] = rgba; \r\n        glColorData[offset++] = rgbaAdditive;\r\n    }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// post processing - can be enabled to pass other canvases through a final shader\r\n\r\nlet glPostShader, glPostArrayBuffer, glPostTexture, glPostIncludeOverlay;\r\n\r\n/** Set up a post processing shader\r\n *  @param {String} shaderCode\r\n *  @param {Boolean} includeOverlay\r\n *  @memberof WebGL */\r\nfunction glInitPostProcess(shaderCode, includeOverlay)\r\n{\r\n    ASSERT(!glPostShader); // can only have 1 post effects shader\r\n\r\n    if (!shaderCode) // default shader\r\n        shaderCode = 'void mainImage(out vec4 c,vec2 p){c=texture2D(iChannel0,p/iResolution.xy);}';\r\n\r\n    // create the shader\r\n    glPostShader = glCreateProgram(\r\n        'precision highp float;'+        // use highp for better accuracy\r\n        'attribute vec2 p;'+             // position\r\n        'void main(){'+                  // shader entry point\r\n        'gl_Position=vec4(p,1,1);'+      // set position\r\n        '}'                              // end of shader\r\n        ,\r\n        'precision highp float;'+        // use highp for better accuracy\r\n        'uniform sampler2D iChannel0;'+  // input texture\r\n        'uniform vec3 iResolution;'+     // size of output texture\r\n        'uniform float iTime;'+          // time passed\r\n        '\\n' + shaderCode + '\\n'+        // insert custom shader code\r\n        'void main(){'+                  // shader entry point\r\n        'mainImage(gl_FragColor,gl_FragCoord.xy);'+ // call post process function\r\n        'gl_FragColor.a=1.;'+            // always use full alpha\r\n        '}'                              // end of shader\r\n    );\r\n\r\n    // create buffer and texture\r\n    glPostArrayBuffer = glContext.createBuffer();\r\n    glPostTexture = glCreateTexture();\r\n    glPostIncludeOverlay = includeOverlay;\r\n\r\n    // hide the original 2d canvas\r\n    mainCanvas.style.visibility = 'hidden';\r\n}\r\n\r\n// Render the post processing shader, called automatically by the engine\r\nfunction glRenderPostProcess()\r\n{\r\n    if (!glPostShader)\r\n        return;\r\n    \r\n    // prepare to render post process shader\r\n    if (glEnable)\r\n    {\r\n        glFlush(); // clear out the buffer\r\n        mainContext.drawImage(glCanvas, 0, 0); // copy to the main canvas\r\n    }\r\n    else // set viewport\r\n        glContext.viewport(0, 0, glCanvas.width = mainCanvas.width, glCanvas.height = mainCanvas.height);\r\n\r\n    if (glPostIncludeOverlay)\r\n    {\r\n        // copy overlay canvas so it will be included in post processing\r\n        mainContext.drawImage(overlayCanvas, 0, 0);\r\n\r\n        // clear overlay canvas\r\n        overlayCanvas.width = mainCanvas.width;\r\n    }\r\n\r\n    // setup shader program to draw one triangle\r\n    glContext.useProgram(glPostShader);\r\n    glContext.disable(gl_BLEND);\r\n    glContext.bindBuffer(gl_ARRAY_BUFFER, glPostArrayBuffer);\r\n    glContext.bufferData(gl_ARRAY_BUFFER, new Float32Array([-3,1,1,-3,1,1]), gl_STATIC_DRAW);\r\n    glContext.pixelStorei(gl_UNPACK_FLIP_Y_WEBGL, true);\r\n\r\n    // set textures, pass in the 2d canvas and gl canvas in separate texture channels\r\n    glContext.activeTexture(gl_TEXTURE0);\r\n    glContext.bindTexture(gl_TEXTURE_2D, glPostTexture);\r\n    glContext.texImage2D(gl_TEXTURE_2D, 0, gl_RGBA, gl_RGBA, gl_UNSIGNED_BYTE, mainCanvas);\r\n\r\n    // set vertex position attribute\r\n    const vertexByteStride = 8;\r\n    const pLocation = glContext.getAttribLocation(glPostShader, 'p');\r\n    glContext.enableVertexAttribArray(pLocation);\r\n    glContext.vertexAttribPointer(pLocation, 2, gl_FLOAT, 0, vertexByteStride, 0);\r\n\r\n    // set uniforms and draw\r\n    const uniformLocation = (name)=>glContext.getUniformLocation(glPostShader, name);\r\n    glContext.uniform1i(uniformLocation('iChannel0'), 0);\r\n    glContext.uniform1f(uniformLocation('iTime'), time);\r\n    glContext.uniform3f(uniformLocation('iResolution'), mainCanvas.width, mainCanvas.height, 1);\r\n    glContext.drawArrays(gl_TRIANGLES, 0, 3);\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// store gl constants as integers so their name doesn't use space in minifed\r\nconst \r\ngl_ONE = 1,\r\ngl_TRIANGLES = 4,\r\ngl_SRC_ALPHA = 770,\r\ngl_ONE_MINUS_SRC_ALPHA = 771,\r\ngl_BLEND = 3042,\r\ngl_TEXTURE_2D = 3553,\r\ngl_UNSIGNED_BYTE = 5121,\r\ngl_BYTE = 5120,\r\ngl_FLOAT = 5126,\r\ngl_RGBA = 6408,\r\ngl_NEAREST = 9728,\r\ngl_LINEAR = 9729,\r\ngl_TEXTURE_MAG_FILTER = 10240,\r\ngl_TEXTURE_MIN_FILTER = 10241,\r\ngl_TEXTURE_WRAP_S = 10242,\r\ngl_TEXTURE_WRAP_T = 10243,\r\ngl_COLOR_BUFFER_BIT = 16384,\r\ngl_CLAMP_TO_EDGE = 33071,\r\ngl_TEXTURE0 = 33984,\r\ngl_TEXTURE1 = 33985,\r\ngl_ARRAY_BUFFER = 34962,\r\ngl_STATIC_DRAW = 35044,\r\ngl_DYNAMIC_DRAW = 35048,\r\ngl_FRAGMENT_SHADER = 35632, \r\ngl_VERTEX_SHADER = 35633,\r\ngl_COMPILE_STATUS = 35713,\r\ngl_LINK_STATUS = 35714,\r\ngl_UNPACK_FLIP_Y_WEBGL = 37440,\r\n\r\n// constants for batch rendering\r\ngl_VERTICES_PER_QUAD = 6,\r\ngl_INDICIES_PER_VERT = 6,\r\ngl_MAX_BATCH = 1<<16,\r\ngl_VERTEX_BYTE_STRIDE = (4 * 2) * 2 + (4) * 2, // vec2 * 2 + (char * 4) * 2\r\ngl_VERTEX_BUFFER_SIZE = gl_MAX_BATCH * gl_VERTICES_PER_QUAD * gl_VERTEX_BYTE_STRIDE;\r\n/*\r\n    LittleJS - The Tiny JavaScript Game Engine That Can!\r\n    MIT License - Copyright 2021 Frank Force\r\n\r\n    Engine Features\r\n    - Object oriented system with base class engine object\r\n    - Base class object handles update, physics, collision, rendering, etc\r\n    - Engine helper classes and functions like Vector2, Color, and Timer\r\n    - Super fast rendering system for tile sheets\r\n    - Sound effects audio with zzfx and music with zzfxm\r\n    - Input processing system with gamepad and touchscreen support\r\n    - Tile layer rendering and collision system\r\n    - Particle effect system\r\n    - Medal system tracks and displays achievements\r\n    - Debug tools and debug rendering system\r\n    - Post processing effects\r\n    - Call engineInit() to start it up!\r\n*/\r\n\r\n/**\r\n * LittleJS Engine Globals\r\n * @namespace Engine\r\n */\r\n\r\n'use strict';\r\n\r\n/** Name of engine\r\n *  @type {String}\r\n *  @default\r\n *  @memberof Engine */\r\nconst engineName = 'LittleJS';\r\n\r\n/** Version of engine\r\n *  @type {String}\r\n *  @default\r\n *  @memberof Engine */\r\nconst engineVersion = '1.6.4';\r\n\r\n/** Frames per second to update objects\r\n *  @type {Number}\r\n *  @default\r\n *  @memberof Engine */\r\nconst frameRate = 60;\r\n\r\n/** How many seconds each frame lasts, engine uses a fixed time step\r\n *  @type {Number}\r\n *  @default 1/60\r\n *  @memberof Engine */\r\nconst timeDelta = 1/frameRate;\r\n\r\n/** Array containing all engine objects\r\n *  @type {Array}\r\n *  @memberof Engine */\r\nlet engineObjects = [];\r\n\r\n/** Array containing only objects that are set to collide with other objects this frame (for optimization)\r\n *  @type {Array}\r\n *  @memberof Engine */\r\nlet engineObjectsCollide = [];\r\n\r\n/** Current update frame, used to calculate time\r\n *  @type {Number}\r\n *  @memberof Engine */\r\nlet frame = 0;\r\n\r\n/** Current engine time since start in seconds, derived from frame\r\n *  @type {Number}\r\n *  @memberof Engine */\r\nlet time = 0;\r\n\r\n/** Actual clock time since start in seconds (not affected by pause or frame rate clamping)\r\n *  @type {Number}\r\n *  @memberof Engine */\r\nlet timeReal = 0;\r\n\r\n/** Is the game paused? Causes time and objects to not be updated\r\n *  @type {Boolean}\r\n *  @default 0\r\n *  @memberof Engine */\r\nlet paused = 0;\r\n\r\n/** Set if game is paused\r\n *  @param {Boolean} paused\r\n *  @memberof Engine */\r\nfunction setPaused(_paused) { paused = _paused; }\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\n/** Start up LittleJS engine with your callback functions\r\n *  @param {Function} gameInit        - Called once after the engine starts up, setup the game\r\n *  @param {Function} gameUpdate      - Called every frame at 60 frames per second, handle input and update the game state\r\n *  @param {Function} gameUpdatePost  - Called after physics and objects are updated, setup camera and prepare for render\r\n *  @param {Function} gameRender      - Called before objects are rendered, draw any background effects that appear behind objects\r\n *  @param {Function} gameRenderPost  - Called after objects are rendered, draw effects or hud that appear above all objects\r\n *  @param {String} [tileImageSource] - Tile image to use, everything starts when the image is finished loading\r\n *  @memberof Engine */\r\nfunction engineInit(gameInit, gameUpdate, gameUpdatePost, gameRender, gameRenderPost, tileImageSource)\r\n{\r\n    // init engine when tiles load or fail to load\r\n    tileImage.onerror = tileImage.onload = ()=>\r\n    {\r\n        // save tile image info\r\n        tileImageFixBleed = vec2(tileFixBleedScale).divide(tileImageSize = vec2(tileImage.width, tileImage.height));\r\n        debug && (tileImage.onload=()=>ASSERT(1)); // tile sheet can not reloaded\r\n\r\n        // setup html\r\n        const styleBody = 'margin:0;overflow:hidden;background:#000' + // fill the window\r\n            ';touch-action:none' + // prevent mobile pinch to resize\r\n            ';user-select:none' +  // prevent mobile hold to select\r\n            ';-webkit-user-select:none'; // compatibility for ios\r\n        document.body.style = styleBody;\r\n        document.body.appendChild(mainCanvas = document.createElement('canvas'));\r\n        mainContext = mainCanvas.getContext('2d');\r\n\r\n        // init stuff and start engine\r\n        debugInit();\r\n        glEnable && glInit();\r\n\r\n        // create overlay canvas for hud to appear above gl canvas\r\n        document.body.appendChild(overlayCanvas = document.createElement('canvas'));\r\n        overlayContext = overlayCanvas.getContext('2d');\r\n\r\n        // set canvas style to fill the window\r\n        const styleCanvas = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)';\r\n        (glCanvas||mainCanvas).style = mainCanvas.style = overlayCanvas.style = styleCanvas;\r\n        \r\n        gameInit();\r\n        engineUpdate();\r\n    };\r\n\r\n    // frame time tracking\r\n    let frameTimeLastMS = 0, frameTimeBufferMS, averageFPS;\r\n\r\n    // main update loop\r\n    function engineUpdate(frameTimeMS=0)\r\n    {\r\n        // update time keeping\r\n        let frameTimeDeltaMS = frameTimeMS - frameTimeLastMS;\r\n        frameTimeLastMS = frameTimeMS;\r\n        if (debug || showWatermark)\r\n            averageFPS = lerp(.05, averageFPS, 1e3/(frameTimeDeltaMS||1));\r\n        const debugSpeedUp   = debug && keyIsDown(107); // +\r\n        const debugSpeedDown = debug && keyIsDown(109); // -\r\n        if (debug) // +/- to speed/slow time\r\n            frameTimeDeltaMS *= debugSpeedUp ? 5 : debugSpeedDown ? .2 : 1;\r\n        timeReal += frameTimeDeltaMS / 1e3;\r\n        frameTimeBufferMS += !paused * frameTimeDeltaMS;\r\n        if (!debugSpeedUp)\r\n            frameTimeBufferMS = min(frameTimeBufferMS, 50); // clamp incase of slow framerate\r\n\r\n        if (canvasFixedSize.x)\r\n        {\r\n            // clear canvas and set fixed size\r\n            mainCanvas.width  = canvasFixedSize.x;\r\n            mainCanvas.height = canvasFixedSize.y;\r\n            \r\n            // fit to window by adding space on top or bottom if necessary\r\n            const aspect = innerWidth / innerHeight;\r\n            const fixedAspect = mainCanvas.width / mainCanvas.height;\r\n            (glCanvas||mainCanvas).style.width = mainCanvas.style.width = overlayCanvas.style.width  = aspect < fixedAspect ? '100%' : '';\r\n            (glCanvas||mainCanvas).style.height = mainCanvas.style.height = overlayCanvas.style.height = aspect < fixedAspect ? '' : '100%';\r\n        }\r\n        else\r\n        {\r\n             // clear canvas and set size to same as window\r\n             mainCanvas.width  = min(innerWidth,  canvasMaxSize.x);\r\n             mainCanvas.height = min(innerHeight, canvasMaxSize.y);\r\n        }\r\n        \r\n        // clear overlay canvas and set size\r\n        overlayCanvas.width  = mainCanvas.width;\r\n        overlayCanvas.height = mainCanvas.height;\r\n\r\n        // save canvas size\r\n        mainCanvasSize = vec2(mainCanvas.width, mainCanvas.height);\r\n\r\n        if (paused)\r\n        {\r\n            // do post update even when paused\r\n            inputUpdate();\r\n            debugUpdate();\r\n            gameUpdatePost();\r\n            inputUpdatePost();\r\n        }\r\n        else\r\n        {\r\n            // apply time delta smoothing, improves smoothness of framerate in some browsers\r\n            let deltaSmooth = 0;\r\n            if (frameTimeBufferMS < 0 && frameTimeBufferMS > -9)\r\n            {\r\n                // force an update each frame if time is close enough (not just a fast refresh rate)\r\n                deltaSmooth = frameTimeBufferMS;\r\n                frameTimeBufferMS = 0;\r\n            }\r\n            \r\n            // update multiple frames if necessary in case of slow framerate\r\n            for (;frameTimeBufferMS >= 0; frameTimeBufferMS -= 1e3 / frameRate)\r\n            {\r\n                // update game and objects\r\n                inputUpdate();\r\n                gameUpdate();\r\n                engineObjectsUpdate();\r\n\r\n                // do post update\r\n                debugUpdate();\r\n                gameUpdatePost();\r\n                inputUpdatePost();\r\n            }\r\n\r\n            // add the time smoothing back in\r\n            frameTimeBufferMS += deltaSmooth;\r\n        }\r\n        \r\n        // render sort then render while removing destroyed objects\r\n        enginePreRender();\r\n        gameRender();\r\n        engineObjects.sort((a,b)=> a.renderOrder - b.renderOrder);\r\n        for (const o of engineObjects)\r\n            o.destroyed || o.render();\r\n        gameRenderPost();\r\n        glRenderPostProcess();\r\n        medalsRender();\r\n        touchGamepadRender();\r\n        debugRender();\r\n        glEnable && glCopyToContext(mainContext);\r\n\r\n        if (showWatermark)\r\n        {\r\n            // update fps\r\n            overlayContext.textAlign = 'right';\r\n            overlayContext.textBaseline = 'top';\r\n            overlayContext.font = '1em monospace';\r\n            overlayContext.fillStyle = '#000';\r\n            const text = engineName + ' ' + 'v' + engineVersion + ' / ' \r\n                + drawCount + ' / ' + engineObjects.length + ' / ' + averageFPS.toFixed(1)\r\n                + (glEnable ? ' GL' : ' 2D') ;\r\n            overlayContext.fillText(text, mainCanvas.width-3, 3);\r\n            overlayContext.fillStyle = '#fff';\r\n            overlayContext.fillText(text, mainCanvas.width-2, 2);\r\n            drawCount = 0;\r\n        }\r\n\r\n        requestAnimationFrame(engineUpdate);\r\n    }\r\n\r\n    // set tile image source to load the image and start the engine\r\n    tileImageSource ? tileImage.src = tileImageSource : tileImage.onload();\r\n}\r\n\r\n// Called automatically by engine to setup render system\r\nfunction enginePreRender()\r\n{\r\n    // save canvas size\r\n    mainCanvasSize = vec2(mainCanvas.width, mainCanvas.height);\r\n\r\n    // disable smoothing for pixel art\r\n    mainContext.imageSmoothingEnabled = !cavasPixelated;\r\n\r\n    // setup gl rendering if enabled\r\n    glEnable && glPreRender();\r\n}\r\n\r\n/** Update each engine object, remove destroyed objects, and update time\r\n *  @memberof Engine */\r\nfunction engineObjectsUpdate()\r\n{\r\n    // get list of solid objects for physics optimzation\r\n    engineObjectsCollide = engineObjects.filter(o=>o.collideSolidObjects);\r\n\r\n    // recursive object update\r\n    const updateObject = (o)=>\r\n    {\r\n        if (!o.destroyed)\r\n        {\r\n            o.update();\r\n            for (const child of o.children)\r\n                updateObject(child);\r\n        }\r\n    }\r\n    for (const o of engineObjects)\r\n        o.parent || updateObject(o);\r\n\r\n    // remove destroyed objects\r\n    engineObjects = engineObjects.filter(o=>!o.destroyed);\r\n\r\n    // increment frame and update time\r\n    time = ++frame / frameRate;\r\n}\r\n\r\n/** Destroy and remove all objects\r\n *  @memberof Engine */\r\nfunction engineObjectsDestroy()\r\n{\r\n    for (const o of engineObjects)\r\n        o.parent || o.destroy();\r\n    engineObjects = engineObjects.filter(o=>!o.destroyed);\r\n}\r\n\r\n/** Triggers a callback for each object within a given area\r\n *  @param {Vector2} [pos]                 - Center of test area\r\n *  @param {Number} [size]                 - Radius of circle if float, rectangle size if Vector2\r\n *  @param {Function} [callbackFunction]   - Calls this function on every object that passes the test\r\n *  @param {Array} [objects=engineObjects] - List of objects to check\r\n *  @memberof Engine */\r\nfunction engineObjectsCallback(pos, size, callbackFunction, objects=engineObjects)\r\n{\r\n    if (!pos) // all objects\r\n    {\r\n        for (const o of objects)\r\n            callbackFunction(o);\r\n    }\r\n    else if (size.x != undefined)  // bounding box test\r\n    {\r\n        for (const o of objects)\r\n            isOverlapping(pos, size, o.pos, o.size) && callbackFunction(o);\r\n    }\r\n    else  // circle test\r\n    {\r\n        const sizeSquared = size*size;\r\n        for (const o of objects)\r\n            pos.distanceSquared(o.pos) < sizeSquared && callbackFunction(o);\r\n    }\r\n}\r\n\r\n/** \r\n * LittleJS Module Export\r\n * <br> - Export engine as a module with extra functions where necessary\r\n */\r\n\r\n// Setters for all variables that devs will need to modify\r\n\r\n\r\n/** Set position of camera in world space\r\n *  @param {Vector2} pos\r\n *  @memberof Settings */\r\nconst setCameraPos = (pos)=> cameraPos = pos;\r\n\r\n/** Set scale of camera in world space\r\n *  @param {Number} scale\r\n *  @memberof Settings */\r\nconst setCameraScale = (scale)=> cameraScale = scale;\r\n\r\n/** Set max size of the canvas\r\n *  @param {Vector2} size\r\n *  @memberof Settings */\r\nconst setCanvasMaxSize = (size)=> canvasMaxSize = size;\r\n\r\n/** Set fixed size of the canvas\r\n *  @param {Vector2} size\r\n *  @memberof Settings */\r\nconst setCanvasFixedSize = (size)=> canvasFixedSize = size;\r\n\r\n/** Disables anti aliasing for pixel art if true\r\n *  @param {Boolean} pixelated\r\n *  @memberof Settings */\r\nconst setCavasPixelated = (pixelated)=> cavasPixelated = pixelated;\r\n\r\n/** Set default font used for text rendering\r\n *  @param {String} font\r\n *  @memberof Settings */\r\nconst setFontDefault = (font)=> fontDefault = font;\r\n\r\n/** Set if webgl rendering is enabled\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setGlEnable = (enable)=> glEnable = enable;\r\n\r\n/** Set to not composite the WebGL canvas\r\n *  @param {Boolean} overlay\r\n *  @memberof Settings */\r\nconst setGlOverlay = (overlay)=> glOverlay = overlay;\r\n\r\n/** Set default size of tiles in pixels\r\n *  @param {Vector2} size\r\n *  @memberof Settings */\r\nconst setTileSizeDefault = (size)=> tileSizeDefault = size;\r\n\r\n/** Set to prevent tile bleeding from neighbors in pixels\r\n *  @param {Number} scale\r\n *  @memberof Settings */\r\nconst setTileFixBleedScale = (scale)=> tileFixBleedScale = scale;\r\n\r\n/** Set if collisions between objects are enabled\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setEnablePhysicsSolver = (enable)=> enablePhysicsSolver = enable;\r\n\r\n/** Set default object mass for collison calcuations\r\n *  @param {Number} mass\r\n *  @memberof Settings */\r\nconst setObjectDefaultMass = (mass)=> objectDefaultMass = mass;\r\n\r\n/** Set how much to slow velocity by each frame\r\n *  @param {Number} damping\r\n *  @memberof Settings */\r\nconst setObjectDefaultDamping = (damp)=> objectDefaultDamping = damp;\r\n\r\n/** Set how much to slow angular velocity each frame\r\n *  @param {Number} damping\r\n *  @memberof Settings */\r\nconst setObjectDefaultAngleDamping = (damp)=> objectDefaultAngleDamping = damp;\r\n\r\n/** Set how much to bounce when a collision occur\r\n *  @param {Number} elasticity\r\n *  @memberof Settings */\r\nconst setObjectDefaultElasticity = (elasticity)=> objectDefaultElasticity = elasticity;\r\n\r\n/** Set how much to slow when touching\r\n *  @param {Number} friction\r\n *  @memberof Settings */\r\nconst setObjectDefaultFriction = (friction)=> objectDefaultFriction = friction;\r\n\r\n/** Set max speed to avoid fast objects missing collisions\r\n *  @param {Number} speed\r\n *  @memberof Settings */\r\nconst setObjectMaxSpeed = (speed)=> objectMaxSpeed = speed;\r\n\r\n/** Set how much gravity to apply to objects along the Y axis\r\n *  @param {Number} gravity\r\n *  @memberof Settings */\r\nconst setGravity = (g)=> gravity = g;\r\n\r\n/** Set to scales emit rate of particles\r\n *  @param {Number} scale\r\n *  @memberof Settings */\r\nconst setParticleEmitRateScale = (scale)=> particleEmitRateScale = scale;\r\n\r\n/** Set if gamepads are enabled\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setGamepadsEnable = (enable)=> gamepadsEnable = enable;\r\n\r\n/** Set if the dpad input is also routed to the left analog stick\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setGamepadDirectionEmulateStick = (enable)=> gamepadDirectionEmulateStick = enable;\r\n\r\n/** Set if true the WASD keys are also routed to the direction keys\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setInputWASDEmulateDirection = (enable)=> inputWASDEmulateDirection = enable;\r\n\r\n/** Set if touch gamepad should appear on mobile devices\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setTouchGamepadEnable = (enable)=> touchGamepadEnable = enable;\r\n\r\n/** Set if touch gamepad should be analog stick or 8 way dpad\r\n *  @param {Boolean} analog\r\n *  @memberof Settings */\r\nconst setTouchGamepadAnalog = (analog)=> touchGamepadAnalog = analog;\r\n\r\n/** Set size of virutal gamepad for touch devices in pixels\r\n *  @param {Number} size\r\n *  @memberof Settings */\r\nconst setTouchGamepadSize = (size)=> touchGamepadSize = size;\r\n\r\n/** Set transparency of touch gamepad overlay\r\n *  @param {Number} alpha\r\n *  @memberof Settings */\r\nconst setTouchGamepadAlpha = (alpha)=> touchGamepadAlpha = alpha;\r\n\r\n/** Set to allow vibration hardware if it exists\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setVibrateEnable = (enable)=> vibrateEnable = enable;\r\n\r\n/** Set to disable all audio code\r\n *  @param {Boolean} enable\r\n *  @memberof Settings */\r\nconst setSoundEnable = (enable)=> soundEnable = enable;\r\n\r\n/** Set volume scale to apply to all sound, music and speech\r\n *  @param {Number} volume\r\n *  @memberof Settings */\r\nconst setSoundVolume = (volume)=> soundVolume = volume;\r\n\r\n/** Set default range where sound no longer plays\r\n *  @param {Number} range\r\n *  @memberof Settings */\r\nconst setSoundDefaultRange = (range)=> soundDefaultRange = range;\r\n\r\n/** Set default range percent to start tapering off sound\r\n *  @param {Number} taper\r\n *  @memberof Settings */\r\nconst setSoundDefaultTaper = (taper)=> soundDefaultTaper = taper;\r\n\r\n/** Set how long to show medals for in seconds\r\n *  @param {Number} time\r\n *  @memberof Settings */\r\nconst setMedalDisplayTime = (time)=> medalDisplayTime = time;\r\n\r\n/** Set how quickly to slide on/off medals in seconds\r\n *  @param {Number} time\r\n *  @memberof Settings */\r\nconst setMedalDisplaySlideTime = (time)=> medalDisplaySlideTime = time;\r\n\r\n/** Set size of medal display\r\n *  @param {Vector2} size\r\n *  @memberof Settings */\r\nconst setMedalDisplaySize = (size)=> medalDisplaySize = size;\r\n\r\n/** Set size of icon in medal display\r\n *  @param {Number} size\r\n *  @memberof Settings */\r\nconst setMedalDisplayIconSize = (size)=> medalDisplayIconSize = size;\r\n\r\n/** Set to stop medals from being unlockable\r\n *  @param {Boolean} preventUnlock\r\n *  @memberof Settings */\r\nconst setMedalsPreventUnlock = (prevent)=> medalsPreventUnlock = prevent;\r\n\r\n/** Set if watermark with FPS should be shown\r\n *  @param {Boolean} show\r\n *  @memberof Debug */\r\nconst setShowWatermark = (show)=> showWatermark = show;\r\n\r\n/** Set if god mode is enabled\r\n *  @param {Boolean} enable\r\n *  @memberof Debug */\r\nconst setGodMode = (enable)=> godMode = enable;\r\n\r\n/** Set key code used to toggle debug mode, Esc by default\r\n *  @param {Number} key\r\n *  @memberof Debug */\r\nconst setDebugKey = (key)=> debugKey = key;\r\n\r\nexport {\r\n\t// Setters for global variables\r\n\tsetCameraPos,\r\n\tsetCameraScale,\r\n\tsetCanvasMaxSize,\r\n\tsetCanvasFixedSize,\r\n\tsetCavasPixelated,\r\n\tsetFontDefault,\r\n\tsetGlEnable,\r\n\tsetGlOverlay,\r\n\tsetTileSizeDefault,\r\n\tsetTileFixBleedScale,\r\n\tsetEnablePhysicsSolver,\r\n\tsetObjectDefaultMass,\r\n\tsetObjectDefaultDamping,\r\n\tsetObjectDefaultAngleDamping,\r\n\tsetObjectDefaultElasticity,\r\n\tsetObjectDefaultFriction,\r\n\tsetObjectMaxSpeed,\r\n\tsetGravity,\r\n\tsetParticleEmitRateScale,\r\n\tsetGamepadsEnable,\r\n\tsetGamepadDirectionEmulateStick,\r\n\tsetInputWASDEmulateDirection,\r\n\tsetTouchGamepadEnable,\r\n\tsetTouchGamepadAnalog,\r\n\tsetTouchGamepadSize,\r\n\tsetTouchGamepadAlpha,\r\n\tsetVibrateEnable,\r\n\tsetSoundEnable,\r\n\tsetSoundVolume,\r\n\tsetSoundDefaultRange,\r\n\tsetSoundDefaultTaper,\r\n\tsetMedalDisplayTime,\r\n\tsetMedalDisplaySlideTime,\r\n\tsetMedalDisplaySize,\r\n\tsetMedalDisplayIconSize,\r\n\tsetMedalsPreventUnlock,\r\n\tsetShowWatermark,\r\n\tsetGodMode,\r\n\tsetDebugKey,\r\n\r\n\t// Settings\r\n\tcanvasMaxSize,\r\n\tcanvasFixedSize,\r\n\tcavasPixelated,\r\n\tfontDefault,\r\n\ttileSizeDefault,\r\n\ttileFixBleedScale,\r\n\tenablePhysicsSolver,\r\n\tobjectDefaultMass,\r\n\tobjectDefaultDamping,\r\n\tobjectDefaultAngleDamping,\r\n\tobjectDefaultElasticity,\r\n\tobjectDefaultFriction,\r\n\tobjectMaxSpeed,\r\n\tgravity,\r\n\tparticleEmitRateScale,\r\n\tcameraPos,\r\n\tcameraScale,\r\n\tglEnable,\r\n\tglOverlay,\r\n\tgamepadsEnable,\r\n\tgamepadDirectionEmulateStick,\r\n\tinputWASDEmulateDirection,\r\n\ttouchGamepadEnable,\r\n\ttouchGamepadAnalog,\r\n\ttouchGamepadSize,\r\n\ttouchGamepadAlpha,\r\n\tvibrateEnable,\r\n\tsoundEnable,\r\n\tsoundVolume,\r\n\tsoundDefaultRange,\r\n\tsoundDefaultTaper,\r\n\tmedalDisplayTime,\r\n\tmedalDisplaySlideTime,\r\n\tmedalDisplaySize,\r\n\tmedalDisplayIconSize,\r\n\t\r\n\t// Globals\r\n\tdebug,\r\n\tshowWatermark,\r\n\tgodMode,\r\n\r\n\t// Debug\r\n\tASSERT,\r\n\tdebugRect,\r\n\tdebugCircle,\r\n\tdebugPoint,\r\n\tdebugLine,\r\n\tdebugAABB,\r\n\tdebugText,\r\n\tdebugClear,\r\n\tdebugSaveCanvas,\r\n\r\n\t// Utilities\r\n\tPI,\r\n\tabs,\r\n\tmin,\r\n\tmax,\r\n\tsign,\r\n\tmod,\r\n\tclamp,\r\n\tpercent,\r\n\tlerp,\r\n\tsmoothStep,\r\n\tnearestPowerOfTwo,\r\n\tisOverlapping,\r\n\twave,\r\n\tformatTime,\r\n\r\n\t// Random\r\n\trand,\r\n\trandInt,\r\n\trandSign,\r\n\trandInCircle,\r\n\trandVector,\r\n\trandColor,\r\n\trandSeed,\r\n\tsetRandSeed,\r\n\trandSeeded,\r\n\r\n\t// Utility Classes\r\n\tVector2,\r\n\tColor,\r\n\tTimer,\r\n\tvec2,\r\n\trgb,\r\n\thsl,\r\n\r\n\t// Base\r\n\tEngineObject,\r\n\r\n\t// Draw\r\n\ttileImage,\r\n\tmainCanvas,\r\n\tmainContext,\r\n\toverlayCanvas,\r\n\toverlayContext,\r\n\tmainCanvasSize,\r\n\tscreenToWorld,\r\n\tworldToScreen,\r\n\tdrawTile,\r\n\tdrawRect,\r\n\tdrawTileScreenSpace,\r\n\tdrawRectScreenSpace,\r\n\tdrawLine,\r\n\tdrawCanvas2D,\r\n\tsetBlendMode,\r\n\tdrawTextScreen,\r\n\tdrawText,\r\n\tengineFontImage,\r\n\tFontImage,\r\n\tisFullscreen,\r\n\ttoggleFullscreen,\r\n\r\n\t// Input\r\n\tkeyIsDown,\r\n\tkeyWasPressed,\r\n\tkeyWasReleased,\r\n\tclearInput,\r\n\tmouseIsDown,\r\n\tmouseWasPressed,\r\n\tmouseWasReleased,\r\n\tmousePos,\r\n\tmousePosScreen,\r\n\tmouseWheel,\r\n\tisUsingGamepad,\r\n\tpreventDefaultInput,\r\n\tgamepadIsDown,\r\n\tgamepadWasPressed,\r\n\tgamepadWasReleased,\r\n\tgamepadStick,\r\n\tmouseToScreen,\r\n\tgamepadsUpdate,\r\n\tvibrate,\r\n\tvibrateStop,\r\n\tisTouchDevice,\r\n\r\n\t// Audio\r\n\tSound,\r\n\tMusic,\r\n\tplayAudioFile,\r\n\tspeak,\r\n\tspeakStop,\r\n\tgetNoteFrequency,\r\n\taudioContext,\r\n\tplaySamples,\r\n\tzzfx,\r\n\r\n\t// Tiles\r\n\ttileCollision,\r\n\ttileCollisionSize,\r\n\tinitTileCollision,\r\n\tsetTileCollisionData,\r\n\tgetTileCollisionData,\r\n\ttileCollisionTest,\r\n\ttileCollisionRaycast,\r\n\tTileLayerData,\r\n\tTileLayer,\r\n\r\n\t// Particles\r\n\tParticleEmitter,\r\n\tParticle,\r\n\r\n\t// Medals\r\n\tmedals,\r\n\tmedalsPreventUnlock,\r\n\tmedalsInit,\r\n\tnewgroundsInit,\r\n\tMedal,\r\n\tNewgrounds,\r\n\r\n\t// WebGL\r\n\tglCanvas,\r\n\tglContext,\r\n\tglSetBlendMode,\r\n\tglSetTexture,\r\n\tglCompileShader,\r\n\tglCreateProgram,\r\n\tglCreateTexture,\r\n\tglInitPostProcess,\r\n\r\n\t// Engine\r\n\tengineName,\r\n\tengineVersion,\r\n\tframeRate,\r\n\ttimeDelta,\r\n\tengineObjects,\r\n\tframe,\r\n\ttime,\r\n\ttimeReal,\r\n\tpaused,\r\n\tsetPaused,\r\n\tengineInit,\r\n\tengineObjectsUpdate,\r\n\tengineObjectsDestroy,\r\n\tengineObjectsCallback,\r\n};\r\n","import * as L from 'littlejsengine/build/littlejs.esm';\n\nexport class Paddle extends L.EngineObject {\n  constructor(private readonly levelSize: L.Vector2) {\n    super(L.vec2(0, 1), L.vec2(4, 0.5));\n    this.color = new L.Color(1, 1, 1, 0.5);\n\n    this.setCollision(true);\n    this.mass = 0; // Static object\n  }\n\n  override update() {\n    const min = this.size.x * 0.5; // half the width of the paddle\n    const max = this.levelSize.x - min;\n    this.pos.x = L.clamp(L.mousePos.x, min, max);\n  }\n\n  increaseSize() {\n    this.size.x += 2;\n  }\n\n  decreaseSize() {\n    this.size.x -= 2;\n    if (this.size.x < 2) this.size.x = 2;\n  }\n\n  resetSize() {\n    this.size.x = 4;\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\n\nexport class Wall extends L.EngineObject {\n  constructor(position: L.Vector2, size: L.Vector2) {\n    super(position, size);\n\n    this.setCollision(true);\n    this.mass = 0; // Static object\n    this.color = new L.Color().setHex('#494746');\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\n\nexport const LevelSize = L.vec2(38, 20);\n","export class Score {\n  private score = 0;\n  private highScore = 0;\n\n  constructor(private readonly initialValue: number) {\n    this.score = this.initialValue;\n    this.highScore = Number(localStorage.getItem('highScore')) || 0;\n  }\n\n  increment() {\n    this.score++;\n    this.evaluateHighScore();\n  }\n\n  decrement() {\n    this.score--;\n    this.evaluateHighScore();\n  }\n\n  add(value: number) {\n    this.score += value;\n    this.evaluateHighScore();\n  }\n\n  reset() {\n    this.score = this.initialValue;\n  }\n\n  toString() {\n    return this.score.toString();\n  }\n\n  toValue() {\n    return this.score;\n  }\n\n  getHighScore() {\n    return this.highScore;\n  }\n\n  private evaluateHighScore() {\n    if (this.score > this.highScore) {\n      this.highScore = this.score;\n      localStorage.setItem('highScore', this.highScore.toString());\n    }\n  }\n}\n","export default \"__VITE_ASSET__93111043__\"","export const Debug = {\n  enabled() {\n    return window.location.hash.includes('debug');\n  },\n  disabled() {\n    return !this.enabled();\n  },\n};\n","function E () {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function (name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function (name, callback, ctx) {\n    var self = this;\n    function listener () {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    };\n\n    listener._ = callback\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function (name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  off: function (name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    (liveEvents.length)\n      ? e[name] = liveEvents\n      : delete e[name];\n\n    return this;\n  }\n};\n\nmodule.exports = E;\nmodule.exports.TinyEmitter = E;\n","import { TinyEmitter } from 'tiny-emitter';\n\nexport const emitter = new TinyEmitter();\n","export enum BonusType {\n  ExtraScore,\n  ExtraBalls,\n  PaddleIncrease,\n  ExtraLife,\n  ExtraWall,\n  PaddleDecrease,\n  DoubleBalls,\n  TripleBalls,\n  ExtraStrength,\n}\n","import { Game } from '/src/game/Game';\n\nexport abstract class BonusType {\n  protected readonly timers: NodeJS.Timeout[] = [];\n  protected readonly timeout = 10_000;\n\n  protected constructor(public readonly game: Game) {}\n\n  abstract apply(): void;\n\n  clearTimers() {\n    this.timers.forEach(clearTimeout);\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\nimport * as L from 'littlejsengine/build/littlejs.esm';\n\nexport class ExtraBalls extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    if (this.game.balls.hasValue()) {\n      const ball = this.game.balls.getOne();\n      if (!ball || ball.destroyed) return;\n\n      this.game.balls.spawnManyAt(L.cameraPos, 3);\n    }\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\nimport { Ball } from '/src/components/Ball';\nimport L from 'littlejsengine/build/littlejs.esm';\n\nexport class ExtraLife extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    this.game.lives.increment();\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\n\nexport class PaddleIncrease extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    this.game.paddle?.increaseSize();\n    this.timers.push(\n      setTimeout(() => {\n        this.game.paddle?.decreaseSize();\n      }, this.timeout),\n    );\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\n\nexport class PaddleDecrease extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    this.game.paddle?.decreaseSize();\n    this.timers.push(\n      setTimeout(() => {\n        this.game.paddle?.increaseSize();\n      }, this.timeout),\n    );\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\n\nexport class ExtraScore extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    this.game.score.add(10);\n  }\n}\n","import { Game } from '/src/game/Game';\nimport { BonusType } from '/src/commands/bonus/BonusType';\nimport { Wall } from '/src/components/Wall';\nimport * as L from 'littlejsengine/build/littlejs.esm';\nimport { LevelSize } from '/src/constants/level';\n\nexport class ExtraWall extends BonusType {\n  private readonly size = L.vec2(LevelSize.x, 0.25);\n  private readonly position = L.vec2(LevelSize.x * 0.5, 0.35);\n\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    this.game.floor?.destroy();\n    this.game.floor = new Wall(this.position, this.size);\n    this.game.floor.color = new L.Color(1, 1, 1, 0.5);\n    this.timers.push(\n      setTimeout(() => {\n        this.game.floor?.destroy();\n        this.game.floor = null;\n      }, this.timeout),\n    );\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\nimport * as L from 'littlejsengine/build/littlejs.esm';\n\nexport class DoubleBalls extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    if (this.game.balls.hasValue()) {\n      this.game.balls.double();\n    }\n  }\n}\n","import { BonusType } from '/src/commands/bonus/BonusType';\nimport { Game } from '/src/game/Game';\nimport * as L from 'littlejsengine/build/littlejs.esm';\n\nexport class TripleBalls extends BonusType {\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply() {\n    if (this.game.balls.hasValue()) {\n      this.game.balls.triple();\n    }\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\n\nexport const Tiles: [number, number][] = [\n  [6, 1], // Green\n  [5, 10], // Light Green\n  [16, 11], // Yellow\n  [12, 7], // Red\n  [15, 20], // Purple\n  [17, 0], // Blue\n  [26, 21], // Light Blue\n  [2, 27], // Orange\n  [31, 30], // Brown\n  // [22, 25], // Grey, reserved for unbreakable bricks\n];\n\nexport const UnbreakableTileIndex = 22;\nexport const UnbreakableTileColor = new L.Color().setHex('#486370');\n\nexport const Colors = [\n  new L.Color().setHex('#00854A'), // Green\n  new L.Color().setHex('#8CC63F'), // Light Green\n  new L.Color().setHex('#FFDD00'), // Yellow\n  new L.Color().setHex('#ED1B25'), // Red\n  new L.Color().setHex('#91278F'), // Purple\n  new L.Color().setHex('#005AAB'), // Blue\n  new L.Color().setHex('#00AAE5'), // Light Blue\n  // new L.Color().setHex('#486370'), // Grey, reserved for unbreakable bricks\n  new L.Color().setHex('#F7931F'), // Orange\n  new L.Color().setHex('#744C1F'), // Brown\n];\n\n// Guard against mistakes\nif (Colors.length !== Tiles.length) {\n  throw new Error('Colors and Tiles must have the same length');\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Colors, Tiles } from '/src/constants/color';\nimport { Paddle } from '/src/components/Paddle';\nimport { emitter } from '/src/utils/Emitter';\nimport { BonusType } from '/src/enums/bonus';\n\nexport class Bonus extends L.EngineObject {\n  private readonly type: BonusType;\n  private readonly sign: number = 1;\n\n  constructor(position: L.Vector2, type: BonusType) {\n    super(position, L.vec2(0.5));\n\n    this.type = type;\n    this.setCollision(true);\n    this.velocity = L.vec2(0, -0.1);\n\n    this.color = Colors[this.type];\n    this.sign = L.randInt(0, 1) === 0 ? -1 : 1;\n  }\n\n  override update() {\n    this.angle += this.sign;\n\n    if (this.pos.y < 0) {\n      // Bonus lost\n      this.destroy();\n    }\n\n    super.update();\n  }\n\n  override collideWithObject(object: L.EngineObject): boolean {\n    if (object instanceof Paddle) {\n      emitter.emit('bonusCollected', this.type);\n      this.destroy();\n    }\n\n    // No collision with anything\n    return false;\n  }\n}\n","import { Game } from '/src/game/Game';\nimport { BonusType } from '/src/enums/bonus';\nimport { BonusType as AbstractBonus } from '/src/commands/bonus/BonusType';\nimport { ExtraBalls } from '/src/commands/bonus/ExtraBalls';\nimport { ExtraLife } from '/src/commands/bonus/ExtraLife';\nimport { PaddleIncrease } from '/src/commands/bonus/PaddleIncrease';\nimport { PaddleDecrease } from '/src/commands/bonus/PaddleDecrease';\nimport { ExtraScore } from '/src/commands/bonus/ExtraScore';\nimport { ExtraWall } from '/src/commands/bonus/ExtraWall';\nimport { DoubleBalls } from '/src/commands/bonus/DoubleBalls';\nimport { TripleBalls } from '/src/commands/bonus/TripleBalls';\nimport * as L from 'littlejsengine/build/littlejs.esm';\nimport { LevelSize } from '/src/constants/level';\nimport { Bonus } from '/src/components/Bonus';\n\nexport class BonusCommand {\n  private readonly commands: Record<BonusType, AbstractBonus>;\n\n  constructor(game: Game) {\n    this.commands = {\n      [BonusType.ExtraBalls]: new ExtraBalls(game),\n      [BonusType.ExtraLife]: new ExtraLife(game),\n      [BonusType.PaddleIncrease]: new PaddleIncrease(game),\n      [BonusType.PaddleDecrease]: new PaddleDecrease(game),\n      [BonusType.ExtraScore]: new ExtraScore(game),\n      [BonusType.ExtraWall]: new ExtraWall(game),\n      [BonusType.DoubleBalls]: new DoubleBalls(game),\n      [BonusType.TripleBalls]: new TripleBalls(game),\n      [BonusType.ExtraStrength]: new ExtraBalls(game),\n    };\n  }\n\n  collect(type: BonusType) {\n    // TODO: Play pickup sound\n    this.commands[type].apply();\n  }\n\n  produce(type: BonusType) {\n    new Bonus(L.vec2(L.randInt(2, LevelSize.x - 2), LevelSize.y - 2), type);\n  }\n\n  clearTimers() {\n    for (const command of Object.values(this.commands)) {\n      command.clearTimers();\n    }\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\n\nexport const Sounds = {\n  GameStart: new L.Sound([, 0, 500, , 0.04, 0.3, 1, 2, , , 570, 0.02, 0.02, , , , 0.04]),\n  BallBounce: new L.Sound([, , 119, 0.02, 0.01, 0.02, , 0.26, , 0.5, , , , , -381, , , , 0.01, 0.8]), // Blip\n  BrickHit: new L.Sound([, , 141, , , 0.02, 1, 0, , , , , , 0.5, 70, , , , 0.01]), // Hit\n  BrickDestroy: new L.Sound([1.37, , 574, 0.04, 0.27, 0.3, 2, 2.9, 0.6, -0.1, , , 0.13, 1.8, , 0.3, , 0.25, 0.01]), //Destroy\n} as const;\n","export const Levels = [\n  [\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],\n    [0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0],\n    [0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0],\n    [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],\n    [1, 0, 3, 0, 1, 0, 3, 1, 0, 3, 1, 0, 3, 0, 1, 0, 3, 0, 1, 1],\n    [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1],\n    [1, 0, 3, 0, 1, 0, 3, 1, 0, 3, 1, 0, 3, 0, 1, 0, 3, 0, 1, 1],\n    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],\n    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],\n    [0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0],\n    [0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0],\n    [0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n  ],\n  [\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],\n    [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],\n    [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],\n    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3],\n    [3, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 3],\n    [3, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 3],\n    [3, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 3],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3],\n    [3, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 3],\n    [3, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 3],\n    [3, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 3],\n    [3, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3],\n    [0, 3, 3, 3, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 3, 3, 3, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3],\n    [3, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 3],\n    [3, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 3],\n    [3, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 3],\n    [3, 3, 3, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3],\n    [3, 3, 3, 3, 3, 3, 0, 0, 1, 0, 1, 0, 0, 3, 3, 3, 3, 3, 3, 3],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3],\n    [3, 1, 3, 1, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 1, 3, 1, 3],\n    [3, 1, 3, 3, 3, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 3, 3, 3, 1, 3],\n    [3, 3, 3, 3, 3, 0, 0, 1, 1, 1, 1, 1, 1, 0, 3, 3, 3, 3, 3, 3],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3],\n    [3, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 3],\n    [3, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 3],\n    [3, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 3],\n    [3, 3, 3, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3],\n    [3, 3, 3, 3, 3, 3, 3, 3, 1, 0, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n  [\n    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],\n    [1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],\n    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],\n    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  ],\n].map((levels) => levels.reverse());\n","export enum BrickType {\n  Empty,\n  Normal,\n  Hard,\n  Unbreakable,\n}\n","type Probability = number;\n\nexport class RandomPicker<TargetValue = unknown> {\n  private probabilities: [TargetValue, Probability][] = [];\n\n  constructor(probabilities?: [TargetValue, Probability][]) {\n    if (probabilities) this.setProbabilities(probabilities);\n  }\n\n  setProbabilities(probabilities: [TargetValue, Probability][]) {\n    this.probabilities = probabilities;\n    this.assertProbabilitiesSumUpToOne();\n  }\n\n  pick(): TargetValue {\n    this.assertProbabilitiesSumUpToOne();\n\n    const randomValue = Math.random();\n    let cumulativeProbability = 0;\n\n    for (const [target, probability] of this.probabilities) {\n      cumulativeProbability += probability / 100;\n\n      if (randomValue <= cumulativeProbability) {\n        return target;\n      }\n    }\n\n    // This should never happen if the probabilities are correctly set.\n    throw new Error('Failed to pick a number based on probabilities.');\n  }\n\n  *[Symbol.iterator]() {\n    for (const [target] of this.probabilities) {\n      yield target;\n    }\n  }\n\n  private assertProbabilitiesSumUpToOne() {\n    if (this.probabilities.length === 0) throw new Error('Probabilities should not be empty.');\n\n    const probabilitySum = this.probabilities.reduce((acc, [, prob]) => acc + prob, 0);\n    if (probabilitySum !== 100) {\n      throw new Error(`Probabilities should sum up to 100. Sum is ${probabilitySum}.`);\n    }\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Colors, Tiles } from '/src/constants/color';\nimport { RandomPicker } from '/src/components/utils/RandomPicker';\nimport { BrickType } from '/src/enums/brick';\n\ntype Strength = number;\n\nexport abstract class Brick extends L.EngineObject {\n  protected strength: Strength = 1;\n  protected hitCount = 0;\n  protected tiles: [number, number];\n  protected index: number = 0;\n  protected readonly picker: RandomPicker<number>;\n\n  protected constructor(position: L.Vector2, size: L.Vector2 = L.vec2(2, 1)) {\n    super(position, size);\n\n    this.picker = new RandomPicker<Strength>([\n      [BrickType.Normal, 70], // 70% chance of being a weak brick\n      [BrickType.Hard, 30], // 30% chance of being a strong brick\n    ]);\n    this.mass = 0;\n    this.angle = 0;\n    this.setCollision(true);\n    this.strength = this.picker.pick();\n    this.index = L.randInt(0, Colors.length);\n    this.tiles = this.getTileByIndex(this.index);\n    this.color = this.getColorByIndex(this.index);\n    this.tileIndex = this.tiles[this.hitCount];\n    this.tileSize = L.vec2(384, 128);\n  }\n\n  get score(): number {\n    return this.strength;\n  }\n\n  getStrength() {\n    return this.strength;\n  }\n\n  setStrength(strength: Strength) {\n    this.strength = strength;\n  }\n\n  increaseHitCount(): void {\n    this.tileIndex = this.tiles[++this.hitCount];\n    this.angle = L.rand(-0.3, 0.3);\n  }\n\n  shallBeDestroyed(): boolean {\n    return this.hitCount >= this.strength;\n  }\n\n  protected getColorByIndex(index: number) {\n    return Colors[index];\n  }\n\n  protected getTileByIndex(index: number): [number, number] {\n    return Tiles[index];\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Brick } from '/src/components/brick/Brick';\nimport { UnbreakableTileColor, UnbreakableTileIndex } from '/src/constants/color';\n\nexport class BrickUnbreakable extends Brick {\n  constructor(position: L.Vector2, size: L.Vector2 = L.vec2(2, 1)) {\n    super(position, size);\n\n    // Breakable after all but not meant to be easily broken\n    this.strength = 16;\n    this.tiles = this.getTileByIndex(1);\n    this.color = UnbreakableTileColor;\n    this.tileIndex = UnbreakableTileIndex;\n  }\n\n  override setStrength(strength: number) {}\n\n  override get score(): number {\n    return 0;\n  }\n\n  override increaseHitCount() {\n    this.angle = L.rand(-0.01, 0.01);\n    this.hitCount++;\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Brick } from '/src/components/brick/Brick';\n\nexport class BrickBreakable extends Brick {\n  constructor(position: L.Vector2, size: L.Vector2 = L.vec2(2, 1)) {\n    super(position, size);\n  }\n}\n","import { Game } from '/src/game/Game';\nimport { cameraPos } from 'littlejsengine/build/littlejs.esm';\nimport * as L from 'littlejsengine/build/littlejs.esm';\nimport { LevelSize } from '/src/constants/level';\nimport { Levels } from '/src/commands/stage/Levels';\nimport { BrickType } from '/src/enums/brick';\nimport { BrickUnbreakable } from '/src/components/brick/BrickUnbreakable';\nimport { BrickBreakable } from '/src/components/brick/BrickBreakable';\n\ntype LevelType = {\n  map: number[][];\n  bricks: number;\n};\nexport class StageCommand {\n  private readonly game: Game;\n  private readonly levels: LevelType[];\n  private index = 0;\n  private currentLevel: LevelType;\n\n  constructor(game: Game) {\n    this.game = game;\n    this.levels = Levels.reduce((acc, map) => {\n      return [\n        ...acc,\n        {\n          map,\n          bricks: map.reduce((acc, row) => {\n            return (\n              acc +\n              row.reduce((acc, brick) => {\n                return acc + (brick === 1 ? 1 : 0);\n              }, 0)\n            );\n          }, 0),\n        },\n      ];\n    }, [] as LevelType[]);\n    this.currentLevel = this.levels[this.index];\n  }\n\n  showStageText() {\n    if (this.game.paused) {\n      new L.FontImage().drawText(\n        `Stage ${String(this.index + 1).padStart(2, '0')}`,\n        cameraPos.add(L.vec2(0, 0)),\n        0.2,\n        true,\n      );\n    }\n  }\n\n  showClickToStartText() {\n    if (this.game.paused || this.game.over) {\n      new L.FontImage().drawText('Click to Start', L.cameraPos.add(L.vec2(0, -5)), 0.1, true);\n    }\n  }\n\n  showGameOverText() {\n    if (this.game.over) {\n      new L.FontImage().drawText(`Game Over`, cameraPos.add(L.vec2(0, 0)), 0.2, true);\n    }\n  }\n\n  showCounterText() {\n    const navTextValues = [\n      `Score: ${String(this.game.score.toValue()).padStart(4, '0')}`,\n      `Lives: ${String(this.game.lives.getValue()).padStart(2, '0')}`,\n      `Time-Left: ${String(this.game.timeLeft).padStart(3, '0')}`,\n      `Mode: ${this.game.modeCommand.current.displayName}`,\n      `High-Score: ${String(this.game.score.getHighScore()).padStart(5, '0')}`,\n    ];\n    new L.FontImage().drawText(navTextValues.join(' | '), L.vec2(LevelSize.x * 0.5, LevelSize.y + 0.5), 0.07, true);\n  }\n\n  execute(level: number) {\n    this.index = level;\n    this.currentLevel = this.levels[this.index];\n    this.restart();\n  }\n\n  activateNext() {\n    this.index = Math.min(this.index + 1, this.levels.length - 1);\n    this.currentLevel = this.levels[this.index];\n    this.restart();\n  }\n\n  restart() {\n    this.reset();\n    this.populateBlocks();\n  }\n\n  pause() {\n    this.game.paused = true;\n  }\n\n  resume() {\n    this.game.paused = false;\n  }\n\n  reset() {\n    this.game.balls.reset();\n    this.game.bricks.forEach((brick) => brick.destroy());\n    this.game.bricks.length = 0;\n    this.game.lives.restore();\n    this.game.score.reset();\n    this.game.destroyed.setVal(0);\n    this.game.startedAt = L.time;\n    this.game.modeCommand.clearTimers();\n  }\n\n  stageIsCleared() {\n    return this.currentLevel.bricks === this.game.destroyed.getValue();\n  }\n\n  private populateBlocks() {\n    if (this.currentLevel === null) return;\n\n    const offsetX = 0;\n    const offsetY = 10;\n    const blockWidth = 2;\n    const blockHeight = 1;\n    for (const [y, row] of this.currentLevel?.map?.entries()) {\n      for (const [x, type] of row.entries()) {\n        if (type === BrickType.Empty) continue;\n        const position = L.vec2(x * blockWidth + offsetX, y * blockHeight + offsetY);\n        if (type === BrickType.Unbreakable) this.game.bricks.push(new BrickUnbreakable(position));\n        if ([BrickType.Normal, BrickType.Hard].includes(type)) {\n          this.game.bricks.push(new BrickBreakable(position));\n        }\n      }\n    }\n  }\n}\n","export class Counter {\n  protected value: number;\n\n  constructor(\n    private readonly initialValue: number,\n    protected readonly MIN: number = 0,\n    protected readonly MAX: number = 9,\n  ) {\n    this.value = this.apply(initialValue);\n  }\n\n  decrement() {\n    this.value = this.apply(--this.value);\n  }\n\n  increment() {\n    this.value = this.apply(++this.value);\n  }\n\n  restore() {\n    this.value = this.initialValue;\n  }\n\n  add(value: number) {\n    this.value += value;\n    this.value = this.apply(this.value);\n  }\n\n  sub(value: number) {\n    this.value -= value;\n    this.value = this.apply(this.value);\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  hasValue() {\n    return this.value > 0;\n  }\n\n  setMax() {\n    this.value = this.MAX;\n  }\n\n  setMin() {\n    this.value = this.MIN;\n  }\n\n  setVal(value: number) {\n    this.value = this.apply(value);\n  }\n\n  private apply(value: number) {\n    return Math.min(Math.max(value, this.MIN), this.MAX);\n  }\n}\n","import { Counter } from '/src/components/utils/Counter';\n\nexport class Lives extends Counter {\n  runOut() {\n    return !this.hasValue();\n  }\n}\n","type Nullable<T> = T | null;\n\nexport class ListNode<T = unknown> {\n  constructor(\n    public value: T,\n    public next: Nullable<ListNode<T>> = null,\n  ) {}\n}\n\nexport class LinkedList<T = unknown> {\n  private head: Nullable<ListNode<T>>;\n  private tail: Nullable<ListNode<T>>;\n  private length: number;\n\n  constructor() {\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n\n  add(value: T) {\n    const node = { value, next: null };\n    if (this.head === null) {\n      this.head = node;\n      this.tail = node;\n      this.length++;\n      return;\n    }\n    if (this.tail === null) this.tail = node;\n    this.tail.next = node;\n    this.tail = node;\n    this.length++;\n  }\n\n  remove(value: T) {\n    if (this.head === null) return;\n    if (this.head.value === value) {\n      this.head = this.head.next;\n      this.length--;\n      return;\n    }\n    let current = this.head;\n    while (current.next !== null) {\n      if (current.next.value === value) {\n        current.next = current.next.next;\n        this.length--;\n        return;\n      }\n      current = current.next;\n    }\n  }\n\n  has(value: T) {\n    if (this.head === null) return false;\n    let current = this.head;\n    while (current !== null) {\n      if (current.value === value) return true;\n      current = current.next!;\n    }\n    return false;\n  }\n\n  *[Symbol.iterator]() {\n    if (this.head === null) return;\n    let current = this.head;\n    while (current !== null) {\n      yield current.value;\n      current = current.next!;\n    }\n  }\n\n  toArray() {\n    return [...this];\n  }\n\n  getLength() {\n    return this.length;\n  }\n\n  isEmpty() {\n    return this.length === 0;\n  }\n\n  peek() {\n    return this.head?.value;\n  }\n\n  clear() {\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n}\n","import { ParticleEmitter, vec2, Color, Vector2 } from 'littlejsengine/build/littlejs.esm';\n\nexport const Particles = {\n  BallDestroy: (position: Vector2, color: Color) =>\n    new ParticleEmitter(\n      position,\n      0, //position, angle\n      0, // emitSize\n      0.1, // emitTime\n      500, // emitRate\n      3.14, // emitConeAngle\n      -1, // tileIndex\n      vec2(8, 8), // tileSizeY\n      color, // colorStartA\n      color, // colorStartB\n      color.scale(1, 0), // colorEndA\n      color.scale(1, 0), // colorEndB\n      0.2, // particleTime\n      0.1, // sizeStart\n      0.45, // sizeEnd\n      0.1, // speed\n      0.05, // angleSpeed\n      0.98, // damping\n      1, // angleDamping\n      0, // gravityScale\n      3.14, // particleConeAngle\n      0.1, // fadeRate\n      1, // randomness\n      false, // collideTiles\n      false, // additive\n      true, // randomColorLinear\n    ), // particle emitter\n  BrickHit: (position: Vector2, color: Color) =>\n    new ParticleEmitter(\n      position,\n      0, //position, angle\n      0, // emitSize\n      0.1, // emitTime\n      50, // emitRate\n      0.45, // emitConeAngle\n      4, // tileIndex\n      vec2(10, 10), // tileSizeY\n      color, // colorStartA\n      color, // colorStartB\n      color.scale(1, 0), // colorEndA\n      color.scale(1, 0), // colorEndB\n      0.2, // particleTime\n      0.1, // sizeStart\n      0.45, // sizeEnd\n      0.39, // speed\n      0.05, // angleSpeed\n      0.98, // damping\n      1, // angleDamping\n      0, // gravityScale\n      1, // particleConeAngle\n      0.1, // fadeRate\n      0.99, // randomness\n      true, // collideTiles\n      true, // additive\n      false, // randomColorLinear\n    ), // particle emitter,\n} as const;\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Counter } from '/src/components/utils/Counter';\n\nexport class Strength extends Counter {\n  constructor(initialValue: number) {\n    super(initialValue);\n  }\n\n  static getColor(value: number) {\n    if (value === 0) return new L.Color().setHex('#ffffff');\n    if (value === 1) return new L.Color().setHex('#ffffff');\n    if (value === 2) return new L.Color().setHex('#ffd0d0');\n    if (value === 3) return new L.Color().setHex('#ffb0b0');\n    if (value === 4) return new L.Color().setHex('#ff9090');\n    if (value === 5) return new L.Color().setHex('#ff7070');\n    if (value === 6) return new L.Color().setHex('#ff5050');\n    if (value === 7) return new L.Color().setHex('#ff3030');\n    if (value === 8) return new L.Color().setHex('#ff1010');\n\n    return new L.Color().setHex('#ff0000');\n  }\n\n  getColor() {\n    return Strength.getColor(this.value);\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Brick } from '/src/components/brick/Brick';\nimport { Sounds } from '/src/constants/sound';\nimport { Particles } from '/src/constants/particle';\nimport { Paddle } from '/src/components/Paddle';\nimport { emitter } from '/src/utils/Emitter';\nimport { Strength } from '/src/components/utils/Strength';\n\nexport class Ball extends L.EngineObject {\n  readonly strength: Strength;\n\n  constructor(position: L.Vector2, strength = 1) {\n    super(position, L.vec2(0.25));\n\n    this.strength = new Strength(strength);\n    const sign = L.randInt(0, 2) === 0 ? -1 : 1;\n    this.velocity = L.vec2(0.1 * sign, -0.1);\n    this.setCollision(true);\n    this.elasticity = 1;\n  }\n\n  override collideWithObject(object: L.EngineObject): boolean {\n    const isBrick = object instanceof Brick;\n    const isPaddle = object instanceof Paddle;\n\n    if (isBrick) return this.handleBrickCollision(object);\n    if (isPaddle) return this.handlePaddleCollision(object);\n\n    return true; // Single hit and bounce off\n  }\n\n  override update() {\n    this.angleVelocity = this.velocity.length() * 10;\n    this.color = this.strength.getColor();\n    return super.update();\n  }\n\n  private handleBrickCollision(brick: Brick) {\n    this.strength.sub(brick.getStrength());\n    const { color } = brick; // Copy the color of the brick, down below it changes\n    // this.color = color; // Change the color of the ball to the color of the brick\n    Sounds.BrickHit.play(this.pos);\n    brick.increaseHitCount();\n    if (brick.shallBeDestroyed()) {\n      Particles.BallDestroy(this.pos, color);\n      Sounds.BrickDestroy.play(this.pos);\n      emitter.emit('brickDestroyed', brick);\n      brick.destroy();\n    } else {\n      Particles.BrickHit(this.pos, color);\n    }\n    // It will not bounce off but will destroy more bricks as it goes through\n    if (this.strength.hasValue()) return false;\n\n    // Default bounce off\n    return true;\n  }\n\n  private handlePaddleCollision(paddle: Paddle) {\n    this.strength.restore(); // Only paddle touch can restore the strength\n    // Accelerate the sound based on the velocity\n    const pitch = this.velocity.length() + 0.5;\n    Sounds.BallBounce.play(this.pos, 1, pitch);\n\n    const deltaX = this.pos.x - paddle.pos.x;\n    this.velocity = this.velocity.rotate(deltaX * 0.3);\n    this.velocity.y = L.max(this.velocity.y, 0.3);\n\n    const speed = L.min(1.04 * this.velocity.length(), 0.5);\n    this.velocity = this.velocity.normalize().scale(speed);\n\n    return false; // We did a custom bounce calculations, avoid the default bounce\n  }\n}\n","import { LinkedList } from '/src/data-structures/LinkedList';\nimport { Ball } from '/src/components/Ball';\nimport * as L from 'littlejsengine/build/littlejs.esm';\nimport { RandomPicker } from '/src/components/utils/RandomPicker';\n\nexport class Balls {\n  private readonly MAX_BALLS = 200;\n  private readonly balls: LinkedList<Ball>;\n  private readonly picker: RandomPicker<number>;\n  private strength: number = 1;\n\n  constructor() {\n    this.balls = new LinkedList();\n    // Choose a number between -0.5 and 0.5 with a 50% chance.\n    this.picker = new RandomPicker([\n      [-0.5, 50],\n      [0.5, 50],\n    ]);\n  }\n\n  add(ball: Ball) {\n    this.balls.add(ball);\n  }\n\n  setStrength(strength: number) {\n    this.strength = strength;\n  }\n\n  remove(ball: Ball) {\n    this.balls.remove(ball);\n  }\n\n  spawnOneAt(position = L.cameraPos) {\n    if (this.balls.getLength() < this.MAX_BALLS) {\n      const x = this.picker.pick();\n      const y = this.picker.pick();\n      this.add(new Ball(L.vec2(position.x + x, position.y + y), this.strength));\n    }\n  }\n\n  spawnManyAt(position = L.cameraPos, count = 1) {\n    for (let i = 0; i < count; i++) {\n      this.spawnOneAt(position);\n    }\n  }\n\n  double() {\n    // Let's make sure we reference the array before we start modifying it.\n    for (const ball of this.balls.toArray()) {\n      this.spawnOneAt(ball.pos);\n    }\n  }\n\n  triple() {\n    // Let's make sure we reference the array before we start modifying it.\n    for (const ball of this.balls.toArray()) {\n      this.spawnManyAt(ball.pos, 2);\n    }\n  }\n\n  hasValue() {\n    return !this.balls.isEmpty();\n  }\n\n  escaped() {\n    return this.balls.isEmpty();\n  }\n\n  getOne() {\n    return this.balls.peek();\n  }\n\n  update() {\n    for (const ball of this.balls) {\n      if (ball.destroyed) this.balls.remove(ball);\n      // Does not remove the ball right away, but waits for the next frame.\n      if (ball.pos.y < -1) ball.destroy();\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const ball of this.balls) {\n      yield ball;\n    }\n  }\n\n  reset() {\n    for (const ball of this.balls) ball.destroy();\n    this.balls.clear();\n  }\n}\n","import { Game } from '/src/game/Game';\nimport { RandomPicker } from '/src/components/utils/RandomPicker';\nimport { BonusType } from '/src/enums/bonus';\n\nexport abstract class Mode {\n  public abstract readonly displayName: string;\n  protected readonly bonusPicker: RandomPicker<BonusType> = new RandomPicker();\n\n  protected timers: NodeJS.Timeout[] = [];\n\n  protected constructor(public readonly game: Game) {}\n\n  abstract apply(): void;\n\n  update() {}\n\n  pickBonus() {\n    return this.bonusPicker.pick();\n  }\n\n  clearTimers() {\n    this.timers.forEach(clearTimeout);\n  }\n}\n","/**\n * The Ease class provides a collection of easing functions for use with tween.js.\n */\nvar Easing = Object.freeze({\n    Linear: Object.freeze({\n        None: function (amount) {\n            return amount;\n        },\n        In: function (amount) {\n            return this.None(amount);\n        },\n        Out: function (amount) {\n            return this.None(amount);\n        },\n        InOut: function (amount) {\n            return this.None(amount);\n        },\n    }),\n    Quadratic: Object.freeze({\n        In: function (amount) {\n            return amount * amount;\n        },\n        Out: function (amount) {\n            return amount * (2 - amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount;\n            }\n            return -0.5 * (--amount * (amount - 2) - 1);\n        },\n    }),\n    Cubic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\n        },\n    }),\n    Quartic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return 1 - --amount * amount * amount * amount;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount;\n            }\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\n        },\n    }),\n    Quintic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\n        },\n    }),\n    Sinusoidal: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\n        },\n        Out: function (amount) {\n            return Math.sin((amount * Math.PI) / 2);\n        },\n        InOut: function (amount) {\n            return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\n        },\n    }),\n    Exponential: Object.freeze({\n        In: function (amount) {\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\n        },\n        Out: function (amount) {\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            if ((amount *= 2) < 1) {\n                return 0.5 * Math.pow(1024, amount - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\n        },\n    }),\n    Circular: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sqrt(1 - amount * amount);\n        },\n        Out: function (amount) {\n            return Math.sqrt(1 - --amount * amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\n        },\n    }),\n    Elastic: Object.freeze({\n        In: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n        },\n        Out: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            amount *= 2;\n            if (amount < 1) {\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\n        },\n    }),\n    Back: Object.freeze({\n        In: function (amount) {\n            var s = 1.70158;\n            return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\n        },\n        Out: function (amount) {\n            var s = 1.70158;\n            return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\n        },\n        InOut: function (amount) {\n            var s = 1.70158 * 1.525;\n            if ((amount *= 2) < 1) {\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\n            }\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\n        },\n    }),\n    Bounce: Object.freeze({\n        In: function (amount) {\n            return 1 - Easing.Bounce.Out(1 - amount);\n        },\n        Out: function (amount) {\n            if (amount < 1 / 2.75) {\n                return 7.5625 * amount * amount;\n            }\n            else if (amount < 2 / 2.75) {\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\n            }\n            else if (amount < 2.5 / 2.75) {\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\n            }\n            else {\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\n            }\n        },\n        InOut: function (amount) {\n            if (amount < 0.5) {\n                return Easing.Bounce.In(amount * 2) * 0.5;\n            }\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\n        },\n    }),\n    generatePow: function (power) {\n        if (power === void 0) { power = 4; }\n        power = power < Number.EPSILON ? Number.EPSILON : power;\n        power = power > 10000 ? 10000 : power;\n        return {\n            In: function (amount) {\n                return Math.pow(amount, power);\n            },\n            Out: function (amount) {\n                return 1 - Math.pow((1 - amount), power);\n            },\n            InOut: function (amount) {\n                if (amount < 0.5) {\n                    return Math.pow((amount * 2), power) / 2;\n                }\n                return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\n            },\n        };\n    },\n});\n\nvar now = function () { return performance.now(); };\n\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tween\n */\nvar Group = /** @class */ (function () {\n    function Group() {\n        this._tweens = {};\n        this._tweensAddedDuringUpdate = {};\n    }\n    Group.prototype.getAll = function () {\n        var _this = this;\n        return Object.keys(this._tweens).map(function (tweenId) {\n            return _this._tweens[tweenId];\n        });\n    };\n    Group.prototype.removeAll = function () {\n        this._tweens = {};\n    };\n    Group.prototype.add = function (tween) {\n        this._tweens[tween.getId()] = tween;\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\n    };\n    Group.prototype.remove = function (tween) {\n        delete this._tweens[tween.getId()];\n        delete this._tweensAddedDuringUpdate[tween.getId()];\n    };\n    Group.prototype.update = function (time, preserve) {\n        if (time === void 0) { time = now(); }\n        if (preserve === void 0) { preserve = false; }\n        var tweenIds = Object.keys(this._tweens);\n        if (tweenIds.length === 0) {\n            return false;\n        }\n        // Tweens are updated in \"batches\". If you add a new tween during an\n        // update, then the new tween will be updated in the next batch.\n        // If you remove a tween during an update, it may or may not be updated.\n        // However, if the removed tween was added during the current batch,\n        // then it will not be updated.\n        while (tweenIds.length > 0) {\n            this._tweensAddedDuringUpdate = {};\n            for (var i = 0; i < tweenIds.length; i++) {\n                var tween = this._tweens[tweenIds[i]];\n                var autoStart = !preserve;\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\n                    delete this._tweens[tweenIds[i]];\n                }\n            }\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n        }\n        return true;\n    };\n    return Group;\n}());\n\n/**\n *\n */\nvar Interpolation = {\n    Linear: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.Linear;\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n        var b = 0;\n        var n = v.length - 1;\n        var pw = Math.pow;\n        var bn = Interpolation.Utils.Bernstein;\n        for (var i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n        return b;\n    },\n    CatmullRom: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.CatmullRom;\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor((f = m * (1 + k)));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        }\n        else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n    Utils: {\n        Linear: function (p0, p1, t) {\n            return (p1 - p0) * t + p0;\n        },\n        Bernstein: function (n, i) {\n            var fc = Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n        Factorial: (function () {\n            var a = [1];\n            return function (n) {\n                var s = 1;\n                if (a[n]) {\n                    return a[n];\n                }\n                for (var i = n; i > 1; i--) {\n                    s *= i;\n                }\n                a[n] = s;\n                return s;\n            };\n        })(),\n        CatmullRom: function (p0, p1, p2, p3, t) {\n            var v0 = (p2 - p0) * 0.5;\n            var v1 = (p3 - p1) * 0.5;\n            var t2 = t * t;\n            var t3 = t * t2;\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        },\n    },\n};\n\n/**\n * Utils\n */\nvar Sequence = /** @class */ (function () {\n    function Sequence() {\n    }\n    Sequence.nextId = function () {\n        return Sequence._nextId++;\n    };\n    Sequence._nextId = 0;\n    return Sequence;\n}());\n\nvar mainGroup = new Group();\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar Tween = /** @class */ (function () {\n    function Tween(_object, _group) {\n        if (_group === void 0) { _group = mainGroup; }\n        this._object = _object;\n        this._group = _group;\n        this._isPaused = false;\n        this._pauseStart = 0;\n        this._valuesStart = {};\n        this._valuesEnd = {};\n        this._valuesStartRepeat = {};\n        this._duration = 1000;\n        this._isDynamic = false;\n        this._initialRepeat = 0;\n        this._repeat = 0;\n        this._yoyo = false;\n        this._isPlaying = false;\n        this._reversed = false;\n        this._delayTime = 0;\n        this._startTime = 0;\n        this._easingFunction = Easing.Linear.None;\n        this._interpolationFunction = Interpolation.Linear;\n        // eslint-disable-next-line\n        this._chainedTweens = [];\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._id = Sequence.nextId();\n        this._isChainStopped = false;\n        this._propertiesAreSetUp = false;\n        this._goToEnd = false;\n    }\n    Tween.prototype.getId = function () {\n        return this._id;\n    };\n    Tween.prototype.isPlaying = function () {\n        return this._isPlaying;\n    };\n    Tween.prototype.isPaused = function () {\n        return this._isPaused;\n    };\n    Tween.prototype.to = function (target, duration) {\n        if (duration === void 0) { duration = 1000; }\n        if (this._isPlaying)\n            throw new Error('Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.');\n        this._valuesEnd = target;\n        this._propertiesAreSetUp = false;\n        this._duration = duration;\n        return this;\n    };\n    Tween.prototype.duration = function (duration) {\n        if (duration === void 0) { duration = 1000; }\n        this._duration = duration;\n        return this;\n    };\n    Tween.prototype.dynamic = function (dynamic) {\n        if (dynamic === void 0) { dynamic = false; }\n        this._isDynamic = dynamic;\n        return this;\n    };\n    Tween.prototype.start = function (time, overrideStartingValues) {\n        if (time === void 0) { time = now(); }\n        if (overrideStartingValues === void 0) { overrideStartingValues = false; }\n        if (this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        this._repeat = this._initialRepeat;\n        if (this._reversed) {\n            // If we were reversed (f.e. using the yoyo feature) then we need to\n            // flip the tween direction back to forward.\n            this._reversed = false;\n            for (var property in this._valuesStartRepeat) {\n                this._swapEndStartRepeatValues(property);\n                this._valuesStart[property] = this._valuesStartRepeat[property];\n            }\n        }\n        this._isPlaying = true;\n        this._isPaused = false;\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._isChainStopped = false;\n        this._startTime = time;\n        this._startTime += this._delayTime;\n        if (!this._propertiesAreSetUp || overrideStartingValues) {\n            this._propertiesAreSetUp = true;\n            // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n            if (!this._isDynamic) {\n                var tmp = {};\n                for (var prop in this._valuesEnd)\n                    tmp[prop] = this._valuesEnd[prop];\n                this._valuesEnd = tmp;\n            }\n            this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat, overrideStartingValues);\n        }\n        return this;\n    };\n    Tween.prototype.startFromCurrentValues = function (time) {\n        return this.start(time, true);\n    };\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat, overrideStartingValues) {\n        for (var property in _valuesEnd) {\n            var startValue = _object[property];\n            var startValueIsArray = Array.isArray(startValue);\n            var propType = startValueIsArray ? 'array' : typeof startValue;\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\n            // If `to()` specifies a property that doesn't exist in the source object,\n            // we should not set that property in the object\n            if (propType === 'undefined' || propType === 'function') {\n                continue;\n            }\n            // Check if an Array was provided as property value\n            if (isInterpolationList) {\n                var endValues = _valuesEnd[property];\n                if (endValues.length === 0) {\n                    continue;\n                }\n                // Handle an array of relative values.\n                // Creates a local copy of the Array with the start value at the front\n                var temp = [startValue];\n                for (var i = 0, l = endValues.length; i < l; i += 1) {\n                    var value = this._handleRelativeValue(startValue, endValues[i]);\n                    if (isNaN(value)) {\n                        isInterpolationList = false;\n                        console.warn('Found invalid interpolation list. Skipping.');\n                        break;\n                    }\n                    temp.push(value);\n                }\n                if (isInterpolationList) {\n                    // if (_valuesStart[property] === undefined) { // handle end values only the first time. NOT NEEDED? setupProperties is now guarded by _propertiesAreSetUp.\n                    _valuesEnd[property] = temp;\n                    // }\n                }\n            }\n            // handle the deepness of the values\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\n                _valuesStart[property] = startValueIsArray ? [] : {};\n                var nestedObject = startValue;\n                for (var prop in nestedObject) {\n                    _valuesStart[property][prop] = nestedObject[prop];\n                }\n                // TODO? repeat nested values? And yoyo? And array values?\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {};\n                var endValues = _valuesEnd[property];\n                // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n                if (!this._isDynamic) {\n                    var tmp = {};\n                    for (var prop in endValues)\n                        tmp[prop] = endValues[prop];\n                    _valuesEnd[property] = endValues = tmp;\n                }\n                this._setupProperties(nestedObject, _valuesStart[property], endValues, _valuesStartRepeat[property], overrideStartingValues);\n            }\n            else {\n                // Save the starting value, but only once unless override is requested.\n                if (typeof _valuesStart[property] === 'undefined' || overrideStartingValues) {\n                    _valuesStart[property] = startValue;\n                }\n                if (!startValueIsArray) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n                }\n                if (isInterpolationList) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\n                }\n                else {\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\n                }\n            }\n        }\n    };\n    Tween.prototype.stop = function () {\n        if (!this._isChainStopped) {\n            this._isChainStopped = true;\n            this.stopChainedTweens();\n        }\n        if (!this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        this._isPlaying = false;\n        this._isPaused = false;\n        if (this._onStopCallback) {\n            this._onStopCallback(this._object);\n        }\n        return this;\n    };\n    Tween.prototype.end = function () {\n        this._goToEnd = true;\n        this.update(Infinity);\n        return this;\n    };\n    Tween.prototype.pause = function (time) {\n        if (time === void 0) { time = now(); }\n        if (this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = true;\n        this._pauseStart = time;\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        return this;\n    };\n    Tween.prototype.resume = function (time) {\n        if (time === void 0) { time = now(); }\n        if (!this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = false;\n        this._startTime += time - this._pauseStart;\n        this._pauseStart = 0;\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        return this;\n    };\n    Tween.prototype.stopChainedTweens = function () {\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            this._chainedTweens[i].stop();\n        }\n        return this;\n    };\n    Tween.prototype.group = function (group) {\n        if (group === void 0) { group = mainGroup; }\n        this._group = group;\n        return this;\n    };\n    Tween.prototype.delay = function (amount) {\n        if (amount === void 0) { amount = 0; }\n        this._delayTime = amount;\n        return this;\n    };\n    Tween.prototype.repeat = function (times) {\n        if (times === void 0) { times = 0; }\n        this._initialRepeat = times;\n        this._repeat = times;\n        return this;\n    };\n    Tween.prototype.repeatDelay = function (amount) {\n        this._repeatDelayTime = amount;\n        return this;\n    };\n    Tween.prototype.yoyo = function (yoyo) {\n        if (yoyo === void 0) { yoyo = false; }\n        this._yoyo = yoyo;\n        return this;\n    };\n    Tween.prototype.easing = function (easingFunction) {\n        if (easingFunction === void 0) { easingFunction = Easing.Linear.None; }\n        this._easingFunction = easingFunction;\n        return this;\n    };\n    Tween.prototype.interpolation = function (interpolationFunction) {\n        if (interpolationFunction === void 0) { interpolationFunction = Interpolation.Linear; }\n        this._interpolationFunction = interpolationFunction;\n        return this;\n    };\n    // eslint-disable-next-line\n    Tween.prototype.chain = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._chainedTweens = tweens;\n        return this;\n    };\n    Tween.prototype.onStart = function (callback) {\n        this._onStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onEveryStart = function (callback) {\n        this._onEveryStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onUpdate = function (callback) {\n        this._onUpdateCallback = callback;\n        return this;\n    };\n    Tween.prototype.onRepeat = function (callback) {\n        this._onRepeatCallback = callback;\n        return this;\n    };\n    Tween.prototype.onComplete = function (callback) {\n        this._onCompleteCallback = callback;\n        return this;\n    };\n    Tween.prototype.onStop = function (callback) {\n        this._onStopCallback = callback;\n        return this;\n    };\n    /**\n     * @returns true if the tween is still playing after the update, false\n     * otherwise (calling update on a paused tween still returns true because\n     * it is still playing, just paused).\n     */\n    Tween.prototype.update = function (time, autoStart) {\n        if (time === void 0) { time = now(); }\n        if (autoStart === void 0) { autoStart = true; }\n        if (this._isPaused)\n            return true;\n        var property;\n        var elapsed;\n        var endTime = this._startTime + this._duration;\n        if (!this._goToEnd && !this._isPlaying) {\n            if (time > endTime)\n                return false;\n            if (autoStart)\n                this.start(time, true);\n        }\n        this._goToEnd = false;\n        if (time < this._startTime) {\n            return true;\n        }\n        if (this._onStartCallbackFired === false) {\n            if (this._onStartCallback) {\n                this._onStartCallback(this._object);\n            }\n            this._onStartCallbackFired = true;\n        }\n        if (this._onEveryStartCallbackFired === false) {\n            if (this._onEveryStartCallback) {\n                this._onEveryStartCallback(this._object);\n            }\n            this._onEveryStartCallbackFired = true;\n        }\n        elapsed = (time - this._startTime) / this._duration;\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\n        var value = this._easingFunction(elapsed);\n        // properties transformations\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\n        if (this._onUpdateCallback) {\n            this._onUpdateCallback(this._object, elapsed);\n        }\n        if (elapsed === 1) {\n            if (this._repeat > 0) {\n                if (isFinite(this._repeat)) {\n                    this._repeat--;\n                }\n                // Reassign starting values, restart by making startTime = now\n                for (property in this._valuesStartRepeat) {\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\n                        this._valuesStartRepeat[property] =\n                            // eslint-disable-next-line\n                            // @ts-ignore FIXME?\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n                    }\n                    if (this._yoyo) {\n                        this._swapEndStartRepeatValues(property);\n                    }\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\n                }\n                if (this._yoyo) {\n                    this._reversed = !this._reversed;\n                }\n                if (this._repeatDelayTime !== undefined) {\n                    this._startTime = time + this._repeatDelayTime;\n                }\n                else {\n                    this._startTime = time + this._delayTime;\n                }\n                if (this._onRepeatCallback) {\n                    this._onRepeatCallback(this._object);\n                }\n                this._onEveryStartCallbackFired = false;\n                return true;\n            }\n            else {\n                if (this._onCompleteCallback) {\n                    this._onCompleteCallback(this._object);\n                }\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n                    // Make the chained tweens start exactly at the time they should,\n                    // even if the `update()` method was called way past the duration of the tween\n                    this._chainedTweens[i].start(this._startTime + this._duration, false);\n                }\n                this._isPlaying = false;\n                return false;\n            }\n        }\n        return true;\n    };\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\n        for (var property in _valuesEnd) {\n            // Don't update properties that do not exist in the source object\n            if (_valuesStart[property] === undefined) {\n                continue;\n            }\n            var start = _valuesStart[property] || 0;\n            var end = _valuesEnd[property];\n            var startIsArray = Array.isArray(_object[property]);\n            var endIsArray = Array.isArray(end);\n            var isInterpolationList = !startIsArray && endIsArray;\n            if (isInterpolationList) {\n                _object[property] = this._interpolationFunction(end, value);\n            }\n            else if (typeof end === 'object' && end) {\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._updateProperties(_object[property], start, end, value);\n            }\n            else {\n                // Parses relative end values with start as base (e.g.: +10, -3)\n                end = this._handleRelativeValue(start, end);\n                // Protect against non numeric properties.\n                if (typeof end === 'number') {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _object[property] = start + (end - start) * value;\n                }\n            }\n        }\n    };\n    Tween.prototype._handleRelativeValue = function (start, end) {\n        if (typeof end !== 'string') {\n            return end;\n        }\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n            return start + parseFloat(end);\n        }\n        return parseFloat(end);\n    };\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\n        var tmp = this._valuesStartRepeat[property];\n        var endValue = this._valuesEnd[property];\n        if (typeof endValue === 'string') {\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\n        }\n        else {\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\n        }\n        this._valuesEnd[property] = tmp;\n    };\n    return Tween;\n}());\n\nvar VERSION = '21.0.0';\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar nextId = Sequence.nextId;\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tweens.\n */\nvar TWEEN = mainGroup;\n// This is the best way to export things in a way that's compatible with both ES\n// Modules and CommonJS, without build hacks, and so as not to break the\n// existing API.\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\nvar getAll = TWEEN.getAll.bind(TWEEN);\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\nvar add = TWEEN.add.bind(TWEEN);\nvar remove = TWEEN.remove.bind(TWEEN);\nvar update = TWEEN.update.bind(TWEEN);\nvar exports = {\n    Easing: Easing,\n    Group: Group,\n    Interpolation: Interpolation,\n    now: now,\n    Sequence: Sequence,\n    nextId: nextId,\n    Tween: Tween,\n    VERSION: VERSION,\n    getAll: getAll,\n    removeAll: removeAll,\n    add: add,\n    remove: remove,\n    update: update,\n};\n\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, exports as default, getAll, nextId, now, remove, removeAll, update };\n","import { Mode } from '/src/commands/mode/Mode';\nimport * as TWEEN from '@tweenjs/tween.js';\nimport * as L from 'littlejsengine/build/littlejs.esm';\nimport { LinkedList } from '/src/data-structures/LinkedList';\nimport { Game } from '/src/game/Game';\nimport { BonusType } from '/src/enums/bonus';\n\nexport class DynamicMode extends Mode {\n  public readonly displayName = 'Dynamic';\n  private readonly timeout = 10_000;\n  private readonly tweens: LinkedList<TWEEN.Tween<L.Vector2>> = new LinkedList();\n\n  constructor(game: Game) {\n    super(game);\n\n    this.bonusPicker.setProbabilities([\n      [BonusType.ExtraScore, 20],\n      [BonusType.ExtraStrength, 20],\n      [BonusType.PaddleIncrease, 20],\n      [BonusType.PaddleDecrease, 40],\n    ]);\n  }\n\n  apply(): void {\n    console.info('Dynamic mode activated');\n    this.timers.push(\n      setInterval(() => {\n        for (const brick of this.game.bricks) {\n          const tween = new TWEEN.Tween(brick.pos);\n          tween.to({ y: brick.pos.y - 1 }, 500);\n          tween.easing(TWEEN.Easing.Bounce.Out);\n          tween.start();\n          this.tweens.add(tween);\n        }\n      }, this.timeout),\n    );\n  }\n\n  override update() {\n    for (const tween of this.tweens) {\n      tween.update();\n    }\n  }\n}\n","import { Mode } from '/src/commands/mode/Mode';\nimport { Game } from '/src/game/Game';\n\nexport class ClassicMode extends Mode {\n  public readonly displayName = 'Classic';\n\n  constructor(game: Game) {\n    super(game);\n  }\n\n  apply(): void {\n    console.info('Classic mode activated');\n    this.game.bricks.forEach((brick) => {\n      // One hit to destroy\n      brick.setStrength(1);\n    });\n  }\n}\n","import { Mode } from '/src/commands/mode/Mode';\nimport { Game } from '/src/game/Game';\nimport * as TWEEN from '@tweenjs/tween.js';\nimport { LinkedList } from '/src/data-structures/LinkedList';\nimport L from 'littlejsengine/build/littlejs.esm';\nimport { BonusType } from '/src/enums/bonus';\n\nexport class BonusMode extends Mode {\n  public readonly displayName = 'Bonus';\n  private readonly timeout = 3_000;\n  private readonly tweens: LinkedList<TWEEN.Tween<L.Vector2>> = new LinkedList();\n\n  constructor(game: Game) {\n    super(game);\n\n    this.bonusPicker.setProbabilities([\n      [BonusType.DoubleBalls, 10],\n      [BonusType.TripleBalls, 10],\n      [BonusType.ExtraBalls, 30],\n      [BonusType.ExtraScore, 30],\n      [BonusType.ExtraWall, 20],\n    ]);\n  }\n\n  apply(): void {\n    console.info('Bonus mode activated');\n    this.game.balls.setStrength(9); // Max strength\n\n    this.timers.push(\n      setInterval(() => {\n        for (const brick of this.game.bricks) {\n          const tween = new TWEEN.Tween(brick.pos);\n          tween.to({ y: brick.pos.y - 1 }, 900);\n          tween.easing(TWEEN.Easing.Bounce.Out);\n          tween.start();\n          this.tweens.add(tween);\n        }\n      }, this.timeout),\n    );\n  }\n\n  override update() {\n    for (const tween of this.tweens) {\n      tween.update();\n    }\n  }\n}\n","import { Mode } from '/src/commands/mode/Mode';\nimport { Game } from '/src/game/Game';\nimport { BonusType } from '/src/enums/bonus';\n\nexport class ModernMode extends Mode {\n  public readonly displayName = 'Modern';\n\n  constructor(game: Game) {\n    super(game);\n\n    this.bonusPicker.setProbabilities([\n      [BonusType.DoubleBalls, 5],\n      [BonusType.TripleBalls, 5],\n      [BonusType.ExtraBalls, 15],\n      [BonusType.ExtraScore, 15],\n      [BonusType.ExtraWall, 10],\n      [BonusType.ExtraStrength, 20],\n      [BonusType.PaddleDecrease, 15],\n      [BonusType.PaddleIncrease, 15],\n    ]);\n  }\n\n  apply(): void {\n    console.info('Modern mode activated');\n  }\n}\n","import { Game } from '/src/game/Game';\nimport { GameMode } from '/src/enums/mode';\nimport { DynamicMode } from '/src/commands/mode/DynamicMode';\nimport { Mode } from '/src/commands/mode/Mode';\nimport { ClassicMode } from '/src/commands/mode/ClassicMode';\nimport { BonusMode } from '/src/commands/mode/BonusMode';\nimport { ModernMode } from '/src/commands/mode/ModernMode';\n\nexport class ModeCommand {\n  private readonly modes: Record<GameMode, Mode>;\n  private currentMode: Mode;\n\n  constructor(game: Game) {\n    this.modes = {\n      [GameMode.Dynamic]: new DynamicMode(game),\n      [GameMode.Classic]: new ClassicMode(game),\n      [GameMode.Bonus]: new BonusMode(game),\n      [GameMode.Modern]: new ModernMode(game),\n    };\n    this.currentMode = this.modes[GameMode.Classic];\n  }\n\n  get current() {\n    return this.currentMode;\n  }\n\n  execute(mode: GameMode) {\n    this.clearTimers();\n    this.currentMode = this.modes[mode];\n    this.currentMode.apply();\n  }\n\n  update() {\n    this.currentMode.update();\n  }\n\n  setDefault() {\n    this.execute(GameMode.Dynamic);\n  }\n\n  modeIsDynamic() {\n    return this.currentMode instanceof DynamicMode;\n  }\n\n  modeIsClassic() {\n    return this.currentMode instanceof ClassicMode;\n  }\n\n  modeIsBonus() {\n    return this.currentMode instanceof BonusMode;\n  }\n\n  modeIsModern() {\n    return this.currentMode instanceof ModernMode;\n  }\n\n  pickBonusType() {\n    return this.currentMode.pickBonus();\n  }\n\n  clearTimers() {\n    this.currentMode.clearTimers();\n  }\n}\n","import * as L from 'littlejsengine/build/littlejs.esm';\nimport { Paddle } from '/src/components/Paddle';\nimport { Wall } from '/src/components/Wall';\nimport { LevelSize } from '/src/constants/level';\nimport { Score } from '/src/game/utils/Score';\nimport Tilemap from '/src/assets/bricks/tiles.png';\nimport { Debug } from '/src/utils/Debug';\nimport { emitter } from '/src/utils/Emitter';\nimport { BonusType } from '/src/enums/bonus';\nimport { BonusCommand } from '/src/commands/BonusCommand';\nimport { Sounds } from '/src/constants/sound';\nimport { StageCommand } from '/src/commands/StageCommand';\nimport { Lives } from '/src/components/utils/Lives';\nimport { Balls } from '/src/components/Balls';\nimport { ModeCommand } from '/src/commands/ModeCommand';\nimport { GameMode } from '/src/enums/mode';\nimport { Brick } from '/src/components/brick/Brick';\nimport { BrickBreakable } from '/src/components/brick/BrickBreakable';\nimport { Counter } from '/src/components/utils/Counter';\n\nL.setShowWatermark(Debug.enabled());\nDebug.disabled() && L.setDebugKey(-1);\n\nexport class Game {\n  public paddle: Paddle | null = null;\n  public balls: Balls;\n  public bricks: Brick[] = [];\n  public floor: Wall | null = null;\n  public over: boolean = false;\n  public paused: boolean = true;\n  public idle: boolean = false;\n  public startedAt: number = 0;\n\n  public readonly levelTime: number = 90; // seconds\n  public readonly lives: Lives;\n  public readonly score: Score;\n  public readonly destroyed: Counter;\n  public readonly modeCommand: ModeCommand;\n  private readonly bonusCommand: BonusCommand;\n  private readonly stageCommand: StageCommand;\n\n  constructor() {\n    this.init = this.init.bind(this);\n    this.update = this.update.bind(this);\n    this.postUpdate = this.postUpdate.bind(this);\n    this.render = this.render.bind(this);\n    this.postRender = this.postRender.bind(this);\n    this.onBonusCollected = this.onBonusCollected.bind(this);\n    this.onBrickDestroyed = this.onBrickDestroyed.bind(this);\n\n    this.balls = new Balls();\n    this.score = new Score(0);\n    this.destroyed = new Counter(0, 0, 999);\n    this.lives = new Lives(3);\n    this.bonusCommand = new BonusCommand(this);\n    this.stageCommand = new StageCommand(this);\n    this.modeCommand = new ModeCommand(this);\n  }\n\n  run(mode: GameMode, stage: number) {\n    this.modeCommand.execute(mode);\n    this.stageCommand.execute(stage);\n    L.engineInit(this.init, this.update, this.postUpdate, this.render, this.postRender, Tilemap);\n    emitter.on('bonusCollected', this.onBonusCollected);\n    emitter.on('brickDestroyed', this.onBrickDestroyed);\n  }\n\n  private init() {\n    L.setCanvasFixedSize(new L.Vector2(1280, 720));\n    L.setCameraPos(LevelSize.scale(0.5));\n\n    this.paddle = new Paddle(LevelSize);\n    new Wall(L.vec2(-0.5, LevelSize.y * 0.5), L.vec2(1, LevelSize.y));\n    new Wall(L.vec2(LevelSize.x + 0.5, LevelSize.y * 0.5), L.vec2(1, LevelSize.y));\n    new Wall(L.vec2(LevelSize.x * 0.5, LevelSize.y), L.vec2(LevelSize.x + 2, 1));\n    this.startedAt = L.time;\n    this.stageCommand.restart();\n  }\n\n  private update() {\n    const mouseKeyPressed = L.mouseWasPressed(0) || L.gamepadWasPressed(0);\n    if (mouseKeyPressed) {\n      // Start the game\n      this.startedAt = L.time;\n      this.paused = false;\n      this.over = false;\n    }\n\n    if (this.over) return;\n    if (this.paused) return;\n\n    this.balls.update();\n\n    if (this.balls.escaped() && !this.idle) {\n      this.lives.decrement(); // Lost 1 life\n      if (this.lives.runOut()) {\n        // TODO: Play game over sound\n        this.over = true;\n        return console.info('Game over');\n      }\n      this.idle = true;\n    }\n\n    if (mouseKeyPressed) {\n      if (!this.balls.hasValue() && this.lives.hasValue()) {\n        Sounds.GameStart.play();\n        this.balls.spawnOneAt(L.cameraPos); // Center of the screen\n        this.idle = false;\n      }\n    }\n  }\n\n  private postUpdate() {\n    this.modeCommand.update();\n    if (this.stageCommand.stageIsCleared()) {\n      console.log('winner');\n      this.stageCommand.pause();\n      this.stageCommand.activateNext();\n    }\n  }\n\n  private render() {\n    // Background drawing\n    L.drawRect(L.cameraPos, L.vec2(100, 100), new L.Color().setHex('#494746'));\n    L.drawRect(L.cameraPos, LevelSize, new L.Color().setHex('#ce9a80'));\n  }\n\n  private postRender() {\n    this.stageCommand.showCounterText();\n    this.stageCommand.showClickToStartText();\n    this.stageCommand.showGameOverText();\n    this.stageCommand.showStageText();\n  }\n\n  private onBonusCollected(bonus: BonusType) {\n    this.bonusCommand.collect(bonus);\n  }\n\n  private onBrickDestroyed(brick: Brick) {\n    this.score.add(brick.score);\n    if (brick instanceof BrickBreakable) this.destroyed.increment();\n    // No bonuses in classic mode\n    if (this.modeCommand.modeIsClassic()) return;\n\n    if (this.score.toValue() % 1 === 0) {\n      this.bonusCommand.produce(this.modeCommand.pickBonusType());\n    }\n  }\n\n  public get timeLeft() {\n    const delta = Math.floor(L.time - this.startedAt);\n    return this.levelTime - delta;\n  }\n}\n","const dialog = document.getElementById('lobby') as HTMLDialogElement;\nconst selectEl = dialog.querySelector('select') as HTMLSelectElement;\nconst start = dialog.querySelector('#start') as HTMLButtonElement;\nconst levels = dialog.querySelectorAll('button.block') as NodeListOf<HTMLButtonElement>;\nconst selected = { ref: levels[0], level: +levels[0].value, mode: +selectEl.value };\n\nstart.addEventListener('click', (event) => {\n  event.preventDefault(); // We don't want to submit this fake form\n  dialog.close(selectEl.value); // Have to send the select box value here.\n  selected.mode = +selectEl.value;\n});\n\nlevels.forEach((level) => {\n  level.addEventListener('click', (event) => {\n    selected.ref.classList.remove('selected');\n    selected.ref = level;\n    selected.level = +level.value;\n    selected.ref.classList.add('selected');\n  });\n});\n\nexport { dialog, selected };\n","import env from './utils/Env';\nimport { Game } from '/src/game/Game';\nimport { dialog, selected } from '/src/ui/lobby';\n\ndialog.showModal();\n\nconsole.info('Is development mode:', env.isDevelopment());\n\nconst game = new Game();\n\ndialog.addEventListener('close', (e) => {\n  // Prevent ESC key from closing the dialog, enforce user to click on a button.\n  if (!['0', '1', '2'].includes(dialog.returnValue)) dialog.showModal();\n\n  game.run(selected.mode, selected.level);\n  console.log(selected);\n});\n"],"names":["EnvMode","GameMode","GameMode2","Env","mode","env","debug","debugPointSize","showWatermark","godMode","debugKey","debugPrimitives","debugOverlay","debugPhysics","debugParticles","debugGamepads","debugTakeScreenshot","downloadLink","ASSERT","assert","debugRect","pos","size","vec2","color","time","angle","fill","Timer","debugCircle","radius","debugPoint","debugLine","posA","posB","thickness","halfDelta","debugAABB","pA","sA","pB","sB","minPos","min","maxPos","max","debugText","text","font","debugSaveCanvas","canvas","filename","engineName","debugInit","debugUpdate","keyWasPressed","debugRender","glCopyToContext","mainContext","overlayCanvas","mainCanvas","gamepadsEnable","gamepads","i","gamepad","centerPos","cameraPos","sticks","stickData","j","drawPos","stickPos","pressed","saveContext","overlayContext","bestDistance","bestObject","o","engineObjects","distance","mousePos","color1","Color","color2","drawRect","drawLine","raycastHitPos","tileCollisionRaycast","getTileCollisionData","drawTextScreen","mousePosScreen","pointSize","cameraScale","p","worldToScreen","w","h","r","x","y","formatTime","keysPressed","inputData","keyIsDown","buttonsPressed","PI","abs","a","b","sign","clamp","v","percent","lerp","isOverlapping","t","rand","randInt","randSign","randInCircle","minRadius","randVector","Vector2","length","randColor","cA","cB","linear","isVector2","s","l","c","arraySize","digits","g","q","f","amount","alphaAmount","useAlpha","toHex","hex","fromHex","toByte","timeLeft","canvasMaxSize","canvasFixedSize","cavasPixelated","fontDefault","glEnable","tileSizeDefault","tileFixBleedScale","objectDefaultMass","objectDefaultDamping","objectDefaultAngleDamping","objectDefaultElasticity","objectDefaultFriction","objectMaxSpeed","gravity","particleEmitRateScale","soundVolume","soundDefaultRange","soundDefaultTaper","medalDisplayTime","medalDisplaySlideTime","EngineObject","tileIndex","tileSize","renderOrder","parent","oldPos","wasMovingDown","groundSpeed","engineObjectsCollide","deltaPos","pushAwayAccel","velocity","sizeBoth","smallStepUp","isBlockedX","isBlockedY","elasticity","inelastic","elastic0","elastic1","tileCollisionTest","drawTile","child","tileData","force","localPos","localAngle","collideSolidObjects","isSolid","collideTiles","mainCanvasSize","tileImage","tileImageSize","tileImageFixBleed","drawCount","screenToWorld","screenPos","worldPos","mirror","additiveColor","useWebGL","glDraw","cols","uvSizeX","uvSizeY","uvX","uvY","drawCanvas2D","context","sX","sY","sWidth","sHeight","drawFunction","setBlendMode","additive","glSetBlendMode","lineWidth","lineColor","textAlign","line","engineFontImage","FontImage","image","paddingSize","startTileIndex","scale","center","drawSize","centerOffset","charCode","tile","key","device","clearInput","mouseWasPressed","isUsingGamepad","gamepadIsDown","button","gamepadWasPressed","inputUpdate","isTouchDevice","gamepadsUpdate","inputUpdatePost","deviceInputData","remapKey","mouseToScreen","rect","data","applyDeadZone","dpad","wasTouching","mouseDown","mouseUp","e","zzfx","touching","Sound","zzfxSound","range","taper","zzfxG","volume","pitch","randomnessScale","pan","lengthSquared","playbackRate","playSamples","semitoneOffset","audioContext","sampleChannels","rate","loop","buffer","zzfxR","source","gainNode","randomness","frequency","attack","sustain","release","shape","shapeCurve","slide","deltaSlide","pitchJump","pitchJumpTime","repeatTime","noise","modulation","bitCrush","delay","sustainVolume","decay","tremolo","PI2","startSlide","startFrequency","tm","tileCollision","tileCollisionSize","object","minX","minY","maxX","maxY","posStart","posEnd","posDelta","dx","dy","sx","sy","e2","ParticleEmitter","emitSize","emitTime","emitRate","emitConeAngle","colorStartA","colorStartB","colorEndA","colorEndB","particleTime","sizeStart","sizeEnd","speed","angleSpeed","damping","angleDamping","gravityScale","particleConeAngle","fadeRate","randomColorLinear","localSpace","timeDelta","particle","Particle","randomizeScale","coneAngle","colorStart","colorEnd","velocityAngle","direction","trailLength","medalsDisplayQueue","medalsDisplayTimeLast","medalsRender","medal","timeReal","slideOffTime","hidePercent","glCanvas","glContext","glTileTexture","glShader","glArrayBuffer","glPositionData","glColorData","glBatchCount","glBatchAdditive","glAdditive","glInit","glCreateTexture","glCreateProgram","vertexData","gl_VERTEX_BUFFER_SIZE","glCompileShader","type","shader","gl_COMPILE_STATUS","vsSource","fsSource","program","gl_VERTEX_SHADER","gl_FRAGMENT_SHADER","gl_LINK_STATUS","texture","gl_TEXTURE_2D","gl_RGBA","gl_UNSIGNED_BYTE","filter","gl_NEAREST","gl_TEXTURE_MIN_FILTER","gl_TEXTURE_MAG_FILTER","gl_TEXTURE_WRAP_S","gl_CLAMP_TO_EDGE","gl_TEXTURE_WRAP_T","glPreRender","gl_COLOR_BUFFER_BIT","gl_TEXTURE0","gl_ARRAY_BUFFER","gl_DYNAMIC_DRAW","offset","initVertexAttribArray","name","typeSize","normalize","location","gl_VERTEX_BYTE_STRIDE","gl_FLOAT","glFlush","destBlend","gl_ONE","gl_ONE_MINUS_SRC_ALPHA","gl_SRC_ALPHA","gl_BLEND","gl_VERTICES_PER_QUAD","gl_INDICIES_PER_VERT","gl_TRIANGLES","forceDraw","sizeX","sizeY","uv0X","uv0Y","uv1X","uv1Y","rgba","rgbaAdditive","gl_MAX_BATCH","cx","cy","engineVersion","frameRate","frame","paused","engineInit","gameInit","gameUpdate","gameUpdatePost","gameRender","gameRenderPost","tileImageSource","styleBody","styleCanvas","engineUpdate","frameTimeLastMS","frameTimeBufferMS","averageFPS","frameTimeMS","frameTimeDeltaMS","debugSpeedUp","debugSpeedDown","aspect","fixedAspect","deltaSmooth","engineObjectsUpdate","enginePreRender","updateObject","setCameraPos","setCanvasFixedSize","setShowWatermark","show","setDebugKey","Paddle","L.EngineObject","levelSize","L.vec2","L.Color","L.clamp","L.mousePos","Wall","position","LevelSize","Score","initialValue","__publicField","value","Tilemap","Debug","E","callback","ctx","self","listener","evtArr","len","evts","liveEvents","tinyEmitterModule","TinyEmitter","emitter","BonusType","BonusType2","game","ExtraBalls","ball","L.cameraPos","ExtraLife","PaddleIncrease","_a","PaddleDecrease","ExtraScore","ExtraWall","DoubleBalls","TripleBalls","Tiles","UnbreakableTileIndex","UnbreakableTileColor","Colors","Bonus","L.randInt","BonusCommand","command","Sounds","L.Sound","Levels","levels","BrickType","BrickType2","RandomPicker","probabilities","randomValue","cumulativeProbability","target","probability","probabilitySum","acc","prob","Brick","strength","L.rand","index","BrickUnbreakable","BrickBreakable","StageCommand","map","row","brick","L.FontImage","navTextValues","level","L.time","offsetX","offsetY","blockWidth","blockHeight","_b","Counter","MIN","MAX","Lives","LinkedList","node","current","Particles","Strength","Ball","isBrick","isPaddle","paddle","deltaX","L.max","L.min","Balls","count","Mode","Easing","power","now","Group","_this","tweenId","tween","preserve","tweenIds","autoStart","Interpolation","k","m","fn","n","pw","bn","p0","p1","fc","p2","p3","v0","v1","t2","t3","Sequence","mainGroup","Tween","_object","_group","duration","dynamic","overrideStartingValues","property","tmp","prop","_valuesStart","_valuesEnd","_valuesStartRepeat","startValue","startValueIsArray","propType","isInterpolationList","endValues","temp","nestedObject","numChainedTweens","group","times","yoyo","easingFunction","interpolationFunction","tweens","_i","elapsed","endTime","start","end","startIsArray","endIsArray","endValue","TWEEN","DynamicMode","TWEEN.Tween","TWEEN.Easing","ClassicMode","BonusMode","ModernMode","ModeCommand","L.setShowWatermark","L.setDebugKey","Game","stage","L.engineInit","L.setCanvasFixedSize","L.Vector2","L.setCameraPos","mouseKeyPressed","L.mouseWasPressed","L.gamepadWasPressed","L.drawRect","bonus","delta","dialog","selectEl","selected","event"],"mappings":"k3BAAY,IAAAA,IAAAA,IACVA,EAAA,YAAc,cACdA,EAAA,WAAa,aACbA,EAAA,YAAc,SACdA,EAAA,WAAa,QACbA,EAAA,OAAS,OACTA,EAAA,SAAW,OACXA,EAAA,QAAU,MAPAA,IAAAA,IAAA,CAAA,CAAA,EAUAC,IAAAA,IACVA,EAAAC,EAAA,QAAA,CAAA,EAAA,UACAD,EAAAC,EAAA,QAAA,CAAA,EAAA,UACAD,EAAAC,EAAA,OAAA,CAAA,EAAA,SACAD,EAAAC,EAAA,MAAA,CAAA,EAAA,QAJUD,IAAAA,IAAA,CAAA,CAAA,ECRL,MAAME,EAAI,CACf,YAAqBC,EAAc,CAAd,KAAA,KAAAA,CAAe,CAEpC,eAAgB,CACP,OAAA,KAAK,OAASJ,GAAQ,WAC/B,CAEA,cAAe,CACN,OAAA,KAAK,OAASA,GAAQ,UAC/B,CAEA,UAAW,CACF,OAAA,KAAK,OAASA,GAAQ,MAC/B,CAEA,eAAgB,CACP,OAAA,KAAK,OAASA,GAAQ,WAC/B,CAEA,YAAa,CACJ,OAAA,KAAK,OAASA,GAAQ,QAC/B,CAEA,WAAY,CACH,OAAA,KAAK,OAASA,GAAQ,OAC/B,CACF,CAEA,MAAAK,GAAe,IAAIF,GAAI,QAAoB,ECTrCG,GAAQ,EAYRC,GAAiB,GAMvB,IAAIC,GAAgB,EAMhBC,GAAU,EAMVC,GAAW,GAGXC,GAAkB,CAAE,EAAEC,GAAe,EAAGC,GAAe,EAC3DC,GAAiB,EAAGC,GAAgB,EAAoBC,GAAqBC,GAS7E,MAAMC,EAAyB,IAAIC,IAAU,QAAQ,OAAO,GAAGA,CAAM,EAU/DC,GAAY,CAACC,EAAKC,EAAKC,EAAM,EAAEC,EAAM,OAAQC,EAAK,EAAGC,EAAM,EAAGC,EAAK,KACzE,CACIT,EAAO,OAAOM,GAAS,QAAQ,EAC/Bb,GAAgB,KAAK,CAAC,IAAAU,EAAK,KAAKE,EAAKD,CAAI,EAAG,MAAAE,EAAO,KAAK,IAAII,GAAMH,CAAI,EAAG,MAAAC,EAAO,KAAAC,CAAI,CAAC,CACzF,EASME,GAAc,CAACR,EAAKS,EAAO,EAAGN,EAAM,OAAQC,EAAK,EAAGE,EAAK,KAC/D,CACIT,EAAO,OAAOM,GAAS,QAAQ,EAC/Bb,GAAgB,KAAK,CAAC,IAAAU,EAAK,KAAKS,EAAQ,MAAAN,EAAO,KAAK,IAAII,GAAMH,CAAI,EAAG,MAAM,EAAG,KAAAE,CAAI,CAAC,CACvF,EAQMI,GAAa,CAACV,EAAKG,EAAOC,EAAMC,IAASN,GAAUC,EAAK,EAAGG,EAAOC,EAAMC,CAAK,EAS7EM,GAAY,CAACC,EAAMC,EAAMV,EAAOW,EAAU,GAAIV,IACpD,CACI,MAAMW,EAAYb,GAAMW,EAAK,EAAID,EAAK,GAAG,GAAIC,EAAK,EAAID,EAAK,GAAG,CAAC,EACzDX,EAAOC,EAAKY,EAAWC,EAAU,OAAM,EAAG,CAAC,EACjDhB,GAAUa,EAAK,IAAIG,CAAS,EAAGd,EAAME,EAAOC,EAAMW,EAAU,MAAO,EAAE,CAAC,CAC1E,EASMC,GAAY,CAACC,EAAIC,EAAIC,EAAIC,EAAIjB,IACnC,CACI,MAAMkB,EAASnB,EAAKoB,EAAIL,EAAG,EAAIC,EAAG,EAAE,EAAGC,EAAG,EAAIC,EAAG,EAAE,CAAC,EAAGE,EAAIL,EAAG,EAAIC,EAAG,EAAE,EAAGC,EAAG,EAAIC,EAAG,EAAE,CAAC,CAAC,EAClFG,EAASrB,EAAKsB,EAAIP,EAAG,EAAIC,EAAG,EAAE,EAAGC,EAAG,EAAIC,EAAG,EAAE,CAAC,EAAGI,EAAIP,EAAG,EAAIC,EAAG,EAAE,EAAGC,EAAG,EAAIC,EAAG,EAAE,CAAC,CAAC,EACxFrB,GAAUsB,EAAO,KAAKE,EAAO,EAAE,EAAGA,EAAO,SAASF,CAAM,EAAGlB,CAAK,CACpE,EAWMsB,GAAY,CAACC,EAAM1B,EAAKC,EAAK,EAAGE,EAAM,OAAQC,EAAK,EAAGC,EAAM,EAAGsB,EAAK,cAC1E,CACI9B,EAAO,OAAOM,GAAS,QAAQ,EAC/Bb,GAAgB,KAAK,CAAC,KAAAoC,EAAM,IAAA1B,EAAK,KAAAC,EAAM,MAAAE,EAAO,KAAK,IAAII,GAAMH,CAAI,EAAG,MAAAC,EAAO,KAAAsB,CAAI,CAAC,CACpF,EAUMC,GAAkB,CAACC,EAAQC,EAAWC,GAAa,SACzD,CACInC,GAAa,SAAW,iBACxBA,GAAa,KAAOiC,EAAO,UAAU,WAAW,EAAE,QAAQ,YAAY,oBAAoB,EAC1FjC,GAAa,MAAK,CACtB,EAKMoC,GAAY,IAClB,CAEI,SAAS,KAAK,YAAYpC,GAAe,SAAS,cAAc,GAAG,CAAC,EACpEA,GAAa,MAAM,QAAU,MACjC,EAEMqC,GAAc,IACpB,CAIQC,EAAc7C,EAAQ,IACtBE,GAAe,CAACA,IAChBA,KAEI2C,EAAc,EAAE,IAChB/C,GAAgB,CAACA,IACjB+C,EAAc,EAAE,IAChB1C,GAAe,CAACA,GAAcC,GAAiB,GAC/CyC,EAAc,EAAE,IAChBzC,GAAiB,CAACA,GAAgBD,GAAe,GACjD0C,EAAc,EAAE,IAChBxC,GAAgB,CAACA,IACjBwC,EAAc,EAAE,IAChB9C,GAAU,CAACA,IACX8C,EAAc,EAAE,IAChBvC,GAAsB,GAMlC,EAEMwC,GAAc,IACpB,CAcI,GAbAC,GAAgBC,CAAW,EAEvB1C,KAGAyC,GAAgBC,EAAa,CAAC,EAC9BA,EAAY,UAAUC,EAAe,EAAG,CAAC,EACzCA,EAAc,OAAS,EAEvBV,GAAgBW,CAAU,EAC1B5C,GAAsB,GAGtBD,IAAiB8C,IAAkB,UAAU,YACjD,CAEI,MAAMC,EAAW,UAAU,cAC3B,QAASC,EAAID,EAAS,OAAQC,KAC9B,CACI,MAAMC,EAAUF,EAASC,CAAC,EAC1B,GAAIC,EACJ,CAGI,MAAMC,EAAYC,EACZC,EAASC,GAAUL,CAAC,EAC1B,QAASM,EAAIF,EAAO,OAAQE,KAC5B,CACI,MAAMC,EAAUL,EAAU,IAAI1C,EAAK8C,EAAE,EAAW,EAAGN,EAAE,EAAW,CAAC,CAAC,EAC5DQ,EAAWD,EAAQ,IAAIH,EAAOE,CAAC,EAAE,MAAM,CAAU,CAAC,EACxDxC,GAAYyC,EAAS,EAAY,QAAQ,EAAE,CAAC,EAC5CtC,GAAUsC,EAASC,EAAU,MAAM,EACnCxC,GAAWwC,EAAU,MAAM,CAC9B,CACD,QAASF,EAAIL,EAAQ,QAAQ,OAAQK,KACrC,CACI,MAAMC,EAAUL,EAAU,IAAI1C,EAAK8C,EAAE,GAAY,EAAGN,EAAE,EAAW,EAAE,EAAW,EAAW,CAAC,EACpFS,EAAUR,EAAQ,QAAQK,CAAC,EAAE,QACnCxC,GAAYyC,EAAS,GAAaE,EAAU,OAAS,QAAS,EAAG,CAAC,EAClE1B,GAAUuB,EAAGC,EAAS,EAAE,CAC3B,CACJ,CACJ,CACJ,CAED,GAAI1D,GACJ,CACI,MAAM6D,EAAcf,EACpBA,EAAcgB,EAGd,IAAIC,EAAe,IAAUC,EAC7B,UAAWC,KAAKC,EAChB,CAGI,GAFID,EAAE,QAAUA,EAAE,WAEd,CAACA,EAAE,KAAK,GAAK,CAACA,EAAE,KAAK,EACrB,SAEJ,MAAME,EAAWC,EAAS,gBAAgBH,EAAE,GAAG,EAC3CE,EAAWJ,IAEXA,EAAeI,EACfH,EAAaC,GAIjB,MAAMvD,EAAOC,EAAKsB,EAAIgC,EAAE,KAAK,EAAG,EAAE,EAAGhC,EAAIgC,EAAE,KAAK,EAAG,EAAE,CAAC,EAChDI,EAAS,IAAIC,EAAM,CAAC,CAACL,EAAE,aAAc,CAAC,CAACA,EAAE,oBAAqB,CAAC,CAACA,EAAE,QAASA,EAAE,OAAO,GAAG,EAAE,EACzFM,EAASN,EAAE,OAAS,IAAIK,EAAM,EAAE,EAAE,EAAE,EAAE,EAAI,IAAIA,EAAM,EAAE,EAAE,EAAE,EAAE,EAClEE,GAASP,EAAE,IAAKvD,EAAM2D,EAAQJ,EAAE,MAAO,CAAC,EACxCO,GAASP,EAAE,IAAKvD,EAAK,MAAM,EAAE,EAAG6D,EAAQN,EAAE,MAAO,CAAC,EAClDA,EAAE,QAAUQ,GAASR,EAAE,IAAKA,EAAE,OAAO,IAAK,GAAI,IAAIK,EAAM,EAAE,EAAE,EAAE,EAAE,EAAG,CAAC,CACvE,CAED,GAAIN,EACJ,CACI,MAAMU,EAAgBC,GAAqBX,EAAW,IAAKI,CAAQ,EACnEM,GAAiBF,GAASE,EAAc,MAAO,EAAC,IAAI/D,EAAK,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAG,IAAI2D,EAAM,EAAE,EAAE,EAAE,EAAE,CAAC,EAC3FE,GAASJ,EAAS,QAAQ,IAAIzD,EAAK,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAG,IAAI2D,EAAM,EAAE,EAAE,EAAE,EAAE,EAAG,EAAG,CAAC,EAC3EG,GAASL,EAAUJ,EAAW,IAAK,GAAIU,EAAgB,IAAIJ,EAAM,EAAE,EAAE,EAAE,EAAE,EAAI,IAAIA,EAAM,EAAE,EAAE,EAAE,EAAE,EAAG,CAAC,EAEnG,MAAMpC,EAAY,eAAiBkC,EAC/B;AAAA,oBAAyBQ,GAAqBR,CAAQ,EACtD;AAAA;AAAA;AAAA,EACAJ,EAAW,SAAQ,EACvBa,GAAe3C,EAAW4C,GAAgB,GAAI,IAAIR,EAAO,IAAK,EAAG,EAAG,WAAW,CAClF,CAEDzB,GAAgBC,EAAce,CAAW,CAC5C,CAED,CAEIC,EAAe,UAAY,EAC3B,MAAMiB,EAAYpF,GAAiBqF,EACnCjF,GAAgB,QAAQkF,GACxB,CACInB,EAAe,KAAI,EAGnB,MAAMrD,EAAMyE,GAAcD,EAAE,GAAG,EAK/B,GAJAnB,EAAe,UAAUrD,EAAI,EAAE,EAAGA,EAAI,EAAE,CAAC,EACzCqD,EAAe,OAAOmB,EAAE,KAAK,EAC7BnB,EAAe,UAAYA,EAAe,YAAcmB,EAAE,MAEtDA,EAAE,MAAQ,KAEVnB,EAAe,KAAOmB,EAAE,KAAKD,EAAc,MAAOC,EAAE,KACpDnB,EAAe,UAAY,SAC3BA,EAAe,aAAe,SAC9BA,EAAe,SAASmB,EAAE,KAAM,EAAG,CAAC,UAE/BA,EAAE,MAAQ,GAAKA,EAAE,KAAK,IAAM,GAAKA,EAAE,KAAK,IAAM,EAGnDnB,EAAe,SAAS,CAACiB,EAAU,EAAG,GAAIA,EAAW,CAAC,EACtDjB,EAAe,SAAS,GAAI,CAACiB,EAAU,EAAG,EAAGA,CAAS,UAEjDE,EAAE,KAAK,GAAK,KACrB,CAEI,MAAME,EAAIF,EAAE,KAAK,EAAED,EAAY,EAAGI,EAAIH,EAAE,KAAK,EAAED,EAAY,EAC3DC,EAAE,MAAQnB,EAAe,SAAS,CAACqB,EAAE,EAAE,EAAG,CAACC,EAAE,EAAE,EAAGD,EAAGC,CAAC,EACtDtB,EAAe,WAAW,CAACqB,EAAE,EAAE,EAAG,CAACC,EAAE,EAAE,EAAGD,EAAGC,CAAC,CACjD,MAIGtB,EAAe,UAAS,EACxBA,EAAe,IAAI,EAAG,EAAGmB,EAAE,KAAKD,EAAa,EAAG,CAAC,EACjDC,EAAE,MAAQnB,EAAe,OACzBA,EAAe,OAAM,EAGzBA,EAAe,QAAO,CAClC,CAAS,EAGD/D,GAAkBA,GAAgB,OAAOsF,GAAGA,EAAE,KAAK,CAAC,CACvD,CAED,CAEIvB,EAAe,KAAI,EACnBA,EAAe,UAAY,OAC3BA,EAAe,UAAY,OAC3BA,EAAe,aAAe,MAC9BA,EAAe,KAAO,iBACtBA,EAAe,YAAc,OAC7BA,EAAe,WAAa,EAE5B,IAAIwB,EAAI,EAAGC,EAAI,IAAKH,EAAI,GACxB,GAAIpF,GACJ,CACI8D,EAAe,SAAStB,GAAY8C,EAAGC,GAAKH,CAAC,EAC7CtB,EAAe,SAAS,YAAcI,EAAc,OAAQoB,EAAGC,GAAKH,CAAC,EACrEtB,EAAe,SAAS,SAAW0B,GAAW3E,CAAI,EAAGyE,EAAGC,GAAKH,CAAC,EAC9DtB,EAAe,SAAS,YAAawB,EAAGC,GAAKH,CAAC,EAC9CtB,EAAe,UAAY,OAC3BA,EAAe,SAAS,qBAAsBwB,EAAGC,GAAKH,CAAC,EACvDtB,EAAe,UAAY7D,GAAe,OAAS,OACnD6D,EAAe,SAAS,mBAAoBwB,EAAGC,GAAKH,CAAC,EACrDtB,EAAe,UAAY5D,GAAiB,OAAS,OACrD4D,EAAe,SAAS,qBAAsBwB,EAAGC,GAAKH,CAAC,EACvDtB,EAAe,UAAY3D,GAAgB,OAAS,OACpD2D,EAAe,SAAS,oBAAqBwB,EAAGC,GAAKH,CAAC,EACtDtB,EAAe,UAAYjE,GAAU,OAAS,OAC9CiE,EAAe,SAAS,cAAewB,EAAGC,GAAKH,CAAC,EAChDtB,EAAe,UAAY,OAC3BA,EAAe,SAAS,qBAAsBwB,EAAGC,GAAKH,CAAC,EAEvD,IAAIK,EAAc,GAClB,UAAUtC,KAAKuC,EAAU,CAAC,EAElBvC,GAAKwC,GAAUxC,EAAG,CAAC,IACnBsC,GAAetC,EAAI,KAE3BsC,GAAe3B,EAAe,SAAS,cAAgB2B,EAAaH,EAAGC,GAAKH,CAAC,EAE7E,IAAIQ,EAAiB,GACrB,GAAIF,EAAU,CAAC,EACf,UAAUvC,KAAKuC,EAAU,CAAC,EAElBvC,GAAKwC,GAAUxC,EAAG,CAAC,IACnByC,GAAkBzC,EAAI,KAE9ByC,GAAkB9B,EAAe,SAAS,YAAc8B,EAAgBN,EAAGC,GAAKH,CAAC,CACpF,MAGGtB,EAAe,SAAS7D,GAAe,gBAAkB,GAAIqF,EAAGC,GAAKH,CAAC,EACtEtB,EAAe,SAAS5D,GAAiB,kBAAoB,GAAIoF,EAAGC,GAAKH,CAAC,EAC1EtB,EAAe,SAASjE,GAAU,WAAa,GAAIyF,EAAGC,GAAKH,CAAC,EAC5DtB,EAAe,SAAS3D,GAAgB,iBAAmB,GAAImF,EAAGC,GAAKH,CAAC,EAG5EtB,EAAe,QAAO,CACzB,CACL,EAgBM+B,GAAK,KAAK,GAMVC,EAAOC,GAAKA,EAAI,EAAI,CAACA,EAAIA,EAOzBhE,EAAM,CAACgE,EAAGC,IAAKD,EAAIC,EAAKD,EAAIC,EAO5B/D,EAAM,CAAC8D,EAAGC,IAAKD,EAAIC,EAAKD,EAAIC,EAM5BC,GAAQF,GAAKA,EAAI,EAAI,GAAK,EAe1BG,EAAQ,CAACC,EAAGpE,EAAI,EAAGE,EAAI,IAAKkE,EAAIpE,EAAMA,EAAMoE,EAAIlE,EAAMA,EAAMkE,EAQ5DC,GAAU,CAACD,EAAGpE,EAAI,EAAGE,EAAI,IAAKA,EAAIF,EAAMmE,GAAOC,EAAEpE,IAAQE,EAAIF,EAAI,EAAI,EAQrEsE,GAAO,CAACpB,EAAGlD,EAAI,EAAGE,EAAI,IAAKF,EAAMmE,EAAMjB,CAAC,GAAKhD,EAAIF,GAqBjDuE,GAAgB,CAAC5E,EAAIC,EAAIC,EAAIC,IAAMiE,EAAIpE,EAAG,EAAIE,EAAG,CAAC,EAAE,EAAID,EAAG,EAAIE,EAAG,GAAKiE,EAAIpE,EAAG,EAAIE,EAAG,CAAC,EAAE,EAAID,EAAG,EAAIE,EAAG,EActG2D,GAAce,IAAMA,EAAE,GAAG,GAAK,KAAOA,EAAE,GAAG,GAAG,IAAI,KAAOA,EAAE,GAAG,GAY7DC,EAAO,CAACT,EAAE,EAAGC,EAAE,IAAKA,GAAKD,EAAEC,GAAG,KAAK,OAAM,EAOzCS,GAAU,CAACV,EAAE,EAAGC,EAAE,IAAKQ,EAAKT,EAAEC,CAAC,EAAE,EAKjCU,GAAW,IAAKD,GAAQ,CAAC,EAAI,EAAI,EAOjCE,GAAe,CAACzF,EAAO,EAAG0F,EAAU,IAAK1F,EAAS,EAAI2F,GAAW3F,EAASsF,EAAKI,EAAY1F,EAAQ,CAAC,GAAG,EAAE,EAAI,IAAI4F,EAMjHD,GAAa,CAACE,EAAO,IAAK,IAAID,EAAS,EAAC,SAASN,EAAK,EAAEX,EAAE,EAAGkB,CAAM,EAQnEC,GAAY,CAACC,EAAK,IAAI3C,EAAO4C,EAAK,IAAI5C,EAAM,EAAE,EAAE,EAAE,CAAC,EAAG6C,IACxDA,EAASF,EAAG,KAAKC,EAAIV,EAAM,CAAA,EAAI,IAAIlC,EAAMkC,EAAKS,EAAG,EAAEC,EAAG,CAAC,EAAEV,EAAKS,EAAG,EAAEC,EAAG,CAAC,EAAEV,EAAKS,EAAG,EAAEC,EAAG,CAAC,EAAEV,EAAKS,EAAG,EAAEC,EAAG,CAAC,CAAC,EAsCtGvG,EAAO,CAAC2E,EAAE,EAAGC,IAAKD,EAAE,GAAK,KAAY,IAAIwB,EAAQxB,EAAGC,GAAgBD,CAAK,EAAI,IAAIwB,EAAQxB,EAAE,EAAGA,EAAE,CAAC,EAQjG8B,EAAajB,GAAK,CAAC,MAAMA,EAAE,CAAC,GAAK,CAAC,MAAMA,EAAE,CAAC,EAWjD,MAAMW,CACN,CAII,YAAYxB,EAAE,EAAGC,EAAE,EACnB,CAEI,KAAK,EAAID,EAET,KAAK,EAAIC,CACZ,CAID,MAAO,CAAE,OAAO,IAAIuB,EAAQ,KAAK,EAAG,KAAK,CAAC,CAAI,CAK9C,IAAIX,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,IAAIW,EAAQ,KAAK,EAAIX,EAAE,EAAG,KAAK,EAAIA,EAAE,CAAC,CAAI,CAKhF,SAASA,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,IAAIW,EAAQ,KAAK,EAAIX,EAAE,EAAG,KAAK,EAAIA,EAAE,CAAC,CAAI,CAKrF,SAASA,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,IAAIW,EAAQ,KAAK,EAAIX,EAAE,EAAG,KAAK,EAAIA,EAAE,CAAC,CAAI,CAKrF,OAAOA,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,IAAIW,EAAQ,KAAK,EAAIX,EAAE,EAAG,KAAK,EAAIA,EAAE,CAAC,CAAI,CAKnF,MAAMkB,EAAG,CAAE,OAAA/G,EAAO,CAAC8G,EAAUC,CAAC,CAAC,EAAU,IAAIP,EAAQ,KAAK,EAAIO,EAAG,KAAK,EAAIA,CAAC,CAAI,CAI/E,QAAS,CAAE,OAAO,KAAK,cAAe,GAAE,EAAK,CAI7C,eAAgB,CAAE,OAAO,KAAK,GAAG,EAAI,KAAK,GAAG,CAAI,CAKjD,SAASlB,EAAG,CAAE,OAAO,KAAK,gBAAgBA,CAAC,GAAG,EAAK,CAKnD,gBAAgBA,EAAG,CAAE,OAAQ,KAAK,EAAIA,EAAE,IAAI,GAAK,KAAK,EAAIA,EAAE,IAAI,CAAI,CAKpE,UAAUY,EAAO,EAAG,CAAE,MAAMO,EAAI,KAAK,OAAQ,EAAE,OAAOA,EAAI,KAAK,MAAMP,EAAOO,CAAC,EAAI,IAAIR,EAAQ,EAAGC,CAAM,CAAI,CAK1G,YAAYA,EAAO,EAAG,CAAE,MAAMO,EAAI,KAAK,SAAU,OAAOA,EAAIP,EAAS,KAAK,MAAMA,EAAOO,CAAC,EAAI,IAAO,CAKnG,IAAInB,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,KAAK,EAAEA,EAAE,EAAI,KAAK,EAAEA,EAAE,CAAI,CAKhE,MAAMA,EAAG,CAAE,OAAA7F,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,KAAK,EAAEA,EAAE,EAAI,KAAK,EAAEA,EAAE,CAAI,CAIlE,OAAQ,CAAE,OAAO,KAAK,MAAM,KAAK,EAAG,KAAK,CAAC,CAAI,CAM9C,SAASJ,EAAE,EAAGgB,EAAO,EAAG,CAAE,YAAK,EAAIA,EAAO,KAAK,IAAIhB,CAAC,EAAG,KAAK,EAAIgB,EAAO,KAAK,IAAIhB,CAAC,EAAU,IAAO,CAKlG,OAAOA,EAAG,CAAE,MAAMwB,EAAI,KAAK,IAAIxB,CAAC,EAAGsB,EAAI,KAAK,IAAItB,CAAC,EAAG,OAAO,IAAIe,EAAQ,KAAK,EAAES,EAAE,KAAK,EAAEF,EAAG,KAAK,EAAEA,EAAE,KAAK,EAAEE,CAAC,CAAI,CAI/G,WAAY,CAAE,OAAOzB,EAAI,KAAK,CAAC,EAAIA,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,EAAI,EAAI,EAAI,KAAK,EAAI,EAAI,EAAI,CAAI,CAI3F,QAAS,CAAE,OAAO,IAAIgB,EAAQ,KAAK,EAAG,CAAC,KAAK,CAAC,CAAI,CAIjD,OAAQ,CAAE,OAAO,IAAIA,EAAQ,KAAK,MAAM,KAAK,CAAC,EAAG,KAAK,MAAM,KAAK,CAAC,CAAC,CAAI,CAIvE,MAAO,CAAE,OAAOhB,EAAI,KAAK,EAAI,KAAK,CAAC,CAAI,CAMvC,KAAKK,EAAGlB,EAAG,CAAE,OAAA3E,EAAO8G,EAAUjB,CAAC,CAAC,EAAU,KAAK,IAAIA,EAAE,SAAS,IAAI,EAAE,MAAMD,EAAMjB,CAAC,CAAC,CAAC,CAAI,CAKvF,WAAWuC,EAAW,CAAE,OAAO,KAAK,GAAK,GAAK,KAAK,GAAK,GAAK,KAAK,EAAIA,EAAU,GAAK,KAAK,EAAIA,EAAU,CAAI,CAK5G,SAASC,EAAO,EAChB,CAAe,MAAO,KAAK,KAAK,EAAE,EAAE,GAAG,KAAO,KAAK,EAAE,QAAQA,CAAM,CAAC,KAAK,KAAK,EAAE,EAAE,GAAG,KAAO,KAAK,EAAE,QAAQA,CAAM,CAAC,IAAO,CAC7H,CAmCA,MAAMnD,CACN,CAMI,YAAYe,EAAE,EAAGqC,EAAE,EAAG1B,EAAE,EAAGD,EAAE,EAC7B,CAEI,KAAK,EAAIV,EAET,KAAK,EAAIqC,EAET,KAAK,EAAI1B,EAET,KAAK,EAAID,CACZ,CAID,MAAO,CAAE,OAAO,IAAIzB,EAAM,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAI,CAK5D,IAAIiD,EAAG,CAAE,OAAO,IAAIjD,EAAM,KAAK,EAAEiD,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,CAAC,CAAI,CAK5E,SAASA,EAAG,CAAE,OAAO,IAAIjD,EAAM,KAAK,EAAEiD,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,CAAC,CAAI,CAKjF,SAASA,EAAG,CAAE,OAAO,IAAIjD,EAAM,KAAK,EAAEiD,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,CAAC,CAAI,CAKjF,OAAOA,EAAG,CAAE,OAAO,IAAIjD,EAAM,KAAK,EAAEiD,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,EAAG,KAAK,EAAEA,EAAE,CAAC,CAAI,CAM/E,MAAMF,EAAGtB,EAAEsB,EAAG,CAAE,OAAO,IAAI/C,EAAM,KAAK,EAAE+C,EAAG,KAAK,EAAEA,EAAG,KAAK,EAAEA,EAAG,KAAK,EAAEtB,CAAC,CAAI,CAI3E,OAAQ,CAAE,OAAO,IAAIzB,EAAM4B,EAAM,KAAK,CAAC,EAAGA,EAAM,KAAK,CAAC,EAAGA,EAAM,KAAK,CAAC,EAAGA,EAAM,KAAK,CAAC,CAAC,CAAI,CAMzF,KAAKqB,EAAGtC,EAAG,CAAE,OAAO,KAAK,IAAIsC,EAAE,SAAS,IAAI,EAAE,MAAMrB,EAAMjB,CAAC,CAAC,CAAC,CAAI,CAQjE,QAAQG,EAAE,EAAG,EAAE,EAAGkC,EAAE,EAAGvB,EAAE,EACzB,CACI,MAAM4B,EAAIL,EAAI,GAAKA,GAAG,EAAE,GAAKA,EAAE,EAAEA,EAAE,EAAGrC,EAAI,EAAEqC,EAAEK,EAC1CC,EAAI,CAAC3C,EAAG0C,EAAGpB,KACNA,GAAMA,EAAE,EAAG,GAAG,GAAK,EAAE,EAAItB,GAAG0C,EAAE1C,GAAG,EAAEsB,EACpCA,EAAI,EAAE,EAAIoB,EACVpB,EAAI,EAAE,EAAItB,GAAG0C,EAAE1C,IAAI,EAAE,EAAEsB,GAAG,EAAItB,EAEtC,YAAK,EAAI2C,EAAE3C,EAAG0C,EAAGvC,EAAI,EAAE,CAAC,EACxB,KAAK,EAAIwC,EAAE3C,EAAG0C,EAAGvC,CAAC,EAClB,KAAK,EAAIwC,EAAE3C,EAAG0C,EAAGvC,EAAI,EAAE,CAAC,EACxB,KAAK,EAAIW,EACF,IACV,CAID,SACA,CACI,MAAMV,EAAIa,EAAM,KAAK,CAAC,EAChBwB,EAAIxB,EAAM,KAAK,CAAC,EAChBF,EAAIE,EAAM,KAAK,CAAC,EAChBH,EAAIG,EAAM,KAAK,CAAC,EAChBjE,EAAM,KAAK,IAAIoD,EAAGqC,EAAG1B,CAAC,EACtBjE,EAAM,KAAK,IAAIsD,EAAGqC,EAAG1B,CAAC,EACtB,GAAK/D,EAAMF,GAAO,EAExB,IAAIqD,EAAI,EAAGiC,EAAI,EACf,GAAIpF,GAAOF,EACX,CACI,IAAI,EAAIE,EAAMF,EACdsF,EAAI,EAAI,GAAK,GAAK,EAAIpF,EAAMF,GAAO,GAAKE,EAAMF,GAC1CsD,GAAKpD,EACLmD,GAAKsC,EAAI1B,GAAK,GAAK0B,EAAI1B,EAAI,EAAI,GAC1B0B,GAAKzF,EACVmD,GAAKY,EAAIX,GAAK,EAAI,EACbW,GAAK/D,IACVmD,GAAMC,EAAIqC,GAAK,EAAI,EAC1B,CAED,MAAO,CAACtC,EAAI,EAAGiC,EAAG,EAAGtB,CAAC,CACzB,CAMD,OAAO8B,EAAO,IAAKC,EAAY,EAC/B,CACI,OAAO,IAAIxD,EAEP,KAAK,EAAIkC,EAAKqB,EAAQ,CAACA,CAAM,EAC7B,KAAK,EAAIrB,EAAKqB,EAAQ,CAACA,CAAM,EAC7B,KAAK,EAAIrB,EAAKqB,EAAQ,CAACA,CAAM,EAC7B,KAAK,EAAIrB,EAAKsB,EAAa,CAACA,CAAW,CAC1C,EAAC,MAAK,CACV,CAKD,SAASC,EAAW,EACpB,CACI,MAAMC,EAAST,KAAOA,EAAEA,EAAE,IAAI,GAAG,GAAK,IAAM,IAAMA,EAAE,SAAS,EAAE,EAC/D,MAAO,IAAMS,EAAM,KAAK,CAAC,EAAIA,EAAM,KAAK,CAAC,EAAIA,EAAM,KAAK,CAAC,GAAKD,EAAWC,EAAM,KAAK,CAAC,EAAI,GAC5F,CAKD,OAAOC,EACP,CACI,MAAMC,EAAWX,GAAKrB,EAAM,SAAS+B,EAAI,MAAMV,EAAEA,EAAE,CAAC,EAAE,EAAE,EAAE,GAAG,EAC7D,YAAK,EAAIW,EAAQ,CAAC,EAClB,KAAK,EAAIA,EAAQ,CAAC,EAClB,KAAK,EAAIA,EAAQ,CAAC,EAClB,KAAK,EAAID,EAAI,OAAS,EAAIC,EAAQ,CAAC,EAAI,EAChC,IACV,CAID,SACA,CACI,MAAMC,EAAUZ,GAAKrB,EAAMqB,CAAC,EAAE,IAAI,EAC5BlC,EAAI8C,EAAO,KAAK,CAAC,EACjBT,EAAIS,EAAO,KAAK,CAAC,GAAG,EACpBnC,EAAImC,EAAO,KAAK,CAAC,GAAG,GACpBpC,EAAIoC,EAAO,KAAK,CAAC,GAAG,GAC1B,OAAO9C,EAAIqC,EAAI1B,EAAID,CACtB,CACL,CAaA,MAAM/E,EACN,CAGI,YAAYoH,EAAU,CAAE,KAAK,KAAOA,GAAY,KAAY,OAAYvH,EAAOuH,EAAU,KAAK,QAAUA,CAAW,CAInH,IAAIA,EAAS,EAAG,CAAE,KAAK,KAAOvH,EAAOuH,EAAU,KAAK,QAAUA,CAAW,CAGzE,OAAQ,CAAE,KAAK,KAAO,MAAY,CAIlC,OAAQ,CAAE,OAAO,KAAK,MAAQ,IAAY,CAI1C,QAAS,CAAE,OAAOvH,GAAQ,KAAK,IAAO,CAItC,SAAU,CAAE,OAAOA,EAAO,KAAK,IAAO,CAItC,KAAM,CAAE,OAAO,KAAK,MAAK,EAAIA,EAAO,KAAK,KAAO,CAAI,CAIpD,YAAa,CAAE,OAAO,KAAK,MAAO,EAAEuF,GAAQ,KAAK,KAAOvF,EAAM,KAAK,QAAS,CAAC,EAAI,CAAI,CAIrF,UAAW,CAAe,OAAO,KAAK,MAAO,EAAG,QAAU,KAAK,IAAI,KAAK,IAAG,CAAE,EAAI,aAAe,KAAK,IAAG,EAAG,EAAI,SAAW,QAAY,CAItI,SAAwB,CAAE,OAAO,KAAK,IAAK,CAAG,CAClD,CAeA,IAAIyC,EAAY3C,EAAI,EAMhBqE,EAAc,GASdqD,GAAgB1H,EAAK,KAAM,IAAI,EAO/B2H,GAAkB3H,EAAI,EAMtB4H,GAAiB,EAMjBC,GAAc,QASdC,GAAW,EAeXC,GAAkB/H,EAAK,EAAE,EAMzBgI,GAAoB,GAepBC,GAAoB,EAMpBC,GAAuB,EAMvBC,GAA4B,EAM5BC,GAA0B,EAM1BC,GAAwB,GAMxBC,GAAiB,EAMjBC,GAAU,EAMVC,GAAwB,EASxBlG,GAAiB,EA2DjBmG,GAAc,GAMdC,GAAoB,GAMpBC,GAAoB,GASpBC,GAAmB,EAMnBC,GAAwB,GAML7I,EAAK,IAAK,EAAE,EA4CnC,MAAM8I,EACN,CAUI,YAAYhJ,EAAIE,EAAI,EAAID,EAAKC,EAAK,CAAC,EAAG+I,EAAU,GAAIC,EAASjB,GAAiB5H,EAAM,EAAGF,EAAOgJ,EAAY,EAC1G,CAEItJ,EAAO8G,EAAU3G,CAAG,GAAK2G,EAAU1G,CAAI,CAAC,EAGxC,KAAK,IAAMD,EAAI,OAEf,KAAK,KAAOC,EAEZ,KAAK,SAEL,KAAK,UAAYgJ,EAEjB,KAAK,SAAWC,EAEhB,KAAK,MAAQ7I,EAEb,KAAK,MAAQF,EAEb,KAAK,cAIL,KAAK,KAAegI,GAEpB,KAAK,QAAeC,GAEpB,KAAK,aAAeC,GAEpB,KAAK,WAAeC,GAEpB,KAAK,SAAeC,GAEpB,KAAK,aAAe,EAEpB,KAAK,YAAcY,EAEnB,KAAK,SAAW,IAAI9C,EAEpB,KAAK,cAAgB,EAGrB,KAAK,UAAYjG,EACjB,KAAK,SAAW,GAChB,KAAK,aAAe,EAGpBqD,EAAc,KAAK,IAAI,CAC1B,CAGD,QACA,CACI,MAAM2F,EAAS,KAAK,OACpB,GAAIA,EACJ,CAEI,KAAK,IAAM,KAAK,SAAS,SAASlJ,EAAKkJ,EAAO,cAAe,EAAC,CAAC,CAAC,EAAE,OAAO,CAACA,EAAO,KAAK,EAAE,IAAIA,EAAO,GAAG,EACtG,KAAK,MAAQA,EAAO,cAAa,EAAG,KAAK,WAAaA,EAAO,MAC7D,MACH,CAGD,KAAK,SAAS,EAAI3D,EAAM,KAAK,SAAS,EAAG,CAAC+C,GAAgBA,EAAc,EACxE,KAAK,SAAS,EAAI/C,EAAM,KAAK,SAAS,EAAG,CAAC+C,GAAgBA,EAAc,EAGxE,MAAMa,EAAS,KAAK,IAAI,KAAI,EAU5B,GATA,KAAK,SAAS,GAAKZ,GAAU,KAAK,aAClC,KAAK,IAAI,GAAK,KAAK,SAAS,GAAK,KAAK,QACtC,KAAK,IAAI,GAAK,KAAK,SAAS,GAAK,KAAK,QACtC,KAAK,OAAS,KAAK,eAAiB,KAAK,aAGzC5I,EAAO,KAAK,cAAgB,GAAK,KAAK,cAAgB,CAAC,EACvDA,EAAO,KAAK,SAAW,GAAK,KAAK,SAAW,CAAC,EAEjB,CAAC,KAAK,KAC9B,OAEJ,MAAMyJ,EAAgB,KAAK,SAAS,EAAI,EACxC,GAAI,KAAK,aACT,CAEI,MAAMC,EAAc,KAAK,aAAa,SAAW,KAAK,aAAa,SAAS,EAAI,EAChF,KAAK,SAAS,EAAIA,GAAe,KAAK,SAAS,EAAIA,GAAe,KAAK,SACvE,KAAK,aAAe,CAEvB,CAED,GAAI,KAAK,oBAIL,UAAW/F,KAAKgG,GAChB,CAUI,GARI,CAAC,KAAK,QAAU,CAAChG,EAAE,SAAWA,EAAE,WAAaA,EAAE,QAAUA,GAAK,MAI9D,CAACqC,GAAc,KAAK,IAAK,KAAK,KAAMrC,EAAE,IAAKA,EAAE,IAAI,GAIjD,CAAC,KAAK,kBAAkBA,CAAC,EAAI,CAACA,EAAE,kBAAkB,IAAI,EACtD,SAEJ,GAAIqC,GAAcwD,EAAQ,KAAK,KAAM7F,EAAE,IAAKA,EAAE,IAAI,EAClD,CAEI,MAAMiG,EAAWJ,EAAO,SAAS7F,EAAE,GAAG,EAChC8C,EAASmD,EAAS,SAClBC,EAAgB,KAChBC,EAAWrD,EAAS,IAAMF,GAAWsD,CAAa,EAAID,EAAS,MAAMC,EAAcpD,CAAM,EAC/F,KAAK,SAAW,KAAK,SAAS,IAAIqD,CAAQ,EACtCnG,EAAE,OACFA,EAAE,SAAWA,EAAE,SAAS,SAASmG,CAAQ,GAE7CpK,IAAgBC,IAAgBwB,GAAU,KAAK,IAAK,KAAK,KAAMwC,EAAE,IAAKA,EAAE,KAAM,MAAM,EACpF,QACH,CAGD,MAAMoG,EAAW,KAAK,KAAK,IAAIpG,EAAE,IAAI,EAC/BqG,GAAeR,EAAO,EAAI7F,EAAE,IAAI,GAAG,EAAIoG,EAAS,EAAInB,GACpDqB,EAAazE,EAAIgE,EAAO,EAAI7F,EAAE,IAAI,CAAC,EAAE,EAAIoG,EAAS,EAClDG,EAAa1E,EAAIgE,EAAO,EAAI7F,EAAE,IAAI,CAAC,EAAE,EAAIoG,EAAS,EAClDI,EAAaxI,EAAI,KAAK,WAAYgC,EAAE,UAAU,EAEpD,GAAIqG,EAAcE,EAAa,CAACD,GAI5B,GADA,KAAK,IAAI,EAAItG,EAAE,IAAI,GAAKoG,EAAS,EAAE,EAAI,MAAWpE,GAAK6D,EAAO,EAAI7F,EAAE,IAAI,CAAC,EACrEA,EAAE,cAAgB8F,GAAiB,CAAC9F,EAAE,KAGlC8F,IACA,KAAK,aAAe9F,GAGxB,KAAK,SAAS,GAAK,CAACwG,UAEfxG,EAAE,KACX,CAEI,MAAMyG,GAAa,KAAK,KAAO,KAAK,SAAS,EAAIzG,EAAE,KAAOA,EAAE,SAAS,IAAM,KAAK,KAAOA,EAAE,MAGnF0G,EAAW,KAAK,SAAS,GAAK,KAAK,KAAO1G,EAAE,OAAS,KAAK,KAAOA,EAAE,MACnEA,EAAE,SAAS,EAAI,EAAIA,EAAE,MAAQ,KAAK,KAAOA,EAAE,MAC3C2G,EAAW3G,EAAE,SAAS,GAAKA,EAAE,KAAO,KAAK,OAAS,KAAK,KAAOA,EAAE,MAChE,KAAK,SAAS,EAAI,EAAI,KAAK,MAAQ,KAAK,KAAOA,EAAE,MAGvD,KAAK,SAAS,EAAIoC,GAAKoE,EAAYC,EAAWC,CAAQ,EACtD1G,EAAE,SAAS,EAAIoC,GAAKoE,EAAYC,EAAWE,CAAQ,CACtD,EAEL,GAAI,CAACN,EAAcC,EAIf,GADA,KAAK,IAAI,EAAItG,EAAE,IAAI,GAAKoG,EAAS,EAAE,EAAI,MAAWpE,GAAK6D,EAAO,EAAI7F,EAAE,IAAI,CAAC,EACrEA,EAAE,KACN,CAEI,MAAMyG,GAAa,KAAK,KAAO,KAAK,SAAS,EAAIzG,EAAE,KAAOA,EAAE,SAAS,IAAM,KAAK,KAAOA,EAAE,MAGnF0G,EAAW,KAAK,SAAS,GAAK,KAAK,KAAO1G,EAAE,OAAS,KAAK,KAAOA,EAAE,MACnEA,EAAE,SAAS,EAAI,EAAIA,EAAE,MAAQ,KAAK,KAAOA,EAAE,MAC3C2G,EAAW3G,EAAE,SAAS,GAAKA,EAAE,KAAO,KAAK,OAAS,KAAK,KAAOA,EAAE,MAChE,KAAK,SAAS,EAAI,EAAI,KAAK,MAAQ,KAAK,KAAOA,EAAE,MAGvD,KAAK,SAAS,EAAIoC,GAAKoE,EAAYC,EAAWC,CAAQ,EACtD1G,EAAE,SAAS,EAAIoC,GAAKoE,EAAYC,EAAWE,CAAQ,CACtD,MAEG,KAAK,SAAS,GAAK,CAACH,EAE5BzK,IAAgBC,IAAgBwB,GAAU,KAAK,IAAK,KAAK,KAAMwC,EAAE,IAAKA,EAAE,KAAM,MAAM,CACvF,CAEL,GAAI,KAAK,cAGD4G,GAAkB,KAAK,IAAK,KAAK,KAAM,IAAI,GAIvC,CAACA,GAAkBf,EAAQ,KAAK,KAAM,IAAI,EAC9C,CAEI,MAAMU,EAAaK,GAAkB,IAAI/D,EAAQgD,EAAO,EAAG,KAAK,IAAI,CAAC,EAAG,KAAK,KAAM,IAAI,EACjFS,EAAaM,GAAkB,IAAI/D,EAAQ,KAAK,IAAI,EAAGgD,EAAO,CAAC,EAAG,KAAK,KAAM,IAAI,EACvF,GAAIU,EAAa,CAACD,EAClB,CAEI,KAAK,aAAeR,EAGpB,KAAK,SAAS,GAAK,CAAC,KAAK,WAGzB,MAAM9F,GAAK6F,EAAO,EAAI,KAAK,KAAK,EAAE,EAAE,IAAMA,EAAO,EAAI,KAAK,KAAK,EAAE,GAC7D7F,EAAI,GAAKA,EAAI,KAAK,QAAU,KAAK,SAAS,EAAIiF,GAAU,KAAK,eAC7D,KAAK,SAAS,EAAI,KAAK,SAAWjF,EAAIiF,GAAU,KAAK,cAAgB,KAAK,QAAU,GAGxF,KAAK,IAAI,EAAIY,EAAO,CACvB,CACGS,IAGA,KAAK,IAAI,EAAIT,EAAO,EACpB,KAAK,SAAS,GAAK,CAAC,KAAK,WAEhC,CAGZ,CAGD,QACA,CAEIgB,GAAS,KAAK,IAAK,KAAK,UAAY,KAAK,KAAM,KAAK,UAAW,KAAK,SAAU,KAAK,MAAO,KAAK,MAAO,KAAK,OAAQ,KAAK,aAAa,CACxI,CAGD,SACA,CACI,GAAI,MAAK,UAIT,MAAK,UAAY,EACjB,KAAK,QAAU,KAAK,OAAO,YAAY,IAAI,EAC3C,UAAWC,KAAS,KAAK,SACrBA,EAAM,QAAQA,EAAM,OAAS,CAAC,EACrC,CAMD,gBAAgBC,EAAUvK,EAAY,CAAE,OAAOuK,EAAW,CAAI,CAM9D,uBAAuBA,EAAUvK,EAAK,CAAE,OAAOuK,EAAW,CAAI,CAM9D,kBAAkB/G,EAAgB,CAAE,MAAO,EAAI,CAI/C,cAAkC,CAAE,OAAOpD,EAAO,KAAK,SAAY,CAInE,kBAAkBkF,EAAgB,CAAM,KAAK,OAAM,KAAK,SAAW,KAAK,SAAS,IAAIA,CAAC,EAAI,CAI1F,WAAWkF,EAAqB,CAAE,KAAK,kBAAkBA,EAAM,MAAM,EAAE,KAAK,IAAI,CAAC,CAAI,CAIrF,eAAgB,CAAE,OAAO,KAAK,OAAS,GAAK,CAAI,CAMhD,SAASF,EAAOG,EAASvK,EAAM,EAAEwK,EAAW,EAC5C,CACI7K,EAAO,CAACyK,EAAM,QAAU,CAAC,KAAK,SAAS,SAASA,CAAK,CAAC,EACtD,KAAK,SAAS,KAAKA,CAAK,EACxBA,EAAM,OAAS,KACfA,EAAM,SAAWG,EAAS,OAC1BH,EAAM,WAAaI,CACtB,CAID,YAAYJ,EACZ,CACIzK,EAAOyK,EAAM,QAAU,MAAQ,KAAK,SAAS,SAASA,CAAK,CAAC,EAC5D,KAAK,SAAS,OAAO,KAAK,SAAS,QAAQA,CAAK,EAAG,CAAC,EACpDA,EAAM,OAAS,CAClB,CAMD,aAAaK,EAAoB,EAAGC,EAAQ,EAAGC,EAAa,EAC5D,CACIhL,EAAO8K,GAAuB,CAACC,CAAO,EAEtC,KAAK,oBAAsBD,EAC3B,KAAK,QAAUC,EACf,KAAK,aAAeC,CACvB,CAID,UACA,CAEI,CACI,IAAInJ,EAAO,UAAY,KAAK,YAAY,KACxC,OAAI,KAAK,IAAI,GAAK,KAAK,IAAI,KACvBA,GAAQ;AAAA,QAAa,KAAK,MAC1B,KAAK,SAAS,GAAK,KAAK,SAAS,KACjCA,GAAQ;AAAA,aAAkB,KAAK,WAC/B,KAAK,KAAK,GAAK,KAAK,KAAK,KACzBA,GAAQ;AAAA,SAAc,KAAK,MAC3B,KAAK,QACLA,GAAQ;AAAA,UAAe,KAAK,MAAM,QAAQ,CAAC,GAC3C,KAAK,QACLA,GAAQ;AAAA,UAAe,KAAK,OACzBA,CACV,CACJ,CACL,CA4BA,IAAIa,EAKAF,EAKAC,EAKAe,EAKAyH,GAAiB5K,EAAI,EAKzB,MAAM6K,EAAY,IAAI,MAGtB,IAAIC,GAAeC,GAAmBC,GAOtC,MAAMC,GAAiBC,IAEnBvL,EAAOiL,GAAe,GAAKA,GAAe,EAAG,2BAA2B,EACjEM,EAAU,IAAIlL,EAAK,EAAE,CAAC,EAAE,SAAS4K,GAAe,MAAM,EAAE,CAAC,EAAE,SAAS5K,EAAK,EAAEqE,EAAY,GAAGA,CAAW,CAAC,EAAE,IAAI1B,CAAS,GAQ1H4B,GAAiB4G,IAEnBxL,EAAOiL,GAAe,GAAKA,GAAe,EAAG,2BAA2B,EACjEO,EAAS,SAASxI,CAAS,EAAE,SAAS3C,EAAKqE,EAAY,CAACA,CAAW,CAAC,EAAE,IAAIuG,GAAe,MAAM,EAAE,CAAC,EAAE,SAAS5K,EAAK,EAAE,CAAC,GAchI,SAASmK,GAASrK,EAAKC,EAAKC,EAAK,CAAC,EAAG+I,EAAU,GAAIC,EAASjB,GAAiB9H,EAAM,IAAI0D,EAAOxD,EAAM,EAAGiL,EACnGC,EAAc,IAAI1H,EAAM,EAAE,EAAE,EAAE,CAAC,EAAG2H,EAASxD,GAC/C,CAEI,GADA7I,IAAiB,EAAE+L,GACHM,EAEZ,GAAIvC,EAAY,GAAK,CAAC8B,EAAU,MAG5BU,GAAOzL,EAAI,EAAGA,EAAI,EAAGC,EAAK,EAAGA,EAAK,EAAGI,EAAO,EAAG,EAAG,EAAG,EAAG,EAAGF,EAAM,QAAO,CAAE,MAG9E,CAEI,MAAMuL,EAAOV,GAAc,EAAI9B,EAAS,EAAG,EACrCyC,EAAUzC,EAAS,EAAI8B,GAAc,EACrCY,EAAU1C,EAAS,EAAI8B,GAAc,EACrCa,EAAO5C,EAAUyC,EAAMC,EAASG,GAAO7C,EAAUyC,EAAK,GAAGE,EAE/DH,GAAOzL,EAAI,EAAGA,EAAI,EAAGsL,EAAS,CAACrL,EAAK,EAAIA,EAAK,EAAGA,EAAK,EAAGI,EACpDwL,EAAMZ,GAAkB,EAAGa,EAAMb,GAAkB,EACnDY,EAAMZ,GAAkB,EAAIU,EAASG,EAAMb,GAAkB,EAAIW,EACjEzL,EAAM,QAAS,EAAEoL,EAAc,QAAS,CAAA,CAC/C,MAKDQ,GAAa/L,EAAKC,EAAMI,EAAOiL,EAASU,GACxC,CACI,GAAI/C,EAAY,EAGZ+C,EAAQ,UAAY7L,EACpB6L,EAAQ,SAAS,IAAK,IAAK,EAAG,CAAC,MAGnC,CAEI,MAAMN,EAAOV,GAAc,EAAI9B,EAAS,EAAG,EACrC+C,EAAMhD,EAAUyC,EAAMxC,EAAS,EAAMhB,GACrCgE,GAAMjD,EAAUyC,EAAK,GAAGxC,EAAS,EAAIhB,GACrCiE,EAAUjD,EAAS,EAAI,EAAEhB,GACzBkE,EAAUlD,EAAS,EAAI,EAAEhB,GAC/B8D,EAAQ,YAAc7L,EAAM,EAC5B6L,EAAQ,UAAUjB,EAAWkB,EAAIC,EAAIC,EAAQC,EAAS,IAAK,IAAK,EAAG,CAAC,CACvE,CACb,CAAS,CAET,CASA,SAASrI,GAAS/D,EAAKC,EAAME,EAAOE,EAAOmL,EAC3C,CACInB,GAASrK,EAAKC,EAAM,GAAIgI,GAAiB9H,EAAOE,EAAO,EAAG,EAAGmL,CAAQ,CACzE,CAqCA,SAASxH,GAASpD,EAAMC,EAAMC,EAAU,GAAIX,EAAOqL,EACnD,CACI,MAAMzK,EAAYb,GAAMW,EAAK,EAAID,EAAK,GAAG,GAAIC,EAAK,EAAID,EAAK,GAAG,CAAC,EACzDX,EAAOC,EAAKY,EAAWC,EAAU,OAAM,EAAG,CAAC,EACjDgD,GAASnD,EAAK,IAAIG,CAAS,EAAGd,EAAME,EAAOY,EAAU,QAASyK,CAAQ,CAC1E,CAUA,SAASO,GAAa/L,EAAKC,EAAMI,EAAOiL,EAAQe,EAAcL,EAAU3J,EACxE,CAEIrC,EAAMyE,GAAczE,CAAG,EACvBC,EAAOA,EAAK,MAAMsE,CAAW,EAC7ByH,EAAQ,KAAI,EACZA,EAAQ,UAAUhM,EAAI,EAAE,GAAG,EAAGA,EAAI,EAAE,GAAG,CAAC,EACxCgM,EAAQ,OAAO3L,CAAK,EACpB2L,EAAQ,MAAMV,EAAS,CAACrL,EAAK,EAAIA,EAAK,EAAGA,EAAK,CAAC,EAC/CoM,EAAaL,CAAO,EACpBA,EAAQ,QAAO,CACnB,CAMA,SAASM,GAAaC,EAAUf,EAASxD,GACzC,CACoBwD,EACZgB,GAAeD,CAAQ,EAEvBlK,EAAY,yBAA2BkK,EAAW,UAAY,aACtE,CA+BA,SAASnI,GAAe1C,EAAM1B,EAAKC,EAAK,EAAGE,EAAM,IAAI0D,EAAO4I,EAAU,EAAGC,EAAU,IAAI7I,EAAM,EAAE,EAAE,CAAC,EAAG8I,EAAU,SAAUhL,EAAKoG,GAAaiE,EAAQ3I,EACnJ,CACI2I,EAAQ,UAAY7L,EACpB6L,EAAQ,UAAYS,EACpBT,EAAQ,YAAcU,EACtBV,EAAQ,UAAYW,EACpBX,EAAQ,KAAO/L,EAAO,MAAO0B,EAC7BqK,EAAQ,aAAe,SACvBA,EAAQ,SAAW,QAEnBhM,EAAMA,EAAI,QACT0B,EAAK,IAAI,MAAM;AAAA,CAAI,EAAE,QAAQkL,GAC9B,CACIH,GAAaT,EAAQ,WAAWY,EAAM5M,EAAI,EAAGA,EAAI,CAAC,EAClDgM,EAAQ,SAASY,EAAM5M,EAAI,EAAGA,EAAI,CAAC,EACnCA,EAAI,GAAKC,CACjB,CAAK,CACL,CAIA,IAAI4M,GAcJ,MAAMC,EACN,CAQI,YAAYC,EAAO7D,EAAShJ,EAAK,CAAC,EAAG8M,EAAY9M,EAAK,EAAE,CAAC,EAAG+M,EAAe,EAAGjB,EAAQ3I,EACtF,CAESwJ,MACAA,GAAkB,IAAI,OAAO,IAAM,sqBAExC,KAAK,MAAQE,GAASF,GACtB,KAAK,SAAW3D,EAChB,KAAK,YAAc8D,EACnB,KAAK,eAAiBC,EACtB,KAAK,QAAUjB,CAClB,CAQD,eAAetK,EAAM1B,EAAKkN,EAAM,EAAGC,EACnC,CACI,MAAMnB,EAAU,KAAK,QACrBA,EAAQ,KAAI,EACZA,EAAQ,sBAAwB,CAAClE,GAEjC,MAAM7H,EAAO,KAAK,SACZmN,EAAWnN,EAAK,IAAI,KAAK,WAAW,EAAE,MAAMiN,CAAK,EACjDxB,EAAO,KAAK,MAAM,MAAQ,KAAK,SAAS,EAAG,GAChDhK,EAAK,IAAI,MAAM;AAAA,CAAI,EAAE,QAAQ,CAACkL,EAAMlK,IACrC,CACI,MAAM2K,EAAeF,EAASP,EAAK,OAAS3M,EAAK,EAAIiN,EAAQ,EAAG,EAAI,EACpE,QAAQlK,EAAE4J,EAAK,OAAQ5J,KACvB,CAEI,IAAIsK,EAAWV,EAAK5J,CAAC,EAAE,WAAU,GAC7BsK,EAAW,IAAMA,EAAW,OAC5BA,EAAW,KAGf,MAAMC,EAAO,KAAK,eAAiBD,EAAW,GACxCzI,EAAI0I,EAAO7B,EACX5G,EAAIyI,EAAO7B,EAAM,EACjBzI,EAAUjD,EAAI,IAAIE,EAAK8C,EAAEN,CAAC,EAAE,SAAS0K,CAAQ,CAAC,EACpDpB,EAAQ,UAAU,KAAK,MAAOnH,EAAI5E,EAAK,EAAG6E,EAAI7E,EAAK,EAAGA,EAAK,EAAGA,EAAK,EAC/DgD,EAAQ,EAAIoK,EAAcpK,EAAQ,EAAGhD,EAAK,EAAIiN,EAAOjN,EAAK,EAAIiN,CAAK,CAC1E,CACb,CAAS,EAEDlB,EAAQ,QAAO,CAClB,CAQD,SAAStK,EAAM1B,EAAKkN,EAAM,EAAGC,EAC7B,CACI,KAAK,eAAezL,EAAM+C,GAAczE,CAAG,EAAE,MAAO,EAAEkN,EAAM3I,EAAY,EAAG4I,CAAM,CACpF,CACL,CAuCA,MAAMjI,GAAY,CAACsI,EAAKC,EAAO,IAAKxI,EAAUwI,CAAM,GAAKxI,EAAUwI,CAAM,EAAED,CAAG,EAAI,EAO5EtL,EAAgB,CAACsL,EAAKC,EAAO,IAAKxI,EAAUwI,CAAM,GAAKxI,EAAUwI,CAAM,EAAED,CAAG,EAAI,EAAI,EAAI,EAWxFE,GAAa,IAAKzI,EAAY,CAAC,CAAA,CAAE,EAcjC0I,GAAkBzL,EAYxB,IAAIyB,EAAWzD,EAAI,EAKfmE,GAAiBnE,EAAI,EAUrB0N,GAAiB,EAYrB,MAAMC,GAAgB,CAACC,EAAQnL,EAAQ,IAAKuC,GAAU4I,EAAQnL,EAAQ,CAAC,EAOjEoL,GAAoB,CAACD,EAAQnL,EAAQ,IAAKT,EAAc4L,EAAQnL,EAAQ,CAAC,EAqB/E,IAAIsC,EAAY,CAAC,CAAA,CAAE,EAEnB,SAAS+I,IACT,CAEIC,IAAiB,SAAS,SAAU,GAAIP,GAAU,EAGlD/J,EAAWwH,GAAc9G,EAAc,EAGvC6J,IACJ,CAEA,SAASC,IACT,CAEI,UAAWC,KAAmBnJ,EAC9B,UAAWvC,KAAK0L,EACZA,EAAgB1L,CAAC,GAAK,CAE9B,CAKA,UAAa,GACb,CACiB,EAAE,QAAU,SAAS,OAClC,EAAE,SAAWuC,EAAU2I,GAAiB,CAAC,EAAES,GAAS,EAAE,KAAK,CAAC,EAAI,GAEpE,EACA,QAAW,GACX,CACiB,EAAE,QAAU,SAAS,OAClCpJ,EAAU,CAAC,EAAEoJ,GAAS,EAAE,KAAK,CAAC,EAAI,EACtC,EACA,MAAMA,GAAYvH,GAAiCA,GAAG,GAAG,GAAKA,GAAG,GAAG,GAAKA,GAAG,GAAG,GAAKA,GAAG,GAAG,GAAKA,EAK/F,YAAe,GAAK,CAAC7B,EAAU2I,GAAiB,CAAC,EAAE,EAAE,MAAM,EAAI,EAAG,YAAY,CAAC,EAAG,EAAE,QAAU,EAAE,eAAc,CAAG,EACjH,UAAe,GAAK3I,EAAU,CAAC,EAAE,EAAE,MAAM,EAAIA,EAAU,CAAC,EAAE,EAAE,MAAM,EAAI,EAAI,EAC1E,YAAe,GAAKZ,GAAiBiK,GAAc,CAAC,EACpD,QAAW,GAAK,EAAE,SAAyB9I,GAAK,EAAE,MAAM,EACxD,cAAiB,GAAK,GAGtB,MAAM8I,GAAiB3K,GACvB,CACI,GAAI,CAACpB,EACD,OAAOrC,EAAI,EAEf,MAAMqO,EAAOhM,EAAW,wBACxB,OAAOrC,EAAKqC,EAAW,MAAOA,EAAW,MAAM,EAAE,SAC7CrC,EAAKyF,GAAQhC,EAAS,EAAG4K,EAAK,KAAMA,EAAK,KAAK,EAAG5I,GAAQhC,EAAS,EAAG4K,EAAK,IAAKA,EAAK,MAAM,CAAC,CAAC,CACpG,EAKMxL,GAAY,CAAA,EAClB,SAASmL,IACT,CAgBI,GAAuB,CAAC,WAAa,CAAC,UAAU,aAAe,CAAC,SAAS,SAAU,GAAI,CAACjP,GACpF,OAGJ,MAAMwD,EAAW,UAAU,cAC3B,QAASC,EAAID,EAAS,OAAQC,KAC9B,CAEI,MAAMC,EAAUF,EAASC,CAAC,EACpB8L,EAAOvJ,EAAUvC,EAAE,CAAC,IAAMuC,EAAUvC,EAAE,CAAC,EAAI,CAAA,GAC3CI,EAASC,GAAUL,CAAC,IAAMK,GAAUL,CAAC,EAAI,CAAA,GAE/C,GAAIC,EACJ,CAGI,MAAM8L,EAAiB/I,GACnBA,EAAK,GAAYC,GAASD,EAAG,GAAU,EAAW,EAClDA,EAAI,IAAY,CAACC,GAAQ,CAACD,EAAG,GAAU,EAAW,EAAI,EAG1D,QAAS1C,EAAI,EAAGA,EAAIL,EAAQ,KAAK,OAAO,EAAGK,GAAG,EAC1CF,EAAOE,GAAG,CAAC,EAAI9C,EAAKuO,EAAc9L,EAAQ,KAAKK,CAAC,CAAC,EAAGyL,EAAc,CAAC9L,EAAQ,KAAKK,EAAE,CAAC,CAAC,CAAC,EAAE,cAG3F,QAASA,EAAIL,EAAQ,QAAQ,OAAQK,KACrC,CACI,MAAM8K,EAASnL,EAAQ,QAAQK,CAAC,EAChCwL,EAAKxL,CAAC,EAAI8K,EAAO,QAAU,EAAI,EAAE,CAACD,GAAc7K,EAAEN,CAAC,EAAI,EAAEmL,GAAc7K,EAAEN,CAAC,EAC1EkL,IAAkB,CAAClL,GAAKoL,EAAO,OAElC,CAGD,CAEI,MAAMY,EAAOxO,EAAK2N,GAAc,GAAGnL,CAAC,EAAImL,GAAc,GAAGnL,CAAC,EAAGmL,GAAc,GAAGnL,CAAC,EAAImL,GAAc,GAAGnL,CAAC,CAAC,EAClGgM,EAAK,cAAe,IACpB5L,EAAO,CAAC,EAAI4L,EAAK,YAAW,EACnC,CACJ,CACJ,CACL,CAkBA,MAAMT,GAAgB,OAAO,eAAiB,OAG9C,GAAIA,GACJ,CAEI,IAAIU,EAAaC,EAAY,YAAaC,EAAU,UACpD,YAAc,UAAY,IAAK,EAG/B,aAAgBC,IAGZC,GAAK,CAAC,EAGN,aAAe,YAAc,WAAcD,GAC3C,CACIA,EAAE,OAAS,EAGX,MAAME,EAAWF,EAAE,QAAQ,OAC3B,OAAIE,GAGAF,EAAE,EAAIA,EAAE,QAAQ,CAAC,EAAE,QACnBA,EAAE,EAAIA,EAAE,QAAQ,CAAC,EAAE,QACnBH,EAAc,YAAYG,CAAC,EAAIF,EAAUE,CAAC,GAErCH,GACLE,EAAQC,CAAC,EAGbH,EAAcK,EAGP,EACV,EAKM,aAAaF,CAAC,EAE7B,CAMwB,IAAIvO,GAqJ5B,MAAM0O,EACN,CAMI,YAAYC,EAAWC,EAAMvG,GAAmBwG,EAAMvG,GACtD,CAII,KAAK,MAAQsG,EAGb,KAAK,MAAQC,EAGb,KAAK,WAAaF,EAAU,CAAC,GAAK,EAClCA,EAAU,CAAC,EAAI,EAGf,KAAK,cAAgBG,GAAM,GAAGH,CAAS,CAC1C,CASD,KAAKlP,EAAKsP,EAAO,EAAGC,EAAM,EAAGC,EAAgB,EAC7C,CAGI,IAAIC,EACJ,GAAIzP,EACJ,CACI,MAAMmP,EAAQ,KAAK,MACnB,GAAIA,EACJ,CAEI,MAAMO,EAAgB7M,EAAU,gBAAgB7C,CAAG,EACnD,GAAI0P,EAAgBP,EAAMA,EACtB,OAGJG,GAAU3J,GAAQ+J,GAAe,GAAIP,EAAOA,EAAM,KAAK,KAAK,CAC/D,CAGDM,EAAMhL,GAAczE,CAAG,EAAE,EAAI,EAAEuC,EAAW,MAAQ,CACrD,CAGD,MAAMoN,EAAeJ,EAAQA,EAAQ,KAAK,WAAWC,EAAgBzJ,EAAK,GAAG,CAAC,EAC9E,OAAO6J,GAAY,CAAC,KAAK,aAAa,EAAGN,EAAQK,EAAcF,CAAG,CACrE,CAQD,SAASI,EAAgB7P,EAAKsP,EAC9B,CAGI,OAAO,KAAK,KAAKtP,EAAKsP,EAAQ,IAAIO,EAAe,IAAK,CAAC,CAC1D,CACL,CAgIA,IAAIC,EAUJ,SAASF,GAAYG,EAAgBT,EAAO,EAAGU,EAAK,EAAGP,EAAI,EAAGQ,EAAK,EACnE,CAWI,GAPKH,IACDA,EAAe,IAAI,cAGvBA,EAAa,OAAM,EAGfA,EAAa,OAAS,UACtB,OAGJ,MAAMI,EAASJ,EAAa,aAAaC,EAAe,OAAQA,EAAe,CAAC,EAAE,OAAQI,CAAK,EAC3FC,EAASN,EAAa,qBAG1BC,EAAe,QAAQ,CAACjJ,EAAEpE,IAAKwN,EAAO,eAAexN,CAAC,EAAE,IAAIoE,CAAC,CAAC,EAC9DsJ,EAAO,OAASF,EAChBE,EAAO,aAAa,MAAQJ,EAC5BI,EAAO,KAAOH,EAGd,MAAMI,EAAWP,EAAa,aAC9B,OAAAO,EAAS,KAAK,MAAQ1H,GAAY2G,EAClCe,EAAS,QAAQP,EAAa,WAAW,EAGzCM,EAAO,QAAQ,IAAI,iBAAiBN,EAAc,CAAC,IAAMrK,EAAMgK,EAAK,GAAI,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQY,CAAQ,EAG9FD,EAAO,MAAK,EACLA,CACX,CAWA,MAAMrB,GAAO,IAAIG,IAAcU,GAAY,CAACP,GAAM,GAAGH,CAAS,CAAC,CAAC,EAK1DiB,EAAQ,MAId,SAASd,GAGLC,EAAS,EAAGgB,EAAa,IAAKC,EAAY,IAAKC,EAAS,EAAGC,EAAU,EACrEC,EAAU,GAAIC,EAAQ,EAAGC,EAAa,EAAGC,EAAQ,EAAGC,EAAa,EACjEC,EAAY,EAAGC,EAAgB,EAAGC,EAAa,EAAGC,EAAQ,EAAGC,EAAa,EAC1EC,EAAW,EAAGC,EAAQ,EAAGC,EAAgB,EAAGC,EAAQ,EAAGC,EAAU,EAErE,CAEI,IAAIC,EAAMrM,GAAG,EAAGsM,GAAab,GAAS,IAAMY,EAAMtB,EAAQA,EAAO5K,GAAE,CAAE,EACjEoM,GAAiBpB,IAAc,EAAID,EAAWvK,EAAK,GAAG,CAAC,GAAK0L,EAAMtB,EAClErK,EAAE,EAAG8L,GAAG,EAAGlP,EAAE,EAAGM,GAAE,EAAG4B,GAAE,EAAGkC,GAAE,EAAGF,EAAE,EAAGO,GAAGb,GAe3C,IAZAkK,EAASA,EAASL,EAAQ,EAC1BoB,GAASpB,EACTM,GAAWN,EACXO,GAAWP,EACXkB,GAASlB,EACTW,GAAc,IAAMW,EAAMtB,GAAO,EACjCgB,GAAcM,EAAMtB,EACpBY,GAAaU,EAAMtB,EACnBa,GAAiBb,EACjBc,EAAaA,EAAad,EAAQ,EAG7B7J,GAASkK,EAASe,EAAQd,EAAUC,EAAUW,EAAQ,EACvD3O,EAAI4D,GAAQf,GAAE7C,GAAG,EAAIkE,EAEf,EAAEE,IAAGsK,EAAS,IAAI,KAEpBxK,EAAI+J,EAAOA,EAAM,EAAGA,EAAM,EAAGA,EAAM,EAC/B,KAAK,KAAK7K,EAAE2L,IAAM,CAAC,EACnBjQ,EAAIF,EAAI,KAAK,IAAIwE,CAAC,EAAE,CAAC,EAAE,EAAE,EACzB,GAAG,EAAEA,EAAE2L,EAAI,EAAE,GAAG,EAChB,EAAE,EAAEpM,EAAI,KAAK,MAAMS,EAAE2L,CAAG,EAAE3L,EAAE2L,CAAG,EAC/B,KAAK,IAAI3L,CAAC,EAEdc,GAAKqK,EACG,EAAIO,EAAUA,EAAQ,KAAK,IAAIC,EAAI/O,EAAEuO,CAAU,EAC7C,GACNzL,GAAKoB,CAAC,EAAGvB,EAAIuB,CAAC,GAAGgK,EACjBtB,EAAS3G,IACTjG,EAAI8N,EAAS9N,EAAE8N,EACf9N,EAAI8N,EAASe,EACb,GAAI7O,EAAE8N,GAAQe,GAAQ,EAAED,GACxB5O,EAAI8N,EAAUe,EAAQd,EACtBa,EACA5O,EAAI4D,GAAS+K,GACZ/K,GAAS5D,EAAI2O,GAAOX,EACrBY,EACA,GAEJ1K,EAAIyK,EAAQzK,EAAE,GAAKyK,EAAQ3O,EAAI,GAC1BA,EAAE4D,GAAO+K,EAAO,GAAK/K,GAAO5D,GAAG2O,GAChC9L,GAAE7C,EAAE2O,EAAM,CAAC,EAAE,GAAKzK,GAG1BO,IAAKoJ,GAAaM,GAASC,GACvB,KAAK,IAAIK,EAAWS,IAAI,EAC5B9L,GAAKqB,GAAIA,GAAE+J,GAAO,GAAK,KAAK,IAAIxO,CAAC,EAAE,GAAG,IAAI,GAEtCM,IAAK,EAAEA,GAAIgO,IAEXT,GAAaQ,EACbY,IAAkBZ,EAClB/N,GAAI,GAGJiO,GAAc,EAAE,EAAErM,GAAIqM,KAEtBV,EAAYoB,GACZd,EAAQa,GACR1O,QAAM,IAId,OAAOuC,EACX,CA2HA,IAAIsM,GAAgB,CAAA,EAKhBC,GAAoB5R,EAAI,EAwB5B,MAAMiE,GAAwBnE,GAC1BA,EAAI,WAAW8R,EAAiB,EAAID,IAAe7R,EAAI,EAAE,GAAG8R,GAAkB,EAAE9R,EAAI,EAAE,CAAC,EAAI,EAQ/F,SAASoK,GAAkBpK,EAAKC,EAAKC,EAAM,EAAE6R,EAC7C,CACI,MAAMC,EAAOxQ,EAAIxB,EAAI,EAAIC,EAAK,EAAE,EAAE,EAAG,CAAC,EAChCgS,EAAOzQ,EAAIxB,EAAI,EAAIC,EAAK,EAAE,EAAE,EAAG,CAAC,EAChCiS,EAAO5Q,EAAItB,EAAI,EAAIC,EAAK,EAAE,EAAG6R,GAAkB,CAAC,EAChDK,EAAO7Q,EAAItB,EAAI,EAAIC,EAAK,EAAE,EAAG6R,GAAkB,CAAC,EACtD,QAAShN,EAAImN,EAAMnN,EAAIqN,EAAM,EAAErN,EAC/B,QAASD,EAAImN,EAAMnN,EAAIqN,EAAM,EAAErN,EAC/B,CACI,MAAM0F,EAAWsH,GAAc/M,EAAEgN,GAAkB,EAAEjN,CAAC,EACtD,GAAI0F,IAAa,CAACwH,GAAUA,EAAO,gBAAgBxH,EAAU,IAAIlE,EAAQxB,EAAGC,CAAC,CAAC,GAC1E,MAAO,EACd,CACL,CAQA,SAASZ,GAAqBkO,EAAUC,EAAQN,EAChD,CAGI,MAAMO,GAAYD,EAASA,EAAO,MAAK,GAAI,SAASD,EAAWA,EAAS,MAAK,CAAE,EACzEG,EAAKlN,EAAIiN,EAAS,CAAC,EAAIE,EAAK,CAACnN,EAAIiN,EAAS,CAAC,EAC3CG,EAAKjN,GAAK8M,EAAS,CAAC,EAAGI,EAAKlN,GAAK8M,EAAS,CAAC,EAEjD,QAASzN,EAAIuN,EAAS,EAAGtN,EAAIsN,EAAS,EAAGtD,EAAIyD,EAAKC,IAClD,CACI,MAAMjI,EAAWpG,GAAqBjE,EAAK2E,EAAEC,CAAC,CAAC,EAC/C,GAAIyF,IAAawH,EAASA,EAAO,uBAAuBxH,EAAU,IAAIlE,EAAQxB,EAAGC,CAAC,CAAC,EAAIyF,EAAW,GAI9F,OAAO,IAAIlE,EAAQxB,EAAE,GAAIC,EAAE,EAAE,EAIjC,GAAID,GAAKwN,EAAO,EAAIvN,GAAKuN,EAAO,EAAG,MACnC,MAAMM,EAAK,EAAE7D,EACT6D,GAAMH,IAAI1D,GAAK0D,EAAI3N,GAAK4N,GACxBE,GAAMJ,IAAIzD,GAAKyD,EAAIzN,GAAK4N,EAC/B,CAEL,CA6QA,MAAME,WAAwB5J,EAC9B,CA+BI,YAEIhJ,EACAK,EACAwS,EAAW,EACXC,EAAW,EACXC,EAAW,IACXC,EAAgB5N,GAChB6D,EAAY,GACZC,EAAWjB,GACXgL,EAAc,IAAIpP,EAClBqP,EAAc,IAAIrP,EAClBsP,EAAY,IAAItP,EAAM,EAAE,EAAE,EAAE,CAAC,EAC7BuP,EAAY,IAAIvP,EAAM,EAAE,EAAE,EAAE,CAAC,EAC7BwP,EAAe,GACfC,EAAY,GACZC,EAAU,EACVC,EAAQ,GACRC,EAAa,IACbC,EAAU,EACVC,EAAe,EACfC,EAAe,EACfC,GAAoBzO,GACpB0O,GAAW,GACXxD,GAAa,GACbzF,EACA0B,GACAwH,EAAoB,EACpB5K,GAAcoD,GAAW,IAAM,EAC/ByH,GAEJ,CACI,MAAMhU,EAAK,IAAIqG,EAAS4C,EAAWC,EAAU7I,EAAO,OAAW8I,EAAW,EAI1E,KAAK,SAAW0J,EAEhB,KAAK,SAAWC,EAEhB,KAAK,SAAWC,EAEhB,KAAK,cAAgBC,EAIrB,KAAK,YAAcC,EAEnB,KAAK,YAAcC,EAEnB,KAAK,UAAcC,EAEnB,KAAK,UAAcC,EAEnB,KAAK,kBAAoBW,EAIzB,KAAK,aAAoBV,EAEzB,KAAK,UAAoBC,EAEzB,KAAK,QAAoBC,EAEzB,KAAK,MAAoBC,EAEzB,KAAK,WAAoBC,EAEzB,KAAK,QAAoBC,EAEzB,KAAK,aAAoBC,EAEzB,KAAK,aAAoBC,EAEzB,KAAK,kBAAoBC,GAEzB,KAAK,SAAoBC,GAEzB,KAAK,WAAoBxD,GAEzB,KAAK,aAAoBzF,EAEzB,KAAK,SAAoB0B,GAEzB,KAAK,WAAsByH,GAE3B,KAAK,WAAoB,EAGzB,KAAK,eAAoB,CAC5B,CAGD,QACA,CAKI,GAHA,KAAK,QAAU,MAAM,SAGjB,CAAC,KAAK,SAAW,KAAK,aAAY,GAAM,KAAK,UAG7C,GAAI,KAAK,SAAWtL,GACpB,CACI,MAAMsH,EAAO,EAAE,KAAK,SAAStH,GAC7B,IAAK,KAAK,gBAAkBuL,GAAW,KAAK,eAAiB,EAAG,KAAK,gBAAkBjE,EACnF,KAAK,aAAY,CACxB,OAGD,KAAK,QAAO,EAEhBvQ,IAAkBM,GAAU,KAAK,IAAKG,EAAK,KAAK,QAAQ,EAAG,OAAQ,EAAG,KAAK,KAAK,CACnF,CAID,cACA,CAEI,IAAIF,EAAM,KAAK,SAAS,GAAK,KACxB,IAAIqG,EAAQN,EAAK,IAAI,EAAE,EAAGA,EAAK,IAAI,EAAE,CAAC,EAClC,SAAS,KAAK,QAAQ,EAAE,OAAO,KAAK,KAAK,EAC5CG,GAAa,KAAK,SAAS,CAAC,EAC9B7F,EAAQ0F,EAAK,KAAK,kBAAmB,CAAC,KAAK,iBAAiB,EAC3D,KAAK,aAEN/F,EAAM,KAAK,IAAI,IAAIA,CAAG,EACtBK,GAAS,KAAK,OAGlB,MAAM6T,EAAW,IAAIC,GAASnU,EAAK,KAAK,UAAW,KAAK,SAAUK,CAAK,EAGjEiQ,EAAa,KAAK,WAClB8D,EAAkB1O,GAAKA,EAAIA,EAAEK,EAAKuK,EAAY,CAACA,CAAU,EAGzD+C,EAAgBe,EAAe,KAAK,YAAY,EAChDd,EAAgBc,EAAe,KAAK,SAAS,EAC7Cb,EAAgBa,EAAe,KAAK,OAAO,EAC3CZ,EAAgBY,EAAe,KAAK,KAAK,EACzCX,EAAgBW,EAAe,KAAK,UAAU,EAAInO,GAAQ,EAC1DoO,EAAgBtO,EAAK,KAAK,cAAe,CAAC,KAAK,aAAa,EAC5DuO,EAAgB/N,GAAU,KAAK,YAAa,KAAK,YAAa,KAAK,iBAAiB,EACpFgO,EAAgBhO,GAAU,KAAK,UAAa,KAAK,UAAW,KAAK,iBAAiB,EAClFiO,EAAgB,KAAK,WAAaH,EAAY,KAAK,MAAQA,EAGjE,OAAAH,EAAS,WAAgBI,EACzBJ,EAAS,cAAgBK,EAAS,SAASD,CAAU,EACrDJ,EAAS,SAAiB,IAAI7N,IAAS,SAASmO,EAAehB,CAAK,EACpEU,EAAS,cAAgBT,EACzBS,EAAS,SAAgBb,EACzBa,EAAS,UAAgBZ,EACzBY,EAAS,aAAgBX,EAAUD,EACnCY,EAAS,SAAgB,KAAK,SAC9BA,EAAS,QAAgB,KAAK,QAC9BA,EAAS,aAAgB,KAAK,aAC9BA,EAAS,WAAgB,KAAK,WAC9BA,EAAS,SAAgB,KAAK,SAC9BA,EAAS,aAAgB,KAAK,aAC9BA,EAAS,aAAgB,KAAK,aAC9BA,EAAS,SAAgB,KAAK,SAC9BA,EAAS,YAAgB,KAAK,YAC9BA,EAAS,WAAgB,KAAK,WAC9BA,EAAS,OAAgBlO,GAAQ,CAAC,EAClCkO,EAAS,kBAAoB,KAAK,YAAc,KAGhDA,EAAS,gBAAkB,KAAK,wBAChC,KAAK,wBAA0B,KAAK,uBAAuBA,CAAQ,EAG5DA,CACV,CAGD,QAAS,CAAE,CACf,CAOA,MAAMC,WAAiBnL,EACvB,CAQI,YAAYhJ,EAAKiJ,EAAWC,EAAU7I,EACtC,CAAE,MAAML,EAAK,IAAIqG,EAAS4C,EAAWC,EAAU7I,CAAK,CAAI,CAGxD,QACA,CAEI,MAAMmE,EAAIlD,GAAKlB,EAAO,KAAK,WAAa,KAAK,SAAU,CAAC,EAClDK,EAAS,KAAK,UAAY+D,EAAI,KAAK,aACnCvE,EAAO,IAAIoG,EAAQ5F,EAAQA,CAAM,EACjCqT,EAAW,KAAK,SAAS,EACzB3T,EAAQ,IAAI0D,EACd,KAAK,WAAW,EAAIW,EAAI,KAAK,cAAc,EAC3C,KAAK,WAAW,EAAIA,EAAI,KAAK,cAAc,EAC3C,KAAK,WAAW,EAAIA,EAAI,KAAK,cAAc,GAC1C,KAAK,WAAW,EAAIA,EAAI,KAAK,cAAc,IAC1CA,EAAIsP,EAAWtP,EAAEsP,EAAWtP,EAAI,EAAEsP,GAAY,EAAEtP,GAAGsP,EAAW,EAAE,EAGtE,KAAK,UAAYxH,GAAa,CAAC,EAE/B,IAAItM,EAAM,KAAK,IAAKK,EAAQ,KAAK,MAOjC,GANI,KAAK,oBAGLL,EAAM,KAAK,kBAAkB,IAAI,IAAIA,EAAI,OAAO,CAAC,KAAK,kBAAkB,KAAK,CAAC,EAC9EK,GAAS,KAAK,kBAAkB,OAEhC,KAAK,WACT,CAEI,IAAIsJ,EAAW,KAAK,SAChB,KAAK,oBACLA,EAAWA,EAAS,OAAO,CAAC,KAAK,kBAAkB,KAAK,GAC5D,MAAM6J,EAAQ7J,EAAS,SACjB8K,EAAY9K,EAAS,MAAM,EAAE6J,CAAK,EAClCkB,EAAclB,EAAQ,KAAK,WACjCvT,EAAK,EAAIuB,EAAIvB,EAAK,EAAGyU,CAAW,EAChCrU,EAAQoU,EAAU,QAClBpK,GAASrK,EAAI,IAAIyU,EAAU,SAASvU,EAAK,EAAE,CAACwU,EAAY,CAAC,CAAC,CAAC,EAAGzU,EAAM,KAAK,UAAW,KAAK,SAAUE,EAAOE,EAAO,KAAK,MAAM,CAC/H,MAEGgK,GAASrK,EAAKC,EAAM,KAAK,UAAW,KAAK,SAAUE,EAAOE,EAAO,KAAK,MAAM,EAChF,KAAK,UAAYiM,KACjB7M,IAAkBM,GAAUC,EAAKC,EAAM,QAAS,EAAGI,CAAK,EAEpDmE,GAAK,IAGL,KAAK,MAAQrE,EACb,KAAK,KAAOF,EACZ,KAAK,iBAAmB,KAAK,gBAAgB,IAAI,EACjD,KAAK,UAAY,EAExB,CACL,CAiBG,IAAC0U,GAAqB,CAAE,EAAkBC,GA+G7C,SAASC,IACT,CACI,GAAI,CAACF,GAAmB,OACpB,OAGJ,MAAMG,EAAQH,GAAmB,CAAC,EAC5BvU,EAAO2U,GAAWH,GACxB,GAAI,CAACA,GACDA,GAAwBG,WACnB3U,EAAO0I,GACZ6L,GAAmB,MAAMC,GAAwB,CAAC,MAEtD,CAEI,MAAMI,EAAelM,GAAmBC,GAClCkM,EACF7U,EAAO2I,GAAwB,EAAI3I,EAAO2I,GAC1C3I,EAAO4U,GAAgB5U,EAAO4U,GAAgBjM,GAAwB,EAC1E+L,EAAM,OAAOG,CAAW,CAC3B,CACL,CAsKA,IAAIC,EAKAC,EAKAC,GAGiBC,GAAUC,GAAeC,GAAgBC,GAAaC,GAAcC,GAAiBC,GAK1G,SAASC,IACT,CAEIV,EAAW,SAAS,cAAc,QAAQ,EAC1CC,EAAYD,EAAS,WAAW,QAAS,CAAC,UAAW,EAAK,CAAC,EAC3DE,GAAgBS,GAAgB9K,CAAS,EAG5B,SAAS,KAAK,YAAYmK,CAAQ,EAG/CG,GAAWS,GACP,4JAUA,+GAMR,EAGI,MAAMC,EAAa,IAAI,YAAYC,EAAqB,EACxDV,GAAgBH,EAAU,eAC1BI,GAAiB,IAAI,aAAaQ,CAAU,EAC5CP,GAAc,IAAI,YAAYO,CAAU,EACxCN,GAAe,CACnB,CAKA,SAASjJ,GAAeD,EACxB,CAEIoJ,GAAapJ,CACjB,CAoBA,SAAS0J,GAAgB7F,EAAQ8F,EACjC,CAEI,MAAMC,EAAShB,EAAU,aAAae,CAAI,EAK1C,GAJAf,EAAU,aAAagB,EAAQ/F,CAAM,EACrC+E,EAAU,cAAcgB,CAAM,EAGjB,CAAChB,EAAU,mBAAmBgB,EAAQC,EAAiB,EAChE,MAAMjB,EAAU,iBAAiBgB,CAAM,EAC3C,OAAOA,CACX,CAOA,SAASL,GAAgBO,EAAUC,EACnC,CAEI,MAAMC,EAAUpB,EAAU,gBAM1B,GALAA,EAAU,aAAaoB,EAASN,GAAgBI,EAAUG,EAAgB,CAAC,EAC3ErB,EAAU,aAAaoB,EAASN,GAAgBK,EAAUG,EAAkB,CAAC,EAC7EtB,EAAU,YAAYoB,CAAO,EAGhB,CAACpB,EAAU,oBAAoBoB,EAASG,EAAc,EAC/D,MAAMvB,EAAU,kBAAkBoB,CAAO,EAC7C,OAAOA,CACX,CAMA,SAASV,GAAgB9I,EACzB,CAEI,MAAM4J,EAAUxB,EAAU,gBAC1BA,EAAU,YAAYyB,GAAeD,CAAO,EAC5C5J,GAASA,EAAM,OAASoI,EAAU,WAAWyB,GAAe,EAAGC,GAASA,GAASC,GAAkB/J,CAAK,EAGxG,MAAMgK,EAA0BC,GAChC,OAAA7B,EAAU,cAAcyB,GAAeK,GAAuBF,CAAM,EACpE5B,EAAU,cAAcyB,GAAeM,GAAuBH,CAAM,EACpE5B,EAAU,cAAcyB,GAAeO,GAAmBC,EAAgB,EAC1EjC,EAAU,cAAcyB,GAAeS,GAAmBD,EAAgB,EACnET,CACX,CAGA,SAASW,IACT,CAEInC,EAAU,SAAS,EAAG,EAAGD,EAAS,MAAQ3S,EAAW,MAAO2S,EAAS,OAAS3S,EAAW,MAAM,EAC/F4S,EAAU,MAAMoC,EAAmB,EAGnCpC,EAAU,WAAWE,EAAQ,EAC7BF,EAAU,cAAcqC,EAAW,EACnCrC,EAAU,YAAYyB,GAAiCxB,EAAa,EACpED,EAAU,WAAWsC,GAAiBnC,EAAa,EACnDH,EAAU,WAAWsC,GAAiBzB,GAAuB0B,EAAe,EAC5ElL,KAGA,IAAImL,EAAS,EACb,MAAMC,EAAwB,CAACC,EAAM3B,EAAM4B,EAAU7X,EAAM8X,EAAU,IACrE,CACI,MAAMC,EAAW7C,EAAU,kBAAkBE,GAAUwC,CAAI,EAC3D1C,EAAU,wBAAwB6C,CAAQ,EAC1C7C,EAAU,oBAAoB6C,EAAU/X,EAAMiW,EAAM6B,EAAWE,GAAuBN,CAAM,EAC5FA,GAAU1X,EAAK6X,CAClB,EACDF,EAAsB,IAAKM,GAAU,EAAG,CAAC,EACzCN,EAAsB,IAAKM,GAAU,EAAG,CAAC,EACzCN,EAAsB,IAAKd,GAAkB,EAAG,EAAG,CAAC,EACpDc,EAAsB,IAAKd,GAAkB,EAAG,EAAG,CAAC,EAGpD,MAAMrE,EAAK,EAAIlO,EAAchC,EAAW,MAClCmQ,EAAK,EAAInO,EAAchC,EAAW,OACxC4S,EAAU,iBAAiBA,EAAU,mBAAmBE,GAAU,GAAG,EAAG,EACpE,IAAI,aAAa,CACb5C,EAAI,EAAG,EAAG,EACV,EAAGC,EAAI,EAAG,EACV,EAAG,EAAG,GAAI,EACV,GAAGD,EAAG5P,EAAU,EAAG,GAAG6P,EAAG7P,EAAU,EAAG,EAAG,CACrD,CAAS,CACT,CACA,CAIA,SAASsV,IACT,CACI,GAAI,CAAC1C,GAAc,OAEnB,MAAM2C,EAAY1C,GAAkB2C,GAASC,GAC7CnD,EAAU,kBAAkBoD,GAAcH,EAAWC,GAAQD,CAAS,EACtEjD,EAAU,OAAOqD,EAAQ,EAGzBrD,EAAU,cAAcsC,GAAiB,EACrClC,GAAe,SAAS,EAAGE,GAAegD,GAAuBC,EAAoB,CAAC,EAC1FvD,EAAU,WAAWwD,GAAc,EAAGlD,GAAegD,EAAoB,EACzEhD,GAAe,EACfC,GAAkBC,EACtB,CAMA,SAASvT,GAAgB4J,EAAS4M,EAClC,CACQ,CAACnD,IAAgB,CAACmD,IAEtBT,KAGkBS,GACd5M,EAAQ,UAAUkJ,EAAU,EAAG,CAAC,EACxC,CAeA,SAASzJ,GAAO5G,EAAGC,EAAG+T,EAAOC,EAAOzY,EAAO0Y,EAAMC,EAAMC,EAAMC,EAAMC,EAAMC,EAAa,EACtF,EAEQ3D,IAAgB4D,IAAgB3D,IAAmBC,KACnDwC,KAGJ,MAAMrR,EAAI,KAAK,IAAIzG,CAAK,EAAE,EAAGuG,EAAI,KAAK,IAAIvG,CAAK,EAAE,EAC3CiZ,EAAKxS,EAAE+R,EAAOU,EAAKzS,EAAEgS,EAAOrG,EAAK7L,EAAEiS,EAAOnG,EAAK9L,EAAEkS,EAGvD,QAAQpW,EAAE,EAAGiV,EAASlC,KAAiBgD,GAAuBC,GAAsBhW,KACpF,CACI,MAAM4C,EAAI5C,EAAE,GAAGA,EAAE,EAAG6C,EAAI7C,EAAE,GAAGA,EAAE,GAAGA,EAAE,EACpC6S,GAAeoC,GAAQ,EAAI9S,GAAKS,EAAE,CAACgU,EAAGA,IAAO/T,EAAEmN,EAAG,CAACA,GACnD6C,GAAeoC,GAAQ,EAAI7S,GAAKS,EAAEgU,EAAG,CAACA,IAAOjU,EAAEmN,EAAG,CAACA,GACnD8C,GAAeoC,GAAQ,EAAIrS,EAAIyT,EAAOE,EACtC1D,GAAeoC,GAAQ,EAAIpS,EAAIyT,EAAOE,EACtC1D,GAAYmC,GAAQ,EAAIwB,EACxB3D,GAAYmC,GAAQ,EAAIyB,CAC3B,CACL,CAkGO,MACPf,GAAS,EACTM,GAAe,EACfJ,GAAe,IACfD,GAAyB,IACzBE,GAAW,KACX5B,GAAgB,KAChBE,GAAmB,KAEnBoB,GAAW,KACXrB,GAAU,KACVG,GAAa,KAEbE,GAAwB,MACxBD,GAAwB,MACxBE,GAAoB,MACpBE,GAAoB,MACpBE,GAAsB,MACtBH,GAAmB,MACnBI,GAAc,MAEdC,GAAkB,MAElBC,GAAkB,MAClBjB,GAAqB,MACrBD,GAAmB,MACnBJ,GAAoB,MACpBM,GAAiB,MAIjB+B,GAAuB,EACvBC,GAAuB,EACvBW,GAAe,MACfpB,GAAyB,EAAI,EAAK,EAAK,EAAK,EAC5CjC,GAAwBqD,GAAeZ,GAAuBR,GA+BxDlW,GAAa,WAMbyX,GAAgB,QAMhBC,GAAY,GAMZxF,GAAY,EAAEwF,GAKpB,IAAIhW,EAAgB,CAAA,EAKhB+F,GAAuB,CAAA,EAKvBkQ,GAAQ,EAKRtZ,EAAO,EAKP2U,GAAW,EAMX4E,GAAS,EAiBb,SAASC,GAAWC,EAAUC,EAAYC,EAAgBC,EAAYC,EAAgBC,EACtF,CAEInP,EAAU,QAAUA,EAAU,OAAS,IACvC,CAEIE,GAAoB/K,EAAKgI,EAAiB,EAAE,OAAO8C,GAAgB9K,EAAK6K,EAAU,MAAOA,EAAU,MAAM,CAAC,EAChGA,EAAU,OAAO,IAAIlL,EAAO,CAAC,EAGvC,MAAMsa,EAAY,uGAIlB,SAAS,KAAK,MAAQA,EACtB,SAAS,KAAK,YAAY5X,EAAa,SAAS,cAAc,QAAQ,CAAC,EACvEF,EAAcE,EAAW,WAAW,IAAI,EAGxCP,KACY4T,KAGZ,SAAS,KAAK,YAAYtT,EAAgB,SAAS,cAAc,QAAQ,CAAC,EAC1Ee,EAAiBf,EAAc,WAAW,IAAI,EAG9C,MAAM8X,EAAc,qEACnBlF,GAAU3S,GAAY,MAAQA,EAAW,MAAQD,EAAc,MAAQ8X,EAExEP,IACAQ,GACR,EAGI,IAAIC,EAAkB,EAAGC,EAAmBC,EAG5C,SAASH,EAAaI,EAAY,EAClC,CAEI,IAAIC,EAAmBD,EAAcH,EACrCA,EAAkBG,EAEdD,EAAa5U,GAAK,IAAK4U,EAAY,KAAKE,GAAkB,EAAE,EAChE,MAAMC,EAA0BzV,GAAU,GAAG,EACvC0V,EAA0B1V,GAAU,GAAG,EAQ7C,GANIwV,GAAoBC,EAAe,EAAIC,EAAiB,GAAK,EACjE7F,IAAY2F,EAAmB,IAC/BH,GAAqB,CAACZ,GAASe,EAC1BC,IACDJ,EAAoBjZ,EAAIiZ,EAAmB,EAAE,GAE7C1S,GAAgB,EACpB,CAEItF,EAAW,MAASsF,GAAgB,EACpCtF,EAAW,OAASsF,GAAgB,EAGpC,MAAMgT,EAAS,WAAa,YACtBC,EAAcvY,EAAW,MAAQA,EAAW,QACjD2S,GAAU3S,GAAY,MAAM,MAAQA,EAAW,MAAM,MAAQD,EAAc,MAAM,MAASuY,EAASC,EAAc,OAAS,IAC1H5F,GAAU3S,GAAY,MAAM,OAASA,EAAW,MAAM,OAASD,EAAc,MAAM,OAASuY,EAASC,EAAc,GAAK,MAC5H,MAIIvY,EAAW,MAASjB,EAAI,WAAasG,GAAc,CAAC,EACpDrF,EAAW,OAASjB,EAAI,YAAasG,GAAc,CAAC,EAIzDtF,EAAc,MAASC,EAAW,MAClCD,EAAc,OAASC,EAAW,OAGlCuI,GAAiB5K,EAAKqC,EAAW,MAAOA,EAAW,MAAM,EAWzD,CAEI,IAAIwY,EAAc,EASlB,IARIR,EAAoB,GAAKA,EAAoB,KAG7CQ,EAAcR,EACdA,EAAoB,GAIlBA,GAAqB,EAAGA,GAAqB,IAAMd,GAGrDzL,KACA8L,IACAkB,KAGA/Y,KACA8X,IACA5L,KAIJoM,GAAqBQ,CACxB,CAGDE,KACAjB,IACAvW,EAAc,KAAK,CAAC6B,EAAEC,IAAKD,EAAE,YAAcC,EAAE,WAAW,EACxD,UAAW/B,KAAKC,EACZD,EAAE,WAAaA,EAAE,SAQrB,GAPAyW,IAEApF,KAEA1S,KACYC,GAAgBC,CAAW,EAEnClD,GACJ,CAEIkE,EAAe,UAAY,QAC3BA,EAAe,aAAe,MAC9BA,EAAe,KAAO,gBACtBA,EAAe,UAAY,OAC3B,MAAM3B,EAAOK,GAAa,KAAYyX,GAAgB,MAChDtO,GAAY,MAAQzH,EAAc,OAAS,MAAQ+W,EAAW,QAAQ,CAAC,EAC3D,MAClBnX,EAAe,SAAS3B,EAAMa,EAAW,MAAM,EAAG,CAAC,EACnDc,EAAe,UAAY,OAC3BA,EAAe,SAAS3B,EAAMa,EAAW,MAAM,EAAG,CAAC,EACnD2I,GAAY,CACf,CAED,sBAAsBmP,CAAY,CACrC,CAGDH,EAAkBnP,EAAU,IAAMmP,EAAkBnP,EAAU,OAAM,CACxE,CAGA,SAASkQ,IACT,CAEInQ,GAAiB5K,EAAKqC,EAAW,MAAOA,EAAW,MAAM,EAGzDF,EAAY,sBAAwB,CAACyF,GAGzBwP,IAChB,CAIA,SAAS0D,IACT,CAEIxR,GAAuB/F,EAAc,OAAOD,GAAGA,EAAE,mBAAmB,EAGpE,MAAM0X,EAAgB1X,GACtB,CACI,GAAI,CAACA,EAAE,UACP,CACIA,EAAE,OAAM,EACR,UAAW8G,KAAS9G,EAAE,SAClB0X,EAAa5Q,CAAK,CACzB,CACJ,EACD,UAAW9G,KAAKC,EACZD,EAAE,QAAU0X,EAAa1X,CAAC,EAG9BC,EAAgBA,EAAc,OAAOD,GAAG,CAACA,EAAE,SAAS,EAGpDpD,EAAO,EAAEsZ,GAAQD,EACrB,CAgDA,MAAM0B,GAAgBnb,GAAO6C,EAAY7C,EAenCob,GAAsBnb,GAAQ4H,GAAkB5H,EAqKhDob,GAAoBC,GAAQnc,GAAgBmc,EAU5CC,GAAe/N,GAAOnO,GAAWmO,EC5pJ1B,MAAAgO,WAAeC,EAAe,CACzC,YAA6BC,EAAsB,CAC3C,MAAAC,EAAO,EAAG,CAAC,EAAGA,EAAO,EAAG,EAAG,CAAC,EADP,KAAA,UAAAD,EAE3B,KAAK,MAAQ,IAAIE,EAAQ,EAAG,EAAG,EAAG,EAAG,EAErC,KAAK,aAAa,EAAI,EACtB,KAAK,KAAO,CACd,CAES,QAAS,CACV,MAAAta,EAAM,KAAK,KAAK,EAAI,GACpBE,EAAM,KAAK,UAAU,EAAIF,EAC1B,KAAA,IAAI,EAAIua,EAAQC,EAAW,EAAGxa,EAAKE,CAAG,CAC7C,CAEA,cAAe,CACb,KAAK,KAAK,GAAK,CACjB,CAEA,cAAe,CACb,KAAK,KAAK,GAAK,EACX,KAAK,KAAK,EAAI,IAAG,KAAK,KAAK,EAAI,EACrC,CAEA,WAAY,CACV,KAAK,KAAK,EAAI,CAChB,CACF,CC3Ba,MAAAua,WAAaN,EAAe,CACvC,YAAYO,EAAqB/b,EAAiB,CAChD,MAAM+b,EAAU/b,CAAI,EAEpB,KAAK,aAAa,EAAI,EACtB,KAAK,KAAO,EACZ,KAAK,MAAQ,IAAI2b,EAAQ,EAAE,OAAO,SAAS,CAC7C,CACF,CCRO,MAAMK,EAAYN,EAAO,GAAI,EAAE,ECF/B,MAAMO,EAAM,CAIjB,YAA6BC,EAAsB,CAH3CC,EAAA,aAAQ,GACRA,EAAA,iBAAY,GAES,KAAA,aAAAD,EAC3B,KAAK,MAAQ,KAAK,aAClB,KAAK,UAAY,OAAO,aAAa,QAAQ,WAAW,CAAC,GAAK,CAChE,CAEA,WAAY,CACL,KAAA,QACL,KAAK,kBAAkB,CACzB,CAEA,WAAY,CACL,KAAA,QACL,KAAK,kBAAkB,CACzB,CAEA,IAAIE,EAAe,CACjB,KAAK,OAASA,EACd,KAAK,kBAAkB,CACzB,CAEA,OAAQ,CACN,KAAK,MAAQ,KAAK,YACpB,CAEA,UAAW,CACF,OAAA,KAAK,MAAM,UACpB,CAEA,SAAU,CACR,OAAO,KAAK,KACd,CAEA,cAAe,CACb,OAAO,KAAK,SACd,CAEQ,mBAAoB,CACtB,KAAK,MAAQ,KAAK,YACpB,KAAK,UAAY,KAAK,MACtB,aAAa,QAAQ,YAAa,KAAK,UAAU,UAAU,EAE/D,CACF,CC9CA,MAAeC,GAAA,GAAA,IAAA,IAAA,qBAAA,YAAA,GAAA,EAAA,KCAFC,GAAQ,CACnB,SAAU,CACR,OAAO,OAAO,SAAS,KAAK,SAAS,OAAO,CAC9C,EACA,UAAW,CACF,MAAA,CAAC,KAAK,SACf,CACF,sBCPA,SAASC,IAAK,CAGd,CAEAA,GAAE,UAAY,CACZ,GAAI,SAAU3E,EAAM4E,EAAUC,EAAK,CACjC,IAAI5N,EAAI,KAAK,IAAM,KAAK,EAAI,CAAA,GAE5B,OAACA,EAAE+I,CAAI,IAAM/I,EAAE+I,CAAI,EAAI,CAAA,IAAK,KAAK,CAC/B,GAAI4E,EACJ,IAAKC,CACX,CAAK,EAEM,IACR,EAED,KAAM,SAAU7E,EAAM4E,EAAUC,EAAK,CACnC,IAAIC,EAAO,KACX,SAASC,GAAY,CACnBD,EAAK,IAAI9E,EAAM+E,CAAQ,EACvBH,EAAS,MAAMC,EAAK,SAAS,CAEnC,CACI,OAAAE,EAAS,EAAIH,EACN,KAAK,GAAG5E,EAAM+E,EAAUF,CAAG,CACnC,EAED,KAAM,SAAU7E,EAAM,CACpB,IAAIrJ,EAAO,CAAA,EAAG,MAAM,KAAK,UAAW,CAAC,EACjCqO,IAAW,KAAK,IAAM,KAAK,EAAI,CAAA,IAAKhF,CAAI,GAAK,CAAE,GAAE,MAAK,EACtD,EAAI,EACJiF,EAAMD,EAAO,OAEjB,IAAK,EAAG,EAAIC,EAAK,IACfD,EAAO,CAAC,EAAE,GAAG,MAAMA,EAAO,CAAC,EAAE,IAAKrO,CAAI,EAGxC,OAAO,IACR,EAED,IAAK,SAAUqJ,EAAM4E,EAAU,CAC7B,IAAI3N,EAAI,KAAK,IAAM,KAAK,EAAI,CAAA,GACxBiO,EAAOjO,EAAE+I,CAAI,EACbmF,EAAa,CAAA,EAEjB,GAAID,GAAQN,EACV,QAAS/Z,EAAI,EAAGoa,EAAMC,EAAK,OAAQra,EAAIoa,EAAKpa,IACtCqa,EAAKra,CAAC,EAAE,KAAO+Z,GAAYM,EAAKra,CAAC,EAAE,GAAG,IAAM+Z,GAC9CO,EAAW,KAAKD,EAAKra,CAAC,CAAC,EAQ7B,OAACsa,EAAW,OACRlO,EAAE+I,CAAI,EAAImF,EACV,OAAOlO,EAAE+I,CAAI,EAEV,IACR,CACH,EAEAoF,GAAc,QAAGT,GACjB,IAAAU,GAAAD,GAAA,QAAA,YAA6BT,GChEhB,MAAAW,GAAU,IAAID,GCFf,IAAAE,GAAAA,IACVA,EAAAC,EAAA,WAAA,CAAA,EAAA,aACAD,EAAAC,EAAA,WAAA,CAAA,EAAA,aACAD,EAAAC,EAAA,eAAA,CAAA,EAAA,iBACAD,EAAAC,EAAA,UAAA,CAAA,EAAA,YACAD,EAAAC,EAAA,UAAA,CAAA,EAAA,YACAD,EAAAC,EAAA,eAAA,CAAA,EAAA,iBACAD,EAAAC,EAAA,YAAA,CAAA,EAAA,cACAD,EAAAC,EAAA,YAAA,CAAA,EAAA,cACAD,EAAAC,EAAA,cAAA,CAAA,EAAA,gBATUD,IAAAA,GAAA,CAAA,CAAA,ECEL,MAAeA,EAAU,CAIpB,YAA4BE,EAAY,CAH/BlB,EAAA,cAA2B,CAAA,GAC3BA,EAAA,eAAU,KAES,KAAA,KAAAkB,CAAa,CAInD,aAAc,CACP,KAAA,OAAO,QAAQ,YAAY,CAClC,CACF,CCTO,MAAMC,WAAmBH,EAAU,CACxC,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,CACN,GAAI,KAAK,KAAK,MAAM,SAAA,EAAY,CAC9B,MAAME,EAAO,KAAK,KAAK,MAAM,OAAO,EAChC,GAAA,CAACA,GAAQA,EAAK,UAAW,OAE7B,KAAK,KAAK,MAAM,YAAYC,EAAa,CAAC,CAC5C,CACF,CACF,CCZO,MAAMC,WAAkBN,EAAU,CACvC,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,CACD,KAAA,KAAK,MAAM,WAClB,CACF,CCVO,MAAMK,WAAuBP,EAAU,CAC5C,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,QACDM,EAAA,KAAA,KAAK,SAAL,MAAAA,EAAa,eAClB,KAAK,OAAO,KACV,WAAW,IAAM,QACVA,EAAA,KAAA,KAAK,SAAL,MAAAA,EAAa,cAAa,EAC9B,KAAK,OAAO,CAAA,CAEnB,CACF,CCbO,MAAMC,WAAuBT,EAAU,CAC5C,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,QACDM,EAAA,KAAA,KAAK,SAAL,MAAAA,EAAa,eAClB,KAAK,OAAO,KACV,WAAW,IAAM,QACVA,EAAA,KAAA,KAAK,SAAL,MAAAA,EAAa,cAAa,EAC9B,KAAK,OAAO,CAAA,CAEnB,CACF,CCbO,MAAME,WAAmBV,EAAU,CACxC,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,CACD,KAAA,KAAK,MAAM,IAAI,EAAE,CACxB,CACF,CCLO,MAAMS,WAAkBX,EAAU,CAIvC,YAAYE,EAAY,CACtB,MAAMA,CAAI,EAJKlB,EAAA,YAAOT,EAAOM,EAAU,EAAG,GAAI,GAC/BG,EAAA,gBAAWT,EAAOM,EAAU,EAAI,GAAK,GAAI,EAI1D,CAEA,OAAQ,QACD2B,EAAA,KAAA,KAAK,QAAL,MAAAA,EAAY,UACjB,KAAK,KAAK,MAAQ,IAAI7B,GAAK,KAAK,SAAU,KAAK,IAAI,EAC9C,KAAA,KAAK,MAAM,MAAQ,IAAIH,EAAQ,EAAG,EAAG,EAAG,EAAG,EAChD,KAAK,OAAO,KACV,WAAW,IAAM,QACVgC,EAAA,KAAA,KAAK,QAAL,MAAAA,EAAY,UACjB,KAAK,KAAK,MAAQ,IAAA,EACjB,KAAK,OAAO,CAAA,CAEnB,CACF,CCrBO,MAAMI,WAAoBZ,EAAU,CACzC,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,CACF,KAAK,KAAK,MAAM,SAAA,GACb,KAAA,KAAK,MAAM,QAEpB,CACF,CCVO,MAAMW,WAAoBb,EAAU,CACzC,YAAYE,EAAY,CACtB,MAAMA,CAAI,CACZ,CAEA,OAAQ,CACF,KAAK,KAAK,MAAM,SAAA,GACb,KAAA,KAAK,MAAM,QAEpB,CACF,CCZO,MAAMY,GAA4B,CACvC,CAAC,EAAG,CAAC,EACL,CAAC,EAAG,EAAE,EACN,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,EACP,CAAC,GAAI,CAAC,EACN,CAAC,GAAI,EAAE,EACP,CAAC,EAAG,EAAE,EACN,CAAC,GAAI,EAAE,CAET,EAEaC,GAAuB,GACvBC,GAAuB,IAAIxC,EAAQ,EAAE,OAAO,SAAS,EAErDyC,GAAS,CACpB,IAAIzC,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAE9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,EAC9B,IAAIA,EAAQ,EAAE,OAAO,SAAS,CAChC,EAGA,GAAIyC,GAAO,SAAWH,GAAM,OACpB,MAAA,IAAI,MAAM,4CAA4C,EC3BjD,MAAAI,WAAc7C,EAAe,CAIxC,YAAYO,EAAqB9F,EAAiB,CAChD,MAAM8F,EAAUL,EAAO,EAAG,CAAC,EAJZS,EAAA,aACAA,EAAA,YAAe,GAK9B,KAAK,KAAOlG,EACZ,KAAK,aAAa,EAAI,EACtB,KAAK,SAAWyF,EAAO,EAAG,GAAI,EAEzB,KAAA,MAAQ0C,GAAO,KAAK,IAAI,EAC7B,KAAK,KAAOE,GAAU,EAAG,CAAC,IAAM,EAAI,GAAK,CAC3C,CAES,QAAS,CAChB,KAAK,OAAS,KAAK,KAEf,KAAK,IAAI,EAAI,GAEf,KAAK,QAAQ,EAGf,MAAM,OAAO,CACf,CAES,kBAAkBxM,EAAiC,CAC1D,OAAIA,aAAkByJ,KACZ2B,GAAA,KAAK,iBAAkB,KAAK,IAAI,EACxC,KAAK,QAAQ,GAIR,EACT,CACF,CC1BO,MAAMqB,EAAa,CAGxB,YAAYlB,EAAY,CAFPlB,EAAA,iBAGf,KAAK,SAAW,CACd,CAACgB,EAAU,UAAU,EAAG,IAAIG,GAAWD,CAAI,EAC3C,CAACF,EAAU,SAAS,EAAG,IAAIM,GAAUJ,CAAI,EACzC,CAACF,EAAU,cAAc,EAAG,IAAIO,GAAeL,CAAI,EACnD,CAACF,EAAU,cAAc,EAAG,IAAIS,GAAeP,CAAI,EACnD,CAACF,EAAU,UAAU,EAAG,IAAIU,GAAWR,CAAI,EAC3C,CAACF,EAAU,SAAS,EAAG,IAAIW,GAAUT,CAAI,EACzC,CAACF,EAAU,WAAW,EAAG,IAAIY,GAAYV,CAAI,EAC7C,CAACF,EAAU,WAAW,EAAG,IAAIa,GAAYX,CAAI,EAC7C,CAACF,EAAU,aAAa,EAAG,IAAIG,GAAWD,CAAI,CAAA,CAElD,CAEA,QAAQpH,EAAiB,CAElB,KAAA,SAASA,CAAI,EAAE,MAAM,CAC5B,CAEA,QAAQA,EAAiB,CACvB,IAAIoI,GAAM3C,EAAO4C,GAAU,EAAGtC,EAAU,EAAI,CAAC,EAAGA,EAAU,EAAI,CAAC,EAAG/F,CAAI,CACxE,CAEA,aAAc,CACZ,UAAWuI,KAAW,OAAO,OAAO,KAAK,QAAQ,EAC/CA,EAAQ,YAAY,CAExB,CACF,CC5CO,MAAMC,GAAS,CACpB,UAAW,IAAIC,GAAQ,CAAG,CAAA,EAAG,IAAO,CAAA,IAAM,GAAK,EAAG,EAAG,CAAA,CAAI,IAAK,IAAM,OAAY,GAAI,CAAC,EACrF,WAAY,IAAIA,GAAQ,GAAK,IAAK,IAAM,IAAM,IAAQ,CAAA,IAAQ,CAAA,GAAa,CAAA,CAAA,CAAA,CAAA,KAAM,CAAA,CAAA,CAAM,IAAM,EAAG,CAAC,EACjG,SAAU,IAAIA,GAAQ,CAAK,CAAA,CAAA,MAAS,IAAM,EAAG,OAAa,GAAK,GAAU,CAAA,CAAA,CAAA,GAAI,CAAC,EAC9E,aAAc,IAAIA,GAAQ,CAAC,KAAQ,CAAA,IAAK,IAAM,IAAM,GAAK,EAAG,IAAK,GAAK,MAAU,IAAM,IAAA,CAAO,GAAO,CAAA,IAAM,GAAI,CAAC,CACjH,ECPaC,GAAS,CACpB,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,EACA,CACE,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3D,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAC7D,CACF,EAAE,IAAKC,GAAWA,EAAO,SAAS,ECrItB,IAAAC,IAAAA,IACVA,EAAAC,EAAA,MAAA,CAAA,EAAA,QACAD,EAAAC,EAAA,OAAA,CAAA,EAAA,SACAD,EAAAC,EAAA,KAAA,CAAA,EAAA,OACAD,EAAAC,EAAA,YAAA,CAAA,EAAA,cAJUD,IAAAA,IAAA,CAAA,CAAA,ECEL,MAAME,EAAoC,CAG/C,YAAYC,EAA8C,CAFlD7C,EAAA,qBAA8C,CAAA,GAGhD6C,GAAe,KAAK,iBAAiBA,CAAa,CACxD,CAEA,iBAAiBA,EAA6C,CAC5D,KAAK,cAAgBA,EACrB,KAAK,8BAA8B,CACrC,CAEA,MAAoB,CAClB,KAAK,8BAA8B,EAE7B,MAAAC,EAAc,KAAK,SACzB,IAAIC,EAAwB,EAE5B,SAAW,CAACC,EAAQC,CAAW,IAAK,KAAK,cAGvC,GAFAF,GAAyBE,EAAc,IAEnCH,GAAeC,EACV,OAAAC,EAKL,MAAA,IAAI,MAAM,iDAAiD,CACnE,CAEA,EAAE,OAAO,QAAQ,GAAI,CACnB,SAAW,CAACA,CAAM,IAAK,KAAK,cACpB,MAAAA,CAEV,CAEQ,+BAAgC,CAClC,GAAA,KAAK,cAAc,SAAW,EAAS,MAAA,IAAI,MAAM,oCAAoC,EAEzF,MAAME,EAAiB,KAAK,cAAc,OAAO,CAACC,EAAK,CAAG,CAAAC,CAAI,IAAMD,EAAMC,EAAM,CAAC,EACjF,GAAIF,IAAmB,IACrB,MAAM,IAAI,MAAM,8CAA8CA,CAAc,GAAG,CAEnF,CACF,CCvCsB,MAAAG,WAAchE,EAAe,CAOvC,YAAYO,EAAqB/b,EAAkB0b,EAAO,EAAG,CAAC,EAAG,CACzE,MAAMK,EAAU/b,CAAI,EAPZmc,EAAA,gBAAqB,GACrBA,EAAA,gBAAW,GACXA,EAAA,cACAA,EAAA,aAAgB,GACPA,EAAA,eAKZ,KAAA,OAAS,IAAI4C,GAAuB,CACvC,CAACF,GAAU,OAAQ,EAAE,EACrB,CAACA,GAAU,KAAM,EAAE,CAAA,CACpB,EACD,KAAK,KAAO,EACZ,KAAK,MAAQ,EACb,KAAK,aAAa,EAAI,EACjB,KAAA,SAAW,KAAK,OAAO,KAAK,EACjC,KAAK,MAAQP,GAAU,EAAGF,GAAO,MAAM,EACvC,KAAK,MAAQ,KAAK,eAAe,KAAK,KAAK,EAC3C,KAAK,MAAQ,KAAK,gBAAgB,KAAK,KAAK,EAC5C,KAAK,UAAY,KAAK,MAAM,KAAK,QAAQ,EACzC,KAAK,SAAW1C,EAAO,IAAK,GAAG,CACjC,CAEA,IAAI,OAAgB,CAClB,OAAO,KAAK,QACd,CAEA,aAAc,CACZ,OAAO,KAAK,QACd,CAEA,YAAY+D,EAAoB,CAC9B,KAAK,SAAWA,CAClB,CAEA,kBAAyB,CACvB,KAAK,UAAY,KAAK,MAAM,EAAE,KAAK,QAAQ,EAC3C,KAAK,MAAQC,EAAO,IAAM,EAAG,CAC/B,CAEA,kBAA4B,CACnB,OAAA,KAAK,UAAY,KAAK,QAC/B,CAEU,gBAAgBC,EAAe,CACvC,OAAOvB,GAAOuB,CAAK,CACrB,CAEU,eAAeA,EAAiC,CACxD,OAAO1B,GAAM0B,CAAK,CACpB,CACF,CCxDO,MAAMC,WAAyBJ,EAAM,CAC1C,YAAYzD,EAAqB/b,EAAkB0b,EAAO,EAAG,CAAC,EAAG,CAC/D,MAAMK,EAAU/b,CAAI,EAGpB,KAAK,SAAW,GACX,KAAA,MAAQ,KAAK,eAAe,CAAC,EAClC,KAAK,MAAQme,GACb,KAAK,UAAYD,EACnB,CAES,YAAYuB,EAAkB,CAAC,CAExC,IAAa,OAAgB,CACpB,MAAA,EACT,CAES,kBAAmB,CAC1B,KAAK,MAAQC,EAAO,KAAO,GAAI,EAC1B,KAAA,UACP,CACF,CCtBO,MAAMG,WAAuBL,EAAM,CACxC,YAAYzD,EAAqB/b,EAAkB0b,EAAO,EAAG,CAAC,EAAG,CAC/D,MAAMK,EAAU/b,CAAI,CACtB,CACF,CCMO,MAAM8f,EAAa,CAMxB,YAAYzC,EAAY,CALPlB,EAAA,aACAA,EAAA,eACTA,EAAA,aAAQ,GACRA,EAAA,qBAGN,KAAK,KAAOkB,EACZ,KAAK,OAASsB,GAAO,OAAO,CAACW,EAAKS,IACzB,CACL,GAAGT,EACH,CACE,IAAAS,EACA,OAAQA,EAAI,OAAO,CAACT,EAAKU,IAErBV,EACAU,EAAI,OAAO,CAACV,EAAKW,IACRX,GAAOW,IAAU,EAAI,EAAI,GAC/B,CAAC,EAEL,CAAC,CACN,CAAA,EAED,CAAiB,CAAA,EACpB,KAAK,aAAe,KAAK,OAAO,KAAK,KAAK,CAC5C,CAEA,eAAgB,CACV,KAAK,KAAK,QACR,IAAAC,GAAc,EAAA,SAChB,SAAS,OAAO,KAAK,MAAQ,CAAC,EAAE,SAAS,EAAG,GAAG,CAAC,GAChDtd,EAAU,IAAI8Y,EAAO,EAAG,CAAC,CAAC,EAC1B,GACA,EAAA,CAGN,CAEA,sBAAuB,EACjB,KAAK,KAAK,QAAU,KAAK,KAAK,OAChC,IAAIwE,GAAE,EAAY,SAAS,iBAAkB1C,EAAY,IAAI9B,EAAO,EAAG,EAAE,CAAC,EAAG,GAAK,EAAI,CAE1F,CAEA,kBAAmB,CACb,KAAK,KAAK,MACZ,IAAIwE,GAAE,EAAY,SAAS,YAAatd,EAAU,IAAI8Y,EAAO,EAAG,CAAC,CAAC,EAAG,GAAK,EAAI,CAElF,CAEA,iBAAkB,CAChB,MAAMyE,EAAgB,CACpB,UAAU,OAAO,KAAK,KAAK,MAAM,QAAS,CAAA,EAAE,SAAS,EAAG,GAAG,CAAC,GAC5D,UAAU,OAAO,KAAK,KAAK,MAAM,SAAU,CAAA,EAAE,SAAS,EAAG,GAAG,CAAC,GAC7D,cAAc,OAAO,KAAK,KAAK,QAAQ,EAAE,SAAS,EAAG,GAAG,CAAC,GACzD,SAAS,KAAK,KAAK,YAAY,QAAQ,WAAW,GAClD,eAAe,OAAO,KAAK,KAAK,MAAM,aAAc,CAAA,EAAE,SAAS,EAAG,GAAG,CAAC,EAAA,EAExE,IAAID,GAAY,EAAE,SAASC,EAAc,KAAK,KAAK,EAAGzE,EAAOM,EAAU,EAAI,GAAKA,EAAU,EAAI,EAAG,EAAG,IAAM,EAAI,CAChH,CAEA,QAAQoE,EAAe,CACrB,KAAK,MAAQA,EACb,KAAK,aAAe,KAAK,OAAO,KAAK,KAAK,EAC1C,KAAK,QAAQ,CACf,CAEA,cAAe,CACR,KAAA,MAAQ,KAAK,IAAI,KAAK,MAAQ,EAAG,KAAK,OAAO,OAAS,CAAC,EAC5D,KAAK,aAAe,KAAK,OAAO,KAAK,KAAK,EAC1C,KAAK,QAAQ,CACf,CAEA,SAAU,CACR,KAAK,MAAM,EACX,KAAK,eAAe,CACtB,CAEA,OAAQ,CACN,KAAK,KAAK,OAAS,EACrB,CAEA,QAAS,CACP,KAAK,KAAK,OAAS,EACrB,CAEA,OAAQ,CACD,KAAA,KAAK,MAAM,QAChB,KAAK,KAAK,OAAO,QAASH,GAAUA,EAAM,SAAS,EAC9C,KAAA,KAAK,OAAO,OAAS,EACrB,KAAA,KAAK,MAAM,UACX,KAAA,KAAK,MAAM,QACX,KAAA,KAAK,UAAU,OAAO,CAAC,EACvB,KAAA,KAAK,UAAYI,EACjB,KAAA,KAAK,YAAY,aACxB,CAEA,gBAAiB,CACf,OAAO,KAAK,aAAa,SAAW,KAAK,KAAK,UAAU,UAC1D,CAEQ,gBAAiB,SACvB,GAAI,KAAK,eAAiB,KAAM,OAEhC,MAAMC,EAAU,EACVC,EAAU,GACVC,EAAa,EACbC,EAAc,EACT,SAAA,CAAC5b,EAAGmb,CAAG,IAAKU,GAAA/C,EAAA,KAAK,eAAL,YAAAA,EAAmB,MAAnB,YAAA+C,EAAwB,UAC7C,SAAW,CAAC9b,EAAGqR,CAAI,IAAK+J,EAAI,UAAW,CACrC,GAAI/J,IAAS4I,GAAU,MAAO,SACxB,MAAA9C,EAAWL,EAAO9W,EAAI4b,EAAaF,EAASzb,EAAI4b,EAAcF,CAAO,EACvEtK,IAAS4I,GAAU,aAAa,KAAK,KAAK,OAAO,KAAK,IAAIe,GAAiB7D,CAAQ,CAAC,EACpF,CAAC8C,GAAU,OAAQA,GAAU,IAAI,EAAE,SAAS5I,CAAI,GAClD,KAAK,KAAK,OAAO,KAAK,IAAI4J,GAAe9D,CAAQ,CAAC,CAEtD,CAEJ,CACF,CCpIO,MAAM4E,EAAQ,CAGnB,YACmBzE,EACE0E,EAAc,EACdC,EAAc,EACjC,CANQ1E,EAAA,cAGS,KAAA,aAAAD,EACE,KAAA,IAAA0E,EACA,KAAA,IAAAC,EAEd,KAAA,MAAQ,KAAK,MAAM3E,CAAY,CACtC,CAEA,WAAY,CACV,KAAK,MAAQ,KAAK,MAAM,EAAE,KAAK,KAAK,CACtC,CAEA,WAAY,CACV,KAAK,MAAQ,KAAK,MAAM,EAAE,KAAK,KAAK,CACtC,CAEA,SAAU,CACR,KAAK,MAAQ,KAAK,YACpB,CAEA,IAAIE,EAAe,CACjB,KAAK,OAASA,EACd,KAAK,MAAQ,KAAK,MAAM,KAAK,KAAK,CACpC,CAEA,IAAIA,EAAe,CACjB,KAAK,OAASA,EACd,KAAK,MAAQ,KAAK,MAAM,KAAK,KAAK,CACpC,CAEA,UAAW,CACT,OAAO,KAAK,KACd,CAEA,UAAW,CACT,OAAO,KAAK,MAAQ,CACtB,CAEA,QAAS,CACP,KAAK,MAAQ,KAAK,GACpB,CAEA,QAAS,CACP,KAAK,MAAQ,KAAK,GACpB,CAEA,OAAOA,EAAe,CACf,KAAA,MAAQ,KAAK,MAAMA,CAAK,CAC/B,CAEQ,MAAMA,EAAe,CACpB,OAAA,KAAK,IAAI,KAAK,IAAIA,EAAO,KAAK,GAAG,EAAG,KAAK,GAAG,CACrD,CACF,CCtDO,MAAM0E,WAAcH,EAAQ,CACjC,QAAS,CACA,MAAA,CAAC,KAAK,UACf,CACF,CCGO,MAAMI,EAAwB,CAKnC,aAAc,CAJN5E,EAAA,aACAA,EAAA,aACAA,EAAA,eAGN,KAAK,KAAO,KACZ,KAAK,KAAO,KACZ,KAAK,OAAS,CAChB,CAEA,IAAIC,EAAU,CACZ,MAAM4E,EAAO,CAAE,MAAA5E,EAAO,KAAM,IAAK,EAC7B,GAAA,KAAK,OAAS,KAAM,CACtB,KAAK,KAAO4E,EACZ,KAAK,KAAOA,EACP,KAAA,SACL,MACF,CACI,KAAK,OAAS,OAAM,KAAK,KAAOA,GACpC,KAAK,KAAK,KAAOA,EACjB,KAAK,KAAOA,EACP,KAAA,QACP,CAEA,OAAO5E,EAAU,CACf,GAAI,KAAK,OAAS,KAAM,OACpB,GAAA,KAAK,KAAK,QAAUA,EAAO,CACxB,KAAA,KAAO,KAAK,KAAK,KACjB,KAAA,SACL,MACF,CACA,IAAI6E,EAAU,KAAK,KACZ,KAAAA,EAAQ,OAAS,MAAM,CACxB,GAAAA,EAAQ,KAAK,QAAU7E,EAAO,CACxB6E,EAAA,KAAOA,EAAQ,KAAK,KACvB,KAAA,SACL,MACF,CACAA,EAAUA,EAAQ,IACpB,CACF,CAEA,IAAI7E,EAAU,CACZ,GAAI,KAAK,OAAS,KAAa,MAAA,GAC/B,IAAI6E,EAAU,KAAK,KACnB,KAAOA,IAAY,MAAM,CACvB,GAAIA,EAAQ,QAAU7E,EAAc,MAAA,GACpC6E,EAAUA,EAAQ,IACpB,CACO,MAAA,EACT,CAEA,EAAE,OAAO,QAAQ,GAAI,CACnB,GAAI,KAAK,OAAS,KAAM,OACxB,IAAIA,EAAU,KAAK,KACnB,KAAOA,IAAY,MACjB,MAAMA,EAAQ,MACdA,EAAUA,EAAQ,IAEtB,CAEA,SAAU,CACD,MAAA,CAAC,GAAG,IAAI,CACjB,CAEA,WAAY,CACV,OAAO,KAAK,MACd,CAEA,SAAU,CACR,OAAO,KAAK,SAAW,CACzB,CAEA,MAAO,OACL,OAAOtD,EAAA,KAAK,OAAL,YAAAA,EAAW,KACpB,CAEA,OAAQ,CACN,KAAK,KAAO,KACZ,KAAK,KAAO,KACZ,KAAK,OAAS,CAChB,CACF,CC1FO,MAAMuD,GAAY,CACvB,YAAa,CAACnF,EAAmB7b,IAC/B,IAAIyS,GACFoJ,EACA,EACA,EACA,GACA,IACA,KACA,GACA9b,EAAK,EAAG,CAAC,EACTC,EACAA,EACAA,EAAM,MAAM,EAAG,CAAC,EAChBA,EAAM,MAAM,EAAG,CAAC,EAChB,GACA,GACA,IACA,GACA,IACA,IACA,EACA,EACA,KACA,GACA,EACA,GACA,GACA,EACF,EACF,SAAU,CAAC6b,EAAmB7b,IAC5B,IAAIyS,GACFoJ,EACA,EACA,EACA,GACA,GACA,IACA,EACA9b,EAAK,GAAI,EAAE,EACXC,EACAA,EACAA,EAAM,MAAM,EAAG,CAAC,EAChBA,EAAM,MAAM,EAAG,CAAC,EAChB,GACA,GACA,IACA,IACA,IACA,IACA,EACA,EACA,EACA,GACA,IACA,GACA,GACA,EACF,CACJ,EC1DO,MAAMihB,WAAiBR,EAAQ,CACpC,YAAYzE,EAAsB,CAChC,MAAMA,CAAY,CACpB,CAEA,OAAO,SAASE,EAAe,CAC7B,OAAIA,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAClDS,IAAU,EAAU,IAAIT,EAAQ,EAAE,OAAO,SAAS,EAE/C,IAAIA,EAAQ,EAAE,OAAO,SAAS,CACvC,CAEA,UAAW,CACF,OAAAwF,GAAS,SAAS,KAAK,KAAK,CACrC,CACF,CCjBa,MAAAC,WAAa5F,EAAe,CAGvC,YAAYO,EAAqB0D,EAAW,EAAG,CAC7C,MAAM1D,EAAUL,EAAO,GAAI,CAAC,EAHrBS,EAAA,iBAKF,KAAA,SAAW,IAAIgF,GAAS1B,CAAQ,EACrC,MAAMla,EAAO+Y,GAAU,EAAG,CAAC,IAAM,EAAI,GAAK,EAC1C,KAAK,SAAW5C,EAAO,GAAMnW,EAAM,GAAI,EACvC,KAAK,aAAa,EAAI,EACtB,KAAK,WAAa,CACpB,CAES,kBAAkBuM,EAAiC,CAC1D,MAAMuP,EAAUvP,aAAkB0N,GAC5B8B,EAAWxP,aAAkByJ,GAE/B,OAAA8F,EAAgB,KAAK,qBAAqBvP,CAAM,EAChDwP,EAAiB,KAAK,sBAAsBxP,CAAM,EAE/C,EACT,CAES,QAAS,CAChB,YAAK,cAAgB,KAAK,SAAS,OAAA,EAAW,GACzC,KAAA,MAAQ,KAAK,SAAS,SAAS,EAC7B,MAAM,QACf,CAEQ,qBAAqBmO,EAAc,CACzC,KAAK,SAAS,IAAIA,EAAM,YAAa,CAAA,EAC/B,KAAA,CAAE,MAAA/f,CAAU,EAAA+f,EAad,OAXGxB,GAAA,SAAS,KAAK,KAAK,GAAG,EAC7BwB,EAAM,iBAAiB,EACnBA,EAAM,oBACEiB,GAAA,YAAY,KAAK,IAAKhhB,CAAK,EAC9Bue,GAAA,aAAa,KAAK,KAAK,GAAG,EACzBvB,GAAA,KAAK,iBAAkB+C,CAAK,EACpCA,EAAM,QAAQ,GAEJiB,GAAA,SAAS,KAAK,IAAKhhB,CAAK,EAGhC,MAAK,SAAS,SAAS,CAI7B,CAEQ,sBAAsBqhB,EAAgB,CAC5C,KAAK,SAAS,UAEd,MAAMjS,EAAQ,KAAK,SAAS,OAAA,EAAW,GACvCmP,GAAO,WAAW,KAAK,KAAK,IAAK,EAAGnP,CAAK,EAEzC,MAAMkS,EAAS,KAAK,IAAI,EAAID,EAAO,IAAI,EACvC,KAAK,SAAW,KAAK,SAAS,OAAOC,EAAS,EAAG,EACjD,KAAK,SAAS,EAAIC,EAAM,KAAK,SAAS,EAAG,EAAG,EAEtC,MAAAlO,EAAQmO,EAAM,KAAO,KAAK,SAAS,OAAA,EAAU,EAAG,EACtD,YAAK,SAAW,KAAK,SAAS,YAAY,MAAMnO,CAAK,EAE9C,EACT,CACF,CCpEO,MAAMoO,EAAM,CAMjB,aAAc,CALGxF,EAAA,iBAAY,KACZA,EAAA,cACAA,EAAA,eACTA,EAAA,gBAAmB,GAGpB,KAAA,MAAQ,IAAI4E,GAEZ,KAAA,OAAS,IAAIhC,GAAa,CAC7B,CAAC,IAAM,EAAE,EACT,CAAC,GAAK,EAAE,CAAA,CACT,CACH,CAEA,IAAIxB,EAAY,CACT,KAAA,MAAM,IAAIA,CAAI,CACrB,CAEA,YAAYkC,EAAkB,CAC5B,KAAK,SAAWA,CAClB,CAEA,OAAOlC,EAAY,CACZ,KAAA,MAAM,OAAOA,CAAI,CACxB,CAEA,WAAWxB,EAAWyB,EAAa,CACjC,GAAI,KAAK,MAAM,UAAU,EAAI,KAAK,UAAW,CACrC,MAAA5Y,EAAI,KAAK,OAAO,KAAK,EACrBC,EAAI,KAAK,OAAO,KAAK,EAC3B,KAAK,IAAI,IAAIuc,GAAK1F,EAAOK,EAAS,EAAInX,EAAGmX,EAAS,EAAIlX,CAAC,EAAG,KAAK,QAAQ,CAAC,CAC1E,CACF,CAEA,YAAYkX,EAAWyB,EAAaoE,EAAQ,EAAG,CAC7C,QAAS,EAAI,EAAG,EAAIA,EAAO,IACzB,KAAK,WAAW7F,CAAQ,CAE5B,CAEA,QAAS,CAEP,UAAWwB,KAAQ,KAAK,MAAM,QAAA,EACvB,KAAA,WAAWA,EAAK,GAAG,CAE5B,CAEA,QAAS,CAEP,UAAWA,KAAQ,KAAK,MAAM,QAAA,EACvB,KAAA,YAAYA,EAAK,IAAK,CAAC,CAEhC,CAEA,UAAW,CACF,MAAA,CAAC,KAAK,MAAM,SACrB,CAEA,SAAU,CACD,OAAA,KAAK,MAAM,SACpB,CAEA,QAAS,CACA,OAAA,KAAK,MAAM,MACpB,CAEA,QAAS,CACI,UAAAA,KAAQ,KAAK,MAClBA,EAAK,WAAgB,KAAA,MAAM,OAAOA,CAAI,EAEtCA,EAAK,IAAI,EAAI,IAAIA,EAAK,QAAQ,CAEtC,CAEA,EAAE,OAAO,QAAQ,GAAI,CACR,UAAAA,KAAQ,KAAK,MAChB,MAAAA,CAEV,CAEA,OAAQ,CACN,UAAWA,KAAQ,KAAK,MAAOA,EAAK,QAAQ,EAC5C,KAAK,MAAM,OACb,CACF,CCtFO,MAAesE,EAAK,CAMf,YAA4BxE,EAAY,CAJ/BlB,EAAA,mBAAuC,IAAI4C,IAEpD5C,EAAA,cAA2B,CAAA,GAEC,KAAA,KAAAkB,CAAa,CAInD,QAAS,CAAC,CAEV,WAAY,CACH,OAAA,KAAK,YAAY,MAC1B,CAEA,aAAc,CACP,KAAA,OAAO,QAAQ,YAAY,CAClC,CACF,CCpBA,IAAIyE,GAAS,OAAO,OAAO,CACvB,OAAQ,OAAO,OAAO,CAClB,KAAM,SAAU3a,EAAQ,CACpB,OAAOA,CACV,EACD,GAAI,SAAUA,EAAQ,CAClB,OAAO,KAAK,KAAKA,CAAM,CAC1B,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAO,KAAK,KAAKA,CAAM,CAC1B,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAO,KAAK,KAAKA,CAAM,CAC1B,CACT,CAAK,EACD,UAAW,OAAO,OAAO,CACrB,GAAI,SAAUA,EAAQ,CAClB,OAAOA,EAASA,CACnB,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAOA,GAAU,EAAIA,EACxB,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAKA,GAAU,GAAK,EACT,GAAMA,EAASA,EAEnB,KAAQ,EAAEA,GAAUA,EAAS,GAAK,EAC5C,CACT,CAAK,EACD,MAAO,OAAO,OAAO,CACjB,GAAI,SAAUA,EAAQ,CAClB,OAAOA,EAASA,EAASA,CAC5B,EACD,IAAK,SAAUA,EAAQ,CACnB,MAAO,EAAEA,EAASA,EAASA,EAAS,CACvC,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAKA,GAAU,GAAK,EACT,GAAMA,EAASA,EAASA,EAE5B,KAAQA,GAAU,GAAKA,EAASA,EAAS,EACnD,CACT,CAAK,EACD,QAAS,OAAO,OAAO,CACnB,GAAI,SAAUA,EAAQ,CAClB,OAAOA,EAASA,EAASA,EAASA,CACrC,EACD,IAAK,SAAUA,EAAQ,CACnB,MAAO,IAAI,EAAEA,EAASA,EAASA,EAASA,CAC3C,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAKA,GAAU,GAAK,EACT,GAAMA,EAASA,EAASA,EAASA,EAErC,MAASA,GAAU,GAAKA,EAASA,EAASA,EAAS,EAC7D,CACT,CAAK,EACD,QAAS,OAAO,OAAO,CACnB,GAAI,SAAUA,EAAQ,CAClB,OAAOA,EAASA,EAASA,EAASA,EAASA,CAC9C,EACD,IAAK,SAAUA,EAAQ,CACnB,MAAO,EAAEA,EAASA,EAASA,EAASA,EAASA,EAAS,CACzD,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAKA,GAAU,GAAK,EACT,GAAMA,EAASA,EAASA,EAASA,EAASA,EAE9C,KAAQA,GAAU,GAAKA,EAASA,EAASA,EAASA,EAAS,EACrE,CACT,CAAK,EACD,WAAY,OAAO,OAAO,CACtB,GAAI,SAAUA,EAAQ,CAClB,MAAO,GAAI,KAAK,KAAM,EAAMA,GAAU,KAAK,GAAM,CAAC,CACrD,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAO,KAAK,IAAKA,EAAS,KAAK,GAAM,CAAC,CACzC,EACD,MAAO,SAAUA,EAAQ,CACrB,MAAO,KAAO,EAAI,KAAK,IAAI,KAAK,IAAM,GAAMA,EAAO,EACtD,CACT,CAAK,EACD,YAAa,OAAO,OAAO,CACvB,GAAI,SAAUA,EAAQ,CAClB,OAAOA,IAAW,EAAI,EAAI,KAAK,IAAI,KAAMA,EAAS,CAAC,CACtD,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAOA,IAAW,EAAI,EAAI,EAAI,KAAK,IAAI,EAAG,IAAMA,CAAM,CACzD,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAIA,IAAW,EACJ,EAEPA,IAAW,EACJ,GAENA,GAAU,GAAK,EACT,GAAM,KAAK,IAAI,KAAMA,EAAS,CAAC,EAEnC,IAAO,CAAC,KAAK,IAAI,EAAG,KAAOA,EAAS,EAAE,EAAI,EACpD,CACT,CAAK,EACD,SAAU,OAAO,OAAO,CACpB,GAAI,SAAUA,EAAQ,CAClB,MAAO,GAAI,KAAK,KAAK,EAAIA,EAASA,CAAM,CAC3C,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAO,KAAK,KAAK,GAAI,EAAEA,EAASA,CAAM,CACzC,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAKA,GAAU,GAAK,EACT,KAAQ,KAAK,KAAK,EAAIA,EAASA,CAAM,EAAI,GAE7C,IAAO,KAAK,KAAK,GAAKA,GAAU,GAAKA,CAAM,EAAI,EACzD,CACT,CAAK,EACD,QAAS,OAAO,OAAO,CACnB,GAAI,SAAUA,EAAQ,CAClB,OAAIA,IAAW,EACJ,EAEPA,IAAW,EACJ,EAEJ,CAAC,KAAK,IAAI,EAAG,IAAMA,EAAS,EAAE,EAAI,KAAK,KAAKA,EAAS,KAAO,EAAI,KAAK,EAAE,CACjF,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAIA,IAAW,EACJ,EAEPA,IAAW,EACJ,EAEJ,KAAK,IAAI,EAAG,IAAMA,CAAM,EAAI,KAAK,KAAKA,EAAS,IAAO,EAAI,KAAK,EAAE,EAAI,CAC/E,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAIA,IAAW,EACJ,EAEPA,IAAW,EACJ,GAEXA,GAAU,EACNA,EAAS,EACF,IAAO,KAAK,IAAI,EAAG,IAAMA,EAAS,EAAE,EAAI,KAAK,KAAKA,EAAS,KAAO,EAAI,KAAK,EAAE,EAEjF,GAAM,KAAK,IAAI,EAAG,KAAOA,EAAS,EAAE,EAAI,KAAK,KAAKA,EAAS,KAAO,EAAI,KAAK,EAAE,EAAI,EAC3F,CACT,CAAK,EACD,KAAM,OAAO,OAAO,CAChB,GAAI,SAAUA,EAAQ,CAClB,IAAIR,EAAI,QACR,OAAOQ,IAAW,EAAI,EAAIA,EAASA,IAAWR,EAAI,GAAKQ,EAASR,EACnE,EACD,IAAK,SAAUQ,EAAQ,CACnB,IAAIR,EAAI,QACR,OAAOQ,IAAW,EAAI,EAAI,EAAEA,EAASA,IAAWR,EAAI,GAAKQ,EAASR,GAAK,CAC1E,EACD,MAAO,SAAUQ,EAAQ,CACrB,IAAIR,EAAI,UACR,OAAKQ,GAAU,GAAK,EACT,IAAOA,EAASA,IAAWR,EAAI,GAAKQ,EAASR,IAEjD,KAAQQ,GAAU,GAAKA,IAAWR,EAAI,GAAKQ,EAASR,GAAK,EACnE,CACT,CAAK,EACD,OAAQ,OAAO,OAAO,CAClB,GAAI,SAAUQ,EAAQ,CAClB,MAAO,GAAI2a,GAAO,OAAO,IAAI,EAAI3a,CAAM,CAC1C,EACD,IAAK,SAAUA,EAAQ,CACnB,OAAIA,EAAS,EAAI,KACN,OAASA,EAASA,EAEpBA,EAAS,EAAI,KACX,QAAUA,GAAU,IAAM,MAAQA,EAAS,IAE7CA,EAAS,IAAM,KACb,QAAUA,GAAU,KAAO,MAAQA,EAAS,MAG5C,QAAUA,GAAU,MAAQ,MAAQA,EAAS,OAE3D,EACD,MAAO,SAAUA,EAAQ,CACrB,OAAIA,EAAS,GACF2a,GAAO,OAAO,GAAG3a,EAAS,CAAC,EAAI,GAEnC2a,GAAO,OAAO,IAAI3a,EAAS,EAAI,CAAC,EAAI,GAAM,EACpD,CACT,CAAK,EACD,YAAa,SAAU4a,EAAO,CAC1B,OAAIA,IAAU,SAAUA,EAAQ,GAChCA,EAAQA,EAAQ,OAAO,QAAU,OAAO,QAAUA,EAClDA,EAAQA,EAAQ,IAAQ,IAAQA,EACzB,CACH,GAAI,SAAU5a,EAAQ,CAClB,OAAO,KAAK,IAAIA,EAAQ4a,CAAK,CAChC,EACD,IAAK,SAAU5a,EAAQ,CACnB,MAAO,GAAI,KAAK,IAAK,EAAIA,EAAS4a,CAAK,CAC1C,EACD,MAAO,SAAU5a,EAAQ,CACrB,OAAIA,EAAS,GACF,KAAK,IAAKA,EAAS,EAAI4a,CAAK,EAAI,GAEnC,EAAI,KAAK,IAAK,EAAI5a,EAAS,EAAI4a,CAAK,GAAK,EAAI,EACxD,CACb,CACK,CACL,CAAC,EAEGC,GAAM,UAAY,CAAE,OAAO,YAAY,IAAG,CAAG,EAQ7CC,GAAuB,UAAY,CACnC,SAASA,GAAQ,CACb,KAAK,QAAU,GACf,KAAK,yBAA2B,EACnC,CACD,OAAAA,EAAM,UAAU,OAAS,UAAY,CACjC,IAAIC,EAAQ,KACZ,OAAO,OAAO,KAAK,KAAK,OAAO,EAAE,IAAI,SAAUC,EAAS,CACpD,OAAOD,EAAM,QAAQC,CAAO,CACxC,CAAS,CACT,EACIF,EAAM,UAAU,UAAY,UAAY,CACpC,KAAK,QAAU,EACvB,EACIA,EAAM,UAAU,IAAM,SAAUG,EAAO,CACnC,KAAK,QAAQA,EAAM,MAAO,CAAA,EAAIA,EAC9B,KAAK,yBAAyBA,EAAM,MAAO,CAAA,EAAIA,CACvD,EACIH,EAAM,UAAU,OAAS,SAAUG,EAAO,CACtC,OAAO,KAAK,QAAQA,EAAM,MAAO,CAAA,EACjC,OAAO,KAAK,yBAAyBA,EAAM,MAAO,CAAA,CAC1D,EACIH,EAAM,UAAU,OAAS,SAAU9hB,EAAMkiB,EAAU,CAC3CliB,IAAS,SAAUA,EAAO6hB,GAAK,GAC/BK,IAAa,SAAUA,EAAW,IACtC,IAAIC,EAAW,OAAO,KAAK,KAAK,OAAO,EACvC,GAAIA,EAAS,SAAW,EACpB,MAAO,GAOX,KAAOA,EAAS,OAAS,GAAG,CACxB,KAAK,yBAA2B,GAChC,QAAS7f,EAAI,EAAGA,EAAI6f,EAAS,OAAQ7f,IAAK,CACtC,IAAI2f,EAAQ,KAAK,QAAQE,EAAS7f,CAAC,CAAC,EAChC8f,EAAY,CAACF,EACbD,GAASA,EAAM,OAAOjiB,EAAMoiB,CAAS,IAAM,IAAS,CAACF,GACrD,OAAO,KAAK,QAAQC,EAAS7f,CAAC,CAAC,CAEtC,CACD6f,EAAW,OAAO,KAAK,KAAK,wBAAwB,CACvD,CACD,MAAO,EACf,EACWL,CACX,EAAC,EAKGO,GAAgB,CAChB,OAAQ,SAAU/c,EAAGgd,EAAG,CACpB,IAAIC,EAAIjd,EAAE,OAAS,EACfyB,EAAIwb,EAAID,EACRhgB,EAAI,KAAK,MAAMyE,CAAC,EAChByb,EAAKH,GAAc,MAAM,OAC7B,OAAIC,EAAI,EACGE,EAAGld,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGyB,CAAC,EAEvBub,EAAI,EACGE,EAAGld,EAAEid,CAAC,EAAGjd,EAAEid,EAAI,CAAC,EAAGA,EAAIxb,CAAC,EAE5Byb,EAAGld,EAAEhD,CAAC,EAAGgD,EAAEhD,EAAI,EAAIigB,EAAIA,EAAIjgB,EAAI,CAAC,EAAGyE,EAAIzE,CAAC,CAClD,EACD,OAAQ,SAAUgD,EAAGgd,EAAG,CAKpB,QAJInd,EAAI,EACJsd,EAAInd,EAAE,OAAS,EACfod,EAAK,KAAK,IACVC,EAAKN,GAAc,MAAM,UACpB/f,EAAI,EAAGA,GAAKmgB,EAAGngB,IACpB6C,GAAKud,EAAG,EAAIJ,EAAGG,EAAIngB,CAAC,EAAIogB,EAAGJ,EAAGhgB,CAAC,EAAIgD,EAAEhD,CAAC,EAAIqgB,EAAGF,EAAGngB,CAAC,EAErD,OAAO6C,CACV,EACD,WAAY,SAAUG,EAAGgd,EAAG,CACxB,IAAIC,EAAIjd,EAAE,OAAS,EACfyB,EAAIwb,EAAID,EACRhgB,EAAI,KAAK,MAAMyE,CAAC,EAChByb,EAAKH,GAAc,MAAM,WAC7B,OAAI/c,EAAE,CAAC,IAAMA,EAAEid,CAAC,GACRD,EAAI,IACJhgB,EAAI,KAAK,MAAOyE,EAAIwb,GAAK,EAAID,KAE1BE,EAAGld,GAAGhD,EAAI,EAAIigB,GAAKA,CAAC,EAAGjd,EAAEhD,CAAC,EAAGgD,GAAGhD,EAAI,GAAKigB,CAAC,EAAGjd,GAAGhD,EAAI,GAAKigB,CAAC,EAAGxb,EAAIzE,CAAC,GAGrEggB,EAAI,EACGhd,EAAE,CAAC,GAAKkd,EAAGld,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAG,CAACyB,CAAC,EAAIzB,EAAE,CAAC,GAEnDgd,EAAI,EACGhd,EAAEid,CAAC,GAAKC,EAAGld,EAAEid,CAAC,EAAGjd,EAAEid,CAAC,EAAGjd,EAAEid,EAAI,CAAC,EAAGjd,EAAEid,EAAI,CAAC,EAAGxb,EAAIwb,CAAC,EAAIjd,EAAEid,CAAC,GAE3DC,EAAGld,EAAEhD,EAAIA,EAAI,EAAI,CAAC,EAAGgD,EAAEhD,CAAC,EAAGgD,EAAEid,EAAIjgB,EAAI,EAAIigB,EAAIjgB,EAAI,CAAC,EAAGgD,EAAEid,EAAIjgB,EAAI,EAAIigB,EAAIjgB,EAAI,CAAC,EAAGyE,EAAIzE,CAAC,CAElG,EACD,MAAO,CACH,OAAQ,SAAUsgB,EAAIC,EAAInd,EAAG,CACzB,OAAQmd,EAAKD,GAAMld,EAAIkd,CAC1B,EACD,UAAW,SAAUH,EAAGngB,EAAG,CACvB,IAAIwgB,EAAKT,GAAc,MAAM,UAC7B,OAAOS,EAAGL,CAAC,EAAIK,EAAGxgB,CAAC,EAAIwgB,EAAGL,EAAIngB,CAAC,CAClC,EACD,UAAY,UAAY,CACpB,IAAI4C,EAAI,CAAC,CAAC,EACV,OAAO,SAAUud,EAAG,CAChB,IAAI,EAAI,EACR,GAAIvd,EAAEud,CAAC,EACH,OAAOvd,EAAEud,CAAC,EAEd,QAAS,EAAIA,EAAG,EAAI,EAAG,IACnB,GAAK,EAET,OAAAvd,EAAEud,CAAC,EAAI,EACA,CACvB,CACA,EAAY,EACJ,WAAY,SAAUG,EAAIC,EAAIE,EAAIC,EAAItd,EAAG,CACrC,IAAIud,GAAMF,EAAKH,GAAM,GACjBM,GAAMF,EAAKH,GAAM,GACjBM,EAAKzd,EAAIA,EACT0d,EAAK1d,EAAIyd,EACb,OAAQ,EAAIN,EAAK,EAAIE,EAAKE,EAAKC,GAAME,GAAM,GAAKP,EAAK,EAAIE,EAAK,EAAIE,EAAKC,GAAMC,EAAKF,EAAKvd,EAAImd,CAC9F,CACJ,CACL,EAKIQ,GAA0B,UAAY,CACtC,SAASA,GAAW,CACnB,CACD,OAAAA,EAAS,OAAS,UAAY,CAC1B,OAAOA,EAAS,SACxB,EACIA,EAAS,QAAU,EACZA,CACX,EAAC,EAEGC,GAAY,IAAIxB,GAUhByB,GAAuB,UAAY,CACnC,SAASA,EAAMC,EAASC,EAAQ,CACxBA,IAAW,SAAUA,EAASH,IAClC,KAAK,QAAUE,EACf,KAAK,OAASC,EACd,KAAK,UAAY,GACjB,KAAK,YAAc,EACnB,KAAK,aAAe,GACpB,KAAK,WAAa,GAClB,KAAK,mBAAqB,GAC1B,KAAK,UAAY,IACjB,KAAK,WAAa,GAClB,KAAK,eAAiB,EACtB,KAAK,QAAU,EACf,KAAK,MAAQ,GACb,KAAK,WAAa,GAClB,KAAK,UAAY,GACjB,KAAK,WAAa,EAClB,KAAK,WAAa,EAClB,KAAK,gBAAkB9B,GAAO,OAAO,KACrC,KAAK,uBAAyBU,GAAc,OAE5C,KAAK,eAAiB,GACtB,KAAK,sBAAwB,GAC7B,KAAK,2BAA6B,GAClC,KAAK,IAAMgB,GAAS,SACpB,KAAK,gBAAkB,GACvB,KAAK,oBAAsB,GAC3B,KAAK,SAAW,EACnB,CACD,OAAAE,EAAM,UAAU,MAAQ,UAAY,CAChC,OAAO,KAAK,GACpB,EACIA,EAAM,UAAU,UAAY,UAAY,CACpC,OAAO,KAAK,UACpB,EACIA,EAAM,UAAU,SAAW,UAAY,CACnC,OAAO,KAAK,SACpB,EACIA,EAAM,UAAU,GAAK,SAAUvE,EAAQ0E,EAAU,CAE7C,GADIA,IAAa,SAAUA,EAAW,KAClC,KAAK,WACL,MAAM,IAAI,MAAM,yFAAyF,EAC7G,YAAK,WAAa1E,EAClB,KAAK,oBAAsB,GAC3B,KAAK,UAAY0E,EACV,IACf,EACIH,EAAM,UAAU,SAAW,SAAUG,EAAU,CAC3C,OAAIA,IAAa,SAAUA,EAAW,KACtC,KAAK,UAAYA,EACV,IACf,EACIH,EAAM,UAAU,QAAU,SAAUI,EAAS,CACzC,OAAIA,IAAY,SAAUA,EAAU,IACpC,KAAK,WAAaA,EACX,IACf,EACIJ,EAAM,UAAU,MAAQ,SAAUvjB,EAAM4jB,EAAwB,CAG5D,GAFI5jB,IAAS,SAAUA,EAAO6hB,GAAK,GAC/B+B,IAA2B,SAAUA,EAAyB,IAC9D,KAAK,WACL,OAAO,KAKX,GAFA,KAAK,QAAU,KAAK,OAAO,IAAI,IAAI,EACnC,KAAK,QAAU,KAAK,eAChB,KAAK,UAAW,CAGhB,KAAK,UAAY,GACjB,QAASC,KAAY,KAAK,mBACtB,KAAK,0BAA0BA,CAAQ,EACvC,KAAK,aAAaA,CAAQ,EAAI,KAAK,mBAAmBA,CAAQ,CAErE,CAQD,GAPA,KAAK,WAAa,GAClB,KAAK,UAAY,GACjB,KAAK,sBAAwB,GAC7B,KAAK,2BAA6B,GAClC,KAAK,gBAAkB,GACvB,KAAK,WAAa7jB,EAClB,KAAK,YAAc,KAAK,WACpB,CAAC,KAAK,qBAAuB4jB,EAAwB,CAGrD,GAFA,KAAK,oBAAsB,GAEvB,CAAC,KAAK,WAAY,CAClB,IAAIE,EAAM,CAAA,EACV,QAASC,KAAQ,KAAK,WAClBD,EAAIC,CAAI,EAAI,KAAK,WAAWA,CAAI,EACpC,KAAK,WAAaD,CACrB,CACD,KAAK,iBAAiB,KAAK,QAAS,KAAK,aAAc,KAAK,WAAY,KAAK,mBAAoBF,CAAsB,CAC1H,CACD,OAAO,IACf,EACIL,EAAM,UAAU,uBAAyB,SAAUvjB,EAAM,CACrD,OAAO,KAAK,MAAMA,EAAM,EAAI,CACpC,EACIujB,EAAM,UAAU,iBAAmB,SAAUC,EAASQ,EAAcC,EAAYC,EAAoBN,EAAwB,CACxH,QAASC,KAAYI,EAAY,CAC7B,IAAIE,EAAaX,EAAQK,CAAQ,EAC7BO,EAAoB,MAAM,QAAQD,CAAU,EAC5CE,EAAWD,EAAoB,QAAU,OAAOD,EAChDG,EAAsB,CAACF,GAAqB,MAAM,QAAQH,EAAWJ,CAAQ,CAAC,EAGlF,GAAI,EAAAQ,IAAa,aAAeA,IAAa,YAI7C,IAAIC,EAAqB,CACrB,IAAIC,EAAYN,EAAWJ,CAAQ,EACnC,GAAIU,EAAU,SAAW,EACrB,SAKJ,QADIC,EAAO,CAACL,CAAU,EACb7hB,EAAI,EAAGmE,EAAI8d,EAAU,OAAQjiB,EAAImE,EAAGnE,GAAK,EAAG,CACjD,IAAI2Z,EAAQ,KAAK,qBAAqBkI,EAAYI,EAAUjiB,CAAC,CAAC,EAC9D,GAAI,MAAM2Z,CAAK,EAAG,CACdqI,EAAsB,GACtB,QAAQ,KAAK,6CAA6C,EAC1D,KACH,CACDE,EAAK,KAAKvI,CAAK,CAClB,CACGqI,IAEAL,EAAWJ,CAAQ,EAAIW,EAG9B,CAED,IAAKH,IAAa,UAAYD,IAAsBD,GAAc,CAACG,EAAqB,CACpFN,EAAaH,CAAQ,EAAIO,EAAoB,CAAA,EAAK,CAAA,EAClD,IAAIK,EAAeN,EACnB,QAASJ,KAAQU,EACbT,EAAaH,CAAQ,EAAEE,CAAI,EAAIU,EAAaV,CAAI,EAGpDG,EAAmBL,CAAQ,EAAIO,EAAoB,CAAA,EAAK,CAAA,EACxD,IAAIG,EAAYN,EAAWJ,CAAQ,EAEnC,GAAI,CAAC,KAAK,WAAY,CAClB,IAAIC,EAAM,CAAA,EACV,QAASC,KAAQQ,EACbT,EAAIC,CAAI,EAAIQ,EAAUR,CAAI,EAC9BE,EAAWJ,CAAQ,EAAIU,EAAYT,CACtC,CACD,KAAK,iBAAiBW,EAAcT,EAAaH,CAAQ,EAAGU,EAAWL,EAAmBL,CAAQ,EAAGD,CAAsB,CAC9H,MAGO,OAAOI,EAAaH,CAAQ,EAAM,KAAeD,KACjDI,EAAaH,CAAQ,EAAIM,GAExBC,IAGDJ,EAAaH,CAAQ,GAAK,GAE1BS,EAGAJ,EAAmBL,CAAQ,EAAII,EAAWJ,CAAQ,EAAE,MAAK,EAAG,UAG5DK,EAAmBL,CAAQ,EAAIG,EAAaH,CAAQ,GAAK,EAGpE,CACT,EACIN,EAAM,UAAU,KAAO,UAAY,CAK/B,OAJK,KAAK,kBACN,KAAK,gBAAkB,GACvB,KAAK,kBAAiB,GAErB,KAAK,YAIV,KAAK,QAAU,KAAK,OAAO,OAAO,IAAI,EACtC,KAAK,WAAa,GAClB,KAAK,UAAY,GACb,KAAK,iBACL,KAAK,gBAAgB,KAAK,OAAO,EAE9B,MATI,IAUnB,EACIA,EAAM,UAAU,IAAM,UAAY,CAC9B,YAAK,SAAW,GAChB,KAAK,OAAO,GAAQ,EACb,IACf,EACIA,EAAM,UAAU,MAAQ,SAAUvjB,EAAM,CAEpC,OADIA,IAAS,SAAUA,EAAO6hB,GAAK,GAC/B,KAAK,WAAa,CAAC,KAAK,WACjB,MAEX,KAAK,UAAY,GACjB,KAAK,YAAc7hB,EAEnB,KAAK,QAAU,KAAK,OAAO,OAAO,IAAI,EAC/B,KACf,EACIujB,EAAM,UAAU,OAAS,SAAUvjB,EAAM,CAErC,OADIA,IAAS,SAAUA,EAAO6hB,GAAK,GAC/B,CAAC,KAAK,WAAa,CAAC,KAAK,WAClB,MAEX,KAAK,UAAY,GACjB,KAAK,YAAc7hB,EAAO,KAAK,YAC/B,KAAK,YAAc,EAEnB,KAAK,QAAU,KAAK,OAAO,IAAI,IAAI,EAC5B,KACf,EACIujB,EAAM,UAAU,kBAAoB,UAAY,CAC5C,QAASjhB,EAAI,EAAGoiB,EAAmB,KAAK,eAAe,OAAQpiB,EAAIoiB,EAAkBpiB,IACjF,KAAK,eAAeA,CAAC,EAAE,KAAI,EAE/B,OAAO,IACf,EACIihB,EAAM,UAAU,MAAQ,SAAUoB,EAAO,CACrC,OAAIA,IAAU,SAAUA,EAAQrB,IAChC,KAAK,OAASqB,EACP,IACf,EACIpB,EAAM,UAAU,MAAQ,SAAUvc,EAAQ,CACtC,OAAIA,IAAW,SAAUA,EAAS,GAClC,KAAK,WAAaA,EACX,IACf,EACIuc,EAAM,UAAU,OAAS,SAAUqB,EAAO,CACtC,OAAIA,IAAU,SAAUA,EAAQ,GAChC,KAAK,eAAiBA,EACtB,KAAK,QAAUA,EACR,IACf,EACIrB,EAAM,UAAU,YAAc,SAAUvc,EAAQ,CAC5C,YAAK,iBAAmBA,EACjB,IACf,EACIuc,EAAM,UAAU,KAAO,SAAUsB,EAAM,CACnC,OAAIA,IAAS,SAAUA,EAAO,IAC9B,KAAK,MAAQA,EACN,IACf,EACItB,EAAM,UAAU,OAAS,SAAUuB,EAAgB,CAC/C,OAAIA,IAAmB,SAAUA,EAAiBnD,GAAO,OAAO,MAChE,KAAK,gBAAkBmD,EAChB,IACf,EACIvB,EAAM,UAAU,cAAgB,SAAUwB,EAAuB,CAC7D,OAAIA,IAA0B,SAAUA,EAAwB1C,GAAc,QAC9E,KAAK,uBAAyB0C,EACvB,IACf,EAEIxB,EAAM,UAAU,MAAQ,UAAY,CAEhC,QADIyB,EAAS,CAAA,EACJC,EAAK,EAAGA,EAAK,UAAU,OAAQA,IACpCD,EAAOC,CAAE,EAAI,UAAUA,CAAE,EAE7B,YAAK,eAAiBD,EACf,IACf,EACIzB,EAAM,UAAU,QAAU,SAAUlH,EAAU,CAC1C,YAAK,iBAAmBA,EACjB,IACf,EACIkH,EAAM,UAAU,aAAe,SAAUlH,EAAU,CAC/C,YAAK,sBAAwBA,EACtB,IACf,EACIkH,EAAM,UAAU,SAAW,SAAUlH,EAAU,CAC3C,YAAK,kBAAoBA,EAClB,IACf,EACIkH,EAAM,UAAU,SAAW,SAAUlH,EAAU,CAC3C,YAAK,kBAAoBA,EAClB,IACf,EACIkH,EAAM,UAAU,WAAa,SAAUlH,EAAU,CAC7C,YAAK,oBAAsBA,EACpB,IACf,EACIkH,EAAM,UAAU,OAAS,SAAUlH,EAAU,CACzC,YAAK,gBAAkBA,EAChB,IACf,EAMIkH,EAAM,UAAU,OAAS,SAAUvjB,EAAMoiB,EAAW,CAGhD,GAFIpiB,IAAS,SAAUA,EAAO6hB,GAAK,GAC/BO,IAAc,SAAUA,EAAY,IACpC,KAAK,UACL,MAAO,GACX,IAAIyB,EACAqB,EACAC,EAAU,KAAK,WAAa,KAAK,UACrC,GAAI,CAAC,KAAK,UAAY,CAAC,KAAK,WAAY,CACpC,GAAInlB,EAAOmlB,EACP,MAAO,GACP/C,GACA,KAAK,MAAMpiB,EAAM,EAAI,CAC5B,CAED,GADA,KAAK,SAAW,GACZA,EAAO,KAAK,WACZ,MAAO,GAEP,KAAK,wBAA0B,KAC3B,KAAK,kBACL,KAAK,iBAAiB,KAAK,OAAO,EAEtC,KAAK,sBAAwB,IAE7B,KAAK,6BAA+B,KAChC,KAAK,uBACL,KAAK,sBAAsB,KAAK,OAAO,EAE3C,KAAK,2BAA6B,IAEtCklB,GAAWllB,EAAO,KAAK,YAAc,KAAK,UAC1CklB,EAAU,KAAK,YAAc,GAAKA,EAAU,EAAI,EAAIA,EACpD,IAAIjJ,EAAQ,KAAK,gBAAgBiJ,CAAO,EAMxC,GAJA,KAAK,kBAAkB,KAAK,QAAS,KAAK,aAAc,KAAK,WAAYjJ,CAAK,EAC1E,KAAK,mBACL,KAAK,kBAAkB,KAAK,QAASiJ,CAAO,EAE5CA,IAAY,EACZ,GAAI,KAAK,QAAU,EAAG,CACd,SAAS,KAAK,OAAO,GACrB,KAAK,UAGT,IAAKrB,KAAY,KAAK,mBACd,CAAC,KAAK,OAAS,OAAO,KAAK,WAAWA,CAAQ,GAAM,WACpD,KAAK,mBAAmBA,CAAQ,EAG5B,KAAK,mBAAmBA,CAAQ,EAAI,WAAW,KAAK,WAAWA,CAAQ,CAAC,GAE5E,KAAK,OACL,KAAK,0BAA0BA,CAAQ,EAE3C,KAAK,aAAaA,CAAQ,EAAI,KAAK,mBAAmBA,CAAQ,EAElE,OAAI,KAAK,QACL,KAAK,UAAY,CAAC,KAAK,WAEvB,KAAK,mBAAqB,OAC1B,KAAK,WAAa7jB,EAAO,KAAK,iBAG9B,KAAK,WAAaA,EAAO,KAAK,WAE9B,KAAK,mBACL,KAAK,kBAAkB,KAAK,OAAO,EAEvC,KAAK,2BAA6B,GAC3B,EACV,KACI,CACG,KAAK,qBACL,KAAK,oBAAoB,KAAK,OAAO,EAEzC,QAASsC,EAAI,EAAGoiB,EAAmB,KAAK,eAAe,OAAQpiB,EAAIoiB,EAAkBpiB,IAGjF,KAAK,eAAeA,CAAC,EAAE,MAAM,KAAK,WAAa,KAAK,UAAW,EAAK,EAExE,YAAK,WAAa,GACX,EACV,CAEL,MAAO,EACf,EACIihB,EAAM,UAAU,kBAAoB,SAAUC,EAASQ,EAAcC,EAAYhI,EAAO,CACpF,QAAS4H,KAAYI,EAEjB,GAAID,EAAaH,CAAQ,IAAM,OAG/B,KAAIuB,EAAQpB,EAAaH,CAAQ,GAAK,EAClCwB,EAAMpB,EAAWJ,CAAQ,EACzByB,EAAe,MAAM,QAAQ9B,EAAQK,CAAQ,CAAC,EAC9C0B,EAAa,MAAM,QAAQF,CAAG,EAC9Bf,EAAsB,CAACgB,GAAgBC,EACvCjB,EACAd,EAAQK,CAAQ,EAAI,KAAK,uBAAuBwB,EAAKpJ,CAAK,EAErD,OAAOoJ,GAAQ,UAAYA,EAGhC,KAAK,kBAAkB7B,EAAQK,CAAQ,EAAGuB,EAAOC,EAAKpJ,CAAK,GAI3DoJ,EAAM,KAAK,qBAAqBD,EAAOC,CAAG,EAEtC,OAAOA,GAAQ,WAGf7B,EAAQK,CAAQ,EAAIuB,GAASC,EAAMD,GAASnJ,IAIhE,EACIsH,EAAM,UAAU,qBAAuB,SAAU6B,EAAOC,EAAK,CACzD,OAAI,OAAOA,GAAQ,SACRA,EAEPA,EAAI,OAAO,CAAC,IAAM,KAAOA,EAAI,OAAO,CAAC,IAAM,IACpCD,EAAQ,WAAWC,CAAG,EAE1B,WAAWA,CAAG,CAC7B,EACI9B,EAAM,UAAU,0BAA4B,SAAUM,EAAU,CAC5D,IAAIC,EAAM,KAAK,mBAAmBD,CAAQ,EACtC2B,EAAW,KAAK,WAAW3B,CAAQ,EACnC,OAAO2B,GAAa,SACpB,KAAK,mBAAmB3B,CAAQ,EAAI,KAAK,mBAAmBA,CAAQ,EAAI,WAAW2B,CAAQ,EAG3F,KAAK,mBAAmB3B,CAAQ,EAAI,KAAK,WAAWA,CAAQ,EAEhE,KAAK,WAAWA,CAAQ,EAAIC,CACpC,EACWP,CACX,EAAC,EAmBGkC,EAAQnC,GAKCmC,EAAM,OAAO,KAAKA,CAAK,EACpBA,EAAM,UAAU,KAAKA,CAAK,EAChCA,EAAM,IAAI,KAAKA,CAAK,EACjBA,EAAM,OAAO,KAAKA,CAAK,EACvBA,EAAM,OAAO,KAAKA,CAAK,ECj0B7B,MAAMC,WAAoBhE,EAAK,CAKpC,YAAYxE,EAAY,CACtB,MAAMA,CAAI,EALIlB,EAAA,mBAAc,WACbA,EAAA,eAAU,KACVA,EAAA,cAA6C,IAAI4E,IAKhE,KAAK,YAAY,iBAAiB,CAChC,CAAC5D,EAAU,WAAY,EAAE,EACzB,CAACA,EAAU,cAAe,EAAE,EAC5B,CAACA,EAAU,eAAgB,EAAE,EAC7B,CAACA,EAAU,eAAgB,EAAE,CAAA,CAC9B,CACH,CAEA,OAAc,CACZ,QAAQ,KAAK,wBAAwB,EACrC,KAAK,OAAO,KACV,YAAY,IAAM,CACL,UAAA8C,KAAS,KAAK,KAAK,OAAQ,CACpC,MAAMmC,EAAQ,IAAI0D,GAAY7F,EAAM,GAAG,EACjCmC,EAAA,GAAG,CAAE,EAAGnC,EAAM,IAAI,EAAI,GAAK,GAAG,EACpCmC,EAAM,OAAO2D,GAAa,OAAO,GAAG,EACpC3D,EAAM,MAAM,EACP,KAAA,OAAO,IAAIA,CAAK,CACvB,CAAA,EACC,KAAK,OAAO,CAAA,CAEnB,CAES,QAAS,CACL,UAAAA,KAAS,KAAK,OACvBA,EAAM,OAAO,CAEjB,CACF,CCxCO,MAAM4D,WAAoBnE,EAAK,CAGpC,YAAYxE,EAAY,CACtB,MAAMA,CAAI,EAHIlB,EAAA,mBAAc,UAI9B,CAEA,OAAc,CACZ,QAAQ,KAAK,wBAAwB,EACrC,KAAK,KAAK,OAAO,QAAS8D,GAAU,CAElCA,EAAM,YAAY,CAAC,CAAA,CACpB,CACH,CACF,CCVO,MAAMgG,WAAkBpE,EAAK,CAKlC,YAAYxE,EAAY,CACtB,MAAMA,CAAI,EALIlB,EAAA,mBAAc,SACbA,EAAA,eAAU,KACVA,EAAA,cAA6C,IAAI4E,IAKhE,KAAK,YAAY,iBAAiB,CAChC,CAAC5D,EAAU,YAAa,EAAE,EAC1B,CAACA,EAAU,YAAa,EAAE,EAC1B,CAACA,EAAU,WAAY,EAAE,EACzB,CAACA,EAAU,WAAY,EAAE,EACzB,CAACA,EAAU,UAAW,EAAE,CAAA,CACzB,CACH,CAEA,OAAc,CACZ,QAAQ,KAAK,sBAAsB,EAC9B,KAAA,KAAK,MAAM,YAAY,CAAC,EAE7B,KAAK,OAAO,KACV,YAAY,IAAM,CACL,UAAA8C,KAAS,KAAK,KAAK,OAAQ,CACpC,MAAMmC,EAAQ,IAAI0D,GAAY7F,EAAM,GAAG,EACjCmC,EAAA,GAAG,CAAE,EAAGnC,EAAM,IAAI,EAAI,GAAK,GAAG,EACpCmC,EAAM,OAAO2D,GAAa,OAAO,GAAG,EACpC3D,EAAM,MAAM,EACP,KAAA,OAAO,IAAIA,CAAK,CACvB,CAAA,EACC,KAAK,OAAO,CAAA,CAEnB,CAES,QAAS,CACL,UAAAA,KAAS,KAAK,OACvBA,EAAM,OAAO,CAEjB,CACF,CC1CO,MAAM8D,WAAmBrE,EAAK,CAGnC,YAAYxE,EAAY,CACtB,MAAMA,CAAI,EAHIlB,EAAA,mBAAc,UAK5B,KAAK,YAAY,iBAAiB,CAChC,CAACgB,EAAU,YAAa,CAAC,EACzB,CAACA,EAAU,YAAa,CAAC,EACzB,CAACA,EAAU,WAAY,EAAE,EACzB,CAACA,EAAU,WAAY,EAAE,EACzB,CAACA,EAAU,UAAW,EAAE,EACxB,CAACA,EAAU,cAAe,EAAE,EAC5B,CAACA,EAAU,eAAgB,EAAE,EAC7B,CAACA,EAAU,eAAgB,EAAE,CAAA,CAC9B,CACH,CAEA,OAAc,CACZ,QAAQ,KAAK,uBAAuB,CACtC,CACF,CCjBO,MAAMgJ,EAAY,CAIvB,YAAY9I,EAAY,CAHPlB,EAAA,cACTA,EAAA,oBAGN,KAAK,MAAQ,CACX,CAACxd,GAAS,OAAO,EAAG,IAAIknB,GAAYxI,CAAI,EACxC,CAAC1e,GAAS,OAAO,EAAG,IAAIqnB,GAAY3I,CAAI,EACxC,CAAC1e,GAAS,KAAK,EAAG,IAAIsnB,GAAU5I,CAAI,EACpC,CAAC1e,GAAS,MAAM,EAAG,IAAIunB,GAAW7I,CAAI,CAAA,EAExC,KAAK,YAAc,KAAK,MAAM1e,GAAS,OAAO,CAChD,CAEA,IAAI,SAAU,CACZ,OAAO,KAAK,WACd,CAEA,QAAQG,EAAgB,CACtB,KAAK,YAAY,EACZ,KAAA,YAAc,KAAK,MAAMA,CAAI,EAClC,KAAK,YAAY,OACnB,CAEA,QAAS,CACP,KAAK,YAAY,QACnB,CAEA,YAAa,CACN,KAAA,QAAQH,GAAS,OAAO,CAC/B,CAEA,eAAgB,CACd,OAAO,KAAK,uBAAuBknB,EACrC,CAEA,eAAgB,CACd,OAAO,KAAK,uBAAuBG,EACrC,CAEA,aAAc,CACZ,OAAO,KAAK,uBAAuBC,EACrC,CAEA,cAAe,CACb,OAAO,KAAK,uBAAuBC,EACrC,CAEA,eAAgB,CACP,OAAA,KAAK,YAAY,WAC1B,CAEA,aAAc,CACZ,KAAK,YAAY,aACnB,CACF,CC3CAE,GAAmB9J,GAAM,QAAA,CAAS,EAClCA,GAAM,SAAS,GAAK+J,GAAc,EAAE,EAE7B,MAAMC,EAAK,CAkBhB,aAAc,CAjBPnK,EAAA,cAAwB,MACxBA,EAAA,cACAA,EAAA,cAAkB,CAAA,GAClBA,EAAA,aAAqB,MACrBA,EAAA,YAAgB,IAChBA,EAAA,cAAkB,IAClBA,EAAA,YAAgB,IAChBA,EAAA,iBAAoB,GAEXA,EAAA,iBAAoB,IACpBA,EAAA,cACAA,EAAA,cACAA,EAAA,kBACAA,EAAA,oBACCA,EAAA,qBACAA,EAAA,qBAGf,KAAK,KAAO,KAAK,KAAK,KAAK,IAAI,EAC/B,KAAK,OAAS,KAAK,OAAO,KAAK,IAAI,EACnC,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,EAC3C,KAAK,OAAS,KAAK,OAAO,KAAK,IAAI,EACnC,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,EAC3C,KAAK,iBAAmB,KAAK,iBAAiB,KAAK,IAAI,EACvD,KAAK,iBAAmB,KAAK,iBAAiB,KAAK,IAAI,EAElD,KAAA,MAAQ,IAAIwF,GACZ,KAAA,MAAQ,IAAI1F,GAAM,CAAC,EACxB,KAAK,UAAY,IAAI0E,GAAQ,EAAG,EAAG,GAAG,EACjC,KAAA,MAAQ,IAAIG,GAAM,CAAC,EACnB,KAAA,aAAe,IAAIvC,GAAa,IAAI,EACpC,KAAA,aAAe,IAAIuB,GAAa,IAAI,EACpC,KAAA,YAAc,IAAIqG,GAAY,IAAI,CACzC,CAEA,IAAIrnB,EAAgBynB,EAAe,CAC5B,KAAA,YAAY,QAAQznB,CAAI,EACxB,KAAA,aAAa,QAAQynB,CAAK,EAC7BC,GAAW,KAAK,KAAM,KAAK,OAAQ,KAAK,WAAY,KAAK,OAAQ,KAAK,WAAYnK,EAAO,EACnFa,GAAA,GAAG,iBAAkB,KAAK,gBAAgB,EAC1CA,GAAA,GAAG,iBAAkB,KAAK,gBAAgB,CACpD,CAEQ,MAAO,CACbuJ,GAAqB,IAAIC,EAAU,KAAM,GAAG,CAAC,EAC7CC,GAAe3K,EAAU,MAAM,EAAG,CAAC,EAE9B,KAAA,OAAS,IAAIT,GAAOS,CAAS,EAClC,IAAIF,GAAKJ,EAAO,IAAMM,EAAU,EAAI,EAAG,EAAGN,EAAO,EAAGM,EAAU,CAAC,CAAC,EAChE,IAAIF,GAAKJ,EAAOM,EAAU,EAAI,GAAKA,EAAU,EAAI,EAAG,EAAGN,EAAO,EAAGM,EAAU,CAAC,CAAC,EAC7E,IAAIF,GAAKJ,EAAOM,EAAU,EAAI,GAAKA,EAAU,CAAC,EAAGN,EAAOM,EAAU,EAAI,EAAG,CAAC,CAAC,EAC3E,KAAK,UAAYqE,EACjB,KAAK,aAAa,SACpB,CAEQ,QAAS,CACf,MAAMuG,EAAkBC,GAAkB,CAAC,GAAKC,GAAoB,CAAC,EAQrE,GAPIF,IAEF,KAAK,UAAYvG,EACjB,KAAK,OAAS,GACd,KAAK,KAAO,IAGV,MAAK,MACL,MAAK,OAIT,IAFA,KAAK,MAAM,SAEP,KAAK,MAAM,QAAa,GAAA,CAAC,KAAK,KAAM,CAElC,GADJ,KAAK,MAAM,YACP,KAAK,MAAM,SAEb,YAAK,KAAO,GACL,QAAQ,KAAK,WAAW,EAEjC,KAAK,KAAO,EACd,CAEIuG,GACE,CAAC,KAAK,MAAM,YAAc,KAAK,MAAM,aACvCnI,GAAO,UAAU,OACZ,KAAA,MAAM,WAAWjB,CAAW,EACjC,KAAK,KAAO,IAGlB,CAEQ,YAAa,CACnB,KAAK,YAAY,SACb,KAAK,aAAa,mBACpB,QAAQ,IAAI,QAAQ,EACpB,KAAK,aAAa,QAClB,KAAK,aAAa,eAEtB,CAEQ,QAAS,CAEfuJ,GAAWvJ,EAAa9B,EAAO,IAAK,GAAG,EAAG,IAAIC,IAAU,OAAO,SAAS,CAAC,EACvEoL,GAASvJ,EAAaxB,EAAW,IAAIL,EAAQ,EAAE,OAAO,SAAS,CAAC,CACpE,CAEQ,YAAa,CACnB,KAAK,aAAa,kBAClB,KAAK,aAAa,uBAClB,KAAK,aAAa,mBAClB,KAAK,aAAa,eACpB,CAEQ,iBAAiBqL,EAAkB,CACpC,KAAA,aAAa,QAAQA,CAAK,CACjC,CAEQ,iBAAiB/G,EAAc,CAChC,KAAA,MAAM,IAAIA,EAAM,KAAK,EACtBA,aAAiBJ,IAAgB,KAAK,UAAU,YAEhD,MAAK,YAAY,cAAc,GAE/B,KAAK,MAAM,QAAQ,EAAI,IAAM,GAC/B,KAAK,aAAa,QAAQ,KAAK,YAAY,eAAe,CAE9D,CAEA,IAAW,UAAW,CACpB,MAAMoH,EAAQ,KAAK,MAAM5G,EAAS,KAAK,SAAS,EAChD,OAAO,KAAK,UAAY4G,CAC1B,CACF,CCzJA,MAAMC,GAAS,SAAS,eAAe,OAAO,EACxCC,GAAWD,GAAO,cAAc,QAAQ,EACxC3B,GAAQ2B,GAAO,cAAc,QAAQ,EACrCtI,GAASsI,GAAO,iBAAiB,cAAc,EAC/CE,GAAW,CAAE,IAAKxI,GAAO,CAAC,EAAG,MAAO,CAACA,GAAO,CAAC,EAAE,MAAO,KAAM,CAACuI,GAAS,KAAM,EAElF5B,GAAM,iBAAiB,QAAU8B,GAAU,CACzCA,EAAM,eAAe,EACdH,GAAA,MAAMC,GAAS,KAAK,EAClBC,GAAA,KAAO,CAACD,GAAS,KAC5B,CAAC,EAEDvI,GAAO,QAASwB,GAAU,CAClBA,EAAA,iBAAiB,QAAUiH,GAAU,CAChCD,GAAA,IAAI,UAAU,OAAO,UAAU,EACxCA,GAAS,IAAMhH,EACNgH,GAAA,MAAQ,CAAChH,EAAM,MACfgH,GAAA,IAAI,UAAU,IAAI,UAAU,CAAA,CACtC,CACH,CAAC,ECfDF,GAAO,UAAU,EAEjB,QAAQ,KAAK,uBAAwBnoB,GAAI,cAAe,CAAA,EAExD,MAAMse,GAAO,IAAIiJ,GAEjBY,GAAO,iBAAiB,QAAU,GAAM,CAEjC,CAAC,IAAK,IAAK,GAAG,EAAE,SAASA,GAAO,WAAW,GAAGA,GAAO,UAAU,EAEpE7J,GAAK,IAAI+J,GAAS,KAAMA,GAAS,KAAK,EACtC,QAAQ,IAAIA,EAAQ,CACtB,CAAC","x_google_ignoreList":[2,9,40]}