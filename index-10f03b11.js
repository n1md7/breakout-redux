var Qe=Object.defineProperty;var Je=(e,t,i)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var O=(e,t,i)=>(Je(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();var tt=(e=>(e.development="development",e.production="production",e.githubPages="github",e.crazyGames="crazy",e.itchIo="itch",e.unitTest="test",e.e2eTest="e2e",e))(tt||{});class ti{constructor(t){this.mode=t}isDevelopment(){return this.mode===tt.development}isCrazyGames(){return this.mode===tt.crazyGames}isItchIo(){return this.mode===tt.itchIo}isGithubPages(){return this.mode===tt.githubPages}isUnitTest(){return this.mode===tt.unitTest}isE2ETest(){return this.mode===tt.e2eTest}}const ei=new ti("github"),ii=1,si=.5;let _t=1,Mt=0,Re=27,ht=[],st=0,nt=0,ot=0,bt=0,Kt,St;const w=(...e)=>console.assert(...e),Tt=(e,t=c(),i="#fff",s=0,o=0,n=!1)=>{w(typeof i=="string"),ht.push({pos:e,size:c(t),color:i,time:new Ht(s),angle:o,fill:n})},he=(e,t=0,i="#fff",s=0,o=!1)=>{w(typeof i=="string"),ht.push({pos:e,size:t,color:i,time:new Ht(s),angle:0,fill:o})},ni=(e,t,i,s)=>Tt(e,0,t,i,s),oi=(e,t,i,s=.1,o)=>{const n=c((t.x-e.x)/2,(t.y-e.y)/2),r=c(s,n.length()*2);Tt(e.add(n),r,i,o,n.angle(),1)},de=(e,t,i,s,o)=>{const n=c(j(e.x-t.x/2,i.x-s.x/2),j(e.y-t.y/2,i.y-s.y/2)),r=c(N(e.x+t.x/2,i.x+s.x/2),N(e.y+t.y/2,i.y+s.y/2));Tt(n.lerp(r,.5),r.subtract(n),o)},li=(e,t,i=1,s="#fff",o=0,n=0,r="monospace")=>{w(typeof s=="string"),ht.push({text:e,pos:t,size:i,color:s,time:new Ht(o),angle:n,font:r})},ri=(e,t=ae+".png")=>{St.download="screenshot.png",St.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),St.click()},ai=()=>{document.body.appendChild(St=document.createElement("a")),St.style.display="none"},ci=()=>{J(Re)&&(st=!st),st&&(J(48)&&(_t=!_t),J(49)&&(nt=!nt,ot=0),J(50)&&(ot=!ot,nt=0),J(51)&&(bt=!bt),J(52)&&(Mt=!Mt),J(53)&&(Kt=1))},hi=()=>{if(Ot(M),Kt&&(Ot(M,1),M.drawImage(Y,0,0),Y.width|=0,ri(p),Kt=0),bt&&wi&&navigator.getGamepads){const e=navigator.getGamepads();for(let t=e.length;t--;){const i=e[t];if(i){const n=F,r=$t[t];for(let a=r.length;a--;){const l=n.add(c(a*1*2,t*1*3)),d=l.add(r[a].scale(1));he(l,1,"#fff7",0,1),oi(l,d,"#f00"),ni(d,"#f00")}for(let a=i.buttons.length;a--;){const l=n.add(c(a*.2*2,t*1*3-1-.2)),d=i.buttons[a].pressed;he(l,.2,d?"#f00":"#fff7",0,1),li(a,l,.2)}}}}if(st){const e=M;M=h;let t=1/0,i;for(const s of G){if(s.canvas||s.destroyed||!s.size.x||!s.size.y)continue;const o=$.distanceSquared(s.pos);o<t&&(t=o,i=s);const n=c(N(s.size.x,.2),N(s.size.y,.2)),r=new f(!!s.collideTiles,!!s.collideSolidObjects,!!s.isSolid,s.parent?.2:.5),a=s.parent?new f(1,1,1,.5):new f(0,0,0,.8);it(s.pos,n,r,s.angle,0),it(s.pos,n.scale(.8),a,s.angle,0),s.parent&&pe(s.pos,s.parent.pos,.1,new f(0,0,1,.5),0)}if(i){const s=Bi(i.pos,$);s&&it(s.floor().add(c(.5)),c(1),new f(0,1,1,.3)),it($.floor().add(c(.5)),c(1),new f(0,0,1,.5),0,0),pe($,i.pos,.1,s?new f(1,0,0,.5):new f(0,1,0,.5),0);const o="mouse pos = "+$+`
mouse collision = `+Le($)+`

--- object info ---
`+i.toString();Be(o,oe,24,new f,.05,0,0,"monospace")}Ot(M=e)}{h.lineWidth=2;const e=si*_;ht.forEach(t=>{h.save();const i=ne(t.pos);if(h.translate(i.x|0,i.y|0),h.rotate(t.angle),h.fillStyle=h.strokeStyle=t.color,t.text!=null)h.font=t.size*_+"px "+t.font,h.textAlign="center",h.textBaseline="middle",h.fillText(t.text,0,0);else if(t.size==0||t.size.x===0&&t.size.y===0)h.fillRect(-e/2,-1,e,3),h.fillRect(-1,-e/2,3,e);else if(t.size.x!=null){const s=t.size.x*_|0,o=t.size.y*_|0;t.fill&&h.fillRect(-s/2|0,-o/2|0,s,o),h.strokeRect(-s/2|0,-o/2|0,s,o)}else h.beginPath(),h.arc(0,0,t.size*_,0,9),t.fill&&h.fill(),h.stroke();h.restore()}),ht=ht.filter(t=>t.time<0)}{h.save(),h.fillStyle="#fff",h.textAlign="left",h.textBaseline="top",h.font="28px monospace",h.shadowColor="#000",h.shadowBlur=9;let e=9,t=-20,i=30;if(st){h.fillText(ae,e,t+=i),h.fillText("Objects: "+G.length,e,t+=i),h.fillText("Time: "+di(k),e,t+=i),h.fillText("---------",e,t+=i),h.fillStyle="#f00",h.fillText("ESC: Debug Overlay",e,t+=i),h.fillStyle=nt?"#f00":"#fff",h.fillText("1: Debug Physics",e,t+=i),h.fillStyle=ot?"#f00":"#fff",h.fillText("2: Debug Particles",e,t+=i),h.fillStyle=bt?"#f00":"#fff",h.fillText("3: Debug Gamepads",e,t+=i),h.fillStyle=Mt?"#f00":"#fff",h.fillText("4: God Mode",e,t+=i),h.fillStyle="#fff",h.fillText("5: Save Screenshot",e,t+=i);let s="";for(const n in E[0])n&&vt(n,0)&&(s+=n+" ");s&&h.fillText("Keys Down: "+s,e,t+=i);let o="";if(E[1])for(const n in E[1])n&&vt(n,1)&&(o+=n+" ");o&&h.fillText("Gamepad: "+o,e,t+=i)}else h.fillText(nt?"Debug Physics":"",e,t+=i),h.fillText(ot?"Debug Particles":"",e,t+=i),h.fillText(Mt?"God Mode":"",e,t+=i),h.fillText(bt?"Debug Gamepads":"",e,t+=i);h.restore()}},kt=Math.PI,L=e=>e<0?-e:e,j=(e,t)=>e<t?e:t,N=(e,t)=>e>t?e:t,dt=e=>e<0?-1:1,T=(e,t=0,i=1)=>e<t?t:e>i?i:e,ut=(e,t=0,i=1)=>i-t?T((e-t)/(i-t)):0,yt=(e,t=0,i=1)=>t+T(e)*(i-t),ue=(e,t,i,s)=>L(e.x-i.x)*2<t.x+s.x&&L(e.y-i.y)*2<t.y+s.y,di=e=>(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0),v=(e=1,t=0)=>t+(e-t)*Math.random(),Ft=(e=1,t=0)=>v(e,t)|0,ui=()=>Ft(2)*2-1,fi=(e=1,t=0)=>e>0?ze(e*v(t/e,1)**.5):new b,ze=(e=1)=>new b().setAngle(v(2*kt),e),fe=(e=new f,t=new f(0,0,0,1),i)=>i?e.lerp(t,v()):new f(v(e.r,t.r),v(e.g,t.g),v(e.b,t.b),v(e.a,t.a)),c=(e=0,t)=>e.x==null?new b(e,t??e):new b(e.x,e.y),U=e=>!isNaN(e.x)&&!isNaN(e.y);class b{constructor(t=0,i=0){this.x=t,this.y=i}copy(){return new b(this.x,this.y)}add(t){return w(U(t)),new b(this.x+t.x,this.y+t.y)}subtract(t){return w(U(t)),new b(this.x-t.x,this.y-t.y)}multiply(t){return w(U(t)),new b(this.x*t.x,this.y*t.y)}divide(t){return w(U(t)),new b(this.x/t.x,this.y/t.y)}scale(t){return w(!U(t)),new b(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const i=this.length();return i?this.scale(t/i):new b(0,t)}clampLength(t=1){const i=this.length();return i>t?this.scale(t/i):this}dot(t){return w(U(t)),this.x*t.x+this.y*t.y}cross(t){return w(U(t)),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,i=1){return this.x=i*Math.sin(t),this.y=i*Math.cos(t),this}rotate(t){const i=Math.cos(t),s=Math.sin(t);return new b(this.x*i-this.y*s,this.x*s+this.y*i)}direction(){return L(this.x)>L(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new b(this.y,-this.x)}floor(){return new b(Math.floor(this.x),Math.floor(this.y))}area(){return L(this.x*this.y)}lerp(t,i){return w(U(t)),this.add(t.subtract(this).scale(T(i)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class f{constructor(t=1,i=1,s=1,o=1){this.r=t,this.g=i,this.b=s,this.a=o}copy(){return new f(this.r,this.g,this.b,this.a)}add(t){return new f(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new f(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new f(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new f(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,i=t){return new f(this.r*t,this.g*t,this.b*t,this.a*i)}clamp(){return new f(T(this.r),T(this.g),T(this.b),T(this.a))}lerp(t,i){return this.add(t.subtract(this).scale(T(i)))}setHSLA(t=0,i=0,s=1,o=1){const n=s<.5?s*(1+i):s+i-s*i,r=2*s-n,a=(l,d,u)=>(u=(u%1+1)%1)<1/6?l+(d-l)*6*u:u<1/2?d:u<2/3?l+(d-l)*(2/3-u)*6:l;return this.r=a(r,n,t+1/3),this.g=a(r,n,t),this.b=a(r,n,t-1/3),this.a=o,this}getHSLA(){const t=T(this.r),i=T(this.g),s=T(this.b),o=T(this.a),n=Math.max(t,i,s),r=Math.min(t,i,s),a=(n+r)/2;let l=0,d=0;if(n!=r){let u=n-r;d=a>.5?u/(2-n-r):u/(n+r),t==n?l=(i-s)/u+(i<s?6:0):i==n?l=(s-t)/u+2:s==n&&(l=(t-i)/u+4)}return[l/6,d,a,o]}mutate(t=.05,i=0){return new f(this.r+v(t,-t),this.g+v(t,-t),this.b+v(t,-t),this.a+v(i,-i)).clamp()}toString(t=1){const i=s=>((s=s*255|0)<16?"0":"")+s.toString(16);return"#"+i(this.r)+i(this.g)+i(this.b)+(t?i(this.a):"")}setHex(t){const i=s=>T(parseInt(t.slice(s,s+2),16)/255);return this.r=i(1),this.g=i(3),this.b=i(5),this.a=t.length>7?i(7):1,this}rgbaInt(){const t=r=>T(r)*255|0,i=t(this.r),s=t(this.g)<<8,o=t(this.b)<<16,n=t(this.a)<<24;return i+s+o+n}}class Ht{constructor(t){this.time=t==null?void 0:k+t,this.setTime=t}set(t=0){this.time=k+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return k<=this.time}elapsed(){return k>this.time}get(){return this.isSet()?k-this.time:0}getPercent(){return this.isSet()?ut(this.time-k,this.setTime,0):0}toString(){return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}valueOf(){return this.get()}}let F=c(),_=32,ge=c(1920,1200),It=c(),gi=1,yi="arial",Ae=1,Gt=c(16),mt=.3,mi=1,pi=1,xi=1,bi=0,Si=.8,Et=1,Pt=0,ye=1,wi=1,Ie=.5,vi=40,Ti=.7,me=5,Rt=.5;c(640,80);class ft{constructor(t=c(),i=c(1),s=-1,o=Gt,n=0,r,a=0){w(U(t)&&U(i)),this.pos=t.copy(),this.size=i,this.drawSize,this.tileIndex=s,this.tileSize=o,this.angle=n,this.color=r,this.additiveColor,this.mass=mi,this.damping=pi,this.angleDamping=xi,this.elasticity=bi,this.friction=Si,this.gravityScale=1,this.renderOrder=a,this.velocity=new b,this.angleVelocity=0,this.spawnTime=k,this.children=[],this.collideTiles=1,G.push(this)}update(){const t=this.parent;if(t){this.pos=this.localPos.multiply(c(t.getMirrorSign(),1)).rotate(-t.angle).add(t.pos),this.angle=t.getMirrorSign()*this.localAngle+t.angle;return}this.velocity.x=T(this.velocity.x,-Et,Et),this.velocity.y=T(this.velocity.y,-Et,Et);const i=this.pos.copy();if(this.velocity.y+=Pt*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,w(this.angleDamping>=0&&this.angleDamping<=1),w(this.damping>=0&&this.damping<=1),!this.mass)return;const s=this.velocity.y<0;if(this.groundObject){const o=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=o+(this.velocity.x-o)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const n of Ze){if(!this.isSolid&!n.isSolid||n.destroyed||n.parent||n==this||!ue(this.pos,this.size,n.pos,n.size)||!this.collideWithObject(n)|!n.collideWithObject(this))continue;if(ue(i,this.size,n.pos,n.size)){const g=i.subtract(n.pos),m=g.length(),S=.001,x=m<.01?ze(S):g.scale(S/m);this.velocity=this.velocity.add(x),n.mass&&(n.velocity=n.velocity.subtract(x)),st&&nt&&de(this.pos,this.size,n.pos,n.size,"#f00");continue}const r=this.size.add(n.size),a=(i.y-n.pos.y)*2>r.y+Pt,l=L(i.y-n.pos.y)*2<r.y,d=L(i.x-n.pos.x)*2<r.x,u=N(this.elasticity,n.elasticity);if(a|d|!l){if(this.pos.y=n.pos.y+(r.y/2+.001)*dt(i.y-n.pos.y),n.groundObject&&s||!n.mass)s&&(this.groundObject=n),this.velocity.y*=-u;else if(n.mass){const g=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),m=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),S=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=yt(u,g,m),n.velocity.y=yt(u,g,S)}}if(!a&l)if(this.pos.x=n.pos.x+(r.x/2+.001)*dt(i.x-n.pos.x),n.mass){const g=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),m=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),S=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=yt(u,g,m),n.velocity.x=yt(u,g,S)}else this.velocity.x*=-u;st&&nt&&de(this.pos,this.size,n.pos,n.size,"#f0f")}if(this.collideTiles&&zt(this.pos,this.size,this)&&!zt(i,this.size,this)){const o=zt(new b(i.x,this.pos.y),this.size,this),n=zt(new b(this.pos.x,i.y),this.size,this);if(o|!n){this.groundObject=s,this.velocity.y*=-this.elasticity;const r=(i.y-this.size.y/2|0)-(i.y-this.size.y/2);r<0&&r>this.damping*this.velocity.y+Pt*this.gravityScale&&(this.velocity.y=this.damping?(r-Pt*this.gravityScale)/this.damping:0),this.pos.y=i.y}n&&(this.pos.x=i.x,this.velocity.x*=-this.elasticity)}}render(){Lt(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}collideWithTile(t,i){return t>0}collideWithTileRaycast(t,i){return t>0}collideWithObject(t){return 1}getAliveTime(){return k-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,i=c(),s=0){w(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this,t.localPos=i.copy(),t.localAngle=s}removeChild(t){w(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=1,i=1,s=1){w(t||!i),this.collideSolidObjects=t,this.isSolid=i,this.collideTiles=s}toString(){{let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+=`
pos = `+this.pos),(this.velocity.x||this.velocity.y)&&(t+=`
velocity = `+this.velocity),(this.size.x||this.size.y)&&(t+=`
size = `+this.size),this.angle&&(t+=`
angle = `+this.angle.toFixed(3)),this.color&&(t+=`
color = `+this.color),t}}}let p,M,Y,h,Z=c();const H=new Image;let pt,xt,Vt;const Di=e=>(w(Z.x&&Z.y,"mainCanvasSize is invalid"),e.add(c(.5)).subtract(Z.scale(.5)).multiply(c(1/_,-1/_)).add(F)),ne=e=>(w(Z.x&&Z.y,"mainCanvasSize is invalid"),e.subtract(F).multiply(c(_,-_)).add(Z.scale(.5)).subtract(c(.5)));function Lt(e,t=c(1),i=-1,s=Gt,o=new f,n=0,r,a=new f(0,0,0,0),l=Ae){if(_t&&++Vt,l)if(i<0||!H.width)we(e.x,e.y,t.x,t.y,n,0,0,0,0,0,o.rgbaInt());else{const d=pt.x/s.x|0,u=s.x/pt.x,g=s.y/pt.y,m=i%d*u,S=(i/d|0)*g;we(e.x,e.y,r?-t.x:t.x,t.y,n,m+xt.x,S+xt.y,m-xt.x+u,S-xt.y+g,o.rgbaInt(),a.rgbaInt())}else Ci(e,t,n,r,d=>{if(i<0)d.fillStyle=o,d.fillRect(-.5,-.5,1,1);else{const u=pt.x/s.x|0,g=i%u*s.x+mt,m=(i/u|0)*s.y+mt,S=s.x-2*mt,x=s.y-2*mt;d.globalAlpha=o.a,d.drawImage(H,g,m,S,x,-.5,-.5,1,1)}})}function it(e,t,i,s,o){Lt(e,t,-1,Gt,i,s,0,0,o)}function pe(e,t,i=.1,s,o){const n=c((t.x-e.x)/2,(t.y-e.y)/2),r=c(i,n.length()*2);it(e.add(n),r,s,n.angle(),o)}function Ci(e,t,i,s,o,n=M){e=ne(e),t=t.scale(_),n.save(),n.translate(e.x+.5|0,e.y+.5|0),n.rotate(i),n.scale(s?-t.x:t.x,t.y),o(n),n.restore()}function xe(e,t=Ae){t?Ge(e):M.globalCompositeOperation=e?"lighter":"source-over"}function Be(e,t,i=1,s=new f,o=0,n=new f(0,0,0),r="center",a=yi,l=h){l.fillStyle=s,l.lineWidth=o,l.strokeStyle=n,l.textAlign=r,l.font=i+"px "+a,l.textBaseline="middle",l.lineJoin="round",t=t.copy(),(e+"").split(`
`).forEach(d=>{o&&l.strokeText(d,t.x,t.y),l.fillText(d,t.x,t.y),t.y+=i})}const vt=(e,t=0)=>E[t]&&E[t][e]&1,J=(e,t=0)=>E[t]&&E[t][e]&2?1:0,Ei=()=>E=[[]];let $=c(),oe=c(),le=0;const at=(e,t=0)=>vt(e,t+1);let E=[[]];function Pi(){_e||document.hasFocus()||Ei(),$=Di(oe),Ai()}function Ri(){for(const e of E)for(const t in e)e[t]&=1}onkeydown=e=>{e.target==document.body&&(e.repeat||(E[le=0][Oe(e.which)]=3))};onkeyup=e=>{e.target==document.body&&(E[0][Oe(e.which)]=4)};const Oe=e=>e==87?38:e==83?40:e==65?37:e==68?39:e;onmousedown=e=>{E[le=0][e.button]=3,onmousemove(e),e.button&&e.preventDefault()};onmouseup=e=>E[0][e.button]=E[0][e.button]&2|4;onmousemove=e=>oe=zi(e);onwheel=e=>e.ctrlKey||dt(e.deltaY);oncontextmenu=e=>!1;const zi=e=>{if(!p)return c();const t=p.getBoundingClientRect();return c(p.width,p.height).multiply(c(ut(e.x,t.left,t.right),ut(e.y,t.top,t.bottom)))},$t=[];function Ai(){if(!navigator||!navigator.getGamepads||!document.hasFocus()&&!ii)return;const e=navigator.getGamepads();for(let t=e.length;t--;){const i=e[t],s=E[t+1]||(E[t+1]=[]),o=$t[t]||($t[t]=[]);if(i){const a=l=>l>.3?ut(l,.3,.8):l<-.3?-ut(-l,.3,.8):0;for(let l=0;l<i.axes.length-1;l+=2)o[l>>1]=c(a(i.axes[l]),a(-i.axes[l+1])).clampLength();for(let l=i.buttons.length;l--;){const d=i.buttons[l];s[l]=d.pressed?1+2*!at(l,t):4*at(l,t),le|=!t&&d.pressed}{const l=c(at(15,t)-at(14,t),at(12,t)-at(13,t));l.lengthSquared()&&(o[0]=l.clampLength())}}}}const _e=window.ontouchstart!==void 0;if(_e){let e,t=onmousedown,i=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=s=>(Ii(0),ontouchstart=ontouchmove=ontouchend=o=>{o.button=0;const n=o.touches.length;return n?(o.x=o.touches[0].clientX,o.y=o.touches[0].clientY,e?onmousemove(o):t(o)):e&&i(o),e=n,!0},ontouchstart(s))}new Ht;class Xt{constructor(t,i=vi,s=Ti){this.range=i,this.taper=s,this.randomness=t[1]||0,t[1]=0,this.cachedSamples=ke(...t)}play(t,i=1,s=1,o=1){let n;if(t){const a=this.range;if(a){const l=F.distanceSquared(t);if(l>a*a)return;i*=ut(l**.5,a,a*this.taper)}n=ne(t).x*2/p.width-1}const r=s+s*this.randomness*o*v(-1,1);return Me([this.cachedSamples],i,r,n)}playNote(t,i,s){return this.play(i,s,2**(t/12),0)}}let X;function Me(e,t=1,i=1,s=0,o=0){if(X||(X=new AudioContext),X.resume(),X.state!="running")return;const n=X.createBuffer(e.length,e[0].length,A),r=X.createBufferSource();e.forEach((l,d)=>n.getChannelData(d).set(l)),r.buffer=n,r.playbackRate.value=i,r.loop=o;const a=X.createGain();return a.gain.value=Ie*t,a.connect(X.destination),r.connect(new StereoPannerNode(X,{pan:T(s,-1,1)})).connect(a),r.start(),r}const Ii=(...e)=>Me([ke(...e)]),A=44100;function ke(e=1,t=.05,i=220,s=0,o=0,n=.1,r=0,a=1,l=0,d=0,u=0,g=0,m=0,S=0,x=0,P=0,R=0,B=1,z=0,K=0){let C=kt*2,jt=l*=500*C/A/A,gt=[],Dt=i*=(1+t*v(-1,1))*C/A,W=0,Ct=0,D=0,lt=1,Nt=0,$e=0,V=0,Wt,rt;for(s=s*A+9,z*=A,o*=A,n*=A,R*=A,d*=500*C/A**3,x*=C/A,u*=C/A,g*=A,m=m*A|0,rt=s+z+o+n+R|0;D<rt;gt[D++]=V)++$e%(P*100|0)||(V=r?r>1?r>2?r>3?Math.sin((W%C)**3):N(j(Math.tan(W),1),-1):1-(2*W/C%2+2)%2:1-4*L(Math.round(W/C)-W/C):Math.sin(W),V=(m?1-K+K*Math.sin(C*D/m):1)*dt(V)*L(V)**a*e*Ie*(D<s?D/s:D<s+z?1-(D-s)/z*(1-B):D<s+z+o?B:D<rt-R?(rt-D-R)/n*B:0),V=R?V/2+(R>D?0:(D<rt-R?1:(rt-D)/R)*gt[D-R|0]/2):V),Wt=(i+=l+=d)*Math.cos(x*Ct++),W+=Wt-Wt*S*(1-(Math.sin(D)+1)*1e9%2),lt&&++lt>g&&(i+=u,Dt+=u,lt=0),m&&!(++Nt%m)&&(i=Dt,l=jt,lt||(lt=1));return gt}let Fe=[],wt=c();const Le=e=>e.arrayCheck(wt)?Fe[(e.y|0)*wt.x+e.x|0]:0;function zt(e,t=c(),i){const s=N(e.x-t.x/2|0,0),o=N(e.y-t.y/2|0,0),n=j(e.x+t.x/2,wt.x),r=j(e.y+t.y/2,wt.y);for(let a=o;a<r;++a)for(let l=s;l<n;++l){const d=Fe[a*wt.x+l];if(d&&(!i||i.collideWithTile(d,new b(l,a))))return 1}}function Bi(e,t,i){const s=(t=t.floor()).subtract(e=e.floor()),o=L(s.x),n=-L(s.y),r=dt(s.x),a=dt(s.y);for(let l=e.x,d=e.y,u=o+n;;){const g=Le(c(l,d));if(g&&(i?i.collideWithTileRaycast(g,new b(l,d)):g>0))return new b(l+.5,d+.5);if(l==t.x&d==t.y)break;const m=2*u;m>=n&&(u+=n,l+=r),m<=o&&(u+=o,d+=a)}}class be extends ft{constructor(t,i,s=0,o=0,n=100,r=kt,a=-1,l=Gt,d=new f,u=new f,g=new f(1,1,1,0),m=new f(1,1,1,0),S=.5,x=.1,P=1,R=.1,B=.05,z=1,K=1,C=0,jt=kt,gt=.1,Dt=.2,W,Ct,D=1,lt=Ct?1e9:0,Nt){super(t,new b,a,l,i,void 0,lt),this.emitSize=s,this.emitTime=o,this.emitRate=n,this.emitConeAngle=r,this.colorStartA=d,this.colorStartB=u,this.colorEndA=g,this.colorEndB=m,this.randomColorLinear=D,this.particleTime=S,this.sizeStart=x,this.sizeEnd=P,this.speed=R,this.angleSpeed=B,this.damping=z,this.angleDamping=K,this.gravityScale=C,this.particleConeAngle=jt,this.fadeRate=gt,this.randomness=Dt,this.collideTiles=W,this.additive=Ct,this.localSpace=Nt,this.trailScale=0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime|this.getAliveTime()<=this.emitTime){if(this.emitRate*ye){const t=1/this.emitRate/ye;for(this.emitTimeBuffer+=is;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy();ot&&Tt(this.pos,c(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let t=this.emitSize.x!=null?new b(v(-.5,.5),v(-.5,.5)).multiply(this.emitSize).rotate(this.angle):fi(this.emitSize/2),i=v(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),i+=this.angle);const s=new Oi(t,this.tileIndex,this.tileSize,i),o=this.randomness,n=P=>P+P*v(o,-o),r=n(this.particleTime),a=n(this.sizeStart),l=n(this.sizeEnd),d=n(this.speed),u=n(this.angleSpeed)*ui(),g=v(this.emitConeAngle,-this.emitConeAngle),m=fe(this.colorStartA,this.colorStartB,this.randomColorLinear),S=fe(this.colorEndA,this.colorEndB,this.randomColorLinear),x=this.localSpace?g:this.angle+g;return s.colorStart=m,s.colorEndDelta=S.subtract(m),s.velocity=new b().setAngle(x,d),s.angleVelocity=u,s.lifeTime=r,s.sizeStart=a,s.sizeEndDelta=l-a,s.fadeRate=this.fadeRate,s.damping=this.damping,s.angleDamping=this.angleDamping,s.elasticity=this.elasticity,s.friction=this.friction,s.gravityScale=this.gravityScale,s.collideTiles=this.collideTiles,s.additive=this.additive,s.renderOrder=this.renderOrder,s.trailScale=this.trailScale,s.mirror=Ft(2),s.localSpaceEmitter=this.localSpace&&this,s.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(s),s}render(){}}class Oi extends ft{constructor(t,i,s,o){super(t,new b,i,s,o)}render(){const t=j((k-this.spawnTime)/this.lifeTime,1),i=this.sizeStart+t*this.sizeEndDelta,s=new b(i,i),o=this.fadeRate/2,n=new f(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<o?t/o:t>1-o?(1-t)/o:1));this.additive&&xe(1);let r=this.pos,a=this.angle;if(this.localSpaceEmitter&&(r=this.localSpaceEmitter.pos.add(r.rotate(-this.localSpaceEmitter.angle)),a+=this.localSpaceEmitter.angle),this.trailScale){let l=this.velocity;this.localSpaceEmitter&&(l=l.rotate(-this.localSpaceEmitter.angle));const d=l.length(),u=l.scale(1/d),g=d*this.trailScale;s.y=N(s.x,g),a=u.angle(),Lt(r.add(u.multiply(c(0,-g/2))),s,this.tileIndex,this.tileSize,n,a,this.mirror)}else Lt(r,s,this.tileIndex,this.tileSize,n,a,this.mirror);this.additive&&xe(),ot&&Tt(r,s,"#f005",0,a),t==1&&(this.color=n,this.size=s,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let Yt=[],At;function _i(){if(!Yt.length)return;const e=Yt[0],t=ie-At;if(!At)At=ie;else if(t>me)Yt.shift(At=0);else{const i=me-Rt,s=t<Rt?1-t/Rt:t>i?(t-i)/Rt:0;e.render(s)}}let q,y,Ue,Bt,He,ct,Qt,Q,Jt,re;function Mi(){q=document.createElement("canvas"),y=q.getContext("webgl",{antialias:!1}),Ue=Fi(H),document.body.appendChild(q),Bt=ki("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec4 v,d,e;void main(){gl_Position=m*vec4(p,1,1);v=vec4(t,p);d=c;e=a;}","precision highp float;varying vec4 v,d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v.xy)*d+e;}");const e=new ArrayBuffer(Ye);He=y.createBuffer(),ct=new Float32Array(e),Qt=new Uint32Array(e),Q=0}function Ge(e){re=e}function Se(e,t){const i=y.createShader(t);if(y.shaderSource(i,e),y.compileShader(i),!y.getShaderParameter(i,Ji))throw y.getShaderInfoLog(i);return i}function ki(e,t){const i=y.createProgram();if(y.attachShader(i,Se(e,Qi)),y.attachShader(i,Se(t,$i)),y.linkProgram(i),!y.getProgramParameter(i,ts))throw y.getProgramInfoLog(i);return i}function Fi(e){const t=y.createTexture();y.bindTexture(et,t),e&&e.width&&y.texImage2D(et,0,De,De,te,e);const i=Ni;return y.texParameteri(et,Xi,i),y.texParameteri(et,Wi,i),y.texParameteri(et,Yi,Ce),y.texParameteri(et,Zi,Ce),t}function Li(){y.viewport(0,0,q.width=p.width,q.height=p.height),y.clear(qi),y.useProgram(Bt),y.activeTexture(Ki),y.bindTexture(et,Ue),y.bindBuffer(ee,He),y.bufferData(ee,Ye,Vi),Ge();let e=0;const t=(o,n,r,a,l=0)=>{const d=y.getAttribLocation(Bt,o);y.enableVertexAttribArray(d),y.vertexAttribPointer(d,a,n,l,Xe,e),e+=a*r};t("p",Te,4,2),t("t",Te,4,2),t("c",te,1,4,1),t("a",te,1,4,1);const i=2*_/p.width,s=2*_/p.height;y.uniformMatrix4fv(y.getUniformLocation(Bt,"m"),0,new Float32Array([i,0,0,0,0,s,0,0,1,1,-1,1,-1-i*F.x,-1-s*F.y,0,0]))}function je(){if(!Q)return;const e=Jt?ve:Gi;y.blendFuncSeparate(Hi,e,ve,e),y.enable(ji),y.bufferSubData(ee,0,ct.subarray(0,Q*Ut*Ne)),y.drawArrays(Ui,0,Q*Ut),Q=0,Jt=re}function Ot(e,t){!Q&&!t||(je(),t&&e.drawImage(q,0,0))}function we(e,t,i,s,o,n,r,a,l,d,u=0){(Q==We||Jt!=re)&&je();const g=Math.cos(o)/2,m=Math.sin(o)/2,S=g*i,x=g*s,P=m*i,R=m*s;for(let B=6,z=Q++*Ut*Ne;B--;){const K=B-4&&B>1,C=B-5&&B-2&&B-1;ct[z++]=e+(K?-S:S)+(C?R:-R),ct[z++]=t+(C?x:-x)+(K?P:-P),ct[z++]=K?n:a,ct[z++]=C?r:l,Qt[z++]=d,Qt[z++]=u}}const ve=1,Ui=4,Hi=770,Gi=771,ji=3042,et=3553,te=5121,Te=5126,De=6408,Ni=9728,Wi=10240,Xi=10241,Yi=10242,Zi=10243,qi=16384,Ce=33071,Ki=33984,ee=34962,Vi=35048,$i=35632,Qi=35633,Ji=35713,ts=35714,Ut=6,Ne=6,We=65536,Xe=4*2*2+4*2,Ye=We*Ut*Xe,ae="LittleJS",es="1.6.4",ce=60,is=1/ce;let G=[],Ze=[],ss=0,k=0,ie=0,ns=0;function os(e,t,i,s,o,n){H.onerror=H.onload=()=>{xt=c(mt).divide(pt=c(H.width,H.height)),H.onload=()=>w(1);const u="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none";document.body.style=u,document.body.appendChild(p=document.createElement("canvas")),M=p.getContext("2d"),ai(),Mi(),document.body.appendChild(Y=document.createElement("canvas")),h=Y.getContext("2d");const g="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";(q||p).style=p.style=Y.style=g,e(),d()};let r=0,a,l;function d(u=0){let g=u-r;r=u,l=yt(.05,l,1e3/(g||1));const m=vt(107),S=vt(109);if(g*=m?5:S?.2:1,ie+=g/1e3,a+=!ns*g,m||(a=j(a,50)),It.x){p.width=It.x,p.height=It.y;const x=innerWidth/innerHeight,P=p.width/p.height;(q||p).style.width=p.style.width=Y.style.width=x<P?"100%":"",(q||p).style.height=p.style.height=Y.style.height=x<P?"":"100%"}else p.width=j(innerWidth,ge.x),p.height=j(innerHeight,ge.y);Y.width=p.width,Y.height=p.height,Z=c(p.width,p.height);{let x=0;for(a<0&&a>-9&&(x=a,a=0);a>=0;a-=1e3/ce)Pi(),t(),rs(),ci(),i(),Ri();a+=x}ls(),s(),G.sort((x,P)=>x.renderOrder-P.renderOrder);for(const x of G)x.destroyed||x.render();if(o(),_i(),hi(),Ot(M),_t){h.textAlign="right",h.textBaseline="top",h.font="1em monospace",h.fillStyle="#000";const x=ae+" v"+es+" / "+Vt+" / "+G.length+" / "+l.toFixed(1)+" GL";h.fillText(x,p.width-3,3),h.fillStyle="#fff",h.fillText(x,p.width-2,2),Vt=0}requestAnimationFrame(d)}n?H.src=n:H.onload()}function ls(){Z=c(p.width,p.height),M.imageSmoothingEnabled=!gi,Li()}function rs(){Ze=G.filter(t=>t.collideSolidObjects);const e=t=>{if(!t.destroyed){t.update();for(const i of t.children)e(i)}};for(const t of G)t.parent||e(t);G=G.filter(t=>!t.destroyed),k=++ss/ce}const as=e=>F=e,cs=e=>It=e,hs=e=>Re=e;class qe extends ft{constructor(t){super(c(0,1),c(6,.5)),this.levelSize=t,this.color=new f(1,1,1,.5),this.setCollision(!0),this.mass=0}update(){const t=this.size.x*.5,i=this.levelSize.x-t;this.pos.x=T($.x,t,i)}}const Ke=[[6,1],[5,10],[16,11],[12,7],[15,20],[17,0],[26,21],[22,25],[2,27],[31,30]],se=[new f().setHex("#00854A"),new f().setHex("#8CC63F"),new f().setHex("#FFDD00"),new f().setHex("#ED1B25"),new f().setHex("#91278F"),new f().setHex("#005AAB"),new f().setHex("#00AAE5"),new f().setHex("#486370"),new f().setHex("#F7931F"),new f().setHex("#744C1F")];if(se.length!==Ke.length)throw new Error("Colors and Tiles must have the same length");class Ve extends ft{constructor(i,s=c(2,1)){super(i,s);O(this,"hitCount",0);O(this,"tiles");O(this,"strength",0);O(this,"index",0);this.setCollision(!0),this.mass=0,this.strength=Ft(0,10)>7?1:0,this.index=Ft(0,se.length),this.tiles=this.getTileByIndex(this.index),this.color=this.getColorByIndex(this.index),this.tileIndex=this.tiles[this.hitCount],this.tileSize=c(384,128),this.angle=0}getColorByIndex(i){return se[i]}getTileByIndex(i){return Ke[i]}get score(){return this.strength+1}increaseHitCount(){this.tileIndex=this.tiles[++this.hitCount],this.angle=v(-.3,.3)}shallBeDestroyed(){return this.hitCount>this.strength}}const Zt={BallBounce:new Xt([,,119,.02,.01,.02,,.26,,.5,,,,,-381,,,,.01,.8]),BrickHit:new Xt([,,141,,,.02,1,0,,,,,,.5,70,,,,.01]),BrickDestroy:new Xt([1.37,,574,.04,.27,.3,2,2.9,.6,-.1,,,.13,1.8,,.3,,.25,.01])},Ee={BallDestroy:(e,t)=>new be(e,0,0,.1,500,3.14,-1,c(8,8),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.1,.05,.98,1,0,3.14,.1,1,!1,!1,!0),BrickHit:(e,t)=>new be(e,0,0,.1,50,.45,4,c(10,10),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.39,.05,.98,1,0,1,.1,.99,!0,!0,!1)};class Pe extends ft{constructor(i,s){super(i,c(.5));O(this,"score");this.score=s,this.velocity=c(-.1,-.1),this.setCollision(!0),this.elasticity=1}collideWithObject(i){if(i instanceof Ve){const{color:s}=i;Zt.BrickHit.play(this.pos),i.increaseHitCount(),i.shallBeDestroyed()?(Ee.BallDestroy(this.pos,s),Zt.BrickDestroy.play(this.pos),this.score.add(i.score),i.destroy()):Ee.BrickHit(this.pos,s)}else{const s=this.velocity.length()+.5;Zt.BallBounce.play(this.pos,1,s)}if(i instanceof qe){const s=this.pos.x-i.pos.x;this.velocity=this.velocity.rotate(s*.3),this.velocity.y=N(this.velocity.y,.3);const o=j(1.04*this.velocity.length(),.5);return this.velocity=this.velocity.normalize().scale(o),!1}return!0}}class qt extends ft{constructor(t,i){super(t,i),this.setCollision(!0),this.mass=0}}const I=c(38,20);class ds{constructor(t){O(this,"score",0);this.initialValue=t,this.score=this.initialValue}increment(){this.score++}decrement(){this.score--}add(t){this.score+=t}reset(){this.score=this.initialValue}toString(){return this.score.toString()}toValue(){return this.score}}const us=""+new URL("tiles-75ceaa43.png",import.meta.url).href,fs={enabled(){return window.location.hash.includes("debug")},disabled(){return!this.enabled()}};fs.disabled()&&hs(-1);class gs{constructor(){O(this,"paddle",null);O(this,"ball",null);O(this,"bricks",[]);O(this,"walls",[]);O(this,"score");this.init=this.init.bind(this),this.update=this.update.bind(this),this.postUpdate=this.postUpdate.bind(this),this.render=this.render.bind(this),this.postRender=this.postRender.bind(this),this.score=new ds(0)}run(){os(this.init,this.update,this.postUpdate,this.render,this.postRender,us)}init(){cs(new b(1280,720));for(let t=2;t<=I.x-2;t+=2)for(let i=12;i<=I.y-2;i++)this.bricks.push(new Ve(c(t,i)));as(I.scale(.5)),this.paddle=new qe(I),this.ball=new Pe(F,this.score),this.walls=[new qt(c(-.5,I.y*.5),c(1,I.y)),new qt(c(I.x+.5,I.y*.5),c(1,I.y)),new qt(c(I.x*.5,I.y),c(I.x+2,1))]}update(){var t;it(F,c(100,100),new f(.5,.5,.5,.5)),it(F,I,new f(.1,.1,.1)),(!this.ball||this.ball.pos.y<-1)&&((t=this.ball)==null||t.destroy(),this.ball=new Pe(F,this.score))}postUpdate(){}render(){}postRender(){Be(`Score: ${this.score.toString()}`,c(Z.x*.5,70),24,new f(1,1,1))}}console.info("Is development mode:",ei.isDevelopment());const ys=new gs;ys.run();
//# sourceMappingURL=index-10f03b11.js.map
