var As=Object.defineProperty;var Ds=(e,t,s)=>t in e?As(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var f=(e,t,s)=>(Ds(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();var rt=(e=>(e.development="development",e.production="production",e.githubPages="github",e.crazyGames="crazy",e.itchIo="itch",e.unitTest="test",e.e2eTest="e2e",e))(rt||{}),at=(e=>(e[e.Classic=0]="Classic",e[e.Dynamic=1]="Dynamic",e[e.Modern=2]="Modern",e[e.Bonus=3]="Bonus",e))(at||{});class Is{constructor(t){this.mode=t}isDevelopment(){return this.mode===rt.development}isCrazyGames(){return this.mode===rt.crazyGames}isItchIo(){return this.mode===rt.itchIo}isGithubPages(){return this.mode===rt.githubPages}isUnitTest(){return this.mode===rt.unitTest}isE2ETest(){return this.mode===rt.e2eTest}}const ks=new Is("github"),Ms=1,Os=.5;let Ot=1,Jt=0,ss=27,vt=[],ct=0,dt=0,ut=0,It=0,de,kt;const E=(...e)=>console.assert(...e),Bt=(e,t=h(),s="#fff",i=0,r=0,n=!1)=>{E(typeof s=="string"),vt.push({pos:e,size:h(t),color:s,time:new se(i),angle:r,fill:n})},ze=(e,t=0,s="#fff",i=0,r=!1)=>{E(typeof s=="string"),vt.push({pos:e,size:t,color:s,time:new se(i),angle:0,fill:r})},zs=(e,t,s,i)=>Bt(e,0,t,s,i),Bs=(e,t,s,i=.1,r)=>{const n=h((t.x-e.x)/2,(t.y-e.y)/2),a=h(i,n.length()*2);Bt(e.add(n),a,s,r,n.angle(),1)},Be=(e,t,s,i,r)=>{const n=h(W(e.x-t.x/2,s.x-i.x/2),W(e.y-t.y/2,s.y-i.y/2)),a=h(G(e.x+t.x/2,s.x+i.x/2),G(e.y+t.y/2,s.y+i.y/2));Bt(n.lerp(a,.5),a.subtract(n),r)},Rs=(e,t,s=1,i="#fff",r=0,n=0,a="monospace")=>{E(typeof i=="string"),vt.push({text:e,pos:t,size:s,color:i,time:new se(r),angle:n,font:a})},Ls=(e,t=Te+".png")=>{kt.download="screenshot.png",kt.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),kt.click()},Fs=()=>{document.body.appendChild(kt=document.createElement("a")),kt.style.display="none"},Us=()=>{Z(ss)&&(ct=!ct),ct&&(Z(48)&&(Ot=!Ot),Z(49)&&(dt=!dt,ut=0),Z(50)&&(ut=!ut,dt=0),Z(51)&&(It=!It),Z(52)&&(Jt=!Jt),Z(53)&&(de=1))},Ns=()=>{if(Yt(F),de&&(Yt(F,1),F.drawImage(q,0,0),q.width|=0,Ls(b),de=0),It&&Js&&navigator.getGamepads){const e=navigator.getGamepads();for(let t=e.length;t--;){const s=e[t];if(s){const n=O,a=fe[t];for(let l=a.length;l--;){const o=n.add(h(l*1*2,t*1*3)),c=o.add(a[l].scale(1));ze(o,1,"#fff7",0,1),Bs(o,c,"#f00"),zs(c,"#f00")}for(let l=s.buttons.length;l--;){const o=n.add(h(l*.2*2,t*1*3-1-.2)),c=s.buttons[l].pressed;ze(o,.2,c?"#f00":"#fff7",0,1),Rs(l,o,.2)}}}}if(ct){const e=F;F=u;let t=1/0,s;for(const i of j){if(i.canvas||i.destroyed||!i.size.x||!i.size.y)continue;const r=$.distanceSquared(i.pos);r<t&&(t=r,s=i);const n=h(G(i.size.x,.2),G(i.size.y,.2)),a=new g(!!i.collideTiles,!!i.collideSolidObjects,!!i.isSolid,i.parent?.2:.5),l=i.parent?new g(1,1,1,.5):new g(0,0,0,.8);lt(i.pos,n,a,i.angle,0),lt(i.pos,n.scale(.8),l,i.angle,0),i.parent&&He(i.pos,i.parent.pos,.1,new g(0,0,1,.5),0)}if(s){const i=ci(s.pos,$);i&&lt(i.floor().add(h(.5)),h(1),new g(0,1,1,.3)),lt($.floor().add(h(.5)),h(1),new g(0,0,1,.5),0,0),He($,s.pos,.1,i?new g(1,0,0,.5):new g(0,1,0,.5),0);const r="mouse pos = "+$+`
mouse collision = `+us($)+`

--- object info ---
`+s.toString();ei(r,we,24,new g,.05,0,0,"monospace")}Yt(F=e)}{u.lineWidth=2;const e=Os*L;vt.forEach(t=>{u.save();const s=ne(t.pos);if(u.translate(s.x|0,s.y|0),u.rotate(t.angle),u.fillStyle=u.strokeStyle=t.color,t.text!=null)u.font=t.size*L+"px "+t.font,u.textAlign="center",u.textBaseline="middle",u.fillText(t.text,0,0);else if(t.size==0||t.size.x===0&&t.size.y===0)u.fillRect(-e/2,-1,e,3),u.fillRect(-1,-e/2,3,e);else if(t.size.x!=null){const i=t.size.x*L|0,r=t.size.y*L|0;t.fill&&u.fillRect(-i/2|0,-r/2|0,i,r),u.strokeRect(-i/2|0,-r/2|0,i,r)}else u.beginPath(),u.arc(0,0,t.size*L,0,9),t.fill&&u.fill(),u.stroke();u.restore()}),vt=vt.filter(t=>t.time<0)}{u.save(),u.fillStyle="#fff",u.textAlign="left",u.textBaseline="top",u.font="28px monospace",u.shadowColor="#000",u.shadowBlur=9;let e=9,t=-20,s=30;if(ct){u.fillText(Te,e,t+=s),u.fillText("Objects: "+j.length,e,t+=s),u.fillText("Time: "+Hs(B),e,t+=s),u.fillText("---------",e,t+=s),u.fillStyle="#f00",u.fillText("ESC: Debug Overlay",e,t+=s),u.fillStyle=dt?"#f00":"#fff",u.fillText("1: Debug Physics",e,t+=s),u.fillStyle=ut?"#f00":"#fff",u.fillText("2: Debug Particles",e,t+=s),u.fillStyle=It?"#f00":"#fff",u.fillText("3: Debug Gamepads",e,t+=s),u.fillStyle=Jt?"#f00":"#fff",u.fillText("4: God Mode",e,t+=s),u.fillStyle="#fff",u.fillText("5: Save Screenshot",e,t+=s);let i="";for(const n in z[0])n&&zt(n,0)&&(i+=n+" ");i&&u.fillText("Keys Down: "+i,e,t+=s);let r="";if(z[1])for(const n in z[1])n&&zt(n,1)&&(r+=n+" ");r&&u.fillText("Gamepad: "+r,e,t+=s)}else u.fillText(dt?"Debug Physics":"",e,t+=s),u.fillText(ut?"Debug Particles":"",e,t+=s),u.fillText(Jt?"God Mode":"",e,t+=s),u.fillText(It?"Debug Gamepads":"",e,t+=s);u.restore()}},Kt=Math.PI,U=e=>e<0?-e:e,W=(e,t)=>e<t?e:t,G=(e,t)=>e>t?e:t,St=e=>e<0?-1:1,A=(e,t=0,s=1)=>e<t?t:e>s?s:e,wt=(e,t=0,s=1)=>s-t?A((e-t)/(s-t)):0,Tt=(e,t=0,s=1)=>t+A(e)*(s-t),Re=(e,t,s,i)=>U(e.x-s.x)*2<t.x+i.x&&U(e.y-s.y)*2<t.y+i.y,Hs=e=>(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0),C=(e=1,t=0)=>t+(e-t)*Math.random(),_t=(e=1,t=0)=>C(e,t)|0,js=()=>_t(2)*2-1,Ws=(e=1,t=0)=>e>0?is(e*C(t/e,1)**.5):new S,is=(e=1)=>new S().setAngle(C(2*Kt),e),Le=(e=new g,t=new g(0,0,0,1),s)=>s?e.lerp(t,C()):new g(C(e.r,t.r),C(e.g,t.g),C(e.b,t.b),C(e.a,t.a)),h=(e=0,t)=>e.x==null?new S(e,t??e):new S(e.x,e.y),N=e=>!isNaN(e.x)&&!isNaN(e.y);class S{constructor(t=0,s=0){this.x=t,this.y=s}copy(){return new S(this.x,this.y)}add(t){return E(N(t)),new S(this.x+t.x,this.y+t.y)}subtract(t){return E(N(t)),new S(this.x-t.x,this.y-t.y)}multiply(t){return E(N(t)),new S(this.x*t.x,this.y*t.y)}divide(t){return E(N(t)),new S(this.x/t.x,this.y/t.y)}scale(t){return E(!N(t)),new S(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new S(0,t)}clampLength(t=1){const s=this.length();return s>t?this.scale(t/s):this}dot(t){return E(N(t)),this.x*t.x+this.y*t.y}cross(t){return E(N(t)),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new S(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return U(this.x)>U(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new S(this.y,-this.x)}floor(){return new S(Math.floor(this.x),Math.floor(this.y))}area(){return U(this.x*this.y)}lerp(t,s){return E(N(t)),this.add(t.subtract(this).scale(A(s)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class g{constructor(t=1,s=1,i=1,r=1){this.r=t,this.g=s,this.b=i,this.a=r}copy(){return new g(this.r,this.g,this.b,this.a)}add(t){return new g(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new g(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new g(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new g(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,s=t){return new g(this.r*t,this.g*t,this.b*t,this.a*s)}clamp(){return new g(A(this.r),A(this.g),A(this.b),A(this.a))}lerp(t,s){return this.add(t.subtract(this).scale(A(s)))}setHSLA(t=0,s=0,i=1,r=1){const n=i<.5?i*(1+s):i+s-i*s,a=2*i-n,l=(o,c,d)=>(d=(d%1+1)%1)<1/6?o+(c-o)*6*d:d<1/2?c:d<2/3?o+(c-o)*(2/3-d)*6:o;return this.r=l(a,n,t+1/3),this.g=l(a,n,t),this.b=l(a,n,t-1/3),this.a=r,this}getHSLA(){const t=A(this.r),s=A(this.g),i=A(this.b),r=A(this.a),n=Math.max(t,s,i),a=Math.min(t,s,i),l=(n+a)/2;let o=0,c=0;if(n!=a){let d=n-a;c=l>.5?d/(2-n-a):d/(n+a),t==n?o=(s-i)/d+(s<i?6:0):s==n?o=(i-t)/d+2:i==n&&(o=(t-s)/d+4)}return[o/6,c,l,r]}mutate(t=.05,s=0){return new g(this.r+C(t,-t),this.g+C(t,-t),this.b+C(t,-t),this.a+C(s,-s)).clamp()}toString(t=1){const s=i=>((i=i*255|0)<16?"0":"")+i.toString(16);return"#"+s(this.r)+s(this.g)+s(this.b)+(t?s(this.a):"")}setHex(t){const s=i=>A(parseInt(t.slice(i,i+2),16)/255);return this.r=s(1),this.g=s(3),this.b=s(5),this.a=t.length>7?s(7):1,this}rgbaInt(){const t=a=>A(a)*255|0,s=t(this.r),i=t(this.g)<<8,r=t(this.b)<<16,n=t(this.a)<<24;return s+i+r+n}}class se{constructor(t){this.time=t==null?void 0:B+t,this.setTime=t}set(t=0){this.time=B+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return B<=this.time}elapsed(){return B>this.time}get(){return this.isSet()?B-this.time:0}getPercent(){return this.isSet()?wt(this.time-B,this.setTime,0):0}toString(){return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}valueOf(){return this.get()}}let O=h(),L=32,Fe=h(1920,1200),Xt=h(),ns=1,Gs="arial",rs=1,ie=h(16),Et=.3,Xs=1,Vs=1,Ys=1,qs=0,Zs=.8,Ft=1,Ut=0,Ue=1,Js=1,as=.5,Ks=40,Qs=.7,Ne=5,Nt=.5;h(640,80);class gt{constructor(t=h(),s=h(1),i=-1,r=ie,n=0,a,l=0){E(N(t)&&N(s)),this.pos=t.copy(),this.size=s,this.drawSize,this.tileIndex=i,this.tileSize=r,this.angle=n,this.color=a,this.additiveColor,this.mass=Xs,this.damping=Vs,this.angleDamping=Ys,this.elasticity=qs,this.friction=Zs,this.gravityScale=1,this.renderOrder=l,this.velocity=new S,this.angleVelocity=0,this.spawnTime=B,this.children=[],this.collideTiles=1,j.push(this)}update(){const t=this.parent;if(t){this.pos=this.localPos.multiply(h(t.getMirrorSign(),1)).rotate(-t.angle).add(t.pos),this.angle=t.getMirrorSign()*this.localAngle+t.angle;return}this.velocity.x=A(this.velocity.x,-Ft,Ft),this.velocity.y=A(this.velocity.y,-Ft,Ft);const s=this.pos.copy();if(this.velocity.y+=Ut*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,E(this.angleDamping>=0&&this.angleDamping<=1),E(this.damping>=0&&this.damping<=1),!this.mass)return;const i=this.velocity.y<0;if(this.groundObject){const r=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=r+(this.velocity.x-r)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const n of Ss){if(!this.isSolid&!n.isSolid||n.destroyed||n.parent||n==this||!Re(this.pos,this.size,n.pos,n.size)||!this.collideWithObject(n)|!n.collideWithObject(this))continue;if(Re(s,this.size,n.pos,n.size)){const p=s.subtract(n.pos),y=p.length(),v=.001,x=y<.01?is(v):p.scale(v/y);this.velocity=this.velocity.add(x),n.mass&&(n.velocity=n.velocity.subtract(x)),ct&&dt&&Be(this.pos,this.size,n.pos,n.size,"#f00");continue}const a=this.size.add(n.size),l=(s.y-n.pos.y)*2>a.y+Ut,o=U(s.y-n.pos.y)*2<a.y,c=U(s.x-n.pos.x)*2<a.x,d=G(this.elasticity,n.elasticity);if(l|c|!o){if(this.pos.y=n.pos.y+(a.y/2+.001)*St(s.y-n.pos.y),n.groundObject&&i||!n.mass)i&&(this.groundObject=n),this.velocity.y*=-d;else if(n.mass){const p=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),y=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),v=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=Tt(d,p,y),n.velocity.y=Tt(d,p,v)}}if(!l&o)if(this.pos.x=n.pos.x+(a.x/2+.001)*St(s.x-n.pos.x),n.mass){const p=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),y=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),v=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=Tt(d,p,y),n.velocity.x=Tt(d,p,v)}else this.velocity.x*=-d;ct&&dt&&Be(this.pos,this.size,n.pos,n.size,"#f0f")}if(this.collideTiles&&Wt(this.pos,this.size,this)&&!Wt(s,this.size,this)){const r=Wt(new S(s.x,this.pos.y),this.size,this),n=Wt(new S(this.pos.x,s.y),this.size,this);if(r|!n){this.groundObject=i,this.velocity.y*=-this.elasticity;const a=(s.y-this.size.y/2|0)-(s.y-this.size.y/2);a<0&&a>this.damping*this.velocity.y+Ut*this.gravityScale&&(this.velocity.y=this.damping?(a-Ut*this.gravityScale)/this.damping:0),this.pos.y=s.y}n&&(this.pos.x=s.x,this.velocity.x*=-this.elasticity)}}render(){Qt(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}collideWithTile(t,s){return t>0}collideWithTileRaycast(t,s){return t>0}collideWithObject(t){return 1}getAliveTime(){return B-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,s=h(),i=0){E(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this,t.localPos=s.copy(),t.localAngle=i}removeChild(t){E(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=1,s=1,i=1){E(t||!s),this.collideSolidObjects=t,this.isSolid=s,this.collideTiles=i}toString(){{let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+=`
pos = `+this.pos),(this.velocity.x||this.velocity.y)&&(t+=`
velocity = `+this.velocity),(this.size.x||this.size.y)&&(t+=`
size = `+this.size),this.angle&&(t+=`
angle = `+this.angle.toFixed(3)),this.color&&(t+=`
color = `+this.color),t}}}let b,F,q,u,st=h();const H=new Image;let Pt,At,ue;const $s=e=>(E(st.x&&st.y,"mainCanvasSize is invalid"),e.add(h(.5)).subtract(st.scale(.5)).multiply(h(1/L,-1/L)).add(O)),ne=e=>(E(st.x&&st.y,"mainCanvasSize is invalid"),e.subtract(O).multiply(h(L,-L)).add(st.scale(.5)).subtract(h(.5)));function Qt(e,t=h(1),s=-1,i=ie,r=new g,n=0,a,l=new g(0,0,0,0),o=rs){if(Ot&&++ue,o)if(s<0||!H.width)Xe(e.x,e.y,t.x,t.y,n,0,0,0,0,0,r.rgbaInt());else{const c=Pt.x/i.x|0,d=i.x/Pt.x,p=i.y/Pt.y,y=s%c*d,v=(s/c|0)*p;Xe(e.x,e.y,a?-t.x:t.x,t.y,n,y+At.x,v+At.y,y-At.x+d,v-At.y+p,r.rgbaInt(),l.rgbaInt())}else ti(e,t,n,a,c=>{if(s<0)c.fillStyle=r,c.fillRect(-.5,-.5,1,1);else{const d=Pt.x/i.x|0,p=s%d*i.x+Et,y=(s/d|0)*i.y+Et,v=i.x-2*Et,x=i.y-2*Et;c.globalAlpha=r.a,c.drawImage(H,p,y,v,x,-.5,-.5,1,1)}})}function lt(e,t,s,i,r){Qt(e,t,-1,ie,s,i,0,0,r)}function He(e,t,s=.1,i,r){const n=h((t.x-e.x)/2,(t.y-e.y)/2),a=h(s,n.length()*2);lt(e.add(n),a,i,n.angle(),r)}function ti(e,t,s,i,r,n=F){e=ne(e),t=t.scale(L),n.save(),n.translate(e.x+.5|0,e.y+.5|0),n.rotate(s),n.scale(i?-t.x:t.x,t.y),r(n),n.restore()}function je(e,t=rs){t?ps(e):F.globalCompositeOperation=e?"lighter":"source-over"}function ei(e,t,s=1,i=new g,r=0,n=new g(0,0,0),a="center",l=Gs,o=u){o.fillStyle=i,o.lineWidth=r,o.strokeStyle=n,o.textAlign=a,o.font=s+"px "+l,o.textBaseline="middle",o.lineJoin="round",t=t.copy(),(e+"").split(`
`).forEach(c=>{r&&o.strokeText(c,t.x,t.y),o.fillText(c,t.x,t.y),t.y+=s})}let he;class Ht{constructor(t,s=h(8),i=h(0,1),r=0,n=u){he||((he=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||he,this.tileSize=s,this.paddingSize=i,this.startTileIndex=r,this.context=n}drawTextScreen(t,s,i=4,r){const n=this.context;n.save(),n.imageSmoothingEnabled=!ns;const a=this.tileSize,l=a.add(this.paddingSize).scale(i),o=this.image.width/this.tileSize.x|0;(t+"").split(`
`).forEach((c,d)=>{const p=r?c.length*a.x*i/2|0:0;for(let y=c.length;y--;){let v=c[y].charCodeAt();(v<32||v>127)&&(v=127);const x=this.startTileIndex+v-32,P=x%o,T=x/o|0,_=s.add(h(y,d).multiply(l));n.drawImage(this.image,P*a.x,T*a.y,a.x,a.y,_.x-p,_.y,a.x*i,a.y*i)}}),n.restore()}drawText(t,s,i=1,r){this.drawTextScreen(t,ne(s).floor(),i*L|0,r)}}const zt=(e,t=0)=>z[t]&&z[t][e]&1,Z=(e,t=0)=>z[t]&&z[t][e]&2?1:0,si=()=>z=[[]],ii=Z;let $=h(),we=h(),_e=0;const mt=(e,t=0)=>zt(e,t+1),ni=(e,t=0)=>Z(e,t+1);let z=[[]];function ri(){ls||document.hasFocus()||si(),$=$s(we),li()}function ai(){for(const e of z)for(const t in e)e[t]&=1}onkeydown=e=>{e.target==document.body&&(e.repeat||(z[_e=0][os(e.which)]=3))};onkeyup=e=>{e.target==document.body&&(z[0][os(e.which)]=4)};const os=e=>e==87?38:e==83?40:e==65?37:e==68?39:e;onmousedown=e=>{z[_e=0][e.button]=3,onmousemove(e),e.button&&e.preventDefault()};onmouseup=e=>z[0][e.button]=z[0][e.button]&2|4;onmousemove=e=>we=oi(e);onwheel=e=>e.ctrlKey||St(e.deltaY);oncontextmenu=e=>!1;const oi=e=>{if(!b)return h();const t=b.getBoundingClientRect();return h(b.width,b.height).multiply(h(wt(e.x,t.left,t.right),wt(e.y,t.top,t.bottom)))},fe=[];function li(){if(!navigator||!navigator.getGamepads||!document.hasFocus()&&!Ms)return;const e=navigator.getGamepads();for(let t=e.length;t--;){const s=e[t],i=z[t+1]||(z[t+1]=[]),r=fe[t]||(fe[t]=[]);if(s){const l=o=>o>.3?wt(o,.3,.8):o<-.3?-wt(-o,.3,.8):0;for(let o=0;o<s.axes.length-1;o+=2)r[o>>1]=h(l(s.axes[o]),l(-s.axes[o+1])).clampLength();for(let o=s.buttons.length;o--;){const c=s.buttons[o];i[o]=c.pressed?1+2*!mt(o,t):4*mt(o,t),_e|=!t&&c.pressed}{const o=h(mt(15,t)-mt(14,t),mt(12,t)-mt(13,t));o.lengthSquared()&&(r[0]=o.clampLength())}}}}const ls=window.ontouchstart!==void 0;if(ls){let e,t=onmousedown,s=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=i=>(hi(0),ontouchstart=ontouchmove=ontouchend=r=>{r.button=0;const n=r.touches.length;return n?(r.x=r.touches[0].clientX,r.y=r.touches[0].clientY,e?onmousemove(r):t(r)):e&&s(r),e=n,!0},ontouchstart(i))}new se;class jt{constructor(t,s=Ks,i=Qs){this.range=s,this.taper=i,this.randomness=t[1]||0,t[1]=0,this.cachedSamples=cs(...t)}play(t,s=1,i=1,r=1){let n;if(t){const l=this.range;if(l){const o=O.distanceSquared(t);if(o>l*l)return;s*=wt(o**.5,l,l*this.taper)}n=ne(t).x*2/b.width-1}const a=i+i*this.randomness*r*C(-1,1);return hs([this.cachedSamples],s,a,n)}playNote(t,s,i){return this.play(s,i,2**(t/12),0)}}let Y;function hs(e,t=1,s=1,i=0,r=0){if(Y||(Y=new AudioContext),Y.resume(),Y.state!="running")return;const n=Y.createBuffer(e.length,e[0].length,R),a=Y.createBufferSource();e.forEach((o,c)=>n.getChannelData(c).set(o)),a.buffer=n,a.playbackRate.value=s,a.loop=r;const l=Y.createGain();return l.gain.value=as*t,l.connect(Y.destination),a.connect(new StereoPannerNode(Y,{pan:A(i,-1,1)})).connect(l),a.start(),a}const hi=(...e)=>hs([cs(...e)]),R=44100;function cs(e=1,t=.05,s=220,i=0,r=0,n=.1,a=0,l=1,o=0,c=0,d=0,p=0,y=0,v=0,x=0,P=0,T=0,_=1,D=0,K=0){let M=Kt*2,ae=o*=500*M/R/R,Ct=[],Rt=s*=(1+t*C(-1,1))*M/R,V=0,Lt=0,I=0,pt=1,oe=0,Ps=0,Q=0,le,yt;for(i=i*R+9,D*=R,r*=R,n*=R,T*=R,c*=500*M/R**3,x*=M/R,d*=M/R,p*=R,y=y*R|0,yt=i+D+r+n+T|0;I<yt;Ct[I++]=Q)++Ps%(P*100|0)||(Q=a?a>1?a>2?a>3?Math.sin((V%M)**3):G(W(Math.tan(V),1),-1):1-(2*V/M%2+2)%2:1-4*U(Math.round(V/M)-V/M):Math.sin(V),Q=(y?1-K+K*Math.sin(M*I/y):1)*St(Q)*U(Q)**l*e*as*(I<i?I/i:I<i+D?1-(I-i)/D*(1-_):I<i+D+r?_:I<yt-T?(yt-I-T)/n*_:0),Q=T?Q/2+(T>I?0:(I<yt-T?1:(yt-I)/T)*Ct[I-T|0]/2):Q),le=(s+=o+=c)*Math.cos(x*Lt++),V+=le-le*v*(1-(Math.sin(I)+1)*1e9%2),pt&&++pt>p&&(s+=d,Rt+=d,pt=0),y&&!(++oe%y)&&(s=Rt,o=ae,pt||(pt=1));return Ct}let ds=[],Mt=h();const us=e=>e.arrayCheck(Mt)?ds[(e.y|0)*Mt.x+e.x|0]:0;function Wt(e,t=h(),s){const i=G(e.x-t.x/2|0,0),r=G(e.y-t.y/2|0,0),n=W(e.x+t.x/2,Mt.x),a=W(e.y+t.y/2,Mt.y);for(let l=r;l<a;++l)for(let o=i;o<n;++o){const c=ds[l*Mt.x+o];if(c&&(!s||s.collideWithTile(c,new S(o,l))))return 1}}function ci(e,t,s){const i=(t=t.floor()).subtract(e=e.floor()),r=U(i.x),n=-U(i.y),a=St(i.x),l=St(i.y);for(let o=e.x,c=e.y,d=r+n;;){const p=us(h(o,c));if(p&&(s?s.collideWithTileRaycast(p,new S(o,c)):p>0))return new S(o+.5,c+.5);if(o==t.x&c==t.y)break;const y=2*d;y>=n&&(d+=n,o+=a),y<=r&&(d+=r,c+=l)}}class We extends gt{constructor(t,s,i=0,r=0,n=100,a=Kt,l=-1,o=ie,c=new g,d=new g,p=new g(1,1,1,0),y=new g(1,1,1,0),v=.5,x=.1,P=1,T=.1,_=.05,D=1,K=1,M=0,ae=Kt,Ct=.1,Rt=.2,V,Lt,I=1,pt=Lt?1e9:0,oe){super(t,new S,l,o,s,void 0,pt),this.emitSize=i,this.emitTime=r,this.emitRate=n,this.emitConeAngle=a,this.colorStartA=c,this.colorStartB=d,this.colorEndA=p,this.colorEndB=y,this.randomColorLinear=I,this.particleTime=v,this.sizeStart=x,this.sizeEnd=P,this.speed=T,this.angleSpeed=_,this.damping=D,this.angleDamping=K,this.gravityScale=M,this.particleConeAngle=ae,this.fadeRate=Ct,this.randomness=Rt,this.collideTiles=V,this.additive=Lt,this.localSpace=oe,this.trailScale=0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime|this.getAliveTime()<=this.emitTime){if(this.emitRate*Ue){const t=1/this.emitRate/Ue;for(this.emitTimeBuffer+=zi;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy();ut&&Bt(this.pos,h(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let t=this.emitSize.x!=null?new S(C(-.5,.5),C(-.5,.5)).multiply(this.emitSize).rotate(this.angle):Ws(this.emitSize/2),s=C(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),s+=this.angle);const i=new di(t,this.tileIndex,this.tileSize,s),r=this.randomness,n=P=>P+P*C(r,-r),a=n(this.particleTime),l=n(this.sizeStart),o=n(this.sizeEnd),c=n(this.speed),d=n(this.angleSpeed)*js(),p=C(this.emitConeAngle,-this.emitConeAngle),y=Le(this.colorStartA,this.colorStartB,this.randomColorLinear),v=Le(this.colorEndA,this.colorEndB,this.randomColorLinear),x=this.localSpace?p:this.angle+p;return i.colorStart=y,i.colorEndDelta=v.subtract(y),i.velocity=new S().setAngle(x,c),i.angleVelocity=d,i.lifeTime=a,i.sizeStart=l,i.sizeEndDelta=o-l,i.fadeRate=this.fadeRate,i.damping=this.damping,i.angleDamping=this.angleDamping,i.elasticity=this.elasticity,i.friction=this.friction,i.gravityScale=this.gravityScale,i.collideTiles=this.collideTiles,i.additive=this.additive,i.renderOrder=this.renderOrder,i.trailScale=this.trailScale,i.mirror=_t(2),i.localSpaceEmitter=this.localSpace&&this,i.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(i),i}render(){}}class di extends gt{constructor(t,s,i,r){super(t,new S,s,i,r)}render(){const t=W((B-this.spawnTime)/this.lifeTime,1),s=this.sizeStart+t*this.sizeEndDelta,i=new S(s,s),r=this.fadeRate/2,n=new g(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<r?t/r:t>1-r?(1-t)/r:1));this.additive&&je(1);let a=this.pos,l=this.angle;if(this.localSpaceEmitter&&(a=this.localSpaceEmitter.pos.add(a.rotate(-this.localSpaceEmitter.angle)),l+=this.localSpaceEmitter.angle),this.trailScale){let o=this.velocity;this.localSpaceEmitter&&(o=o.rotate(-this.localSpaceEmitter.angle));const c=o.length(),d=o.scale(1/c),p=c*this.trailScale;i.y=G(i.x,p),l=d.angle(),Qt(a.add(d.multiply(h(0,-p/2))),i,this.tileIndex,this.tileSize,n,l,this.mirror)}else Qt(a,i,this.tileIndex,this.tileSize,n,l,this.mirror);this.additive&&je(),ut&&Bt(a,i,"#f005",0,l),t==1&&(this.color=n,this.size=i,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let ce=[],Gt;function ui(){if(!ce.length)return;const e=ce[0],t=xe-Gt;if(!Gt)Gt=xe;else if(t>Ne)ce.shift(Gt=0);else{const s=Ne-Nt,i=t<Nt?1-t/Nt:t>s?(t-s)/Nt:0;e.render(i)}}let J,m,fs,Vt,gs,xt,ge,tt,pe,Ce;function fi(){J=document.createElement("canvas"),m=J.getContext("webgl",{antialias:!1}),fs=pi(H),document.body.appendChild(J),Vt=gi("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec4 v,d,e;void main(){gl_Position=m*vec4(p,1,1);v=vec4(t,p);d=c;e=a;}","precision highp float;varying vec4 v,d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v.xy)*d+e;}");const e=new ArrayBuffer(vs);gs=m.createBuffer(),xt=new Float32Array(e),ge=new Uint32Array(e),tt=0}function ps(e){Ce=e}function Ge(e,t){const s=m.createShader(t);if(m.shaderSource(s,e),m.compileShader(s),!m.getShaderParameter(s,ki))throw m.getShaderInfoLog(s);return s}function gi(e,t){const s=m.createProgram();if(m.attachShader(s,Ge(e,Ii)),m.attachShader(s,Ge(t,Di)),m.linkProgram(s),!m.getProgramParameter(s,Mi))throw m.getProgramInfoLog(s);return s}function pi(e){const t=m.createTexture();m.bindTexture(ot,t),e&&e.width&&m.texImage2D(ot,0,qe,qe,ye,e);const s=Si;return m.texParameteri(ot,_i,s),m.texParameteri(ot,wi,s),m.texParameteri(ot,Ci,Ze),m.texParameteri(ot,Ti,Ze),t}function yi(){m.viewport(0,0,J.width=b.width,J.height=b.height),m.clear(Ei),m.useProgram(Vt),m.activeTexture(Pi),m.bindTexture(ot,fs),m.bindBuffer(me,gs),m.bufferData(me,vs,Ai),ps();let e=0;const t=(r,n,a,l,o=0)=>{const c=m.getAttribLocation(Vt,r);m.enableVertexAttribArray(c),m.vertexAttribPointer(c,l,n,o,bs,e),e+=l*a};t("p",Ye,4,2),t("t",Ye,4,2),t("c",ye,1,4,1),t("a",ye,1,4,1);const s=2*L/b.width,i=2*L/b.height;m.uniformMatrix4fv(m.getUniformLocation(Vt,"m"),0,new Float32Array([s,0,0,0,0,i,0,0,1,1,-1,1,-1-s*O.x,-1-i*O.y,0,0]))}function ys(){if(!tt)return;const e=pe?Ve:bi;m.blendFuncSeparate(xi,e,Ve,e),m.enable(vi),m.bufferSubData(me,0,xt.subarray(0,tt*$t*ms)),m.drawArrays(mi,0,tt*$t),tt=0,pe=Ce}function Yt(e,t){!tt&&!t||(ys(),t&&e.drawImage(J,0,0))}function Xe(e,t,s,i,r,n,a,l,o,c,d=0){(tt==xs||pe!=Ce)&&ys();const p=Math.cos(r)/2,y=Math.sin(r)/2,v=p*s,x=p*i,P=y*s,T=y*i;for(let _=6,D=tt++*$t*ms;_--;){const K=_-4&&_>1,M=_-5&&_-2&&_-1;xt[D++]=e+(K?-v:v)+(M?T:-T),xt[D++]=t+(M?x:-x)+(K?P:-P),xt[D++]=K?n:l,xt[D++]=M?a:o,ge[D++]=c,ge[D++]=d}}const Ve=1,mi=4,xi=770,bi=771,vi=3042,ot=3553,ye=5121,Ye=5126,qe=6408,Si=9728,wi=10240,_i=10241,Ci=10242,Ti=10243,Ei=16384,Ze=33071,Pi=33984,me=34962,Ai=35048,Di=35632,Ii=35633,ki=35713,Mi=35714,$t=6,ms=6,xs=65536,bs=4*2*2+4*2,vs=xs*$t*bs,Te="LittleJS",Oi="1.6.4",Ee=60,zi=1/Ee;let j=[],Ss=[],Bi=0,B=0,xe=0,Ri=0;function Li(e,t,s,i,r,n){H.onerror=H.onload=()=>{At=h(Et).divide(Pt=h(H.width,H.height)),H.onload=()=>E(1);const d="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none";document.body.style=d,document.body.appendChild(b=document.createElement("canvas")),F=b.getContext("2d"),Fs(),fi(),document.body.appendChild(q=document.createElement("canvas")),u=q.getContext("2d");const p="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";(J||b).style=b.style=q.style=p,e(),c()};let a=0,l,o;function c(d=0){let p=d-a;a=d,o=Tt(.05,o,1e3/(p||1));const y=zt(107),v=zt(109);if(p*=y?5:v?.2:1,xe+=p/1e3,l+=!Ri*p,y||(l=W(l,50)),Xt.x){b.width=Xt.x,b.height=Xt.y;const x=innerWidth/innerHeight,P=b.width/b.height;(J||b).style.width=b.style.width=q.style.width=x<P?"100%":"",(J||b).style.height=b.style.height=q.style.height=x<P?"":"100%"}else b.width=W(innerWidth,Fe.x),b.height=W(innerHeight,Fe.y);q.width=b.width,q.height=b.height,st=h(b.width,b.height);{let x=0;for(l<0&&l>-9&&(x=l,l=0);l>=0;l-=1e3/Ee)ri(),t(),Ui(),Us(),s(),ai();l+=x}Fi(),i(),j.sort((x,P)=>x.renderOrder-P.renderOrder);for(const x of j)x.destroyed||x.render();if(r(),ui(),Ns(),Yt(F),Ot){u.textAlign="right",u.textBaseline="top",u.font="1em monospace",u.fillStyle="#000";const x=Te+" v"+Oi+" / "+ue+" / "+j.length+" / "+o.toFixed(1)+" GL";u.fillText(x,b.width-3,3),u.fillStyle="#fff",u.fillText(x,b.width-2,2),ue=0}requestAnimationFrame(c)}n?H.src=n:H.onload()}function Fi(){st=h(b.width,b.height),F.imageSmoothingEnabled=!ns,yi()}function Ui(){Ss=j.filter(t=>t.collideSolidObjects);const e=t=>{if(!t.destroyed){t.update();for(const s of t.children)e(s)}};for(const t of j)t.parent||e(t);j=j.filter(t=>!t.destroyed),B=++Bi/Ee}const Ni=e=>O=e,Hi=e=>Xt=e,ji=e=>Ot=e,Wi=e=>ss=e;class Pe extends gt{constructor(t){super(h(0,1),h(4,.5)),this.levelSize=t,this.color=new g(1,1,1,.5),this.setCollision(!0),this.mass=0}update(){const t=this.size.x*.5,s=this.levelSize.x-t;this.pos.x=A($.x,t,s)}increaseSize(){this.size.x+=2}decreaseSize(){this.size.x-=2,this.size.x<2&&(this.size.x=2)}resetSize(){this.size.x=4}}class qt extends gt{constructor(t,s){super(t,s),this.setCollision(!0),this.mass=0,this.color=new g().setHex("#494746")}}const k=h(38,20);class Gi{constructor(t){f(this,"score",0);f(this,"highScore",0);this.initialValue=t,this.score=this.initialValue,this.highScore=Number(localStorage.getItem("highScore"))||0}increment(){this.score++,this.evaluateHighScore()}decrement(){this.score--,this.evaluateHighScore()}add(t){this.score+=t,this.evaluateHighScore()}reset(){this.score=this.initialValue}toString(){return this.score.toString()}toValue(){return this.score}getHighScore(){return this.highScore}evaluateHighScore(){this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("highScore",this.highScore.toString()))}}const Xi=""+new URL("tiles-75ceaa43.png",import.meta.url).href,ws={enabled(){return window.location.hash.includes("debug")},disabled(){return!this.enabled()}};var _s={exports:{}};function Ae(){}Ae.prototype={on:function(e,t,s){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:s}),this},once:function(e,t,s){var i=this;function r(){i.off(e,r),t.apply(s,arguments)}return r._=t,this.on(e,r,s)},emit:function(e){var t=[].slice.call(arguments,1),s=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=s.length;for(i;i<r;i++)s[i].fn.apply(s[i].ctx,t);return this},off:function(e,t){var s=this.e||(this.e={}),i=s[e],r=[];if(i&&t)for(var n=0,a=i.length;n<a;n++)i[n].fn!==t&&i[n].fn._!==t&&r.push(i[n]);return r.length?s[e]=r:delete s[e],this}};_s.exports=Ae;var Vi=_s.exports.TinyEmitter=Ae;const te=new Vi;var w=(e=>(e[e.ExtraScore=0]="ExtraScore",e[e.ExtraBalls=1]="ExtraBalls",e[e.PaddleIncrease=2]="PaddleIncrease",e[e.ExtraLife=3]="ExtraLife",e[e.ExtraWall=4]="ExtraWall",e[e.PaddleDecrease=5]="PaddleDecrease",e[e.DoubleBalls=6]="DoubleBalls",e[e.TripleBalls=7]="TripleBalls",e[e.ExtraStrength=8]="ExtraStrength",e))(w||{});class nt{constructor(t){f(this,"timers",[]);f(this,"timeout",1e4);this.game=t}clearTimers(){this.timers.forEach(clearTimeout)}}class Je extends nt{constructor(t){super(t)}apply(){if(this.game.balls.hasValue()){const t=this.game.balls.getOne();if(!t||t.destroyed)return;this.game.balls.spawnManyAt(O,3)}}}class Yi extends nt{constructor(t){super(t)}apply(){this.game.lives.increment()}}class qi extends nt{constructor(t){super(t)}apply(){var t;(t=this.game.paddle)==null||t.increaseSize(),this.timers.push(setTimeout(()=>{var s;(s=this.game.paddle)==null||s.decreaseSize()},this.timeout))}}class Zi extends nt{constructor(t){super(t)}apply(){var t;(t=this.game.paddle)==null||t.decreaseSize(),this.timers.push(setTimeout(()=>{var s;(s=this.game.paddle)==null||s.increaseSize()},this.timeout))}}class Ji extends nt{constructor(t){super(t)}apply(){this.game.score.add(10)}}class Ki extends nt{constructor(s){super(s);f(this,"size",h(k.x,.25));f(this,"position",h(k.x*.5,.35))}apply(){var s;(s=this.game.floor)==null||s.destroy(),this.game.floor=new qt(this.position,this.size),this.game.floor.color=new g(1,1,1,.5),this.timers.push(setTimeout(()=>{var i;(i=this.game.floor)==null||i.destroy(),this.game.floor=null},this.timeout))}}class Qi extends nt{constructor(t){super(t)}apply(){this.game.balls.hasValue()&&this.game.balls.double()}}class $i extends nt{constructor(t){super(t)}apply(){this.game.balls.hasValue()&&this.game.balls.triple()}}const Cs=[[6,1],[5,10],[16,11],[12,7],[15,20],[17,0],[26,21],[2,27],[31,30]],tn=22,en=new g().setHex("#486370"),ee=[new g().setHex("#00854A"),new g().setHex("#8CC63F"),new g().setHex("#FFDD00"),new g().setHex("#ED1B25"),new g().setHex("#91278F"),new g().setHex("#005AAB"),new g().setHex("#00AAE5"),new g().setHex("#F7931F"),new g().setHex("#744C1F")];if(ee.length!==Cs.length)throw new Error("Colors and Tiles must have the same length");class sn extends gt{constructor(s,i){super(s,h(.5));f(this,"type");f(this,"sign",1);this.type=i,this.setCollision(!0),this.velocity=h(0,-.1),this.color=ee[this.type],this.sign=_t(0,1)===0?-1:1}update(){this.angle+=this.sign,this.pos.y<0&&this.destroy(),super.update()}collideWithObject(s){return s instanceof Pe&&(te.emit("bonusCollected",this.type),this.destroy()),!1}}class nn{constructor(t){f(this,"commands");this.commands={[w.ExtraBalls]:new Je(t),[w.ExtraLife]:new Yi(t),[w.PaddleIncrease]:new qi(t),[w.PaddleDecrease]:new Zi(t),[w.ExtraScore]:new Ji(t),[w.ExtraWall]:new Ki(t),[w.DoubleBalls]:new Qi(t),[w.TripleBalls]:new $i(t),[w.ExtraStrength]:new Je(t)}}collect(t){this.commands[t].apply()}produce(t){new sn(h(_t(2,k.x-2),k.y-2),t)}clearTimers(){for(const t of Object.values(this.commands))t.clearTimers()}}const Zt={GameStart:new jt([,0,500,,.04,.3,1,2,,,570,.02,.02,,,,.04]),BallBounce:new jt([,,119,.02,.01,.02,,.26,,.5,,,,,-381,,,,.01,.8]),BrickHit:new jt([,,141,,,.02,1,0,,,,,,.5,70,,,,.01]),BrickDestroy:new jt([1.37,,574,.04,.27,.3,2,2.9,.6,-.1,,,.13,1.8,,.3,,.25,.01])},rn=[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0],[0,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,3,0,1,0,3,1,0,3,1,0,3,0,1,0,3,0,1,1],[1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1],[1,0,3,0,1,0,3,1,0,3,1,0,3,0,1,0,3,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0],[0,0,1,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[3,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,3],[0,3,3,3,0,0,0,0,1,0,1,0,0,0,0,0,3,3,3,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[3,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3],[3,3,3,3,3,3,0,0,1,0,1,0,0,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,3,1,3,1,0,0,0,0,0,0,0,0,1,3,1,3,1,3],[3,1,3,3,3,1,1,1,0,0,0,0,1,1,1,3,3,3,1,3],[3,3,3,3,3,0,0,1,1,1,1,1,1,0,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,1,1,1,1,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,0,3],[3,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3],[3,3,3,3,3,3,3,3,1,0,1,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]].map(e=>e.reverse());var ht=(e=>(e[e.Empty=0]="Empty",e[e.Normal=1]="Normal",e[e.Hard=2]="Hard",e[e.Unbreakable=3]="Unbreakable",e))(ht||{});class De{constructor(t){f(this,"probabilities",[]);t&&this.setProbabilities(t)}setProbabilities(t){this.probabilities=t,this.assertProbabilitiesSumUpToOne()}pick(){this.assertProbabilitiesSumUpToOne();const t=Math.random();let s=0;for(const[i,r]of this.probabilities)if(s+=r/100,t<=s)return i;throw new Error("Failed to pick a number based on probabilities.")}*[Symbol.iterator](){for(const[t]of this.probabilities)yield t}assertProbabilitiesSumUpToOne(){if(this.probabilities.length===0)throw new Error("Probabilities should not be empty.");const t=this.probabilities.reduce((s,[,i])=>s+i,0);if(t!==100)throw new Error(`Probabilities should sum up to 100. Sum is ${t}.`)}}class Ie extends gt{constructor(s,i=h(2,1)){super(s,i);f(this,"strength",1);f(this,"hitCount",0);f(this,"tiles");f(this,"index",0);f(this,"picker");this.picker=new De([[ht.Normal,70],[ht.Hard,30]]),this.mass=0,this.angle=0,this.setCollision(!0),this.strength=this.picker.pick(),this.index=_t(0,ee.length),this.tiles=this.getTileByIndex(this.index),this.color=this.getColorByIndex(this.index),this.tileIndex=this.tiles[this.hitCount],this.tileSize=h(384,128)}get score(){return this.strength}getStrength(){return this.strength}setStrength(s){this.strength=s}increaseHitCount(){this.tileIndex=this.tiles[++this.hitCount],this.angle=C(-.3,.3)}shallBeDestroyed(){return this.hitCount>=this.strength}getColorByIndex(s){return ee[s]}getTileByIndex(s){return Cs[s]}}class an extends Ie{constructor(t,s=h(2,1)){super(t,s),this.strength=16,this.tiles=this.getTileByIndex(1),this.color=en,this.tileIndex=tn}setStrength(t){}get score(){return 0}increaseHitCount(){this.angle=C(-.01,.01),this.hitCount++}}class Ts extends Ie{constructor(t,s=h(2,1)){super(t,s)}}class on{constructor(t){f(this,"game");f(this,"levels");f(this,"index",0);f(this,"currentLevel");this.game=t,this.levels=rn.reduce((s,i)=>[...s,{map:i,bricks:i.reduce((r,n)=>r+n.reduce((a,l)=>a+(l===1?1:0),0),0)}],[]),this.currentLevel=this.levels[this.index]}showStageText(){this.game.paused&&new Ht().drawText(`Stage ${String(this.index+1).padStart(2,"0")}`,O.add(h(0,0)),.2,!0)}showClickToStartText(){(this.game.paused||this.game.over)&&new Ht().drawText("Click to Start",O.add(h(0,-5)),.1,!0)}showGameOverText(){this.game.over&&new Ht().drawText("Game Over",O.add(h(0,0)),.2,!0)}showCounterText(){const t=[`Score: ${String(this.game.score.toValue()).padStart(4,"0")}`,`Lives: ${String(this.game.lives.getValue()).padStart(2,"0")}`,`Time-Left: ${String(this.game.timeLeft).padStart(3,"0")}`,`Mode: ${this.game.modeCommand.current.displayName}`,`High-Score: ${String(this.game.score.getHighScore()).padStart(5,"0")}`];new Ht().drawText(t.join(" | "),h(k.x*.5,k.y+.5),.07,!0)}execute(t){this.index=t,this.currentLevel=this.levels[this.index],this.restart()}activateNext(){this.index=Math.min(this.index+1,this.levels.length-1),this.currentLevel=this.levels[this.index],this.restart()}restart(){this.reset(),this.populateBlocks()}pause(){this.game.paused=!0}resume(){this.game.paused=!1}reset(){this.game.balls.reset(),this.game.bricks.forEach(t=>t.destroy()),this.game.bricks.length=0,this.game.lives.restore(),this.game.score.reset(),this.game.destroyed.setVal(0),this.game.startedAt=B,this.game.modeCommand.clearTimers()}stageIsCleared(){return this.currentLevel.bricks===this.game.destroyed.getValue()}populateBlocks(){var n,a;if(this.currentLevel===null)return;const t=0,s=10,i=2,r=1;for(const[l,o]of(a=(n=this.currentLevel)==null?void 0:n.map)==null?void 0:a.entries())for(const[c,d]of o.entries()){if(d===ht.Empty)continue;const p=h(c*i+t,l*r+s);d===ht.Unbreakable&&this.game.bricks.push(new an(p)),[ht.Normal,ht.Hard].includes(d)&&this.game.bricks.push(new Ts(p))}}}class ke{constructor(t,s=0,i=9){f(this,"value");this.initialValue=t,this.MIN=s,this.MAX=i,this.value=this.apply(t)}decrement(){this.value=this.apply(--this.value)}increment(){this.value=this.apply(++this.value)}restore(){this.value=this.initialValue}add(t){this.value+=t,this.value=this.apply(this.value)}sub(t){this.value-=t,this.value=this.apply(this.value)}getValue(){return this.value}hasValue(){return this.value>0}setMax(){this.value=this.MAX}setMin(){this.value=this.MIN}setVal(t){this.value=this.apply(t)}apply(t){return Math.min(Math.max(t,this.MIN),this.MAX)}}class ln extends ke{runOut(){return!this.hasValue()}}class Me{constructor(){f(this,"head");f(this,"tail");f(this,"length");this.head=null,this.tail=null,this.length=0}add(t){const s={value:t,next:null};if(this.head===null){this.head=s,this.tail=s,this.length++;return}this.tail===null&&(this.tail=s),this.tail.next=s,this.tail=s,this.length++}remove(t){if(this.head===null)return;if(this.head.value===t){this.head=this.head.next,this.length--;return}let s=this.head;for(;s.next!==null;){if(s.next.value===t){s.next=s.next.next,this.length--;return}s=s.next}}has(t){if(this.head===null)return!1;let s=this.head;for(;s!==null;){if(s.value===t)return!0;s=s.next}return!1}*[Symbol.iterator](){if(this.head===null)return;let t=this.head;for(;t!==null;)yield t.value,t=t.next}toArray(){return[...this]}getLength(){return this.length}isEmpty(){return this.length===0}peek(){var t;return(t=this.head)==null?void 0:t.value}clear(){this.head=null,this.tail=null,this.length=0}}const Ke={BallDestroy:(e,t)=>new We(e,0,0,.1,500,3.14,-1,h(8,8),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.1,.05,.98,1,0,3.14,.1,1,!1,!1,!0),BrickHit:(e,t)=>new We(e,0,0,.1,50,.45,4,h(10,10),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.39,.05,.98,1,0,1,.1,.99,!0,!0,!1)};class Oe extends ke{constructor(t){super(t)}static getColor(t){return t===0?new g().setHex("#ffffff"):t===1?new g().setHex("#ffffff"):t===2?new g().setHex("#ffd0d0"):t===3?new g().setHex("#ffb0b0"):t===4?new g().setHex("#ff9090"):t===5?new g().setHex("#ff7070"):t===6?new g().setHex("#ff5050"):t===7?new g().setHex("#ff3030"):t===8?new g().setHex("#ff1010"):new g().setHex("#ff0000")}getColor(){return Oe.getColor(this.value)}}class hn extends gt{constructor(s,i=1){super(s,h(.25));f(this,"strength");this.strength=new Oe(i);const r=_t(0,2)===0?-1:1;this.velocity=h(.1*r,-.1),this.setCollision(!0),this.elasticity=1}collideWithObject(s){const i=s instanceof Ie,r=s instanceof Pe;return i?this.handleBrickCollision(s):r?this.handlePaddleCollision(s):!0}update(){return this.angleVelocity=this.velocity.length()*10,this.color=this.strength.getColor(),super.update()}handleBrickCollision(s){this.strength.sub(s.getStrength());const{color:i}=s;return Zt.BrickHit.play(this.pos),s.increaseHitCount(),s.shallBeDestroyed()?(Ke.BallDestroy(this.pos,i),Zt.BrickDestroy.play(this.pos),te.emit("brickDestroyed",s),s.destroy()):Ke.BrickHit(this.pos,i),!this.strength.hasValue()}handlePaddleCollision(s){this.strength.restore();const i=this.velocity.length()+.5;Zt.BallBounce.play(this.pos,1,i);const r=this.pos.x-s.pos.x;this.velocity=this.velocity.rotate(r*.3),this.velocity.y=G(this.velocity.y,.3);const n=W(1.04*this.velocity.length(),.5);return this.velocity=this.velocity.normalize().scale(n),!1}}class cn{constructor(){f(this,"MAX_BALLS",200);f(this,"balls");f(this,"picker");f(this,"strength",1);this.balls=new Me,this.picker=new De([[-.5,50],[.5,50]])}add(t){this.balls.add(t)}setStrength(t){this.strength=t}remove(t){this.balls.remove(t)}spawnOneAt(t=O){if(this.balls.getLength()<this.MAX_BALLS){const s=this.picker.pick(),i=this.picker.pick();this.add(new hn(h(t.x+s,t.y+i),this.strength))}}spawnManyAt(t=O,s=1){for(let i=0;i<s;i++)this.spawnOneAt(t)}double(){for(const t of this.balls.toArray())this.spawnOneAt(t.pos)}triple(){for(const t of this.balls.toArray())this.spawnManyAt(t.pos,2)}hasValue(){return!this.balls.isEmpty()}escaped(){return this.balls.isEmpty()}getOne(){return this.balls.peek()}update(){for(const t of this.balls)t.destroyed&&this.balls.remove(t),t.pos.y<-1&&t.destroy()}*[Symbol.iterator](){for(const t of this.balls)yield t}reset(){for(const t of this.balls)t.destroy();this.balls.clear()}}class re{constructor(t){f(this,"bonusPicker",new De);f(this,"timers",[]);this.game=t}update(){}pickBonus(){return this.bonusPicker.pick()}clearTimers(){this.timers.forEach(clearTimeout)}}var ft=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return this.None(e)},Out:function(e){return this.None(e)},InOut:function(e){return this.None(e)}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-ft.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?ft.Bounce.In(e*2)*.5:ft.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),Dt=function(){return performance.now()},dn=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(s){return t._tweens[s]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,s){t===void 0&&(t=Dt()),s===void 0&&(s=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],a=!s;n&&n.update(t,a)===!1&&!s&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),bt={Linear:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=bt.Utils.Linear;return t<0?n(e[0],e[1],i):t>1?n(e[s],e[s-1],s-i):n(e[r],e[r+1>s?s:r+1],i-r)},Bezier:function(e,t){for(var s=0,i=e.length-1,r=Math.pow,n=bt.Utils.Bernstein,a=0;a<=i;a++)s+=r(1-t,i-a)*r(t,a)*e[a]*n(i,a);return s},CatmullRom:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=bt.Utils.CatmullRom;return e[0]===e[s]?(t<0&&(r=Math.floor(i=s*(1+t))),n(e[(r-1+s)%s],e[r],e[(r+1)%s],e[(r+2)%s],i-r)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[s]-(n(e[s],e[s],e[s-1],e[s-1],i-s)-e[s]):n(e[r?r-1:0],e[r],e[s<r+1?s:r+1],e[s<r+2?s:r+2],i-r)},Utils:{Linear:function(e,t,s){return(t-e)*s+e},Bernstein:function(e,t){var s=bt.Utils.Factorial;return s(e)/s(t)/s(e-t)},Factorial:function(){var e=[1];return function(t){var s=1;if(e[t])return e[t];for(var i=t;i>1;i--)s*=i;return e[t]=s,s}}(),CatmullRom:function(e,t,s,i,r){var n=(s-e)*.5,a=(i-t)*.5,l=r*r,o=r*l;return(2*t-2*s+n+a)*o+(-3*t+3*s-2*n-a)*l+n*r+t}}},un=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),be=new dn,Es=function(){function e(t,s){s===void 0&&(s=be),this._object=t,this._group=s,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ft.Linear.None,this._interpolationFunction=bt.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=un.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(t,s){if(s===void 0&&(s=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=s,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,s){if(t===void 0&&(t=Dt()),s===void 0&&(s=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||s){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var n in this._valuesEnd)r[n]=this._valuesEnd[n];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,s)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,s,i,r,n){for(var a in i){var l=t[a],o=Array.isArray(l),c=o?"array":typeof l,d=!o&&Array.isArray(i[a]);if(!(c==="undefined"||c==="function")){if(d){var p=i[a];if(p.length===0)continue;for(var y=[l],v=0,x=p.length;v<x;v+=1){var P=this._handleRelativeValue(l,p[v]);if(isNaN(P)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}y.push(P)}d&&(i[a]=y)}if((c==="object"||o)&&l&&!d){s[a]=o?[]:{};var T=l;for(var _ in T)s[a][_]=T[_];r[a]=o?[]:{};var p=i[a];if(!this._isDynamic){var D={};for(var _ in p)D[_]=p[_];i[a]=p=D}this._setupProperties(T,s[a],p,r[a],n)}else(typeof s[a]>"u"||n)&&(s[a]=l),o||(s[a]*=1),d?r[a]=i[a].slice().reverse():r[a]=s[a]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=Dt()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=Dt()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,s=this._chainedTweens.length;t<s;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=be),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=ft.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=bt.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,s){if(t===void 0&&(t=Dt()),s===void 0&&(s=!0),this._isPaused)return!0;var i,r,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>n)return!1;s&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=this._duration===0||r>1?1:r;var a=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var l=0,o=this._chainedTweens.length;l<o;l++)this._chainedTweens[l].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,s,i,r){for(var n in i)if(s[n]!==void 0){var a=s[n]||0,l=i[n],o=Array.isArray(t[n]),c=Array.isArray(l),d=!o&&c;d?t[n]=this._interpolationFunction(l,r):typeof l=="object"&&l?this._updateProperties(t[n],a,l,r):(l=this._handleRelativeValue(a,l),typeof l=="number"&&(t[n]=a+(l-a)*r))}},e.prototype._handleRelativeValue=function(t,s){return typeof s!="string"?s:s.charAt(0)==="+"||s.charAt(0)==="-"?t+parseFloat(s):parseFloat(s)},e.prototype._swapEndStartRepeatValues=function(t){var s=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s},e}(),X=be;X.getAll.bind(X);X.removeAll.bind(X);X.add.bind(X);X.remove.bind(X);X.update.bind(X);class Qe extends re{constructor(s){super(s);f(this,"displayName","Dynamic");f(this,"timeout",1e4);f(this,"tweens",new Me);this.bonusPicker.setProbabilities([[w.ExtraScore,20],[w.ExtraStrength,20],[w.PaddleIncrease,20],[w.PaddleDecrease,40]])}apply(){console.info("Dynamic mode activated"),this.timers.push(setInterval(()=>{for(const s of this.game.bricks){const i=new Es(s.pos);i.to({y:s.pos.y-1},500),i.easing(ft.Bounce.Out),i.start(),this.tweens.add(i)}},this.timeout))}update(){for(const s of this.tweens)s.update()}}class $e extends re{constructor(s){super(s);f(this,"displayName","Classic")}apply(){console.info("Classic mode activated"),this.game.bricks.forEach(s=>{s.setStrength(1)})}}class ts extends re{constructor(s){super(s);f(this,"displayName","Bonus");f(this,"timeout",3e3);f(this,"tweens",new Me);this.bonusPicker.setProbabilities([[w.DoubleBalls,10],[w.TripleBalls,10],[w.ExtraBalls,30],[w.ExtraScore,30],[w.ExtraWall,20]])}apply(){console.info("Bonus mode activated"),this.game.balls.setStrength(9),this.timers.push(setInterval(()=>{for(const s of this.game.bricks){const i=new Es(s.pos);i.to({y:s.pos.y-1},900),i.easing(ft.Bounce.Out),i.start(),this.tweens.add(i)}},this.timeout))}update(){for(const s of this.tweens)s.update()}}class es extends re{constructor(s){super(s);f(this,"displayName","Modern");this.bonusPicker.setProbabilities([[w.DoubleBalls,5],[w.TripleBalls,5],[w.ExtraBalls,15],[w.ExtraScore,15],[w.ExtraWall,10],[w.ExtraStrength,20],[w.PaddleDecrease,15],[w.PaddleIncrease,15]])}apply(){console.info("Modern mode activated")}}class fn{constructor(t){f(this,"modes");f(this,"currentMode");this.modes={[at.Dynamic]:new Qe(t),[at.Classic]:new $e(t),[at.Bonus]:new ts(t),[at.Modern]:new es(t)},this.currentMode=this.modes[at.Classic]}get current(){return this.currentMode}execute(t){this.clearTimers(),this.currentMode=this.modes[t],this.currentMode.apply()}update(){this.currentMode.update()}setDefault(){this.execute(at.Dynamic)}modeIsDynamic(){return this.currentMode instanceof Qe}modeIsClassic(){return this.currentMode instanceof $e}modeIsBonus(){return this.currentMode instanceof ts}modeIsModern(){return this.currentMode instanceof es}pickBonusType(){return this.currentMode.pickBonus()}clearTimers(){this.currentMode.clearTimers()}}ji(ws.enabled());ws.disabled()&&Wi(-1);class gn{constructor(){f(this,"paddle",null);f(this,"balls");f(this,"bricks",[]);f(this,"floor",null);f(this,"over",!1);f(this,"paused",!0);f(this,"idle",!1);f(this,"startedAt",0);f(this,"levelTime",90);f(this,"lives");f(this,"score");f(this,"destroyed");f(this,"modeCommand");f(this,"bonusCommand");f(this,"stageCommand");this.init=this.init.bind(this),this.update=this.update.bind(this),this.postUpdate=this.postUpdate.bind(this),this.render=this.render.bind(this),this.postRender=this.postRender.bind(this),this.onBonusCollected=this.onBonusCollected.bind(this),this.onBrickDestroyed=this.onBrickDestroyed.bind(this),this.balls=new cn,this.score=new Gi(0),this.destroyed=new ke(0,0,999),this.lives=new ln(3),this.bonusCommand=new nn(this),this.stageCommand=new on(this),this.modeCommand=new fn(this)}run(t,s){this.modeCommand.execute(t),this.stageCommand.execute(s),Li(this.init,this.update,this.postUpdate,this.render,this.postRender,Xi),te.on("bonusCollected",this.onBonusCollected),te.on("brickDestroyed",this.onBrickDestroyed)}init(){Hi(new S(1280,720)),Ni(k.scale(.5)),this.paddle=new Pe(k),new qt(h(-.5,k.y*.5),h(1,k.y)),new qt(h(k.x+.5,k.y*.5),h(1,k.y)),new qt(h(k.x*.5,k.y),h(k.x+2,1)),this.startedAt=B,this.stageCommand.restart()}update(){const t=ii(0)||ni(0);if(t&&(this.startedAt=B,this.paused=!1,this.over=!1),!this.over&&!this.paused){if(this.balls.update(),this.balls.escaped()&&!this.idle){if(this.lives.decrement(),this.lives.runOut())return this.over=!0,console.info("Game over");this.idle=!0}t&&!this.balls.hasValue()&&this.lives.hasValue()&&(Zt.GameStart.play(),this.balls.spawnOneAt(O),this.idle=!1)}}postUpdate(){this.modeCommand.update(),this.stageCommand.stageIsCleared()&&(console.log("winner"),this.stageCommand.pause(),this.stageCommand.activateNext())}render(){lt(O,h(100,100),new g().setHex("#494746")),lt(O,k,new g().setHex("#ce9a80"))}postRender(){this.stageCommand.showCounterText(),this.stageCommand.showClickToStartText(),this.stageCommand.showGameOverText(),this.stageCommand.showStageText()}onBonusCollected(t){this.bonusCommand.collect(t)}onBrickDestroyed(t){this.score.add(t.score),t instanceof Ts&&this.destroyed.increment(),!this.modeCommand.modeIsClassic()&&this.score.toValue()%1===0&&this.bonusCommand.produce(this.modeCommand.pickBonusType())}get timeLeft(){const t=Math.floor(B-this.startedAt);return this.levelTime-t}}const it=document.getElementById("lobby"),ve=it.querySelector("select"),pn=it.querySelector("#start"),Se=it.querySelectorAll("button.block"),et={ref:Se[0],level:+Se[0].value,mode:+ve.value};pn.addEventListener("click",e=>{e.preventDefault(),it.close(ve.value),et.mode=+ve.value});Se.forEach(e=>{e.addEventListener("click",t=>{et.ref.classList.remove("selected"),et.ref=e,et.level=+e.value,et.ref.classList.add("selected")})});it.showModal();console.info("Is development mode:",ks.isDevelopment());const yn=new gn;it.addEventListener("close",e=>{["0","1","2"].includes(it.returnValue)||it.showModal(),yn.run(et.mode,et.level),console.log(et)});
//# sourceMappingURL=index-137e0931.js.map
