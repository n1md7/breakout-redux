var ln=Object.defineProperty;var cn=(e,t,s)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var g=(e,t,s)=>(cn(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();var wt=(e=>(e.development="development",e.production="production",e.githubPages="github",e.crazyGames="crazy",e.itchIo="itch",e.unitTest="test",e.e2eTest="e2e",e))(wt||{}),R=(e=>(e[e.Classic=0]="Classic",e[e.Dynamic=1]="Dynamic",e[e.Modern=2]="Modern",e[e.Bonus=3]="Bonus",e[e.Empty=4]="Empty",e))(R||{});class hn{constructor(t){this.mode=t}isDevelopment(){return this.mode===wt.development}isCrazyGames(){return this.mode===wt.crazyGames}isItchIo(){return this.mode===wt.itchIo}isGithubPages(){return this.mode===wt.githubPages}isUnitTest(){return this.mode===wt.unitTest}isE2ETest(){return this.mode===wt.e2eTest}}const Be=new hn("github"),un=1,dn=.5;let te=1,Te=0,ii=27,Lt=[],_t=0,Ct=0,Tt=0,Yt=0,ts,qt;const $=(...e)=>console.assert(...e),ne=(e,t=d(),s="#fff",i=0,r=0,n=!1)=>{$(typeof s=="string"),Lt.push({pos:e,size:d(t),color:s,time:new ze(i),angle:r,fill:n})},Ms=(e,t=0,s="#fff",i=0,r=!1)=>{$(typeof s=="string"),Lt.push({pos:e,size:t,color:s,time:new ze(i),angle:0,fill:r})},fn=(e,t,s,i)=>ne(e,0,t,s,i),gn=(e,t,s,i=.1,r)=>{const n=d((t.x-e.x)/2,(t.y-e.y)/2),a=d(i,n.length()*2);ne(e.add(n),a,s,r,n.angle(),1)},Os=(e,t,s,i,r)=>{const n=d(it(e.x-t.x/2,s.x-i.x/2),it(e.y-t.y/2,s.y-i.y/2)),a=d(nt(e.x+t.x/2,s.x+i.x/2),nt(e.y+t.y/2,s.y+i.y/2));ne(n.lerp(a,.5),a.subtract(n),r)},pn=(e,t,s=1,i="#fff",r=0,n=0,a="monospace")=>{$(typeof i=="string"),Lt.push({text:e,pos:t,size:s,color:i,time:new ze(r),angle:n,font:a})},yn=(e,t=Ss+".png")=>{qt.download="screenshot.png",qt.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),qt.click()},mn=()=>{document.body.appendChild(qt=document.createElement("a")),qt.style.display="none"},bn=()=>{ct(ii)&&(_t=!_t),_t&&(ct(48)&&(te=!te),ct(49)&&(Ct=!Ct,Tt=0),ct(50)&&(Tt=!Tt,Ct=0),ct(51)&&(Yt=!Yt),ct(52)&&(Te=!Te),ct(53)&&(ts=1))},wn=()=>{if(Se(Y),ts&&(Se(Y,1),Y.drawImage(lt,0,0),lt.width|=0,yn(x),ts=0),Yt&&Dn&&navigator.getGamepads){const e=navigator.getGamepads();for(let t=e.length;t--;){const s=e[t];if(s){const n=G,a=ss[t];for(let o=a.length;o--;){const l=n.add(d(o*1*2,t*1*3)),h=l.add(a[o].scale(1));Ms(l,1,"#fff7",0,1),gn(l,h,"#f00"),fn(h,"#f00")}for(let o=s.buttons.length;o--;){const l=n.add(d(o*.2*2,t*1*3-1-.2)),h=s.buttons[o].pressed;Ms(l,.2,h?"#f00":"#fff7",0,1),pn(o,l,.2)}}}}if(_t){const e=Y;Y=p;let t=1/0,s;for(const i of st){if(i.canvas||i.destroyed||!i.size.x||!i.size.y)continue;const r=ft.distanceSquared(i.pos);r<t&&(t=r,s=i);const n=d(nt(i.size.x,.2),nt(i.size.y,.2)),a=new y(!!i.collideTiles,!!i.collideSolidObjects,!!i.isSolid,i.parent?.2:.5),o=i.parent?new y(1,1,1,.5):new y(0,0,0,.8);vt(i.pos,n,a,i.angle,0),vt(i.pos,n.scale(.8),o,i.angle,0),i.parent&&Ls(i.pos,i.parent.pos,.1,new y(0,0,1,.5),0)}if(s){const i=Un(s.pos,ft);i&&vt(i.floor().add(d(.5)),d(1),new y(0,1,1,.3)),vt(ft.floor().add(d(.5)),d(1),new y(0,0,1,.5),0,0),Ls(ft,s.pos,.1,i?new y(1,0,0,.5):new y(0,1,0,.5),0);const r="mouse pos = "+ft+`
mouse collision = `+fi(ft)+`

--- object info ---
`+s.toString();$n(r,ms,24,new y,.05,0,0,"monospace")}Se(Y=e)}{p.lineWidth=2;const e=dn*X;Lt.forEach(t=>{p.save();const s=Le(t.pos);if(p.translate(s.x|0,s.y|0),p.rotate(t.angle),p.fillStyle=p.strokeStyle=t.color,t.text!=null)p.font=t.size*X+"px "+t.font,p.textAlign="center",p.textBaseline="middle",p.fillText(t.text,0,0);else if(t.size==0||t.size.x===0&&t.size.y===0)p.fillRect(-e/2,-1,e,3),p.fillRect(-1,-e/2,3,e);else if(t.size.x!=null){const i=t.size.x*X|0,r=t.size.y*X|0;t.fill&&p.fillRect(-i/2|0,-r/2|0,i,r),p.strokeRect(-i/2|0,-r/2|0,i,r)}else p.beginPath(),p.arc(0,0,t.size*X,0,9),t.fill&&p.fill(),p.stroke();p.restore()}),Lt=Lt.filter(t=>t.time<0)}{p.save(),p.fillStyle="#fff",p.textAlign="left",p.textBaseline="top",p.font="28px monospace",p.shadowColor="#000",p.shadowBlur=9;let e=9,t=-20,s=30;if(_t){p.fillText(Ss,e,t+=s),p.fillText("Objects: "+st.length,e,t+=s),p.fillText("Time: "+xn(q),e,t+=s),p.fillText("---------",e,t+=s),p.fillStyle="#f00",p.fillText("ESC: Debug Overlay",e,t+=s),p.fillStyle=Ct?"#f00":"#fff",p.fillText("1: Debug Physics",e,t+=s),p.fillStyle=Tt?"#f00":"#fff",p.fillText("2: Debug Particles",e,t+=s),p.fillStyle=Yt?"#f00":"#fff",p.fillText("3: Debug Gamepads",e,t+=s),p.fillStyle=Te?"#f00":"#fff",p.fillText("4: God Mode",e,t+=s),p.fillStyle="#fff",p.fillText("5: Save Screenshot",e,t+=s);let i="";for(const n in U[0])n&&ee(n,0)&&(i+=n+" ");i&&p.fillText("Keys Down: "+i,e,t+=s);let r="";if(U[1])for(const n in U[1])n&&ee(n,1)&&(r+=n+" ");r&&p.fillText("Gamepad: "+r,e,t+=s)}else p.fillText(Ct?"Debug Physics":"",e,t+=s),p.fillText(Tt?"Debug Particles":"",e,t+=s),p.fillText(Te?"God Mode":"",e,t+=s),p.fillText(Yt?"Debug Gamepads":"",e,t+=s);p.restore()}},ke=Math.PI,Z=e=>e<0?-e:e,it=(e,t)=>e<t?e:t,nt=(e,t)=>e>t?e:t,Nt=e=>e<0?-1:1,L=(e,t=0,s=1)=>e<t?t:e>s?s:e,jt=(e,t=0,s=1)=>s-t?L((e-t)/(s-t)):0,Gt=(e,t=0,s=1)=>t+L(e)*(s-t),Is=(e,t,s,i)=>Z(e.x-s.x)*2<t.x+i.x&&Z(e.y-s.y)*2<t.y+i.y,xn=e=>(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0),P=(e=1,t=0)=>t+(e-t)*Math.random(),Ht=(e=1,t=0)=>P(e,t)|0,Sn=()=>Ht(2)*2-1,vn=(e=1,t=0)=>e>0?ni(e*P(t/e,1)**.5):new _,ni=(e=1)=>new _().setAngle(P(2*ke),e),$s=(e=new y,t=new y(0,0,0,1),s)=>s?e.lerp(t,P()):new y(P(e.r,t.r),P(e.g,t.g),P(e.b,t.b),P(e.a,t.a)),d=(e=0,t)=>e.x==null?new _(e,t??e):new _(e.x,e.y),tt=e=>!isNaN(e.x)&&!isNaN(e.y);class _{constructor(t=0,s=0){this.x=t,this.y=s}copy(){return new _(this.x,this.y)}add(t){return $(tt(t)),new _(this.x+t.x,this.y+t.y)}subtract(t){return $(tt(t)),new _(this.x-t.x,this.y-t.y)}multiply(t){return $(tt(t)),new _(this.x*t.x,this.y*t.y)}divide(t){return $(tt(t)),new _(this.x/t.x,this.y/t.y)}scale(t){return $(!tt(t)),new _(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new _(0,t)}clampLength(t=1){const s=this.length();return s>t?this.scale(t/s):this}dot(t){return $(tt(t)),this.x*t.x+this.y*t.y}cross(t){return $(tt(t)),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new _(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return Z(this.x)>Z(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new _(this.y,-this.x)}floor(){return new _(Math.floor(this.x),Math.floor(this.y))}area(){return Z(this.x*this.y)}lerp(t,s){return $(tt(t)),this.add(t.subtract(this).scale(L(s)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class y{constructor(t=1,s=1,i=1,r=1){this.r=t,this.g=s,this.b=i,this.a=r}copy(){return new y(this.r,this.g,this.b,this.a)}add(t){return new y(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new y(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new y(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new y(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,s=t){return new y(this.r*t,this.g*t,this.b*t,this.a*s)}clamp(){return new y(L(this.r),L(this.g),L(this.b),L(this.a))}lerp(t,s){return this.add(t.subtract(this).scale(L(s)))}setHSLA(t=0,s=0,i=1,r=1){const n=i<.5?i*(1+s):i+s-i*s,a=2*i-n,o=(l,h,c)=>(c=(c%1+1)%1)<1/6?l+(h-l)*6*c:c<1/2?h:c<2/3?l+(h-l)*(2/3-c)*6:l;return this.r=o(a,n,t+1/3),this.g=o(a,n,t),this.b=o(a,n,t-1/3),this.a=r,this}getHSLA(){const t=L(this.r),s=L(this.g),i=L(this.b),r=L(this.a),n=Math.max(t,s,i),a=Math.min(t,s,i),o=(n+a)/2;let l=0,h=0;if(n!=a){let c=n-a;h=o>.5?c/(2-n-a):c/(n+a),t==n?l=(s-i)/c+(s<i?6:0):s==n?l=(i-t)/c+2:i==n&&(l=(t-s)/c+4)}return[l/6,h,o,r]}mutate(t=.05,s=0){return new y(this.r+P(t,-t),this.g+P(t,-t),this.b+P(t,-t),this.a+P(s,-s)).clamp()}toString(t=1){const s=i=>((i=i*255|0)<16?"0":"")+i.toString(16);return"#"+s(this.r)+s(this.g)+s(this.b)+(t?s(this.a):"")}setHex(t){const s=i=>L(parseInt(t.slice(i,i+2),16)/255);return this.r=s(1),this.g=s(3),this.b=s(5),this.a=t.length>7?s(7):1,this}rgbaInt(){const t=a=>L(a)*255|0,s=t(this.r),i=t(this.g)<<8,r=t(this.b)<<16,n=t(this.a)<<24;return s+i+r+n}}class ze{constructor(t){this.time=t==null?void 0:q+t,this.setTime=t}set(t=0){this.time=q+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return q<=this.time}elapsed(){return q>this.time}get(){return this.isSet()?q-this.time:0}getPercent(){return this.isSet()?jt(this.time-q,this.setTime,0):0}toString(){return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}valueOf(){return this.get()}}let G=d(),X=32,Bs=d(1920,1200),we=d(),ri=1,_n="arial",ai=1,Re=d(16),Wt=.3,Cn=1,Tn=1,kn=1,En=0,An=.8,de=1,fe=0,zs=1,Dn=1,Zt=1,oi=.5,Pn=40,Mn=.7,Rs=5,ge=.5;d(640,80);class Pt{constructor(t=d(),s=d(1),i=-1,r=Re,n=0,a,o=0){$(tt(t)&&tt(s)),this.pos=t.copy(),this.size=s,this.drawSize,this.tileIndex=i,this.tileSize=r,this.angle=n,this.color=a,this.additiveColor,this.mass=Cn,this.damping=Tn,this.angleDamping=kn,this.elasticity=En,this.friction=An,this.gravityScale=1,this.renderOrder=o,this.velocity=new _,this.angleVelocity=0,this.spawnTime=q,this.children=[],this.collideTiles=1,st.push(this)}update(){const t=this.parent;if(t){this.pos=this.localPos.multiply(d(t.getMirrorSign(),1)).rotate(-t.angle).add(t.pos),this.angle=t.getMirrorSign()*this.localAngle+t.angle;return}this.velocity.x=L(this.velocity.x,-de,de),this.velocity.y=L(this.velocity.y,-de,de);const s=this.pos.copy();if(this.velocity.y+=fe*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,$(this.angleDamping>=0&&this.angleDamping<=1),$(this.damping>=0&&this.damping<=1),!this.mass)return;const i=this.velocity.y<0;if(this.groundObject){const r=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=r+(this.velocity.x-r)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const n of _i){if(!this.isSolid&!n.isSolid||n.destroyed||n.parent||n==this||!Is(this.pos,this.size,n.pos,n.size)||!this.collideWithObject(n)|!n.collideWithObject(this))continue;if(Is(s,this.size,n.pos,n.size)){const u=s.subtract(n.pos),f=u.length(),m=.001,b=f<.01?ni(m):u.scale(m/f);this.velocity=this.velocity.add(b),n.mass&&(n.velocity=n.velocity.subtract(b)),_t&&Ct&&Os(this.pos,this.size,n.pos,n.size,"#f00");continue}const a=this.size.add(n.size),o=(s.y-n.pos.y)*2>a.y+fe,l=Z(s.y-n.pos.y)*2<a.y,h=Z(s.x-n.pos.x)*2<a.x,c=nt(this.elasticity,n.elasticity);if(o|h|!l){if(this.pos.y=n.pos.y+(a.y/2+.001)*Nt(s.y-n.pos.y),n.groundObject&&i||!n.mass)i&&(this.groundObject=n),this.velocity.y*=-c;else if(n.mass){const u=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),f=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),m=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=Gt(c,u,f),n.velocity.y=Gt(c,u,m)}}if(!o&l)if(this.pos.x=n.pos.x+(a.x/2+.001)*Nt(s.x-n.pos.x),n.mass){const u=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),f=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),m=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=Gt(c,u,f),n.velocity.x=Gt(c,u,m)}else this.velocity.x*=-c;_t&&Ct&&Os(this.pos,this.size,n.pos,n.size,"#f0f")}if(this.collideTiles&&ye(this.pos,this.size,this)&&!ye(s,this.size,this)){const r=ye(new _(s.x,this.pos.y),this.size,this),n=ye(new _(this.pos.x,s.y),this.size,this);if(r|!n){this.groundObject=i,this.velocity.y*=-this.elasticity;const a=(s.y-this.size.y/2|0)-(s.y-this.size.y/2);a<0&&a>this.damping*this.velocity.y+fe*this.gravityScale&&(this.velocity.y=this.damping?(a-fe*this.gravityScale)/this.damping:0),this.pos.y=s.y}n&&(this.pos.x=s.x,this.velocity.x*=-this.elasticity)}}render(){Ee(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}collideWithTile(t,s){return t>0}collideWithTileRaycast(t,s){return t>0}collideWithObject(t){return 1}getAliveTime(){return q-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,s=d(),i=0){$(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this,t.localPos=s.copy(),t.localAngle=i}removeChild(t){$(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=1,s=1,i=1){$(t||!s),this.collideSolidObjects=t,this.isSolid=s,this.collideTiles=i}toString(){{let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+=`
pos = `+this.pos),(this.velocity.x||this.velocity.y)&&(t+=`
velocity = `+this.velocity),(this.size.x||this.size.y)&&(t+=`
size = `+this.size),this.angle&&(t+=`
angle = `+this.angle.toFixed(3)),this.color&&(t+=`
color = `+this.color),t}}}let x,Y,lt,p,pt=d();const et=new Image;let Vt,Xt,es;const On=e=>($(pt.x&&pt.y,"mainCanvasSize is invalid"),e.add(d(.5)).subtract(pt.scale(.5)).multiply(d(1/X,-1/X)).add(G)),Le=e=>($(pt.x&&pt.y,"mainCanvasSize is invalid"),e.subtract(G).multiply(d(X,-X)).add(pt.scale(.5)).subtract(d(.5)));function Ee(e,t=d(1),s=-1,i=Re,r=new y,n=0,a,o=new y(0,0,0,0),l=ai){if(te&&++es,l)if(s<0||!et.width)Fs(e.x,e.y,t.x,t.y,n,0,0,0,0,0,r.rgbaInt());else{const h=Vt.x/i.x|0,c=i.x/Vt.x,u=i.y/Vt.y,f=s%h*c,m=(s/h|0)*u;Fs(e.x,e.y,a?-t.x:t.x,t.y,n,f+Xt.x,m+Xt.y,f-Xt.x+c,m-Xt.y+u,r.rgbaInt(),o.rgbaInt())}else In(e,t,n,a,h=>{if(s<0)h.fillStyle=r,h.fillRect(-.5,-.5,1,1);else{const c=Vt.x/i.x|0,u=s%c*i.x+Wt,f=(s/c|0)*i.y+Wt,m=i.x-2*Wt,b=i.y-2*Wt;h.globalAlpha=r.a,h.drawImage(et,u,f,m,b,-.5,-.5,1,1)}})}function vt(e,t,s,i,r){Ee(e,t,-1,Re,s,i,0,0,r)}function Ls(e,t,s=.1,i,r){const n=d((t.x-e.x)/2,(t.y-e.y)/2),a=d(s,n.length()*2);vt(e.add(n),a,i,n.angle(),r)}function In(e,t,s,i,r,n=Y){e=Le(e),t=t.scale(X),n.save(),n.translate(e.x+.5|0,e.y+.5|0),n.rotate(s),n.scale(i?-t.x:t.x,t.y),r(n),n.restore()}function Ns(e,t=ai){t?yi(e):Y.globalCompositeOperation=e?"lighter":"source-over"}function $n(e,t,s=1,i=new y,r=0,n=new y(0,0,0),a="center",o=_n,l=p){l.fillStyle=i,l.lineWidth=r,l.strokeStyle=n,l.textAlign=a,l.font=s+"px "+o,l.textBaseline="middle",l.lineJoin="round",t=t.copy(),(e+"").split(`
`).forEach(h=>{r&&l.strokeText(h,t.x,t.y),l.fillText(h,t.x,t.y),t.y+=s})}let Ve;class Xe{constructor(t,s=d(8),i=d(0,1),r=0,n=p){Ve||((Ve=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||Ve,this.tileSize=s,this.paddingSize=i,this.startTileIndex=r,this.context=n}drawTextScreen(t,s,i=4,r){const n=this.context;n.save(),n.imageSmoothingEnabled=!ri;const a=this.tileSize,o=a.add(this.paddingSize).scale(i),l=this.image.width/this.tileSize.x|0;(t+"").split(`
`).forEach((h,c)=>{const u=r?h.length*a.x*i/2|0:0;for(let f=h.length;f--;){let m=h[f].charCodeAt();(m<32||m>127)&&(m=127);const b=this.startTileIndex+m-32,E=b%l,A=b/l|0,T=s.add(d(f,c).multiply(o));n.drawImage(this.image,E*a.x,A*a.y,a.x,a.y,T.x-u,T.y,a.x*i,a.y*i)}}),n.restore()}drawText(t,s,i=1,r){this.drawTextScreen(t,Le(s).floor(),i*X|0,r)}}const ee=(e,t=0)=>U[t]&&U[t][e]&1,ct=(e,t=0)=>U[t]&&U[t][e]&2?1:0,Bn=()=>U=[[]],ys=ct;let ft=d(),ms=d(),bs=0;const It=(e,t=0)=>ee(e,t+1),ws=(e,t=0)=>ct(e,t+1);let U=[[]];function zn(){ci||document.hasFocus()||Bn(),ft=On(ms),Nn()}function Rn(){for(const e of U)for(const t in e)e[t]&=1}onkeydown=e=>{e.target==document.body&&(e.repeat||(U[bs=0][li(e.which)]=3))};onkeyup=e=>{e.target==document.body&&(U[0][li(e.which)]=4)};const li=e=>e==87?38:e==83?40:e==65?37:e==68?39:e;onmousedown=e=>{U[bs=0][e.button]=3,onmousemove(e),e.button&&e.preventDefault()};onmouseup=e=>U[0][e.button]=U[0][e.button]&2|4;onmousemove=e=>ms=Ln(e);onwheel=e=>e.ctrlKey||Nt(e.deltaY);oncontextmenu=e=>!1;const Ln=e=>{if(!x)return d();const t=x.getBoundingClientRect();return d(x.width,x.height).multiply(d(jt(e.x,t.left,t.right),jt(e.y,t.top,t.bottom)))},ss=[];function Nn(){if(!navigator||!navigator.getGamepads||!document.hasFocus()&&!un)return;const e=navigator.getGamepads();for(let t=e.length;t--;){const s=e[t],i=U[t+1]||(U[t+1]=[]),r=ss[t]||(ss[t]=[]);if(s){const o=l=>l>.3?jt(l,.3,.8):l<-.3?-jt(-l,.3,.8):0;for(let l=0;l<s.axes.length-1;l+=2)r[l>>1]=d(o(s.axes[l]),o(-s.axes[l+1])).clampLength();for(let l=s.buttons.length;l--;){const h=s.buttons[l];i[l]=h.pressed?1+2*!It(l,t):4*It(l,t),bs|=!t&&h.pressed}{const l=d(It(15,t)-It(14,t),It(12,t)-It(13,t));l.lengthSquared()&&(r[0]=l.clampLength())}}}}const ci=window.ontouchstart!==void 0;if(ci){let e,t=onmousedown,s=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=i=>(jn(0),ontouchstart=ontouchmove=ontouchend=r=>{r.button=0;const n=r.touches.length;return n?(r.x=r.touches[0].clientX,r.y=r.touches[0].clientY,e?onmousemove(r):t(r)):e&&s(r),e=n,!0},ontouchstart(i))}new ze;let pe=class{constructor(t,s=Pn,i=Mn){Zt&&(this.range=s,this.taper=i,this.randomness=t[1]||0,t[1]=0,this.cachedSamples=ui(...t))}play(t,s=1,i=1,r=1){if(!Zt)return;let n;if(t){const o=this.range;if(o){const l=G.distanceSquared(t);if(l>o*o)return;s*=jt(l**.5,o,o*this.taper)}n=Le(t).x*2/x.width-1}const a=i+i*this.randomness*r*P(-1,1);return hi([this.cachedSamples],s,a,n)}playNote(t,s,i){if(Zt)return this.play(s,i,2**(t/12),0)}},ot;function hi(e,t=1,s=1,i=0,r=0){if(!Zt||(ot||(ot=new AudioContext),ot.resume(),ot.state!="running"))return;const n=ot.createBuffer(e.length,e[0].length,W),a=ot.createBufferSource();e.forEach((l,h)=>n.getChannelData(h).set(l)),a.buffer=n,a.playbackRate.value=s,a.loop=r;const o=ot.createGain();return o.gain.value=oi*t,o.connect(ot.destination),a.connect(new StereoPannerNode(ot,{pan:L(i,-1,1)})).connect(o),a.start(),a}const jn=(...e)=>hi([ui(...e)]),W=44100;function ui(e=1,t=.05,s=220,i=0,r=0,n=.1,a=0,o=1,l=0,h=0,c=0,u=0,f=0,m=0,b=0,E=0,A=0,T=1,v=0,B=0){let k=ke*2,J=l*=500*k/W/W,bt=[],he=s*=(1+t*P(-1,1))*k/W,at=0,ue=0,N=0,Mt=1,Ge=0,on=0,dt=0,We,Ot;for(i=i*W+9,v*=W,r*=W,n*=W,A*=W,h*=500*k/W**3,b*=k/W,c*=k/W,u*=W,f=f*W|0,Ot=i+v+r+n+A|0;N<Ot;bt[N++]=dt)++on%(E*100|0)||(dt=a?a>1?a>2?a>3?Math.sin((at%k)**3):nt(it(Math.tan(at),1),-1):1-(2*at/k%2+2)%2:1-4*Z(Math.round(at/k)-at/k):Math.sin(at),dt=(f?1-B+B*Math.sin(k*N/f):1)*Nt(dt)*Z(dt)**o*e*oi*(N<i?N/i:N<i+v?1-(N-i)/v*(1-T):N<i+v+r?T:N<Ot-A?(Ot-N-A)/n*T:0),dt=A?dt/2+(A>N?0:(N<Ot-A?1:(Ot-N)/A)*bt[N-A|0]/2):dt),We=(s+=l+=h)*Math.cos(b*ue++),at+=We-We*m*(1-(Math.sin(N)+1)*1e9%2),Mt&&++Mt>u&&(s+=c,he+=c,Mt=0),f&&!(++Ge%f)&&(s=he,l=J,Mt||(Mt=1));return bt}let di=[],Qt=d();const fi=e=>e.arrayCheck(Qt)?di[(e.y|0)*Qt.x+e.x|0]:0;function ye(e,t=d(),s){const i=nt(e.x-t.x/2|0,0),r=nt(e.y-t.y/2|0,0),n=it(e.x+t.x/2,Qt.x),a=it(e.y+t.y/2,Qt.y);for(let o=r;o<a;++o)for(let l=i;l<n;++l){const h=di[o*Qt.x+l];if(h&&(!s||s.collideWithTile(h,new _(l,o))))return 1}}function Un(e,t,s){const i=(t=t.floor()).subtract(e=e.floor()),r=Z(i.x),n=-Z(i.y),a=Nt(i.x),o=Nt(i.y);for(let l=e.x,h=e.y,c=r+n;;){const u=fi(d(l,h));if(u&&(s?s.collideWithTileRaycast(u,new _(l,h)):u>0))return new _(l+.5,h+.5);if(l==t.x&h==t.y)break;const f=2*c;f>=n&&(c+=n,l+=a),f<=r&&(c+=r,h+=o)}}class js extends Pt{constructor(t,s,i=0,r=0,n=100,a=ke,o=-1,l=Re,h=new y,c=new y,u=new y(1,1,1,0),f=new y(1,1,1,0),m=.5,b=.1,E=1,A=.1,T=.05,v=1,B=1,k=0,J=ke,bt=.1,he=.2,at,ue,N=1,Mt=ue?1e9:0,Ge){super(t,new _,o,l,s,void 0,Mt),this.emitSize=i,this.emitTime=r,this.emitRate=n,this.emitConeAngle=a,this.colorStartA=h,this.colorStartB=c,this.colorEndA=u,this.colorEndB=f,this.randomColorLinear=N,this.particleTime=m,this.sizeStart=b,this.sizeEnd=E,this.speed=A,this.angleSpeed=T,this.damping=v,this.angleDamping=B,this.gravityScale=k,this.particleConeAngle=J,this.fadeRate=bt,this.randomness=he,this.collideTiles=at,this.additive=ue,this.localSpace=Ge,this.trailScale=0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime|this.getAliveTime()<=this.emitTime){if(this.emitRate*zs){const t=1/this.emitRate/zs;for(this.emitTimeBuffer+=vi;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy();Tt&&ne(this.pos,d(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let t=this.emitSize.x!=null?new _(P(-.5,.5),P(-.5,.5)).multiply(this.emitSize).rotate(this.angle):vn(this.emitSize/2),s=P(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),s+=this.angle);const i=new Fn(t,this.tileIndex,this.tileSize,s),r=this.randomness,n=E=>E+E*P(r,-r),a=n(this.particleTime),o=n(this.sizeStart),l=n(this.sizeEnd),h=n(this.speed),c=n(this.angleSpeed)*Sn(),u=P(this.emitConeAngle,-this.emitConeAngle),f=$s(this.colorStartA,this.colorStartB,this.randomColorLinear),m=$s(this.colorEndA,this.colorEndB,this.randomColorLinear),b=this.localSpace?u:this.angle+u;return i.colorStart=f,i.colorEndDelta=m.subtract(f),i.velocity=new _().setAngle(b,h),i.angleVelocity=c,i.lifeTime=a,i.sizeStart=o,i.sizeEndDelta=l-o,i.fadeRate=this.fadeRate,i.damping=this.damping,i.angleDamping=this.angleDamping,i.elasticity=this.elasticity,i.friction=this.friction,i.gravityScale=this.gravityScale,i.collideTiles=this.collideTiles,i.additive=this.additive,i.renderOrder=this.renderOrder,i.trailScale=this.trailScale,i.mirror=Ht(2),i.localSpaceEmitter=this.localSpace&&this,i.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(i),i}render(){}}class Fn extends Pt{constructor(t,s,i,r){super(t,new _,s,i,r)}render(){const t=it((q-this.spawnTime)/this.lifeTime,1),s=this.sizeStart+t*this.sizeEndDelta,i=new _(s,s),r=this.fadeRate/2,n=new y(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<r?t/r:t>1-r?(1-t)/r:1));this.additive&&Ns(1);let a=this.pos,o=this.angle;if(this.localSpaceEmitter&&(a=this.localSpaceEmitter.pos.add(a.rotate(-this.localSpaceEmitter.angle)),o+=this.localSpaceEmitter.angle),this.trailScale){let l=this.velocity;this.localSpaceEmitter&&(l=l.rotate(-this.localSpaceEmitter.angle));const h=l.length(),c=l.scale(1/h),u=h*this.trailScale;i.y=nt(i.x,u),o=c.angle(),Ee(a.add(c.multiply(d(0,-u/2))),i,this.tileIndex,this.tileSize,n,o,this.mirror)}else Ee(a,i,this.tileIndex,this.tileSize,n,o,this.mirror);this.additive&&Ns(),Tt&&ne(a,i,"#f005",0,o),t==1&&(this.color=n,this.size=i,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let Ke=[],me;function Hn(){if(!Ke.length)return;const e=Ke[0],t=os-me;if(!me)me=os;else if(t>Rs)Ke.shift(me=0);else{const s=Rs-ge,i=t<ge?1-t/ge:t>s?(t-s)/ge:0;e.render(i)}}let ht,w,gi,xe,pi,Bt,is,gt,ns,xs;function Gn(){ht=document.createElement("canvas"),w=ht.getContext("webgl",{antialias:!1}),gi=Vn(et),document.body.appendChild(ht),xe=Wn("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec4 v,d,e;void main(){gl_Position=m*vec4(p,1,1);v=vec4(t,p);d=c;e=a;}","precision highp float;varying vec4 v,d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v.xy)*d+e;}");const e=new ArrayBuffer(Si);pi=w.createBuffer(),Bt=new Float32Array(e),is=new Uint32Array(e),gt=0}function yi(e){xs=e}function Us(e,t){const s=w.createShader(t);if(w.shaderSource(s,e),w.compileShader(s),!w.getShaderParameter(s,lr))throw w.getShaderInfoLog(s);return s}function Wn(e,t){const s=w.createProgram();if(w.attachShader(s,Us(e,or)),w.attachShader(s,Us(t,ar)),w.linkProgram(s),!w.getProgramParameter(s,cr))throw w.getProgramInfoLog(s);return s}function Vn(e){const t=w.createTexture();w.bindTexture(xt,t),e&&e.width&&w.texImage2D(xt,0,Ws,Ws,rs,e);const s=Qn;return w.texParameteri(xt,tr,s),w.texParameteri(xt,Jn,s),w.texParameteri(xt,er,Vs),w.texParameteri(xt,sr,Vs),t}function Xn(){w.viewport(0,0,ht.width=x.width,ht.height=x.height),w.clear(ir),w.useProgram(xe),w.activeTexture(nr),w.bindTexture(xt,gi),w.bindBuffer(as,pi),w.bufferData(as,Si,rr),yi();let e=0;const t=(r,n,a,o,l=0)=>{const h=w.getAttribLocation(xe,r);w.enableVertexAttribArray(h),w.vertexAttribPointer(h,o,n,l,xi,e),e+=o*a};t("p",Gs,4,2),t("t",Gs,4,2),t("c",rs,1,4,1),t("a",rs,1,4,1);const s=2*X/x.width,i=2*X/x.height;w.uniformMatrix4fv(w.getUniformLocation(xe,"m"),0,new Float32Array([s,0,0,0,0,i,0,0,1,1,-1,1,-1-s*G.x,-1-i*G.y,0,0]))}function mi(){if(!gt)return;const e=ns?Hs:qn;w.blendFuncSeparate(Yn,e,Hs,e),w.enable(Zn),w.bufferSubData(as,0,Bt.subarray(0,gt*Ae*bi)),w.drawArrays(Kn,0,gt*Ae),gt=0,ns=xs}function Se(e,t){!gt&&!t||(mi(),t&&e.drawImage(ht,0,0))}function Fs(e,t,s,i,r,n,a,o,l,h,c=0){(gt==wi||ns!=xs)&&mi();const u=Math.cos(r)/2,f=Math.sin(r)/2,m=u*s,b=u*i,E=f*s,A=f*i;for(let T=6,v=gt++*Ae*bi;T--;){const B=T-4&&T>1,k=T-5&&T-2&&T-1;Bt[v++]=e+(B?-m:m)+(k?A:-A),Bt[v++]=t+(k?b:-b)+(B?E:-E),Bt[v++]=B?n:o,Bt[v++]=k?a:l,is[v++]=h,is[v++]=c}}const Hs=1,Kn=4,Yn=770,qn=771,Zn=3042,xt=3553,rs=5121,Gs=5126,Ws=6408,Qn=9728,Jn=10240,tr=10241,er=10242,sr=10243,ir=16384,Vs=33071,nr=33984,as=34962,rr=35048,ar=35632,or=35633,lr=35713,cr=35714,Ae=6,bi=6,wi=65536,xi=4*2*2+4*2,Si=wi*Ae*xi,Ss="LittleJS",hr="1.6.4",vs=60,vi=1/vs;let st=[],_i=[],ur=0,q=0,os=0,dr=0;function fr(e,t,s,i,r,n){et.onerror=et.onload=()=>{Xt=d(Wt).divide(Vt=d(et.width,et.height)),et.onload=()=>$(1);const c="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none";document.body.style=c,document.body.appendChild(x=document.createElement("canvas")),Y=x.getContext("2d"),mn(),Gn(),document.body.appendChild(lt=document.createElement("canvas")),p=lt.getContext("2d");const u="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";(ht||x).style=x.style=lt.style=u,e(),h()};let a=0,o,l;function h(c=0){let u=c-a;a=c,l=Gt(.05,l,1e3/(u||1));const f=ee(107),m=ee(109);if(u*=f?5:m?.2:1,os+=u/1e3,o+=!dr*u,f||(o=it(o,50)),we.x){x.width=we.x,x.height=we.y;const b=innerWidth/innerHeight,E=x.width/x.height;(ht||x).style.width=x.style.width=lt.style.width=b<E?"100%":"",(ht||x).style.height=x.style.height=lt.style.height=b<E?"":"100%"}else x.width=it(innerWidth,Bs.x),x.height=it(innerHeight,Bs.y);lt.width=x.width,lt.height=x.height,pt=d(x.width,x.height);{let b=0;for(o<0&&o>-9&&(b=o,o=0);o>=0;o-=1e3/vs)zn(),t(),pr(),bn(),s(),Rn();o+=b}gr(),i(),st.sort((b,E)=>b.renderOrder-E.renderOrder);for(const b of st)b.destroyed||b.render();if(r(),Hn(),wn(),Se(Y),te){p.textAlign="right",p.textBaseline="top",p.font="1em monospace",p.fillStyle="#000";const b=Ss+" v"+hr+" / "+es+" / "+st.length+" / "+l.toFixed(1)+" GL";p.fillText(b,x.width-3,3),p.fillStyle="#fff",p.fillText(b,x.width-2,2),es=0}requestAnimationFrame(h)}n?et.src=n:et.onload()}function gr(){pt=d(x.width,x.height),Y.imageSmoothingEnabled=!ri,Xn()}function pr(){_i=st.filter(t=>t.collideSolidObjects);const e=t=>{if(!t.destroyed){t.update();for(const s of t.children)e(s)}};for(const t of st)t.parent||e(t);st=st.filter(t=>!t.destroyed),q=++ur/vs}const yr=e=>G=e,mr=e=>we=e,Ci=e=>Zt=e,br=e=>te=e,wr=e=>ii=e;class _s extends Pt{constructor(t){super(d(0,1.25),d(4,.5)),this.levelSize=t,this.color=new y(1,1,1,.5),this.setCollision(!0),this.mass=0}update(){const t=this.size.x*.5,s=this.levelSize.x-t;this.pos.x=L(ft.x,t,s)}increaseSize(){this.size.x+=2}decreaseSize(){this.size.x-=2,this.size.x<2&&(this.size.x=2)}resetSize(){this.size.x=4}}class ve extends Pt{constructor(t,s){super(t,s),this.setCollision(!0),this.mass=0,this.color=new y().setHex("#494746")}}const j=d(38,20),xr=(e,t)=>e===t,De=Symbol("solid-proxy"),Sr=Symbol("solid-track"),Pe={equals:xr};let Ti=Di;const yt=1,Me=2,ki={owned:null,cleanups:null,context:null,owner:null};var z=null;let Ye=null,I=null,F=null,ut=null,Ne=0;function _e(e,t){const s=I,i=z,r=e.length===0,n=t===void 0?i:t,a=r?ki:{owned:null,cleanups:null,context:n?n.context:null,owner:n},o=r?e:()=>e(()=>At(()=>je(a)));z=a,I=null;try{return ae(o,!0)}finally{I=s,z=i}}function K(e,t){t=t?Object.assign({},Pe,t):Pe;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=r=>(typeof r=="function"&&(r=r(s.value)),Ai(s,r));return[Ei.bind(s),i]}function H(e,t,s){const i=Cs(e,t,!1,yt);re(i)}function vr(e,t,s){Ti=kr;const i=Cs(e,t,!1,yt);(!s||!s.render)&&(i.user=!0),ut?ut.push(i):re(i)}function se(e,t,s){s=s?Object.assign({},Pe,s):Pe;const i=Cs(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=s.equals||void 0,re(i),Ei.bind(i)}function At(e){if(I===null)return e();const t=I;I=null;try{return e()}finally{I=t}}function _r(e){return z===null||(z.cleanups===null?z.cleanups=[e]:z.cleanups.push(e)),e}function Ei(){if(this.sources&&this.state)if(this.state===yt)re(this);else{const e=F;F=null,ae(()=>Ie(this),!1),F=e}if(I){const e=this.observers?this.observers.length:0;I.sources?(I.sources.push(this),I.sourceSlots.push(e)):(I.sources=[this],I.sourceSlots=[e]),this.observers?(this.observers.push(I),this.observerSlots.push(I.sources.length-1)):(this.observers=[I],this.observerSlots=[I.sources.length-1])}return this.value}function Ai(e,t,s){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&ae(()=>{for(let r=0;r<e.observers.length;r+=1){const n=e.observers[r],a=Ye&&Ye.running;a&&Ye.disposed.has(n),(a?!n.tState:!n.state)&&(n.pure?F.push(n):ut.push(n),n.observers&&Pi(n)),a||(n.state=yt)}if(F.length>1e6)throw F=[],new Error},!1)),t}function re(e){if(!e.fn)return;je(e);const t=z,s=I,i=Ne;I=z=e,Cr(e,e.value,i),I=s,z=t}function Cr(e,t,s){let i;try{i=e.fn(t)}catch(r){return e.pure&&(e.state=yt,e.owned&&e.owned.forEach(je),e.owned=null),e.updatedAt=s+1,Mi(r)}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?Ai(e,i):e.value=i,e.updatedAt=s)}function Cs(e,t,s,i=yt,r){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:z,context:z?z.context:null,pure:s};return z===null||z!==ki&&(z.owned?z.owned.push(n):z.owned=[n]),n}function Oe(e){if(e.state===0)return;if(e.state===Me)return Ie(e);if(e.suspense&&At(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ne);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===yt)re(e);else if(e.state===Me){const i=F;F=null,ae(()=>Ie(e,t[0]),!1),F=i}}function ae(e,t){if(F)return e();let s=!1;t||(F=[]),ut?s=!0:ut=[],Ne++;try{const i=e();return Tr(s),i}catch(i){s||(ut=null),F=null,Mi(i)}}function Tr(e){if(F&&(Di(F),F=null),e)return;const t=ut;ut=null,t.length&&ae(()=>Ti(t),!1)}function Di(e){for(let t=0;t<e.length;t++)Oe(e[t])}function kr(e){let t,s=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[s++]=i:Oe(i)}for(t=0;t<s;t++)Oe(e[t])}function Ie(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const i=e.sources[s];if(i.sources){const r=i.state;r===yt?i!==t&&(!i.updatedAt||i.updatedAt<Ne)&&Oe(i):r===Me&&Ie(i,t)}}}function Pi(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=Me,s.pure?F.push(s):ut.push(s),s.observers&&Pi(s))}}function je(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),i=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const n=r.pop(),a=s.observerSlots.pop();i<r.length&&(n.sourceSlots[a]=i,r[i]=n,s.observerSlots[i]=a)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)je(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Er(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Mi(e,t=z){throw Er(e)}const Ar=Symbol("fallback");function Xs(e){for(let t=0;t<e.length;t++)e[t]()}function Dr(e,t,s={}){let i=[],r=[],n=[],a=0,o=t.length>1?[]:null;return _r(()=>Xs(n)),()=>{let l=e()||[],h,c;return l[Sr],At(()=>{let f=l.length,m,b,E,A,T,v,B,k,J;if(f===0)a!==0&&(Xs(n),n=[],i=[],r=[],a=0,o&&(o=[])),s.fallback&&(i=[Ar],r[0]=_e(bt=>(n[0]=bt,s.fallback())),a=1);else if(a===0){for(r=new Array(f),c=0;c<f;c++)i[c]=l[c],r[c]=_e(u);a=f}else{for(E=new Array(f),A=new Array(f),o&&(T=new Array(f)),v=0,B=Math.min(a,f);v<B&&i[v]===l[v];v++);for(B=a-1,k=f-1;B>=v&&k>=v&&i[B]===l[k];B--,k--)E[k]=r[B],A[k]=n[B],o&&(T[k]=o[B]);for(m=new Map,b=new Array(k+1),c=k;c>=v;c--)J=l[c],h=m.get(J),b[c]=h===void 0?-1:h,m.set(J,c);for(h=v;h<=B;h++)J=i[h],c=m.get(J),c!==void 0&&c!==-1?(E[c]=r[h],A[c]=n[h],o&&(T[c]=o[h]),c=b[c],m.set(J,c)):n[h]();for(c=v;c<f;c++)c in E?(r[c]=E[c],n[c]=A[c],o&&(o[c]=T[c],o[c](c))):r[c]=_e(u);r=r.slice(0,a=f),i=l.slice(0)}return r});function u(f){if(n[c]=f,o){const[m,b]=K(c);return o[c]=b,t(l[c],m)}return t(l[c])}}}function M(e,t){return At(()=>e(t||{}))}function be(){return!0}const ls={get(e,t,s){return t===De?s:e.get(t)},has(e,t){return t===De?!0:e.has(t)},set:be,deleteProperty:be,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:be,deleteProperty:be}},ownKeys(e){return e.keys()}};function qe(e){return(e=typeof e=="function"?e():e)?e:{}}function Pr(){for(let e=0,t=this.length;e<t;++e){const s=this[e]();if(s!==void 0)return s}}function Ks(...e){let t=!1;for(let n=0;n<e.length;n++){const a=e[n];t=t||!!a&&De in a,e[n]=typeof a=="function"?(t=!0,se(a)):a}if(t)return new Proxy({get(n){for(let a=e.length-1;a>=0;a--){const o=qe(e[a])[n];if(o!==void 0)return o}},has(n){for(let a=e.length-1;a>=0;a--)if(n in qe(e[a]))return!0;return!1},keys(){const n=[];for(let a=0;a<e.length;a++)n.push(...Object.keys(qe(e[a])));return[...new Set(n)]}},ls);const s={},i={},r=new Set;for(let n=e.length-1;n>=0;n--){const a=e[n];if(!a)continue;const o=Object.getOwnPropertyNames(a);for(let l=0,h=o.length;l<h;l++){const c=o[l];if(c==="__proto__"||c==="constructor")continue;const u=Object.getOwnPropertyDescriptor(a,c);if(!r.has(c))u.get?(r.add(c),Object.defineProperty(s,c,{enumerable:!0,configurable:!0,get:Pr.bind(i[c]=[u.get.bind(a)])})):(u.value!==void 0&&r.add(c),s[c]=u.value);else{const f=i[c];f?u.get?f.push(u.get.bind(a)):u.value!==void 0&&f.push(()=>u.value):s[c]===void 0&&(s[c]=u.value)}}}return s}function Mr(e,...t){if(De in e){const r=new Set(t.length>1?t.flat():t[0]),n=t.map(a=>new Proxy({get(o){return a.includes(o)?e[o]:void 0},has(o){return a.includes(o)&&o in e},keys(){return a.filter(o=>o in e)}},ls));return n.push(new Proxy({get(a){return r.has(a)?void 0:e[a]},has(a){return r.has(a)?!1:a in e},keys(){return Object.keys(e).filter(a=>!r.has(a))}},ls)),n}const s={},i=t.map(()=>({}));for(const r of Object.getOwnPropertyNames(e)){const n=Object.getOwnPropertyDescriptor(e,r),a=!n.get&&!n.set&&n.enumerable&&n.writable&&n.configurable;let o=!1,l=0;for(const h of t)h.includes(r)&&(o=!0,a?i[l][r]=n.value:Object.defineProperty(i[l],r,n)),++l;o||(a?s[r]=n.value:Object.defineProperty(s,r,n))}return[...i,s]}const Or=e=>`Stale read from <${e}>.`;function Oi(e){const t="fallback"in e&&{fallback:()=>e.fallback};return se(Dr(()=>e.each,e.children,t||void 0))}function Ir(e){const t=e.keyed,s=se(()=>e.when,void 0,{equals:(i,r)=>t?i===r:!i==!r});return se(()=>{const i=s();if(i){const r=e.children;return typeof r=="function"&&r.length>0?At(()=>r(t?i:()=>{if(!At(s))throw Or("Show");return e.when})):r}return e.fallback},void 0,void 0)}const[Ut,zt]=K(R.Modern),[Ue,Ii]=K(0),[ie,$i]=K(!0),[Jt,Bi]=K(!0),[zi,St]=K(0),[Ri,cs]=K(0),[Li,hs]=K(!1),[Ni,us]=K(!1),[ji,ds]=K(!1),$r=Object.freeze(Object.defineProperty({__proto__:null,extraLifeDialogShown:ji,gameOverDialogShown:Li,gameWinDialogShown:Ni,highScore:Ri,mode:Ut,music:Jt,score:zi,setExtraLifeDialogShown:ds,setGameOverDialogShown:hs,setGameWinDialogShown:us,setHighScore:cs,setMode:zt,setMusic:Bi,setScore:St,setSound:$i,setStage:Ii,sound:ie,stage:Ue},Symbol.toStringTag,{value:"Module"}));class Br{constructor(t,s){g(this,"prefix","Breakout-");this.key=t,this.defaultValue=s,this.set(this.get())}get(){const t=localStorage.getItem(this.prefix+this.key);return t||this.defaultValue}toString(){return Number(this.get())}toValue(){return Number(this.get())}set(t){localStorage.setItem(this.prefix+this.key,String(t))}reset(){this.set(this.defaultValue)}}class Fe{constructor(t,s=0,i=9){g(this,"value");this.initialValue=t,this.MIN=s,this.MAX=i,this.value=this.apply(t)}decrement(){this.value=this.apply(--this.value)}increment(){this.value=this.apply(++this.value)}restore(){this.value=this.initialValue}add(t){this.value+=t,this.value=this.apply(this.value)}sub(t){this.value-=t,this.value=this.apply(this.value)}getValue(){return this.value}hasValue(){return this.value>0}setMax(){this.value=this.MAX}setMin(){this.value=this.MIN}setVal(t){this.value=this.apply(t)}apply(t){return Math.min(Math.max(t,this.MIN),this.MAX)}}class zr{constructor(t){g(this,"score");g(this,"highScore");this.initialValue=t,this.score=new Fe(t,0,1e16),this.highScore=new Br("highScore",0),cs(this.highScore.toValue()),St(this.score.getValue())}increment(){this.score.increment(),St(this.score.getValue()),this.evaluateHighScore()}decrement(){this.score.decrement(),St(this.score.getValue),this.evaluateHighScore()}add(t){this.score.add(t),St(this.score.getValue()),this.evaluateHighScore()}double(){this.score.setVal(this.score.getValue()*2),St(this.score.getValue()),this.evaluateHighScore()}reset(){this.score.restore(),St(this.initialValue)}toString(){return this.score.toString()}toValue(){return this.score.getValue()}getHighScore(){return this.highScore}evaluateHighScore(){this.score.getValue()>this.highScore.toValue()&&(this.highScore.set(this.score.getValue()),cs(this.score.getValue()))}}const Rr=""+new URL("tiles-75ceaa43.png",import.meta.url).href,Ui={enabled(){return window.location.hash.includes("debug")},disabled(){return!this.enabled()}};var C=(e=>(e[e.ExtraScore=0]="ExtraScore",e[e.ExtraBalls=1]="ExtraBalls",e[e.PaddleIncrease=2]="PaddleIncrease",e[e.ExtraLife=3]="ExtraLife",e[e.ExtraWall=4]="ExtraWall",e[e.PaddleDecrease=5]="PaddleDecrease",e[e.DoubleBalls=6]="DoubleBalls",e[e.TripleBalls=7]="TripleBalls",e[e.ExtraStrength=8]="ExtraStrength",e))(C||{});class mt{constructor(t){g(this,"timers",[]);g(this,"timeout",1e4);this.game=t}clearTimers(){this.timers.forEach(clearTimeout)}}let Ys=class extends mt{constructor(t){super(t)}apply(){if(this.game.balls.hasValue()){const t=this.game.balls.getOne();if(!t||t.destroyed)return;this.game.balls.spawnManyAt(G,3)}}};class Lr extends mt{constructor(t){super(t)}apply(){this.game.lives.increment()}}class Nr extends mt{constructor(t){super(t)}apply(){var t;(t=this.game.paddle)==null||t.increaseSize(),this.timers.push(setTimeout(()=>{var s;(s=this.game.paddle)==null||s.decreaseSize()},this.timeout))}}class jr extends mt{constructor(t){super(t)}apply(){var t;(t=this.game.paddle)==null||t.decreaseSize(),this.timers.push(setTimeout(()=>{var s;(s=this.game.paddle)==null||s.increaseSize()},this.timeout))}}class Ur extends mt{constructor(t){super(t)}apply(){this.game.score.add(10)}}class Fr extends mt{constructor(s){super(s);g(this,"size",d(j.x,.25));g(this,"position",d(j.x*.5,.14))}apply(){var s;(s=this.game.floor)==null||s.destroy(),this.game.floor=new ve(this.position,this.size),this.game.floor.color=new y(1,1,1,.5),this.timers.push(setTimeout(()=>{var i;(i=this.game.floor)==null||i.destroy(),this.game.floor=null},this.timeout))}}class Hr extends mt{constructor(t){super(t)}apply(){this.game.balls.hasValue()&&this.game.balls.double()}}class Gr extends mt{constructor(t){super(t)}apply(){this.game.balls.hasValue()&&this.game.balls.triple()}}const Fi=[[6,1],[5,10],[16,11],[12,7],[15,20],[17,0],[26,21],[2,27],[31,30]],Wr=22,Vr=new y().setHex("#486370"),$e=[new y().setHex("#00854A"),new y().setHex("#8CC63F"),new y().setHex("#FFDD00"),new y().setHex("#ED1B25"),new y().setHex("#91278F"),new y().setHex("#005AAB"),new y().setHex("#00AAE5"),new y().setHex("#F7931F"),new y().setHex("#744C1F")];if($e.length!==Fi.length)throw new Error("Colors and Tiles must have the same length");var Hi={exports:{}};function Ts(){}Ts.prototype={on:function(e,t,s){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:s}),this},once:function(e,t,s){var i=this;function r(){i.off(e,r),t.apply(s,arguments)}return r._=t,this.on(e,r,s)},emit:function(e){var t=[].slice.call(arguments,1),s=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=s.length;for(i;i<r;i++)s[i].fn.apply(s[i].ctx,t);return this},off:function(e,t){var s=this.e||(this.e={}),i=s[e],r=[];if(i&&t)for(var n=0,a=i.length;n<a;n++)i[n].fn!==t&&i[n].fn._!==t&&r.push(i[n]);return r.length?s[e]=r:delete s[e],this}};Hi.exports=Ts;var Xr=Hi.exports.TinyEmitter=Ts;const S=new Xr;class Kr extends Pt{constructor(s,i){super(s,d(.5));g(this,"type");g(this,"sign",1);g(this,"stopped",!1);g(this,"oldVelocity",d(0));this.type=i,this.setCollision(!0),this.velocity=d(0,-.1),this.color=$e[this.type],this.sign=Ht(0,1)===0?-1:1}getType(){return this.type}update(){this.stopped||(this.angle+=this.sign*.3,this.pos.y<0&&this.destroy(),super.update())}collideWithObject(s){return s instanceof _s&&(S.emit("bonusCollected",this),this.destroy()),!1}stopMovement(){this.stopped=!0,this.oldVelocity=this.velocity,this.velocity=d(0)}resumeMovement(){this.stopped=!1,this.velocity=this.oldVelocity}}class Yr{constructor(t,s=null){this.value=t,this.next=s}}class oe{constructor(){g(this,"head");g(this,"tail");g(this,"length");this.head=null,this.tail=null,this.length=0}add(t){const s=new Yr(t);if(this.head===null){this.head=s,this.tail=s,this.length++;return}this.tail===null&&(this.tail=s),this.tail.next=s,this.tail=s,this.length++}remove(t){if(this.head===null)return;if(this.head.value===t){this.head=this.head.next,this.head===null&&(this.tail=null),this.length--;return}let s=this.head;for(;s.next!==null;){if(s.next.value===t){s.next=s.next.next,s.next===null&&(this.tail=s),this.length--;return}s=s.next}}has(t){if(this.head===null)return!1;let s=this.head;for(;s!==null;){if(s.value===t)return!0;s=s.next}return!1}*[Symbol.iterator](){if(this.head===null)return;let t=this.head;for(;t!==null;)yield t.value,t=t.next}toArray(){const t=[];let s=this.head;for(;s!==null;)t.push(s.value),s=s.next;return t}getLength(){return this.length}isEmpty(){return this.length===0}peek(){var t;return(t=this.head)==null?void 0:t.value}clear(){this.head=null,this.tail=null,this.length=0}}class qr{constructor(t){g(this,"commands");g(this,"bonuses",new oe);this.commands={[C.ExtraBalls]:new Ys(t),[C.ExtraLife]:new Lr(t),[C.PaddleIncrease]:new Nr(t),[C.PaddleDecrease]:new jr(t),[C.ExtraScore]:new Ur(t),[C.ExtraWall]:new Fr(t),[C.DoubleBalls]:new Hr(t),[C.TripleBalls]:new Gr(t),[C.ExtraStrength]:new Ys(t)}}collect(t){this.commands[t.getType()].apply();for(const s of this.bonuses)s.destroyed&&this.bonuses.remove(s)}produce(t){this.bonuses.add(new Kr(d(Ht(2,j.x-2),j.y-2),t))}clearTimers(){for(const t of Object.values(this.commands))t.clearTimers()}destroy(){this.clearTimers();for(const t of this.bonuses)t.destroy(),this.bonuses.remove(t)}stop(){for(const t of this.bonuses)t.stopMovement()}resume(){for(const t of this.bonuses)t.resumeMovement()}}var kt=(e=>(e[e.Empty=0]="Empty",e[e.Normal=1]="Normal",e[e.Hard=2]="Hard",e[e.Unbreakable=3]="Unbreakable",e))(kt||{});class O{constructor(t,s){g(this,"offsetX",0);g(this,"offsetY",10);g(this,"blockWidth",2);g(this,"blockHeight",1);g(this,"count");g(this,"coords");g(this,"key");this.name=t,this.map=s,this.map=s.reverse(),this.count=this.countBricks(),this.coords=this.calcCoords(),this.key=`Stage:${this.name}`}getMap(){return this.map}getBrickCount(){return this.count}brickCountEquals(t){return this.count===t.getValue()}getCoords(){return this.coords}countBricks(){return this.map.reduce((t,s)=>t+s.reduce((i,r)=>i+(r===1?1:0),0),0)}calcCoords(){const t=[];for(const[s,i]of this.map.entries())for(const[r,n]of i.entries())n!==kt.Empty&&t.push([n,d(r*this.blockWidth+this.offsetX,s*this.blockHeight+this.offsetY)]);return t}isUnlocked(){return localStorage.getItem(this.key)==="unlocked"}unlock(){localStorage.setItem(this.key,"unlocked"),S.emit("stage-unlocked",this.name)}}const Gi=[new class extends O{constructor(){super("01",[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0],[0,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("02",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,3,0,1,0,3,1,0,3,1,0,3,0,1,0,3,0,1,1],[1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1],[1,0,3,0,1,0,3,1,0,3,1,0,3,0,1,0,3,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("03",[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0],[0,0,1,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("04",[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("05",[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("06",[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("07",[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[3,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,3],[0,3,3,3,0,0,0,0,1,0,1,0,0,0,0,0,3,3,3,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("08",[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3],[3,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3],[3,3,3,3,3,3,0,0,1,0,1,0,0,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("09",[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,3,1,3,1,0,0,0,0,0,0,0,0,1,3,1,3,1,3],[3,1,3,3,3,1,1,1,0,0,0,0,1,1,1,3,3,3,1,3],[3,3,3,3,3,0,0,1,1,1,1,1,1,0,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("10",[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3],[3,1,0,1,0,1,0,0,1,1,1,1,0,0,1,0,1,0,1,3],[3,1,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,3],[3,0,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,0,3],[3,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3],[3,3,3,3,3,3,3,3,1,0,1,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("11",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("12",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("13",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("14",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("15",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("16",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("17",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("18",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("19",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}},new class extends O{constructor(){super("20",[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.unlock()}}];class Zr{constructor(t){g(this,"game");g(this,"stages");g(this,"index",0);g(this,"currentStage");this.game=t,this.stages=Gi,this.currentStage=this.stages[this.index]}get current(){return this.currentStage}showClickToStartText(){new Xe().drawText("Click to Start",G.add(d(0,-5)),.1,!0)}showCurrentStageText(){new Xe().drawText(`Stage ${this.currentStage.name}`,G.add(d(0,0)),.2,!0)}showCounterText(){const t=[`Score: ${String(this.game.score.toValue()).padStart(4,"0")}`,`Lives: ${String(this.game.lives.getValue()).padStart(2,"0")}`,`Stage: ${String(this.game.stage.currentStage.name).padStart(2,"0")}`,`Mode: ${this.game.mode.toString()}`,`High-Score: ${String(this.game.score.getHighScore()).padStart(6,"0")}`];new Xe().drawText(t.join(" | "),d(j.x*.5,j.y+.5),.07,!0)}execute(t){this.index=t,this.currentStage=this.stages[this.index]}next(){this.index=Math.min(this.index+1,this.stages.length-1),this.currentStage=this.stages[this.index],this.game.mode.toggleBonus(),this.start()}start(){this.game.bricks.destroy(),this.game.bricks.populate()}restart(){this.game.bricks.destroy(),this.game.bricks.populate()}isCleared(){return this.currentStage.brickCountEquals(this.game.bricks.destroyed)}}class Qr extends Fe{runOut(){return!this.hasValue()}}class ks{constructor(t){g(this,"probabilities",[]);t&&this.setProbabilities(t)}setProbabilities(t){this.probabilities=t,this.assertProbabilitiesSumUpToOne()}pick(){this.assertProbabilitiesSumUpToOne();const t=Math.random();let s=0;for(const[i,r]of this.probabilities)if(s+=r/100,t<=s)return i;throw new Error("Failed to pick a number based on probabilities.")}*[Symbol.iterator](){for(const[t]of this.probabilities)yield t}assertProbabilitiesSumUpToOne(){if(this.probabilities.length===0)throw new Error("Probabilities should not be empty.");const t=this.probabilities.reduce((s,[,i])=>s+i,0);if(t!==100)throw new Error(`Probabilities should sum up to 100. Sum is ${t}.`)}}class Es extends Pt{constructor(s,i=d(2,1)){super(s,i);g(this,"strength",1);g(this,"hitCount",0);g(this,"tiles");g(this,"index",0);g(this,"picker");this.picker=new ks([[kt.Normal,70],[kt.Hard,30]]),this.mass=0,this.angle=0,this.setCollision(!0),this.strength=this.picker.pick(),this.index=Ht(0,$e.length),this.tiles=this.getTileByIndex(this.index),this.color=this.getColorByIndex(this.index),this.tileIndex=this.tiles[this.hitCount],this.tileSize=d(384,128),this.renderOrder=-1}get score(){return this.strength}getStrength(){return this.strength}setStrength(s){this.strength=s}increaseHitCount(){this.tileIndex=this.tiles[++this.hitCount],this.angle=P(-.3,.3)}shallBeDestroyed(){return this.hitCount>=this.strength}getColorByIndex(s){return $e[s]}getTileByIndex(s){return Fi[s]}}S.on("sound",()=>{Ci(ie()),console.info("Sound is",ie()?"enabled":"disabled")});S.emit("music",()=>{console.info("Music is",Jt()?"enabled":"disabled")});const Ce={GameStart:new pe([,0,500,,.04,.3,1,2,,,570,.02,.02,,,,.04]),BallBounce:new pe([,,119,.02,.01,.02,,.26,,.5,,,,,-381,,,,.01,.8]),BrickHit:new pe([,,141,,,.02,1,0,,,,,,.5,70,,,,.01]),BrickDestroy:new pe([1.37,,574,.04,.27,.3,2,2.9,.6,-.1,,,.13,1.8,,.3,,.25,.01])},qs={BallDestroy:(e,t)=>new js(e,0,0,.1,500,3.14,-1,d(8,8),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.1,.05,.98,1,0,3.14,.1,1,!1,!1,!0),BrickHit:(e,t)=>new js(e,0,0,.1,50,.45,4,d(10,10),t,t,t.scale(1,0),t.scale(1,0),.2,.1,.45,.39,.05,.98,1,0,1,.1,.99,!0,!0,!1)};class As extends Fe{constructor(t){super(t)}static getColor(t){return t===0?new y().setHex("#ffffff"):t===1?new y().setHex("#ffffff"):t===2?new y().setHex("#ffd0d0"):t===3?new y().setHex("#ffb0b0"):t===4?new y().setHex("#ff9090"):t===5?new y().setHex("#ff7070"):t===6?new y().setHex("#ff5050"):t===7?new y().setHex("#ff3030"):t===8?new y().setHex("#ff1010"):new y().setHex("#ff0000")}getColor(){return As.getColor(this.value)}}class Jr extends Pt{constructor(s,i=1){super(s,d(.25));g(this,"strength");g(this,"stopped",!1);g(this,"oldVelocity",d(0));this.strength=new As(i);const r=Ht(0,2)===0?-1:1;this.velocity=d(.1*r,-.1),this.setCollision(!0),this.elasticity=1}collideWithObject(s){const i=s instanceof Es,r=s instanceof _s;return i?this.handleBrickCollision(s):r?this.handlePaddleCollision(s):!0}update(){if(!this.stopped)return this.angleVelocity=this.velocity.length()*10,this.color=this.strength.getColor(),super.update()}stopMovement(){this.stopped=!0,this.oldVelocity=this.velocity,this.velocity=d(0)}resumeMovement(){this.stopped=!1,this.velocity=this.oldVelocity}handleBrickCollision(s){this.strength.sub(s.getStrength());const{color:i}=s;return Ce.BrickHit.play(this.pos),s.increaseHitCount(),s.shallBeDestroyed()?(qs.BallDestroy(this.pos,i),Ce.BrickDestroy.play(this.pos),S.emit("brickDestroyed",s),s.destroy()):qs.BrickHit(this.pos,i),!this.strength.hasValue()}handlePaddleCollision(s){this.strength.restore();const i=this.velocity.length()+.5;Ce.BallBounce.play(this.pos,1,i);const r=this.pos.x-s.pos.x;this.velocity=this.velocity.rotate(r*.3),this.velocity.y=nt(this.velocity.y,.3);const n=it(1.04*this.velocity.length(),.5);return this.velocity=this.velocity.normalize().scale(n),!1}}class t0{constructor(){g(this,"MAX_BALLS",200);g(this,"balls");g(this,"picker");g(this,"strength",1);this.balls=new oe,this.picker=new ks([[-.5,50],[.5,50]])}add(t){this.balls.add(t)}setStrength(t){this.strength=t}remove(t){this.balls.remove(t)}spawnOneAt(t=G){if(this.balls.getLength()<this.MAX_BALLS){const s=this.picker.pick(),i=this.picker.pick();this.add(new Jr(d(t.x+s,t.y+i),this.strength))}}spawnManyAt(t=G,s=1){for(let i=0;i<s;i++)this.spawnOneAt(t)}double(){for(const t of this.balls.toArray())this.spawnOneAt(t.pos)}triple(){for(const t of this.balls.toArray())this.spawnManyAt(t.pos,2)}hasValue(){return!this.balls.isEmpty()}escaped(){return this.balls.isEmpty()}getOne(){return this.balls.peek()}update(){for(const t of this.balls)t.pos.y<-1&&t.destroy(),t.destroyed&&this.balls.remove(t)}*[Symbol.iterator](){for(const t of this.balls)yield t}destroy(){for(const t of this.balls)t.destroy();this.balls.clear()}stop(){for(const t of this.balls)t.stopMovement()}resume(){for(const t of this.balls)t.resumeMovement()}}let le=class{constructor(t){g(this,"bonusPicker",new ks);g(this,"timers",[]);this.game=t}async update(){}pickBonus(){return this.bonusPicker.pick()}clearTimers(){this.timers.forEach(clearTimeout)}};var Et=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return this.None(e)},Out:function(e){return this.None(e)},InOut:function(e){return this.None(e)}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-Et.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?Et.Bounce.In(e*2)*.5:Et.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),Kt=function(){return performance.now()},e0=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(s){return t._tweens[s]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,s){t===void 0&&(t=Kt()),s===void 0&&(s=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],a=!s;n&&n.update(t,a)===!1&&!s&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),Rt={Linear:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=Rt.Utils.Linear;return t<0?n(e[0],e[1],i):t>1?n(e[s],e[s-1],s-i):n(e[r],e[r+1>s?s:r+1],i-r)},Bezier:function(e,t){for(var s=0,i=e.length-1,r=Math.pow,n=Rt.Utils.Bernstein,a=0;a<=i;a++)s+=r(1-t,i-a)*r(t,a)*e[a]*n(i,a);return s},CatmullRom:function(e,t){var s=e.length-1,i=s*t,r=Math.floor(i),n=Rt.Utils.CatmullRom;return e[0]===e[s]?(t<0&&(r=Math.floor(i=s*(1+t))),n(e[(r-1+s)%s],e[r],e[(r+1)%s],e[(r+2)%s],i-r)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[s]-(n(e[s],e[s],e[s-1],e[s-1],i-s)-e[s]):n(e[r?r-1:0],e[r],e[s<r+1?s:r+1],e[s<r+2?s:r+2],i-r)},Utils:{Linear:function(e,t,s){return(t-e)*s+e},Bernstein:function(e,t){var s=Rt.Utils.Factorial;return s(e)/s(t)/s(e-t)},Factorial:function(){var e=[1];return function(t){var s=1;if(e[t])return e[t];for(var i=t;i>1;i--)s*=i;return e[t]=s,s}}(),CatmullRom:function(e,t,s,i,r){var n=(s-e)*.5,a=(i-t)*.5,o=r*r,l=r*o;return(2*t-2*s+n+a)*l+(-3*t+3*s-2*n-a)*o+n*r+t}}},s0=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),fs=new e0,Wi=function(){function e(t,s){s===void 0&&(s=fs),this._object=t,this._group=s,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Et.Linear.None,this._interpolationFunction=Rt.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=s0.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(t,s){if(s===void 0&&(s=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=s,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,s){if(t===void 0&&(t=Kt()),s===void 0&&(s=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||s){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var n in this._valuesEnd)r[n]=this._valuesEnd[n];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,s)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,s,i,r,n){for(var a in i){var o=t[a],l=Array.isArray(o),h=l?"array":typeof o,c=!l&&Array.isArray(i[a]);if(!(h==="undefined"||h==="function")){if(c){var u=i[a];if(u.length===0)continue;for(var f=[o],m=0,b=u.length;m<b;m+=1){var E=this._handleRelativeValue(o,u[m]);if(isNaN(E)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}f.push(E)}c&&(i[a]=f)}if((h==="object"||l)&&o&&!c){s[a]=l?[]:{};var A=o;for(var T in A)s[a][T]=A[T];r[a]=l?[]:{};var u=i[a];if(!this._isDynamic){var v={};for(var T in u)v[T]=u[T];i[a]=u=v}this._setupProperties(A,s[a],u,r[a],n)}else(typeof s[a]>"u"||n)&&(s[a]=o),l||(s[a]*=1),c?r[a]=i[a].slice().reverse():r[a]=s[a]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=Kt()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=Kt()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,s=this._chainedTweens.length;t<s;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=fs),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=Et.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=Rt.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,s){if(t===void 0&&(t=Kt()),s===void 0&&(s=!0),this._isPaused)return!0;var i,r,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>n)return!1;s&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=this._duration===0||r>1?1:r;var a=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,l=this._chainedTweens.length;o<l;o++)this._chainedTweens[o].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,s,i,r){for(var n in i)if(s[n]!==void 0){var a=s[n]||0,o=i[n],l=Array.isArray(t[n]),h=Array.isArray(o),c=!l&&h;c?t[n]=this._interpolationFunction(o,r):typeof o=="object"&&o?this._updateProperties(t[n],a,o,r):(o=this._handleRelativeValue(a,o),typeof o=="number"&&(t[n]=a+(o-a)*r))}},e.prototype._handleRelativeValue=function(t,s){return typeof s!="string"?s:s.charAt(0)==="+"||s.charAt(0)==="-"?t+parseFloat(s):parseFloat(s)},e.prototype._swapEndStartRepeatValues=function(t){var s=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s},e}(),rt=fs;rt.getAll.bind(rt);rt.removeAll.bind(rt);rt.add.bind(rt);rt.remove.bind(rt);rt.update.bind(rt);class Ze extends le{constructor(s){super(s);g(this,"displayName","Dynamic");g(this,"timeout",1e4);g(this,"tweens",new oe);this.bonusPicker.setProbabilities([[C.ExtraScore,20],[C.ExtraStrength,20],[C.PaddleIncrease,20],[C.PaddleDecrease,40]])}apply(){console.info("Dynamic mode activated"),this.game.balls.setStrength(2),this.tweens.clear(),this.timers.push(setInterval(()=>{if(this.game.state.isStarted)for(const s of this.game.bricks){const i=new Wi(s.pos);i.to({y:s.pos.y-1},500),i.easing(Et.Bounce.Out),i.start(),this.tweens.add(i)}},this.timeout))}async update(){await super.update();for(const s of this.tweens)s.update()}}class Qe extends le{constructor(){super(...arguments);g(this,"displayName","Classic")}apply(){if(console.info("Classic mode activated"),this.game.bricks.areEmpty())throw new Error("No bricks to iterate");this.game.balls.setStrength(1);for(const s of this.game.bricks)s.setStrength(1)}}class Zs extends le{constructor(s){super(s);g(this,"displayName","Bonus");g(this,"timeout",3e3);g(this,"tweens",new oe);this.bonusPicker.setProbabilities([[C.DoubleBalls,10],[C.TripleBalls,10],[C.ExtraBalls,30],[C.ExtraScore,30],[C.ExtraWall,20]])}apply(){console.info("Bonus mode activated"),this.game.balls.setStrength(9),this.tweens.clear(),this.timers.push(setInterval(()=>{for(const s of this.game.bricks){const i=new Wi(s.pos);i.to({y:s.pos.y-1},900),i.easing(Et.Bounce.Out),i.start(),this.tweens.add(i)}},this.timeout))}async update(){await super.update();for(const s of this.tweens)s.update()}}class Je extends le{constructor(s){super(s);g(this,"displayName","Modern");this.bonusPicker.setProbabilities([[C.DoubleBalls,5],[C.TripleBalls,5],[C.ExtraBalls,15],[C.ExtraScore,15],[C.ExtraWall,10],[C.ExtraStrength,20],[C.PaddleDecrease,15],[C.PaddleIncrease,15]])}apply(){this.game.balls.setStrength(3),console.info("Modern mode activated")}}class i0 extends le{constructor(){super(...arguments);g(this,"displayName","Empty")}apply(){}}class n0{constructor(t){g(this,"modes");g(this,"currentMode");g(this,"previousMode",null);this.modes={[R.Empty]:new i0(t),[R.Dynamic]:new Ze(t),[R.Classic]:new Qe(t),[R.Bonus]:new Zs(t),[R.Modern]:new Je(t)},this.currentMode=this.modes[R.Empty]}toString(){return this.currentMode.displayName}execute(t){this.clearTimers(),this.previousMode=this.currentMode,this.currentMode=this.modes[t],this.currentMode.apply()}async update(){await this.currentMode.update()}toggleBonus(){if(this.modeIsBonus())return this.restorePreviousMode();this.execute(R.Bonus),zt(R.Bonus)}restorePreviousMode(){this.clearTimers(),this.previousMode&&(this.previousMode instanceof Qe?zt(R.Classic):this.previousMode instanceof Je?zt(R.Modern):this.previousMode instanceof Ze&&zt(R.Dynamic),this.currentMode=this.previousMode,this.currentMode.apply())}setDefault(){this.execute(R.Dynamic)}modeIsDynamic(){return this.currentMode instanceof Ze}isClassic(){return this.currentMode instanceof Qe}modeIsBonus(){return this.currentMode instanceof Zs}modeIsModern(){return this.currentMode instanceof Je}pickBonusType(){return this.currentMode.pickBonus()}clearTimers(){this.currentMode.clearTimers()}}class Q{constructor(t){this.game=t}async attach(){console.group(`${this.constructor.name} state`),console.debug("Attached")}async detach(){console.debug("Detached"),console.groupEnd()}update(t){}}class Vi extends Q{constructor(t){super(t),this.onBonusCollected=this.onBonusCollected.bind(this),this.onBrickDestroyed=this.onBrickDestroyed.bind(this)}async attach(){await super.attach(),this.game.bonus.resume(),this.game.balls.resume(),S.on("bonusCollected",this.onBonusCollected),S.on("brickDestroyed",this.onBrickDestroyed),!this.game.balls.hasValue()&&this.game.lives.hasValue()&&(Ce.GameStart.play(),this.game.balls.spawnOneAt(G))}async detach(){this.game.bonus.stop(),this.game.balls.stop(),this.game.mode.clearTimers(),S.off("bonusCollected",this.onBonusCollected),S.off("brickDestroyed",this.onBrickDestroyed),await super.detach()}async update(t){if(this.game.balls.update(),this.game.balls.escaped())return this.game.balls.destroy(),this.game.lives.decrement(),this.game.lives.runOut()?await this.game.state.changeTo("extraLifeDialog"):await this.game.state.changeTo("idle");if(this.game.stage.isCleared())return await this.game.state.changeTo("stageWinDialog")}onBonusCollected(t){this.game.bonus.collect(t)}onBrickDestroyed(t){this.game.score.add(t.score),t.isBreakable&&this.game.bricks.destroyed.increment(),!this.game.mode.isClassic()&&this.game.score.toValue()%1===0&&this.game.bonus.produce(this.game.mode.pickBonusType())}}class Xi extends Q{}class Ki extends Q{async attach(){await super.attach(),this.game.stage.restart(),this.game.balls.destroy(),this.game.bonus.destroy(),this.game.lives.restore()}async detach(){await super.detach()}async update(t){(ys(0)||ws(0))&&await this.game.state.changeTo("started"),this.game.stage.showCurrentStageText(),this.game.stage.showClickToStartText()}}class Yi extends Q{async attach(){await super.attach()}async detach(){await super.detach()}async update(t){(ys(0)||ws(0))&&await this.game.state.changeTo("started"),this.game.stage.showClickToStartText()}}class qi extends Q{async attach(){await super.attach();try{await this.game.ads.showRewardAd(),console.info("Ad finished"),await this.rewardPlayer(),await this.game.state.changeTo("idle")}catch(t){console.warn("Ad error",t),await this.game.state.changeTo("gameOver")}}async detach(){await super.detach()}async rewardPlayer(){this.game.lives.increment()}}let Zi=class extends Q{constructor(t){super(t),this.handleStartClick=this.handleStartClick.bind(this)}async attach(){await super.attach(),this.game.bonus.stop(),hs(!0),S.on("startClick",this.handleStartClick)}async detach(){hs(!1),S.off("startClick",this.handleStartClick),await super.detach()}async handleStartClick(){this.game.mode.execute(Ut()),this.game.stage.execute(Ue()),this.game.balls.destroy(),this.game.bonus.destroy(),this.game.bricks.destroy(),this.game.lives.restore(),this.game.bricks.populate(),this.game.state.previous.isExtraLifeDialog&&this.game.score.reset(),await this.game.state.changeTo("idle")}};class Qi extends Q{constructor(t){super(t),this.handleDoubleWin=this.handleDoubleWin.bind(this),this.handleNextStage=this.handleNextStage.bind(this),this.handleRestart=this.handleRestart.bind(this)}async attach(){await super.attach(),Be.isCrazyGames()&&await window.CrazyGames.SDK.game.happytime(),us(!0),S.on("doubleWin",this.handleDoubleWin),S.on("nextStage",this.handleNextStage),S.on("restartStage",this.handleRestart)}async detach(){us(!1),S.off("doubleWin",this.handleDoubleWin),S.off("nextStage",this.handleNextStage),S.off("restartStage",this.handleRestart),await super.detach()}async handleDoubleWin(){await this.game.state.changeTo("adBreakDoubleScore")}async handleNextStage(){await this.game.state.changeTo("nextStage")}async handleRestart(){await this.game.state.changeTo("restarted")}}class gs extends Q{}let Ji=class extends Q{constructor(t){super(t),this.handleGetExtraLife=this.handleGetExtraLife.bind(this)}async attach(){await super.attach(),ds(!0),S.on("getExtraLife",this.handleGetExtraLife)}async detach(){ds(!1),S.off("getExtraLife",this.handleGetExtraLife),await super.detach()}async handleGetExtraLife(t){if(t)return await this.game.state.changeTo("adBreakExtraLife");await this.game.state.changeTo("gameOver")}};class tn extends Q{async attach(){await super.attach(),this.game.balls.destroy(),this.game.bonus.destroy(),this.game.stage.next()}async detach(){await super.detach()}async update(t){(ys(0)||ws(0))&&await this.game.state.changeTo("started"),this.game.stage.showCurrentStageText(),this.game.stage.showClickToStartText()}}class Qs{constructor(t){this.state=t}get isPaused(){return this.state instanceof Xi}get isStarted(){return this.state instanceof Vi}get isIdle(){return this.state instanceof Yi}get isGameOver(){return this.state instanceof Zi}get isAdBreak(){return this.state instanceof qi}get isExtraLifeDialog(){return this.state instanceof Ji}get isStageWinDialog(){return this.state instanceof Qi}get isNextStage(){return this.state instanceof tn}get isRestarted(){return this.state instanceof Ki}get isInitial(){return this.state instanceof gs}get value(){return this.state}set value(t){this.state=t}}class r0 extends Q{async attach(){await super.attach();try{await this.game.ads.showRewardAd(),console.info("Ad finished"),await this.rewardPlayer()}catch(t){console.warn("Ad error",t)}finally{await this.game.state.changeTo("nextStage")}}async detach(){await super.detach()}async rewardPlayer(){this.game.score.double()}}class a0 extends Qs{constructor(s){super(new gs(s));g(this,"states");g(this,"previousState");this.states={initial:new gs(s),started:new Vi(s),paused:new Xi(s),idle:new Yi(s),restarted:new Ki(s),gameOver:new Zi(s),nextStage:new tn(s),extraLifeDialog:new Ji(s),stageWinDialog:new Qi(s),adBreakExtraLife:new qi(s),adBreakDoubleScore:new r0(s)},this.state=this.states.initial,this.state.attach(),this.previousState=new Qs(this.state)}get previous(){return this.previousState}async changeTo(s){this.previousState.value=this.state,await this.state.detach(),this.state=this.states[s],await this.state.attach()}update(s){this.state.update(s)}}class o0 extends Es{constructor(t,s=d(2,1)){super(t,s),this.strength=16,this.tiles=this.getTileByIndex(1),this.color=Vr,this.tileIndex=Wr}get isBreakable(){return!1}setStrength(t){}get score(){return 0}increaseHitCount(){this.angle=P(-.01,.01),this.hitCount++}}class l0 extends Es{constructor(t,s=d(2,1)){super(t,s)}get isBreakable(){return!0}}class c0{constructor(t){g(this,"destroyed");g(this,"bricks");g(this,"game");this.game=t,this.bricks=new oe,this.destroyed=new Fe(0,0,999)}populate(){for(const[t,s]of this.game.stage.current.getCoords()){if(t===kt.Unbreakable){this.bricks.add(new o0(s));continue}[kt.Normal,kt.Hard].includes(t)&&this.bricks.add(new l0(s))}}areEmpty(){return this.bricks.isEmpty()}destroy(){for(const t of this.bricks)t.destroy();this.bricks.clear(),this.destroyed.setVal(0)}*[Symbol.iterator](){for(const t of this.bricks)yield t}}class h0{constructor(){}async showRewardAd(){if(Be.isCrazyGames())return await window.CrazyGames.SDK.game.gameplayStop(),new Promise((t,s)=>{window.CrazyGames.SDK.ad.requestAd("rewarded",{adStarted:()=>console.info("Ad started"),adError:i=>s(i),adFinished:()=>window.CrazyGames.SDK.game.gameplayStart().finally(t)})})}}br(Ui.enabled());Ci(ie());Ui.disabled()&&wr(-1);class u0{constructor(){g(this,"lives");g(this,"score");g(this,"mode");g(this,"bonus");g(this,"stage");g(this,"state");g(this,"bricks");g(this,"ads");g(this,"balls");g(this,"paddle",null);g(this,"floor",null);this.init=this.init.bind(this),this.update=this.update.bind(this),this.postUpdate=this.postUpdate.bind(this),this.render=this.render.bind(this),this.postRender=this.postRender.bind(this),this.balls=new t0,this.score=new zr(0),this.lives=new Qr(3),this.bonus=new qr(this),this.stage=new Zr(this),this.mode=new n0(this),this.state=new a0(this),this.bricks=new c0(this),this.ads=new h0}run(t,s){this.stage.execute(s),this.stage.start(),this.mode.execute(t),fr(this.init,this.update,this.postUpdate,this.render,this.postRender,Rr)}init(){mr(new _(1280,720)),yr(j.scale(.5)),this.paddle=new _s(j),new ve(d(-.5,j.y*.5),d(1,j.y)),new ve(d(j.x+.5,j.y*.5),d(1,j.y)),new ve(d(j.x*.5,j.y),d(j.x+2,1)),setTimeout(()=>this.state.changeTo("idle"))}update(){this.state.update(vi)}async postUpdate(){await this.mode.update()}render(){vt(G,d(100,100),new y().setHex("#494746")),vt(G,j,new y().setHex("#ce9a80"))}postRender(){this.stage.showCounterText()}}console.info("Is development mode:",Be.isDevelopment());const en=new u0;window.game=en;window.store=$r;S.on("start",async()=>{en.run(Ut(),Ue()),Be.isCrazyGames()&&await window.CrazyGames.SDK.game.gameplayStart()});const d0=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],f0=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...d0]),g0=new Set(["innerHTML","textContent","innerText","children"]),p0=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),y0=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function m0(e,t){const s=y0[e];return typeof s=="object"?s[t]?s.$:void 0:s}const b0=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),w0={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function x0(e,t,s){let i=s.length,r=t.length,n=i,a=0,o=0,l=t[r-1].nextSibling,h=null;for(;a<r||o<n;){if(t[a]===s[o]){a++,o++;continue}for(;t[r-1]===s[n-1];)r--,n--;if(r===a){const c=n<i?o?s[o-1].nextSibling:s[n-o]:l;for(;o<n;)e.insertBefore(s[o++],c)}else if(n===o)for(;a<r;)(!h||!h.has(t[a]))&&t[a].remove(),a++;else if(t[a]===s[n-1]&&s[o]===t[r-1]){const c=t[--r].nextSibling;e.insertBefore(s[o++],t[a++].nextSibling),e.insertBefore(s[--n],c),t[r]=s[n]}else{if(!h){h=new Map;let u=o;for(;u<n;)h.set(s[u],u++)}const c=h.get(t[a]);if(c!=null)if(o<c&&c<n){let u=a,f=1,m;for(;++u<r&&u<n&&!((m=h.get(t[u]))==null||m!==c+f);)f++;if(f>c-o){const b=t[a];for(;o<c;)e.insertBefore(s[o++],b)}else e.replaceChild(s[o++],t[a++])}else a++;else t[a++].remove()}}}const Js="_$DX_DELEGATE";function S0(e,t,s,i={}){let r;return _e(n=>{r=n,t===document?e():D(t,e(),t.firstChild?null:void 0,s)},i.owner),()=>{r(),t.textContent=""}}function V(e,t,s){let i;const r=()=>{const a=document.createElement("template");return a.innerHTML=e,s?a.content.firstChild.firstChild:a.content.firstChild},n=t?()=>At(()=>document.importNode(i||(i=r()),!0)):()=>(i||(i=r())).cloneNode(!0);return n.cloneNode=n,n}function ce(e,t=window.document){const s=t[Js]||(t[Js]=new Set);for(let i=0,r=e.length;i<r;i++){const n=e[i];s.has(n)||(s.add(n),t.addEventListener(n,D0))}}function Dt(e,t,s){s==null?e.removeAttribute(t):e.setAttribute(t,s)}function v0(e,t,s,i){i==null?e.removeAttributeNS(t,s):e.setAttributeNS(t,s,i)}function _0(e,t){t==null?e.removeAttribute("class"):e.className=t}function Ds(e,t,s,i){if(i)Array.isArray(s)?(e[`$$${t}`]=s[0],e[`$$${t}Data`]=s[1]):e[`$$${t}`]=s;else if(Array.isArray(s)){const r=s[0];e.addEventListener(t,s[0]=n=>r.call(e,s[1],n))}else e.addEventListener(t,s)}function C0(e,t,s={}){const i=Object.keys(t||{}),r=Object.keys(s);let n,a;for(n=0,a=r.length;n<a;n++){const o=r[n];!o||o==="undefined"||t[o]||(ti(e,o,!1),delete s[o])}for(n=0,a=i.length;n<a;n++){const o=i[n],l=!!t[o];!o||o==="undefined"||s[o]===l||!l||(ti(e,o,!0),s[o]=l)}return s}function T0(e,t,s){if(!t)return s?Dt(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof s=="string"&&(i.cssText=s=void 0),s||(s={}),t||(t={});let r,n;for(n in s)t[n]==null&&i.removeProperty(n),delete s[n];for(n in t)r=t[n],r!==s[n]&&(i.setProperty(n,r),s[n]=r);return s}function k0(e,t={},s,i){const r={};return i||H(()=>r.children=Ft(e,t.children,r.children)),H(()=>t.ref&&t.ref(e)),H(()=>E0(e,t,s,!0,r,!0)),r}function D(e,t,s,i){if(s!==void 0&&!i&&(i=[]),typeof t!="function")return Ft(e,t,i,s);H(r=>Ft(e,t(),r,s),i)}function E0(e,t,s,i,r={},n=!1){t||(t={});for(const a in r)if(!(a in t)){if(a==="children")continue;r[a]=ei(e,a,null,r[a],s,n)}for(const a in t){if(a==="children"){i||Ft(e,t.children);continue}const o=t[a];r[a]=ei(e,a,o,r[a],s,n)}}function A0(e){return e.toLowerCase().replace(/-([a-z])/g,(t,s)=>s.toUpperCase())}function ti(e,t,s){const i=t.trim().split(/\s+/);for(let r=0,n=i.length;r<n;r++)e.classList.toggle(i[r],s)}function ei(e,t,s,i,r,n){let a,o,l,h,c;if(t==="style")return T0(e,s,i);if(t==="classList")return C0(e,s,i);if(s===i)return i;if(t==="ref")n||s(e);else if(t.slice(0,3)==="on:"){const u=t.slice(3);i&&e.removeEventListener(u,i),s&&e.addEventListener(u,s)}else if(t.slice(0,10)==="oncapture:"){const u=t.slice(10);i&&e.removeEventListener(u,i,!0),s&&e.addEventListener(u,s,!0)}else if(t.slice(0,2)==="on"){const u=t.slice(2).toLowerCase(),f=b0.has(u);if(!f&&i){const m=Array.isArray(i)?i[0]:i;e.removeEventListener(u,m)}(f||s)&&(Ds(e,u,s,f),f&&ce([u]))}else if(t.slice(0,5)==="attr:")Dt(e,t.slice(5),s);else if((c=t.slice(0,5)==="prop:")||(l=g0.has(t))||!r&&((h=m0(t,e.tagName))||(o=f0.has(t)))||(a=e.nodeName.includes("-")))c&&(t=t.slice(5),o=!0),t==="class"||t==="className"?_0(e,s):a&&!o&&!l?e[A0(t)]=s:e[h||t]=s;else{const u=r&&t.indexOf(":")>-1&&w0[t.split(":")[0]];u?v0(e,u,t,s):Dt(e,p0[t]||t,s)}return s}function D0(e){const t=`$$${e.type}`;let s=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==s&&Object.defineProperty(e,"target",{configurable:!0,value:s}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return s||document}});s;){const i=s[t];if(i&&!s.disabled){const r=s[`${t}Data`];if(r!==void 0?i.call(s,r,e):i.call(s,e),e.cancelBubble)return}s=s._$host||s.parentNode||s.host}}function Ft(e,t,s,i,r){for(;typeof s=="function";)s=s();if(t===s)return s;const n=typeof t,a=i!==void 0;if(e=a&&s[0]&&s[0].parentNode||e,n==="string"||n==="number")if(n==="number"&&(t=t.toString()),a){let o=s[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),s=$t(e,s,i,o)}else s!==""&&typeof s=="string"?s=e.firstChild.data=t:s=e.textContent=t;else if(t==null||n==="boolean")s=$t(e,s,i);else{if(n==="function")return H(()=>{let o=t();for(;typeof o=="function";)o=o();s=Ft(e,o,s,i)}),()=>s;if(Array.isArray(t)){const o=[],l=s&&Array.isArray(s);if(ps(o,t,s,r))return H(()=>s=Ft(e,o,s,i,!0)),()=>s;if(o.length===0){if(s=$t(e,s,i),a)return s}else l?s.length===0?si(e,o,i):x0(e,s,o):(s&&$t(e),si(e,o));s=o}else if(t.nodeType){if(Array.isArray(s)){if(a)return s=$t(e,s,i,t);$t(e,s,null,t)}else s==null||s===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);s=t}else console.warn("Unrecognized value. Skipped inserting",t)}return s}function ps(e,t,s,i){let r=!1;for(let n=0,a=t.length;n<a;n++){let o=t[n],l=s&&s[n],h;if(!(o==null||o===!0||o===!1))if((h=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))r=ps(e,o,l)||r;else if(h==="function")if(i){for(;typeof o=="function";)o=o();r=ps(e,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||r}else e.push(o),r=!0;else{const c=String(o);l&&l.nodeType===3&&l.data===c?e.push(l):e.push(document.createTextNode(c))}}return r}function si(e,t,s=null){for(let i=0,r=t.length;i<r;i++)e.insertBefore(t[i],s)}function $t(e,t,s,i){if(s===void 0)return e.textContent="";const r=i||document.createTextNode("");if(t.length){let n=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(r!==o){const l=o.parentNode===e;!n&&!a?l?e.replaceChild(r,o):e.insertBefore(r,s):l&&o.remove()}else n=!0}}else e.insertBefore(r,s);return[r]}const P0=!1,M0=V('<section><fieldset><legend><b>Sound/Music</b></legend><div><input type="checkbox" id="sound"><label for="sound">Sound</label><input type="checkbox" id="music"><label for="music">Music'),sn=()=>{const e=({target:s})=>{const{checked:i}=s;$i(i),S.emit("sound",i)},t=()=>{Bi(!Jt()),S.emit("music",!Jt())};return(()=>{const s=M0(),i=s.firstChild,r=i.firstChild,n=r.nextSibling,a=n.firstChild,o=a.nextSibling,l=o.nextSibling;return a.addEventListener("change",e),l.addEventListener("change",t),H(()=>a.checked=ie()),H(()=>l.checked=Jt()),s})()},O0=V('<section class="modes"><fieldset><legend><b>Mode'),I0=V('<div class="mode"><input type="radio"><label>'),nn=()=>{const e=[{name:"Classic",value:R.Classic},{name:"Dynamic",value:R.Dynamic},{name:"Modern",value:R.Modern}],t=s=>()=>{zt(s),S.emit("modeChange",s)};return(()=>{const s=O0(),i=s.firstChild;return i.firstChild,D(i,M(Oi,{each:e,children:r=>(()=>{const n=I0(),a=n.firstChild,o=a.nextSibling;return Ds(a,"change",t(r.value)),D(o,()=>r.name),H(l=>{const h=r.name,c=r.name;return h!==l._v$&&Dt(a,"id",l._v$=h),c!==l._v$2&&Dt(o,"for",l._v$2=c),l},{_v$:void 0,_v$2:void 0}),H(()=>a.checked=Ut()===r.value),n})()}),null),s})()},$0=V('<section><fieldset><legend><b>Levels</b></legend><div class="levels">'),B0=V("<div>No items"),z0=V('<div class="level"><input type="radio" name="stage"><label>'),rn=()=>{const[e,t]=K(Ue()),s=i=>()=>{Ii(i),t(i),S.emit("stageChange",i)};return(()=>{const i=$0(),r=i.firstChild,n=r.firstChild,a=n.nextSibling;return D(a,M(Oi,{get each(){return Gi},get fallback(){return B0()},children:(o,l)=>(()=>{const h=z0(),c=h.firstChild,u=c.nextSibling;return Ds(c,"change",s(l())),D(u,()=>o.name),H(f=>{const m=o.name,b=o.name;return m!==f._v$&&Dt(c,"id",f._v$=m),b!==f._v$2&&Dt(u,"for",f._v$2=b),f},{_v$:void 0,_v$2:void 0}),H(()=>c.checked=l()===e()),h})()})),i})()},R0=V("<div><div>Current Score: <b>"),L0=V("<fieldset><legend><b>Score</b></legend><div><div><div>High Score: <b>"),Ps=({highScoreOnly:e})=>(()=>{const t=L0(),s=t.firstChild,i=s.nextSibling,r=i.firstChild,n=r.firstChild,a=n.firstChild,o=a.nextSibling;return D(i,M(Ir,{when:!e,get children(){const l=R0(),h=l.firstChild,c=h.firstChild,u=c.nextSibling;return D(u,zi),l}}),r),D(o,Ri),t})(),N0=V('<dialog><h2>Brick breaker</h2><section class="actions"><button>Play'),j0=()=>{const[e,t]=K(!0),s=()=>{t(!1),S.emit("start")};return(()=>{const i=N0(),r=i.firstChild,n=r.nextSibling,a=n.firstChild;return D(i,M(Ps,{highScoreOnly:!0}),n),D(i,M(nn,{}),n),D(i,M(rn,{}),n),D(i,M(sn,{}),n),a.$$click=s,H(()=>i.open=e()),i})()};ce(["click"]);const U0=V('<dialog><h2>Game Over</h2><section class="actions"><button>Start'),F0=()=>{const e=()=>S.emit("startClick");return(()=>{const t=U0(),s=t.firstChild,i=s.nextSibling,r=i.firstChild;return D(t,M(Ps,{}),i),D(t,M(nn,{}),i),D(t,M(rn,{}),i),D(t,M(sn,{}),i),r.$$click=e,H(()=>t.open=Li()),t})()};ce(["click"]);const H0=V('<svg stroke-width="0"></svg>',2),G0=V("<title></title>",2);function He(e,t){const s=Ks(e.a,t),[i,r]=Mr(s,["src"]);return(()=>{const n=H0.cloneNode(!0);return k0(n,Ks({get stroke(){return e.a.stroke},get color(){return t.color||"currentColor"},get fill(){return t.color||"currentColor"},get style(){return{...t.style,overflow:"visible"}}},r,{get height(){return t.size||"1em"},get width(){return t.size||"1em"},get innerHTML(){return e.c},xmlns:"http://www.w3.org/2000/svg"}),!0,!0),D(n,()=>P0,null),D(n,(()=>{const a=se(()=>!!t.title);return()=>a()&&(()=>{const o=G0.cloneNode(!0);return D(o,()=>t.title),o})()})(),null),n})()}function an(e){return He({a:{viewBox:"0 0 24 24"},c:'<path d="M4 8H2v12a2 2 0 0 0 2 2h12v-2H4z"/><path d="M20 2H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm-9 12V6l7 4z"/>'},e)}const W0=V('<dialog><h2>Get extra life</h2><p>Watch a short ad to get one last chance to beat your high score.</p><section class="actions"><button>No, thanks</button><button>Watch ad <!> '),V0=()=>{const e=()=>{S.emit("getExtraLife",!1)},t=()=>{S.emit("getExtraLife",!0)};return(()=>{const s=W0(),i=s.firstChild,r=i.nextSibling,n=r.nextSibling,a=n.firstChild,o=a.nextSibling,l=o.firstChild,h=l.nextSibling;return h.nextSibling,a.$$click=e,o.$$click=t,D(o,M(an,{}),h),H(()=>s.open=ji()),s})()};ce(["click"]);function X0(e){return He({a:{xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-multiplier-2x",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},c:'<path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 16l4 -4"/><path d="M18 16l-4 -4"/><path d="M6 10a2 2 0 1 1 4 0c0 .591 -.417 1.318 -.816 1.858l-3.184 4.143l4 0"/>'},e)}function K0(e){return He({a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path fill-rule="evenodd" d="M12.75 8a4.5 4.5 0 0 1-8.61 1.834l-1.391.565A6.001 6.001 0 0 0 14.25 8 6 6 0 0 0 3.5 4.334V2.5H2v4l.75.75h3.5v-1.5H4.352A4.5 4.5 0 0 1 12.75 8z" clip-rule="evenodd"/>'},e)}function Y0(e){return He({a:{viewBox:"0 0 16 16"},c:'<path fill="currentColor" d="M12 2v12h-2V8.5l-5 5v-11l5 5V2z"/>'},e)}const q0=V('<dialog><h2>You win! <span class="emoji">🎉</span></h2><section class="actions"><button>Double score</button><button>Restart </button><button>Next '),Z0=()=>{const[e,t]=K(!1),s=()=>S.emit("doubleWin"),i=()=>S.emit("restartStage"),r=()=>S.emit("nextStage");return vr(()=>{t(Ut()===R.Bonus)},[Ut()]),(()=>{const n=q0(),a=n.firstChild,o=a.nextSibling,l=o.firstChild;l.firstChild;const h=l.nextSibling;h.firstChild;const c=h.nextSibling;return c.firstChild,D(n,M(Ps,{}),o),l.$$click=s,D(l,M(X0,{}),null),D(l,M(an,{}),null),h.$$click=i,D(h,M(K0,{}),null),c.$$click=r,D(c,M(Y0,{}),null),H(u=>{const f=Ni(),m=e();return f!==u._v$&&(n.open=u._v$=f),m!==u._v$2&&(h.disabled=u._v$2=m),u},{_v$:void 0,_v$2:void 0}),n})()};ce(["click"]);window.CrazyGames.SDK.game.sdkGameLoadingStart().then(()=>console.info("CrazyGames SDK loading started")).catch(e=>{console.error(`Error while loading CrazyGames SDK: ${e}`)});S0(()=>[M(j0,{}),M(F0,{}),M(Z0,{}),M(V0,{})],document.body);window.CrazyGames.SDK.game.sdkGameLoadingStop().then(()=>console.info("CrazyGames SDK loading stopped")).catch(e=>{console.error(`Error while stopping CrazyGames SDK loading: ${e}`)});
//# sourceMappingURL=index-eb812bc6.js.map
